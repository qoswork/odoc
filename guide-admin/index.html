<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Copyright (c) 2015-2018 The OpenNMS Group, Inc.">
<title>管理员指南</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #212121; padding: 0; margin: 0; font-family: "Roboto", sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.stretch { width: 100%; }

p.lead { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #212121; font-weight: 300; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #212121; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #4d9c2d; }
a img { border: none; }

#content a { color: #212121; text-decoration: none; border-bottom: 0.75px dashed #212121; line-height: inherit; }
#content a:hover, a:focus { color: #4d9c2d; border-bottom: 0.75px dashed #4d9c2d; }
#content a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Roboto", sans-serif; font-weight: bold; font-style: normal; color: #444; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Roboto Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #212121; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #212121; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #212121; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f7f7f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f7; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Roboto Mono", "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Roboto Mono", monospace; display: inline-block; color: #212121; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Roboto", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none !important;}
#toc a:active { text-decoration: none; }

#toctitle { color: #444; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f7f7f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f7f7f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #212121; padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

#content { margin-bottom: 0.625em; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { #content { margin-bottom: 1.25em; }
  .sect1 { padding-bottom: 1.25em; } }
.sect1:last-child { padding-bottom: 0; }

.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #444; text-decoration: none; font-weight: bold;}
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #444;}

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock { background-color: #f7f7f7; }
.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Roboto", Arial, Helvetica, sans-serif; font-size: 1rem; }

table.tableblock.fit-content > caption.title { white-space: nowrap; width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: 1.21875em; line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > [class="paragraph"]:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Roboto", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f7f7f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #444; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f7; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f7; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #444; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Roboto", sans-serif; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 1em 1.25em 1em; display: block; }
.quoteblock.abstract > .title { margin: 0 0 0.375em 0; font-size: 1.15em; text-align: center; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { word-spacing: 0; line-height: 1.6; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract p:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }

p.tableblock:last-child { margin-bottom: 0; }

td.tableblock > .content { margin-bottom: -1.25em; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 1px 1px 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 1px 1px 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 1px 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 1px 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 1px 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot, table.frame-ends { border-width: 1px 0; }

table.stripes-all tr, table.stripes-odd tr:nth-of-type(odd) { background: #f7f7f7; }

table.stripes-none tr, table.stripes-odd tr:nth-of-type(even) { background: none; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #212121; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { display: -ms-flexbox; display: -webkit-box; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; list-style: none; margin: 0 0 0.625em -1.25em; }

ul.inline > li { margin-left: 1.25em; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist td:not([class]):first-child { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist td:not([class]):first-child img { max-width: none; }
.colist td:not([class]):last-child { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; margin-left: -1.05em; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #3465a4; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; color: #444; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #f57900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #cc0000; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #cc0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #212121; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Roboto", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@page { margin: 1.25cm 0.75cm; }

@media print { * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  html { font-size: 80%; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { padding: 0 0.9375em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
@media print, amzn-kf8 { #header > h1:first-child { margin-top: 1.25rem; }
  .sect1 { padding: 0 !important; }
  .sect1 + .sect1 { border: 0; }
  #footer { background: none; }
  #footer-text { color: rgba(0, 0, 0, 0.6); font-size: 0.9em; } }
@media amzn-kf8 { #header, #content, #footnotes, #footer { padding: 0; } }

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body id="ga" class="book toc2 toc-left">
<div id="header">
<h1>管理员指南</h1>
<div class="details">
<span id="author" class="author">Copyright (c) 2015-2018 The OpenNMS Group, Inc.</span><br>
<span id="revnumber"> OpenNMS Horizon 23.0.1,</span>
<span id="revdate">Last updated 2018-12-22 11:30:11 CST</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#ga-admin-datachoices">1. 数据选择</a></li>
<li><a href="#ga-role-user-management">2. 用户管理</a>
<ul class="sectlevel2">
<li><a href="#ga-role-user-management-users">2.1. 用户</a></li>
<li><a href="#ga-role-user-management-roles">2.2. 安全角色</a></li>
<li><a href="#ga-role-user-management-pre-authentication">2.3. Web UI Pre-Authentication</a>
<ul class="sectlevel3">
<li><a href="#_启用_pre_authentication">2.3.1. 启用 Pre-Authentication</a></li>
<li><a href="#_配置_pre_authentication">2.3.2. 配置 Pre-Authentication</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-admin-ui">3. 管理 Web 界面</a>
<ul class="sectlevel2">
<li><a href="#ga-surveillance-view">3.1. 监视视图</a>
<ul class="sectlevel3">
<li><a href="#_默认监视视图配置">3.1.1. 默认监视视图配置</a></li>
<li><a href="#_配置监控视图">3.1.2. 配置监控视图</a></li>
<li><a href="#_分类设备">3.1.3. 分类设备</a></li>
<li><a href="#_为用户和组创建视图">3.1.4. 为用户和组创建视图</a></li>
</ul>
</li>
<li><a href="#ga-dashboard-view">3.2. Dashboard</a>
<ul class="sectlevel3">
<li><a href="#ga-dashboard-components">3.2.1. 组件</a></li>
<li><a href="#ga-dashboard-advanced-configuration">3.2.2. 高级配置</a></li>
</ul>
</li>
<li><a href="#ga-admin-ui-start-page">3.3. Grafana Dashboard Box</a></li>
<li><a href="#ga-admin-ui-ops-board">3.4. Operator Board</a>
<ul class="sectlevel3">
<li><a href="#_配置">3.4.1. 配置</a></li>
<li><a href="#_dashlets">3.4.2. Dashlets</a></li>
<li><a href="#webui-opsboard-dashlet-boosting">3.4.3. 提升 <em>Dashlet</em></a></li>
<li><a href="#webui-opsboard-criteria-builder">3.4.4. Criteria Builder</a></li>
</ul>
</li>
<li><a href="#ga-admin-ui-jmx-config-generator">3.5. JMX 配置生成器</a>
<ul class="sectlevel3">
<li><a href="#_基于_web_的工具">3.5.1. 基于 Web 的工具</a></li>
<li><a href="#_cli_based_utility">3.5.2. CLI based utility</a></li>
</ul>
</li>
<li><a href="#ga-admin-ui-heatmap">3.6. Heatmap</a></li>
<li><a href="#ga-admin-ui-trend">3.7. Trend</a></li>
</ul>
</li>
<li><a href="#ga-service-assurance">4. 服务保障</a>
<ul class="sectlevel2">
<li><a href="#ga-pollerd-configuration">4.1. Pollerd 配置</a></li>
<li><a href="#ga-service-assurance-critical-service">4.2. 关键服务</a></li>
<li><a href="#ga-service-assurance-downtime-model">4.3. Downtime Model</a></li>
<li><a href="#ga-service-assurance-path-outage">4.4. Path Outages（路径故障）</a></li>
<li><a href="#ga-pollerd-packages">4.5. Polling Packages（轮询包）</a>
<ul class="sectlevel3">
<li><a href="#ga-pollerd-packages-response-time-config">4.5.1. 响应时间配置</a></li>
<li><a href="#ga-pollerd-packages-overlapping-service">4.5.2. 覆盖服务</a></li>
<li><a href="#ga-pollerd-packages-test-service-manually">4.5.3. 手动测试服务</a></li>
<li><a href="#_在_karaf_shell_上测试过滤器">4.5.4. 在 Karaf Shell 上测试过滤器</a></li>
</ul>
</li>
<li><a href="#ga-service-monitors">4.6. 服务监测器</a>
<ul class="sectlevel3">
<li><a href="#ga-service-assurance-monitors-common-parameters">4.6.1. 常见配置参数</a></li>
<li><a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">4.6.2. 在参数中使用占位符</a></li>
<li><a href="#_availabilitymonitor">4.6.3. AvailabilityMonitor</a></li>
<li><a href="#_bgpsessionmonitor">4.6.4. BgpSessionMonitor</a></li>
<li><a href="#_bsfmonitor">4.6.5. BSFMonitor</a></li>
<li><a href="#_ciscoipslamonitor">4.6.6. CiscoIpSlaMonitor</a></li>
<li><a href="#_ciscopingmibmonitor">4.6.7. CiscoPingMibMonitor</a></li>
<li><a href="#_citrixmonitor">4.6.8. CitrixMonitor</a></li>
<li><a href="#_dhcpmonitor">4.6.9. DhcpMonitor</a></li>
<li><a href="#_diskusagemonitor">4.6.10. DiskUsageMonitor</a></li>
<li><a href="#_dnsmonitor">4.6.11. DnsMonitor</a></li>
<li><a href="#poller-dns-resolution-monitor">4.6.12. DNSResolutionMonitor</a></li>
<li><a href="#_ftpmonitor">4.6.13. FtpMonitor</a></li>
<li><a href="#_hostresourceswrunmonitor">4.6.14. HostResourceSwRunMonitor</a></li>
<li><a href="#poller-http-monitor">4.6.15. HttpMonitor</a></li>
<li><a href="#_httppostmonitor">4.6.16. HttpPostMonitor</a></li>
<li><a href="#_httpsmonitor">4.6.17. HttpsMonitor</a></li>
<li><a href="#poller-icmp-monitor">4.6.18. IcmpMonitor</a></li>
<li><a href="#poller-imap-monitor">4.6.19. ImapMonitor</a></li>
<li><a href="#_imapsmonitor">4.6.20. ImapsMonitor</a></li>
<li><a href="#_jcifsmonitor">4.6.21. JCifsMonitor</a></li>
<li><a href="#_jdbcmonitor">4.6.22. JDBCMonitor</a></li>
<li><a href="#_jdbcstoredproceduremonitor">4.6.23. JDBCStoredProcedureMonitor</a></li>
<li><a href="#_jdbcquerymonitor">4.6.24. JDBCQueryMonitor</a></li>
<li><a href="#poller-jmx-monitor">4.6.25. JmxMonitor</a></li>
<li><a href="#_jolokiabeanmonitor">4.6.26. JolokiaBeanMonitor</a></li>
<li><a href="#poller-ldap-monitor">4.6.27. LdapMonitor</a></li>
<li><a href="#_ldapsmonitor">4.6.28. LdapsMonitor</a></li>
<li><a href="#_memcachedmonitor">4.6.29. MemcachedMonitor</a></li>
<li><a href="#_netscalergrouphealthmonitor">4.6.30. NetScalerGroupHealthMonitor</a></li>
<li><a href="#_nrpemonitor">4.6.31. NrpeMonitor</a></li>
<li><a href="#_ntpmonitor">4.6.32. NtpMonitor</a></li>
<li><a href="#OmsaStorageMonitor">4.6.33. OmsaStorageMonitor</a></li>
<li><a href="#_openmanagechassismonitor">4.6.34. OpenManageChassisMonitor</a></li>
<li><a href="#_pagesequencemonitor">4.6.35. PageSequenceMonitor</a></li>
<li><a href="#_percmonitor">4.6.36. PercMonitor</a></li>
<li><a href="#_pop3monitor">4.6.37. Pop3Monitor</a></li>
<li><a href="#_prtablemonitor">4.6.38. PrTableMonitor</a></li>
<li><a href="#_radiusauthmonitor">4.6.39. RadiusAuthMonitor</a></li>
<li><a href="#_smbmonitor">4.6.40. SmbMonitor</a></li>
<li><a href="#_snmpmonitor">4.6.41. SnmpMonitor</a></li>
<li><a href="#_sshmonitor">4.6.42. SshMonitor</a></li>
<li><a href="#_sslcertmonitor">4.6.43. SSLCertMonitor</a></li>
<li><a href="#_strafepingmonitor">4.6.44. StrafePingMonitor</a></li>
<li><a href="#_tcpmonitor">4.6.45. TcpMonitor</a></li>
<li><a href="#_systemexecutemonitor">4.6.46. SystemExecuteMonitor</a></li>
<li><a href="#_vmwarecimmonitor">4.6.47. VmwareCimMonitor</a></li>
<li><a href="#_vmwaremonitor">4.6.48. VmwareMonitor</a></li>
<li><a href="#_webmonitor">4.6.49. WebMonitor</a></li>
<li><a href="#_win32servicemonitor">4.6.50. Win32ServiceMonitor</a></li>
<li><a href="#_wsmanmonitor">4.6.51. WsManMonitor</a></li>
<li><a href="#_xmpmonitor">4.6.52. XmpMonitor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-performance-mgmt">5. 性能管理</a>
<ul class="sectlevel2">
<li><a href="#ga-collectd-configuration">5.1. Collectd 配置</a>
<ul class="sectlevel3">
<li><a href="#ga-performance-management-collectd-resource-types">5.1.1. 资源类型</a></li>
</ul>
</li>
<li><a href="#ga-collectd-packages">5.2. 采集包</a>
<ul class="sectlevel3">
<li><a href="#ga-collectd-packages-services">5.2.1. 服务(Service)配置</a></li>
</ul>
</li>
<li><a href="#ga-performance-mgmt-collectors">5.3. 采集器</a>
<ul class="sectlevel3">
<li><a href="#_snmpcollector">5.3.1. SnmpCollector</a></li>
<li><a href="#_httpcollector">5.3.2. HttpCollector</a></li>
<li><a href="#_jdbccollector">5.3.3. JdbcCollector</a></li>
<li><a href="#_jmxcollector">5.3.4. JmxCollector</a></li>
<li><a href="#_nsclientcollector">5.3.5. NSClientCollector</a></li>
<li><a href="#_tcacollector">5.3.6. TcaCollector</a></li>
<li><a href="#_vmwarecimcollector">5.3.7. VmwareCimCollector</a></li>
<li><a href="#_vmwarecollector">5.3.8. VmwareCollector</a></li>
<li><a href="#_wmicollector">5.3.9. WmiCollector</a></li>
<li><a href="#ga-performance-mgmt-collectors-wsman-collector">5.3.10. WsManCollector</a></li>
<li><a href="#_xmlcollector">5.3.11. XmlCollector</a></li>
<li><a href="#_xmpcollector">5.3.12. XmpCollector</a></li>
</ul>
</li>
<li><a href="#ga-performance-mgmt-shell">5.4. Shell Commands</a>
<ul class="sectlevel3">
<li><a href="#ga-performance-mgmt-adhoc-collection">5.4.1. 点对点采集</a></li>
<li><a href="#_输出说明">5.4.2. 输出说明</a></li>
<li><a href="#ga-performance-mgmt-stress-testing">5.4.3. 压力测试</a></li>
<li><a href="#_解释输出">5.4.4. 解释输出</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-events">6. 事件</a>
<ul class="sectlevel2">
<li><a href="#ga-events-anatomy-of-an-event">6.1. 事件分析</a></li>
<li><a href="#ga-events-sources-of-events">6.2. 事件源</a>
<ul class="sectlevel3">
<li><a href="#ga-events-sources-snmp-traps">6.2.1. SNMP Traps</a></li>
<li><a href="#ga-events-sources-syslog">6.2.2. Syslog 消息</a></li>
<li><a href="#ga-events-sources-rest">6.2.3. ReST</a></li>
<li><a href="#ga-events-sources-xml-tcp">6.2.4. XML-TCP</a></li>
<li><a href="#ga-events-sources-eif">6.2.5. 接收 IBM Tivoli 收集整合的事件</a></li>
<li><a href="#ga-events-sources-tl1">6.2.6. TL1 自主消息</a></li>
<li><a href="#ga-events-sources-sink-api">6.2.7. Sink</a></li>
</ul>
</li>
<li><a href="#ga-events-event-bus">6.3. 事件总线</a>
<ul class="sectlevel3">
<li><a href="#_将事件关联到指定设备">6.3.1. 将事件关联到指定设备</a></li>
</ul>
</li>
<li><a href="#ga-events-event-configuration">6.4. 事件配置</a>
<ul class="sectlevel3">
<li><a href="#_配置文件_eventd_configuration_xml">6.4.1. 配置文件 eventd-configuration.xml</a></li>
<li><a href="#_配置文件_eventconf_xml_及其分支配置">6.4.2. 配置文件 eventconf.xml 及其分支配置</a></li>
<li><a href="#_重新加载事件配置">6.4.3. 重新加载事件配置</a></li>
</ul>
</li>
<li><a href="#_调试_2">6.5. 调试</a></li>
</ul>
</li>
<li><a href="#ga-alarms">7. 告警</a>
<ul class="sectlevel2">
<li><a href="#_单告警跟踪问题状态">7.1. 单告警跟踪问题状态</a></li>
<li><a href="#_告警模块">7.2. 告警模块</a></li>
<li><a href="#ga-alarmd-configuration">7.3. 配置告警</a></li>
<li><a href="#ga-alarm-notes">7.4. 告警注释</a></li>
<li><a href="#ga-alarm-sounds">7.5. 告警声音</a></li>
<li><a href="#_活动告警闪烁">7.6. 活动告警闪烁</a></li>
<li><a href="#_配置告警声音和闪烁">7.7. 配置告警声音和闪烁</a></li>
</ul>
</li>
<li><a href="#ga-notifications">8. 通知</a>
<ul class="sectlevel2">
<li><a href="#ga-notifications-introduction">8.1. 介绍</a></li>
<li><a href="#ga-notifications-getting-started">8.2. 入门</a>
<ul class="sectlevel3">
<li><a href="#_启用通知">8.2.1. 启用通知</a></li>
<li><a href="#_配置目标路径">8.2.2. 配置目标路径</a></li>
<li><a href="#_配置事件通知">8.2.3. 配置事件通知</a></li>
</ul>
</li>
<li><a href="#ga-notifications-concepts">8.3. 概念</a>
<ul class="sectlevel3">
<li><a href="#_事件和_ueis">8.3.1. 事件和 UEIs</a></li>
<li><a href="#_用户组和计划角色">8.3.2. 用户，组，和计划角色</a></li>
<li><a href="#_值班计划">8.3.3. 值班计划</a></li>
<li><a href="#_目的路径">8.3.4. 目的路径</a></li>
<li><a href="#_通知命令">8.3.5. 通知命令</a></li>
</ul>
</li>
<li><a href="#ga-notifications-bonus-strategies">8.4. 新通知方法</a>
<ul class="sectlevel3">
<li><a href="#ga-notifications-strategy-mattermost">8.4.1. Mattermost</a></li>
<li><a href="#ga-notifications-strategy-slack">8.4.2. Slack 通知</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-provisioning">9. Provisioning（探针）</a>
<ul class="sectlevel2">
<li><a href="#ga-provisioning-introduction">9.1. 介绍</a></li>
<li><a href="#_概念">9.2. 概念</a>
<ul class="sectlevel3">
<li><a href="#_术语">9.2.1. 术语</a></li>
<li><a href="#_地址可伸缩">9.2.2. 地址可伸缩</a></li>
</ul>
</li>
<li><a href="#_入门">9.3. 入门</a>
<ul class="sectlevel3">
<li><a href="#_提供_snmp_配置">9.3.1. 提供 SNMP 配置</a></li>
<li><a href="#_自动发现_2">9.3.2. 自动发现</a></li>
<li><a href="#_增强的定向发现_2">9.3.3. 增强的定向发现</a></li>
</ul>
</li>
<li><a href="#_导入处理程序">9.4. 导入处理程序</a>
<ul class="sectlevel3">
<li><a href="#_通用处理程序">9.4.1. 通用处理程序</a></li>
<li><a href="#_文件处理程序">9.4.2. 文件处理程序</a></li>
<li><a href="#_http_处理程序">9.4.3. HTTP 处理程序</a></li>
<li><a href="#_dns_处理程序">9.4.4. DNS 处理程序</a></li>
</ul>
</li>
<li><a href="#_provisioning_实例">9.5. Provisioning 实例</a>
<ul class="sectlevel3">
<li><a href="#_基本的_provisioning">9.5.1. 基本的 Provisioning</a></li>
<li><a href="#_provisioning_高级配置示例">9.5.2. Provisioning 高级配置示例</a></li>
</ul>
</li>
<li><a href="#_适配器">9.6. 适配器</a>
<ul class="sectlevel3">
<li><a href="#_ddns_适配器">9.6.1. DDNS 适配器</a></li>
<li><a href="#_rancid_适配器">9.6.2. RANCID 适配器</a></li>
</ul>
</li>
<li><a href="#_整合_provisiond">9.7. 整合 Provisiond</a>
<ul class="sectlevel3">
<li><a href="#_provisioning_groups_设备">9.7.1. Provisioning Groups 设备</a></li>
<li><a href="#_例子">9.7.2. 例子</a></li>
</ul>
</li>
<li><a href="#_provisioning_单个设备_快速添加设备">9.8. Provisioning 单个设备 (快速添加设备)</a></li>
<li><a href="#_使用_provision_pl_配置_provisioning">9.9. 使用 <em>provision.pl</em> 配置 Provisioning</a>
<ul class="sectlevel3">
<li><a href="#_创建一个新_requisition">9.9.1. 创建一个新 requisition</a></li>
</ul>
</li>
<li><a href="#_其它_api_示例">9.10. 其它 API 示例</a></li>
<li><a href="#ga-provisioning-detectors">9.11. 服务探测器</a>
<ul class="sectlevel3">
<li><a href="#_http_探测器">9.11.1. HTTP 探测器</a></li>
<li><a href="#_https_探测器">9.11.2. HTTPS 探测器</a></li>
<li><a href="#_snmp_探测器">9.11.3. SNMP 探测器</a></li>
<li><a href="#_ws_man_探测器">9.11.4. WS-Man 探测器</a></li>
<li><a href="#_ws_man_wql_探测器">9.11.5. WS-Man WQL 探测器</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-bsm">10. Business Service Monitoring</a>
<ul class="sectlevel2">
<li><a href="#_business_service_hierarchy">10.1. Business Service Hierarchy</a></li>
<li><a href="#gu-bsm-op-status">10.2. Operational status</a></li>
<li><a href="#gu-bsm-rc-imp-analysis">10.3. Root Cause and Impact Analysis</a></li>
<li><a href="#gu-bsm-sim-mode">10.4. Simulation Mode</a></li>
<li><a href="#gu-bsm-share-view">10.5. Share View</a></li>
<li><a href="#gu-bsm-change-iconset">10.6. Change Icons</a></li>
<li><a href="#_business_service_definition">10.7. Business Service Definition</a></li>
<li><a href="#_edges">10.8. Edges</a>
<ul class="sectlevel3">
<li><a href="#_child_services">10.8.1. Child Services</a></li>
<li><a href="#_ip_services">10.8.2. IP Services</a></li>
<li><a href="#_custom_reduction_key">10.8.3. Custom Reduction Key</a></li>
</ul>
</li>
<li><a href="#_map_functions">10.9. Map Functions</a></li>
<li><a href="#_reduce_functions">10.10. Reduce Functions</a></li>
<li><a href="#_business_service_daemon">10.11. Business Service Daemon</a></li>
</ul>
</li>
<li><a href="#ga-topology">11. Topology Map</a>
<ul class="sectlevel2">
<li><a href="#_properties">11.1. Properties</a></li>
<li><a href="#_icons">11.2. Icons</a>
<ul class="sectlevel3">
<li><a href="#_icon_resolution">11.2.1. Icon resolution</a></li>
<li><a href="#_change_existing_icon_mappings">11.2.2. Change existing icon mappings</a></li>
<li><a href="#ga-topology-add-icons">11.2.3. Add new icons</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_asset_topology_provider">12. Asset Topology Provider</a>
<ul class="sectlevel2">
<li><a href="#_overview">12.1. Overview</a></li>
<li><a href="#_asset_layers">12.2. Asset layers</a></li>
<li><a href="#_node_filtering">12.3. Node filtering</a></li>
<li><a href="#_configuration">12.4. Configuration</a></li>
<li><a href="#_creating_asset_based_topologies_from_karaf_consol">12.5. Creating Asset Based Topologies From Karaf Consol</a></li>
<li><a href="#_creating_asset_based_topologies_using_opennms_horizon_events">12.6. Creating Asset Based Topologies Using <em>OpenNMS Horizon</em> events</a></li>
<li><a href="#_viewing_the_topology">12.7. Viewing the topology</a></li>
<li><a href="#_additional_notes">12.8. Additional notes</a></li>
</ul>
</li>
<li><a href="#ga-database-reports">13. Database Reports</a>
<ul class="sectlevel2">
<li><a href="#ga-database-reports-overview">13.1. Overview</a></li>
<li><a href="#ga-database-report-add-custom-report">13.2. Modify existing reports</a></li>
<li><a href="#_add_a_custom_report">13.3. Add a custom report</a></li>
<li><a href="#ga-database-reports-usage-jaspersoft-studio">13.4. Usage of Jaspersoft Studio</a>
<ul class="sectlevel3">
<li><a href="#ga-database-reports-connect-database">13.4.1. Connect to the OpenNMS Horizon Database</a></li>
<li><a href="#ga-database-reports-measurement-ds-helpers">13.4.2. Use Measurements Datasource and Helpers</a></li>
</ul>
</li>
<li><a href="#ga-database-reports-access-performance-data">13.5. Accessing Performance Data</a>
<ul class="sectlevel3">
<li><a href="#ga-database-reports-fields">13.5.1. Fields</a></li>
<li><a href="#ga-database-reports-parameters">13.5.2. Parameters</a></li>
</ul>
</li>
<li><a href="#ga-database-reports-helper-methods">13.6. Helper methods</a>
<ul class="sectlevel3">
<li><a href="#ga-database-reports-node-source-descriptor">13.6.1. Usage of the node source descriptor</a></li>
<li><a href="#ga-database-reports-interface-descriptor">13.6.2. Usage of the interface descriptor</a></li>
<li><a href="#ga-database-reports-https">13.6.3. Use HTTPS</a></li>
</ul>
</li>
<li><a href="#ga-database-reports-limitations">13.7. Limitations</a></li>
</ul>
</li>
<li><a href="#ga-enlinkd">14. 增强的链路发现 (Enlinkd)</a>
<ul class="sectlevel2">
<li><a href="#ga-enlinkd-daemon">14.1. Enlinkd 模块</a></li>
<li><a href="#ga-enlinkd-layer-2-link-discovery">14.2. 2层链路发现</a>
<ul class="sectlevel3">
<li><a href="#_lldp_发现">14.2.1. LLDP 发现</a></li>
<li><a href="#_cdp_发现">14.2.2. CDP 发现</a></li>
<li><a href="#_透明网桥发现">14.2.3. 透明网桥发现</a></li>
</ul>
</li>
<li><a href="#ga-enlinkd-layer-3-link-discovery">14.3. 3层链路发现</a>
<ul class="sectlevel3">
<li><a href="#_ospf_发现">14.3.1. OSPF 发现</a></li>
<li><a href="#_is_is_发现">14.3.2. IS-IS 发现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-opennms-operation">15. 操作</a>
<ul class="sectlevel2">
<li><a href="#ga-operation-https-ssl">15.1. HTTPS / SSL</a>
<ul class="sectlevel3">
<li><a href="#ga-operation-standalone-https-jetty">15.1.1. Standalone HTTPS with Jetty</a></li>
<li><a href="#ga-operation-https-client">15.1.2. OpenNMS Horizon as HTTPS client</a></li>
<li><a href="#ga-operation-trust-store-key-store">15.1.3. Differences between <em>Java Trust Store</em> and <em>Java Key Store</em></a></li>
<li><a href="#ga-operation-ssl-properties">15.1.4. Debugging / Properties</a></li>
</ul>
</li>
<li><a href="#ga-operation-request-logging">15.2. Request Logging</a></li>
<li><a href="#_geocoder_service">15.3. Geocoder Service</a></li>
<li><a href="#_resourcecli_simple_resource_management_tool">15.4. resourcecli: simple resource management tool</a>
<ul class="sectlevel3">
<li><a href="#_usage_2">15.4.1. Usage</a></li>
<li><a href="#_sub_command_list">15.4.2. Sub-command: list</a></li>
<li><a href="#_sub_command_show">15.4.3. Sub-command: show</a></li>
<li><a href="#_sub_command_delete">15.4.4. Sub-command: delete</a></li>
</ul>
</li>
<li><a href="#_newts_repository_converter_rrdjrb_to_newts_migration_utility">15.5. newts-repository-converter: Rrd/Jrb to Newts migration utility</a>
<ul class="sectlevel3">
<li><a href="#_migration">15.5.1. Migration</a></li>
<li><a href="#_usage_3">15.5.2. Usage</a></li>
<li><a href="#_example_1_convert_rrd_based_data_with_storebygroup_enabled">15.5.3. Example 1: convert Rrd-based data with storeByGroup enabled</a></li>
<li><a href="#_example_2_convert_jrobin_based_data_with_storebygroup_disabled">15.5.4. Example 2: convert JRobin-based data with storeByGroup disabled</a></li>
</ul>
</li>
<li><a href="#ga-opennms-operation-newts">15.6. Newts (新时间序列)</a>
<ul class="sectlevel3">
<li><a href="#_配置_2">15.6.1. 配置</a></li>
<li><a href="#_cassandra_monitoring">15.6.2. Cassandra Monitoring</a></li>
<li><a href="#_newts_monitoring">15.6.3. Newts Monitoring</a></li>
</ul>
</li>
<li><a href="#ga-opennms-operation-daemon-config-files">15.7. 模块（Daemon）配置文件</a>
<ul class="sectlevel3">
<li><a href="#ga-opennms-operation-daemon-config-files-eventd">15.7.1. Eventd（事件模块）</a></li>
<li><a href="#ga-opennms-operation-daemon-config-files-notifd">15.7.2. Notifd（通知模块）</a></li>
<li><a href="#ga-opennms-operation-daemon-config-files-pollerd">15.7.3. Pollerd（轮询模块）</a></li>
<li><a href="#ga-opennms-operation-daemon-config-files-syslogd">15.7.4. Syslogd</a></li>
<li><a href="#ga-opennms-operation-daemon-config-files-trapd">15.7.5. Trapd</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-opennms-system-properties">16. 系统属性</a></li>
<li><a href="#ga-ticketing">17. Ticketing</a>
<ul class="sectlevel2">
<li><a href="#ga-ticketing-jira">17.1. JIRA Ticketing Plugin</a>
<ul class="sectlevel3">
<li><a href="#ga-ticketing-jira-setup">17.1.1. Setup</a></li>
<li><a href="#_jira_commands">17.1.2. Jira Commands</a></li>
<li><a href="#_custom_fields">17.1.3. Custom fields</a></li>
<li><a href="#ga-ticketing-jira-troubleshooting">17.1.4. Troubleshooting</a></li>
</ul>
</li>
<li><a href="#ga-ticketing-remedy">17.2. Remedy Ticketing Plugin</a>
<ul class="sectlevel3">
<li><a href="#_remedy_product_overview">17.2.1. Remedy Product Overview</a></li>
<li><a href="#_supported_remedy_product_versions">17.2.2. Supported Remedy Product Versions</a></li>
<li><a href="#ga-ticketing-remedy-setup">17.2.3. Setup</a></li>
</ul>
</li>
<li><a href="#ga-ticketing-tsrm">17.3. TSRM Ticketing Plugin</a>
<ul class="sectlevel3">
<li><a href="#ga-ticketing-tsrm-setup">17.3.1. Setup</a></li>
<li><a href="#_mapping_opennms_ticket_with_tsrm_incident">17.3.2. Mapping OpenNMS Ticket with TSRM Incident</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-rmi">18. Enabling RMI</a>
<ul class="sectlevel2">
<li><a href="#_enabling_rmi">18.1. Enabling RMI</a></li>
<li><a href="#_enabling_ssl">18.2. Enabling SSL</a></li>
<li><a href="#_connecting_to_rmi_over_ssl">18.3. Connecting to RMI over SSL</a></li>
</ul>
</li>
<li><a href="#ga-minion">19. Minion</a>
<ul class="sectlevel2">
<li><a href="#ga-minion-kafka">19.1. 使用 Kafka 接收 ( Traps 和 Syslog)</a>
<ul class="sectlevel3">
<li><a href="#_消费者配置">19.1.1. 消费者配置</a></li>
<li><a href="#ga-minion-kafka-producer-configuration">19.1.2. 生产者配置</a></li>
</ul>
</li>
<li><a href="#_使用_kafka_进行_rpc">19.2. 使用 Kafka 进行 RPC</a>
<ul class="sectlevel3">
<li><a href="#_客户端opennms_配置">19.2.1. 客户端(OpenNMS) 配置</a></li>
<li><a href="#_服务器_minion_配置">19.2.2. 服务器 (Minion) 配置</a></li>
</ul>
</li>
<li><a href="#_使用_aws_sqs">19.3. 使用 AWS SQS</a>
<ul class="sectlevel3">
<li><a href="#_opennms_horizon_配置">19.3.1. <em>OpenNMS Horizon</em> 配置</a></li>
<li><a href="#_minion_配置">19.3.2. Minion 配置</a></li>
<li><a href="#_sqs_配置">19.3.3. SQS 配置</a></li>
<li><a href="#_管理多个环境">19.3.4. 管理多个环境</a></li>
<li><a href="#_aws_证书">19.3.5. AWS 证书</a></li>
<li><a href="#_限制">19.3.6. 限制</a></li>
</ul>
</li>
<li><a href="#_使用_off_heap离线堆存储接收消息">19.4. 使用 Off-heap（离线堆）存储接收消息</a>
<ul class="sectlevel3">
<li><a href="#_配置_off_heap离线堆存储">19.4.1. 配置 Off-heap（离线堆）存储</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-sentinel">20. Sentinel</a>
<ul class="sectlevel2">
<li><a href="#_限制_2">20.1. 限制</a></li>
<li><a href="#_安装">20.2. 安装</a></li>
<li><a href="#_启动清空">20.3. 启动清空</a></li>
<li><a href="#_配置_3">20.4. 配置</a>
<ul class="sectlevel3">
<li><a href="#_配置数据源">20.4.1. 配置数据源</a></li>
<li><a href="#_配置控制器">20.4.2. 配置控制器</a></li>
<li><a href="#_配置连接">20.4.3. 配置连接</a></li>
<li><a href="#_可用功能">20.4.4. 可用功能</a></li>
<li><a href="#_自动安装">20.4.5. 自动安装</a></li>
<li><a href="#_自动启动">20.4.6. 自动启动</a></li>
<li><a href="#_健康检查_故障排除">20.4.7. 健康检查 / 故障排除</a></li>
</ul>
</li>
<li><a href="#_flow_处理">20.5. Flow 处理</a>
<ul class="sectlevel3">
<li><a href="#_配置_sentinel">20.5.1. 配置 Sentinel</a></li>
<li><a href="#_配置_minion">20.5.2. 配置 Minion</a></li>
<li><a href="#_配置_opennms">20.5.3. 配置 OpenNMS</a></li>
<li><a href="#_自动配置_sentinel_的_flow_处理">20.5.4. 自动配置 Sentinel 的 flow 处理</a></li>
</ul>
</li>
<li><a href="#_将采集集合保存到_newts">20.6. 将采集集合保存到 Newts</a>
<ul class="sectlevel3">
<li><a href="#_适配器_2">20.6.1. 适配器</a></li>
<li><a href="#ga-sentinel-configure-newts">20.6.2. 配置 Newts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-opennms-plugin-manager">21. Plugin Manager</a>
<ul class="sectlevel2">
<li><a href="#_plugin_manager_ui">21.1. Plugin Manager UI</a></li>
<li><a href="#_plugin_manager_ui_panel">21.2. Plugin Manager UI panel</a></li>
<li><a href="#_setting_karaf_instance_data">21.3. Setting Karaf Instance Data</a></li>
<li><a href="#_manually_adding_a_managed_karaf_instance">21.4. Manually adding a managed <em>Karaf</em> instance</a></li>
<li><a href="#_installed_plugins">21.5. Installed Plugins</a></li>
<li><a href="#_available_plugins_server">21.6. Available Plugins Server</a></li>
<li><a href="#_installing_available_plugins">21.7. Installing Available Plugins</a></li>
<li><a href="#_plugins_manifest">21.8. Plugins Manifest</a></li>
<li><a href="#_installing_internal_plugins">21.9. Installing Internal Plugins</a></li>
<li><a href="#_installed_licences_panel">21.10. Installed Licences Panel</a></li>
<li><a href="#_adding_a_new_licence">21.11. Adding a New Licence</a></li>
<li><a href="#_licence_structure">21.12. Licence Structure</a></li>
</ul>
</li>
<li><a href="#_internal_plugins">22. Internal Plugins</a>
<ul class="sectlevel2">
<li><a href="#_internal_plugins_supplied_with_opennms_horizon">22.1. Internal Plugins supplied with <em>OpenNMS Horizon</em></a></li>
<li><a href="#_installing_plugins_with_the_karaf_consol">22.2. Installing Plugins with the Karaf Consol</a></li>
<li><a href="#ga-internal-plugins-alarm-change-notifier">22.3. Alarm Change Notifier Plugin</a></li>
<li><a href="#_elasticsearch_rest_plugin">22.4. Elasticsearch ReST plugin</a></li>
</ul>
</li>
<li><a href="#ga-special-cases-and-workarounds">23. Special Cases and Workarounds</a>
<ul class="sectlevel2">
<li><a href="#_overriding_snmp_client_behavior">23.1. Overriding SNMP Client Behavior</a></li>
</ul>
</li>
<li><a href="#ga-ifttt">24. IFTTT Integration</a>
<ul class="sectlevel2">
<li><a href="#_ifttt_configuration">24.1. IFTTT Configuration</a></li>
<li><a href="#_opennms_configuration">24.2. OpenNMS Configuration</a></li>
<li><a href="#_example">24.3. Example</a></li>
</ul>
</li>
<li><a href="#ga-telemetryd">25. Telemetry 模块(Daemon)</a>
<ul class="sectlevel2">
<li><a href="#_什么是侦听器listener">25.1. 什么是侦听器(Listener)</a></li>
<li><a href="#_什么是适配器adapter">25.2. 什么是适配器(Adapter)</a></li>
<li><a href="#_什么是协议">25.3. 什么是协议</a></li>
<li><a href="#_通过_minion_推送传感器数据">25.4. 通过 Minion 推送传感器数据</a></li>
<li><a href="#ga-telemetryd-protocols">25.5. 协议参考</a>
<ul class="sectlevel3">
<li><a href="#_ipfix_接口">25.5.1. IPFIX 接口</a></li>
<li><a href="#_junos_telemetry_接口">25.5.2. Junos Telemetry 接口</a></li>
<li><a href="#_netflow_v5_接口">25.5.3. NetFlow v5 接口</a></li>
<li><a href="#_netflow_v9_接口">25.5.4. NetFlow v9 接口</a></li>
<li><a href="#_cisco_nx_os_telemetry">25.5.5. Cisco NX-OS Telemetry</a></li>
<li><a href="#_sflow_接口">25.5.6. sFlow 接口</a></li>
</ul>
</li>
<li><a href="#ga-telemetryd-listener">25.6. 侦听器(Listener)参考</a>
<ul class="sectlevel3">
<li><a href="#_udp_侦听器listener">25.6.1. UDP 侦听器(Listener)</a></li>
<li><a href="#_netflow_v9_udp_侦听器listener">25.6.2. Netflow v9 UDP 侦听器(Listener)</a></li>
<li><a href="#_ipfix_udp_侦听器listener">25.6.3. IPFIX UDP 侦听器(Listener)</a></li>
<li><a href="#_ipfix_tcp_侦听器listener">25.6.4. IPFIX TCP 侦听器(Listener)</a></li>
<li><a href="#_sflow_udp_侦听器listener">25.6.5. sFlow UDP 侦听器(Listener)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-elasticsearch-integration">26. Elasticsearch Integration</a>
<ul class="sectlevel2">
<li><a href="#ga-elasticsearch-integration-configuration">26.1. Configuration</a></li>
<li><a href="#_credentials">26.2. Credentials</a></li>
<li><a href="#ga-elasticsearch-integration-features">26.3. Features</a>
<ul class="sectlevel3">
<li><a href="#_version_matrix">26.3.1. Version Matrix</a></li>
<li><a href="#_alarm_and_event_forwarder">26.3.2. Alarm and Event Forwarder</a></li>
<li><a href="#ga-elasticsearch-integration-flow-support">26.3.3. Flow Support</a></li>
<li><a href="#ga-elasticsearch-integration-situation-feedback">26.3.4. Situation Feedback</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-flow-support">27. Flow 支持</a>
<ul class="sectlevel2">
<li><a href="#ga-flow-support-introduction">27.1. 介绍</a>
<ul class="sectlevel3">
<li><a href="#_工作原理">27.1.1. 工作原理</a></li>
</ul>
</li>
<li><a href="#ga-flow-support-setup">27.2. 设置</a>
<ul class="sectlevel3">
<li><a href="#_照片_elasticsearch_存储">27.2.1. 照片 Elasticsearch 存储</a></li>
<li><a href="#_启用协议">27.2.2. 启用协议</a></li>
<li><a href="#_在_web_ui_中链接到_opennms_helm">27.2.3. 在 Web UI 中链接到 OpenNMS Helm</a></li>
<li><a href="#_设备缓存配置_可选">27.2.4. 设备缓存配置 (可选)</a></li>
<li><a href="#_classification_导出过滤器缓存配置_可选">27.2.5. Classification 导出过滤器缓存配置 (可选)</a></li>
</ul>
</li>
<li><a href="#ga-flow-support-classification-engine">27.3. Classification Engine (分类引擎)</a>
<ul class="sectlevel3">
<li><a href="#_规则定义">27.3.1. 规则定义</a></li>
<li><a href="#_规则优先级">27.3.2. 规则优先级</a></li>
<li><a href="#_验证">27.3.3. 验证</a></li>
<li><a href="#_例子_2">27.3.4. 例子</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-kafka-producer">28. Kafka Producer</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">28.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_events">28.1.1. Events</a></li>
<li><a href="#_alarms">28.1.2. Alarms</a></li>
<li><a href="#_nodes">28.1.3. Nodes</a></li>
<li><a href="#_metrics">28.1.4. Metrics</a></li>
</ul>
</li>
<li><a href="#_enabling_the_kafka_producer">28.2. Enabling the Kafka Producer</a></li>
<li><a href="#_configuring_the_kafka_producer">28.3. Configuring the Kafka Producer</a>
<ul class="sectlevel3">
<li><a href="#_configuring_filtering">28.3.1. Configuring Filtering</a></li>
<li><a href="#_enabling_metric_forwarding">28.3.2. Enabling Metric Forwarding</a></li>
<li><a href="#_configuring_topic_names">28.3.3. Configuring Topic Names</a></li>
</ul>
</li>
<li><a href="#_shell_commands">28.4. Shell Commands</a>
<ul class="sectlevel3">
<li><a href="#_kafka_producerlist_alarms">28.4.1. kafka-producer:list-alarms</a></li>
<li><a href="#_kafka_producersync_alarms">28.4.2. kafka-producer:sync-alarms</a></li>
<li><a href="#_kafka_producerevaluate_filter">28.4.3. kafka-producer:evaluate-filter</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ga-alarm-correlation">29. Alarm Correlation</a>
<ul class="sectlevel2">
<li><a href="#ga-situation-feedback">29.1. Situation Feedback</a>
<ul class="sectlevel3">
<li><a href="#_introduction">29.1.1. Introduction</a></li>
<li><a href="#_installation_2">29.1.2. Installation</a></li>
<li><a href="#_requirements">29.1.3. Requirements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="ga-admin-datachoices">1. 数据选择</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>数据选择（Data Choices）</code> 模块收集匿名使用统计数据，并发送到 <a href="https://stats.opennms.org。" class="bare">https://stats.opennms.org。</a></p>
</div>
<div class="paragraph">
<p>当具有 <code>Admin</code> 角色的用户第一次登录系统时，将提示是否希望选择加入来发布这些统计数据。
只有 <code>Administrator</code> 选择加入后，才会发布统计数据。</p>
</div>
<div class="paragraph">
<p>稍后可以在 'Admin' 菜单中的 'Data Choices' 链接来禁用使用统计信息。</p>
</div>
<div class="paragraph">
<p>启用后，将在系统启动时和每24小时收集并发布以下匿名统计数据：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>系统 ID (随机生成的 UUID)</p>
</li>
<li>
<p>OpenNMS Horizon 发行版</p>
</li>
<li>
<p>OpenNMS Horizon 版本</p>
</li>
<li>
<p>OS 体系结构</p>
</li>
<li>
<p>OS 名称</p>
</li>
<li>
<p>OS 版本</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>alarms</code> 表中的告警数</p>
</li>
<li>
<p><code>events</code> 表中的事件数</p>
</li>
<li>
<p><code>ipinterface</code> 表中的 IP 接口数</p>
</li>
<li>
<p><code>node</code> 表的设备数</p>
</li>
<li>
<p>设备数，按 System OID 分组</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-role-user-management">2. 用户管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>用户</em> 是 <em>OpenNMS Horizon</em> 系统中可以登录的账户。
理论上，每个用户对应一个人。
<em>OpenNMS Horizon</em> <em>用户</em> 代表一个参与者，该参与者可以通过关联 <em>安全角色</em> 在系统中被授予权限。
<em>OpenNMS Horizon</em> 默认将 <em>用户</em> 信息和凭证存储在本地文件中。
凭证和用户详细信息，例如，联系信息、描述或 <em>安全角色</em> 可以通过 Web 用户界面中的 <em>Admin 部分</em> 进行管理。</p>
</div>
<div class="paragraph">
<p>除了本地 <em>用户</em>，还可以配置外部 <a href="https://wiki.opennms.org/wiki/Spring_Security_and_LDAP">LDAP</a> 服务和 <a href="https://wiki.opennms.org/wiki/Single_Sign_On">SSO</a>，但是本节不讨论这些服务。
以下段落描述如何在 <em>OpenNMS Horizon</em> 中管理内置的 <em>用户</em> 和 <em>安全角色</em>。</p>
</div>
<div class="sect2">
<h3 id="ga-role-user-management-users">2.1. 用户</h3>
<div class="paragraph">
<p>管理 <em>用户</em> 是通过 <em>Web 用户界面</em> 完成的，并且需要具有管理权限的 <em>用户</em> 身份登录。
默认情况下，<em>admin</em> 用户用于最初创建和修改 <em>用户</em>。
<em>用户</em>, <em>密码</em> 和其它详细描述保存在 <code>users.xml</code> 文件中。
当 <em>用户</em> 属性更改时，不需要重新启动 <em>OpenNMS Horizon</em>。</p>
</div>
<div class="paragraph">
<p>如果要把管理任务分配给 <em>用户</em>，则可以把名为 <em>ROLE_ADMIN</em> 的 <em>安全角色</em> 赋予用户。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
不要删除 <em>admin</em> 和 <em>rtc</em> 用户。
         <em>RTC</em> 用户用来在开始页面上计算设备和服务的可用性来进行实时通讯。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
修改默认的 <em>admin</em> 密码。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">如何设置用户密码</div>
<ol class="arabic">
<li>
<p>以具有管理权限的 <strong>用户</strong> 身份登录</p>
</li>
<li>
<p>从用户的主导航中选择 <strong>Configure OpenNMS</strong> ，该导航菜单在你的登录用户名下</p>
</li>
<li>
<p>选择 <strong>Configure Users, Groups and On-Call roles</strong> 然后选择 <strong>Configure Users</strong></p>
</li>
<li>
<p>单击现有 <em>用户</em> 旁边的 <strong>修改</strong> 图标，并选择 <strong>Reset Password</strong></p>
</li>
<li>
<p>设置新的 <strong>密码</strong>, <strong>确认密码</strong> ，然后单击 <strong>OK</strong></p>
</li>
<li>
<p>单击 <strong>Finish</strong> 以保存并应用更改</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">用户如何更改自己的密码</div>
<ol class="arabic">
<li>
<p>使用用户名和旧密码登录</p>
</li>
<li>
<p>从用户的主导航中选择 <strong>Change Password</strong> ，该导航菜单在你的登录用户名下</p>
</li>
<li>
<p>选择 <strong>Change Password</strong></p>
</li>
<li>
<p>使用旧密码验证身份，并设置新密码和确认密码</p>
</li>
<li>
<p>单击 <strong>Submit</strong></p>
</li>
<li>
<p>注销并使用新密码登录</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">如何创建或修改用户</div>
<ol class="arabic">
<li>
<p>以具有管理权限的 <strong>用户</strong> 身份登录</p>
</li>
<li>
<p>从用户的主导航中选择 <strong>Configure OpenNMS</strong> ，该导航菜单在你的登录用户名下</p>
</li>
<li>
<p>选择 <strong>Configure Users, Groups and On-Call roles</strong> 然后选择 <strong>Configure Users</strong></p>
</li>
<li>
<p>使用 <strong>Add new user</strong> ，输入 <strong>登录名</strong> 作为 <em>用户 ID</em> 和 <strong>密码</strong> ，再输入确认密码，或者单击现有 <em>用户</em> 旁边的 <strong>修改</strong>。</p>
</li>
<li>
<p><em>可选项</em>: 填写详细的 <em>用户信息</em>，提供关于系统中新用户的更多上下文信息</p>
</li>
<li>
<p><em>可选项</em>: 分配 <em>安全角色</em> 以授予或删除系统中的权限</p>
</li>
<li>
<p><em>可选项</em>: 提供 <em>通知</em> 目标中使用的 <em>通知信息</em>，以便向 <em>用户</em> 发送消息</p>
</li>
<li>
<p><em>可选项</em>: 设置 <em>用户</em> 接收 <em>通知</em> 的时间表</p>
</li>
<li>
<p>单击 <strong>Finish</strong> 以保存并应用更改</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认情况下，新 <em>用户</em> 会分配一个 <em>ROLE_USER</em> 的 <em>安全角色</em>。
     确认和处理 <em>告警</em> 以及 <em>通知</em> 是可以的。
     管理菜单 <em>Configure OpenNMS</em> 不可用。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">如何删除现有用户</div>
<ol class="arabic">
<li>
<p>以具有管理权限的 <strong>用户</strong> 身份登录</p>
</li>
<li>
<p>从用户的主导航中选择 <strong>Configure OpenNMS</strong> ，该导航菜单在你的登录用户名下</p>
</li>
<li>
<p>选择 <strong>Configure Users, Groups and On-Call roles</strong> 然后选择 <strong>Configure Users</strong></p>
</li>
<li>
<p>使用 <em>用户</em> 旁边的垃圾箱图标删除</p>
</li>
<li>
<p>使用 <strong>OK</strong> 确认删除请求</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ga-role-user-management-roles">2.2. 安全角色</h3>
<div class="paragraph">
<p><em>安全角色</em> 是一组权限，可以分配给 <em>用户</em>。
它们可以控制访问 Web 用户界面和 <em>ReST API</em>，来进行监视和查看信息。
在分布式部署的情况下，<em>Minion</em> 或 <em>远程轮询</em> 实例与 <em>OpenNMS Horizon</em> 交互时，需要 <em>ROLE_MINION</em> 和 <em>ROLE_REMOTING</em> 定义的 <em>安全角色</em>。
可以使用以下 <em>安全</em>：</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 1. <em>OpenNMS Horizon</em> 中的功能和现有系统角色</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">安全角色名称</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>anyone</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果安装了 <code>opennms-webapp-remoting</code> 包，任何用户都可以从 <a href="http://opennms.server:8980/opennms-remoting/webstart/app.jnlp" class="bare">http://opennms.server:8980/opennms-remoting/webstart/app.jnlp</a> 下载远程轮询 <em>Java Webstart</em> 安装包。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_ANONYMOUS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许 <em>HTTP OPTIONS</em> 请求，在 ReST 资源和 Web 用户界面的登录和注销页面上显示允许的 HTTP 方法。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_ADMIN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 Web 用户界面和 <em>ReST API</em> 中创建，读取，更新和删除的权限。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_ASSET_EDITOR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只更新设备的资产记录的权限。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_DASHBOARD</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许用户只访问 <em>Dashboard</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_DELEGATE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许代表另一个用户执行操作 (例如，确认告警)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_JMX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许检索 JMX 度量指标，但是不允许执行 <em>OpenNMS Horizon</em> JVM 的 MBeans，即使它们只返回简单的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_MINION</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Minion</em> 操作所需的最小权限。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_MOBILE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许用户使用 <em>OpenNMS COMPASS</em> 移动应用程序通过 ReST API 确认 <em>告警</em> 和 <em>通知</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_PROVISION</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许用户使用 <em>Provisioning 系统</em> ，并在 <em>OpenNMS Horizon</em> 中配置 <em>SNMP</em> 来从设备服务管理信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_READONLY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅限于读取 Web 用户界面中的信息，而不能更改 <em>告警</em> 状态或 <em>通知</em>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_REMOTING</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许从 <em>Remote Poller（远程轮询）</em> 实例访问交互监控信息的权限。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_REST</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许用户与 <em>OpenNMS Horizon</em> 的整个 <em>ReST API</em> 进行交互</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_RTC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与 <em>OpenNMS Horizon</em> <em>Real-Time Console</em> 交换可用性计算信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ROLE_USER</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">新建用户的默认权限，Web 用户界面上允许升级和确认 <em>告警</em> 和 <em>通知</em>。</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<div class="title">如何管理 <em>用户</em> 的 <em>安全角色</em>:</div>
<ol class="arabic">
<li>
<p>以具有管理权限的 <strong>用户</strong> 身份登录</p>
</li>
<li>
<p>从用户的主导航中选择 <strong>Configure OpenNMS</strong> ，该导航菜单在你的登录用户名下</p>
</li>
<li>
<p>选择 <strong>Configure Users, Groups and On-Call roles</strong> 然后选择 <strong>Configure Users</strong></p>
</li>
<li>
<p>通过单击 <strong>用户</strong> 旁边的修改图标修改现有 <strong>用户</strong></p>
</li>
<li>
<p>在 <strong>安全角色</strong> 里从 <strong>可以角色</strong> 中选择 <strong>角色</strong></p>
</li>
<li>
<p>使用 <strong>Add</strong> 和 <strong>Remove</strong> 从 <strong>用户</strong> 分配和删除 <strong>安全角色</strong></p>
</li>
<li>
<p>单击 <strong>Finish</strong> 以保存并应用更改</p>
</li>
<li>
<p><strong>注销</strong> 然后 <strong>登录</strong> 以应用新的 <em>安全角色</em> 设置</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">如何添加自定义角色</div>
<ul>
<li>
<p>创建一个名为 <code>$OPENNMS_HOME/etc/security-roles.properties</code> 的文件。</p>
</li>
<li>
<p>添加名为 <code>roles</code> 的属性，并添加逗号分隔列表的自定义角色，例如：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>roles=operator,stage</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>将安全角色和用户关联后，新的自定义角色就可用了，如下图所示：</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/webui/users/custom-roles.png" alt="custom roles"></span>
:imagesdir: ../../images</p>
</div>
</div>
<div class="sect2">
<h3 id="ga-role-user-management-pre-authentication">2.3. Web UI Pre-Authentication</h3>
<div class="paragraph">
<p>可用配置 <em>OpenNMS Horizon</em> 运行在代理后面提供身份认证，然后使用 header 将 pre-authenticated 的用户传递给 <em>OpenNMS Horizon</em> webapp。</p>
</div>
<div class="paragraph">
<p>配置 pre-authentication 在 <code>$OPENNMS_HOME/jetty-webapps/opennms/WEB-INF/spring-security.d/header-preauth.xml</code> 中定义。此文件自动引入到 Spring Security context 中，但默认不启用。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>不要</strong> 以这种方式配置 <em>OpenNMS Horizon</em> ，除非你确定 web UI 只会被代理访问，不会被最终用户访问。
	否则，恶意攻击者可以设计包含 pre-authentication header ，并完全控制 web UI 和 ReST APIs。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_启用_pre_authentication">2.3.1. 启用 Pre-Authentication</h4>
<div class="paragraph">
<p>编辑 <code>header-preauth.xml</code> 文件，并设置 <code>enabled</code> 属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;beans:property name="enabled" value="true" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置_pre_authentication">2.3.2. 配置 Pre-Authentication</h4>
<div class="paragraph">
<p>可以设置许多其它属性来更改 pre-authentication 插件的行为。</p>
</div>
<table class="tableblock frame-topbot grid-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">插件 pre-authentication 是否处于激活状态。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failOnError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果为 true，那么如果 header 未设置或用户不存在，则禁止登录。如果为 false，则转向其它机制 (基本身份验证，表单登录等。)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>userHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用来指定进行身份验证的用户的 HTTP header。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X-Remote-User</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>credentialsHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用逗号分隔的用户具有的附加凭据 (角色) 列表。</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-admin-ui">3. 管理 Web 界面</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ga-surveillance-view">3.1. 监视视图</h3>
<div class="paragraph">
<p>当网络较大并且包含不同优先级的设备时，如何清楚地显示 "整个系统" 是怎样工作的变得很重要。
监视视图旨在实现这一目标。 通过使用类别，您可以定义一个矩阵，以便汇总监控结果。
想象一下，你有10台服务器，10个互联网连接和5台带 DSL 线路的 PCs：</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">服务器</th>
<th class="tableblock halign-left valign-top">互联网连接</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Super important</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 of 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 of 10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slightly important</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 of 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 of 10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vanity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 of 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 of 10</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>整个想法是让人们一眼就能看出问题所在。
矩阵类型的显示允许比简单列表高得多的聚合。
此外，监视视图显示节点而不是服务 - 当您查看类别时，这是一个重要的信息。
乍一看，您想知道有多少服务器存在问题，而不是此类别中有多少服务存在问题。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/surveillance-view/01_surveillance-view.png" alt="01 surveillance view">
</div>
<div class="title">Figure 1. 已配置的 <em>监视视图</em> 示例</div>
</div>
<div class="paragraph">
<p>监视视图单元故障的可视指示定义如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>没有服务 down: 绿色正常</p>
</li>
<li>
<p>一个 (1) 服务 down: 黄色作为警告</p>
</li>
<li>
<p>超过一项 (1) 服务 down: 红色，严重警告</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>此 <em>监视视图</em> 模型还构建了 <a href="#ga-dashboard-components">Dashboard View</a> 的基础。</p>
</div>
<div class="sect3">
<h4 id="_默认监视视图配置">3.1.1. 默认监视视图配置</h4>
<div class="paragraph">
<p><em>监视视图</em> 在 <code>surveillance-views.xml</code> 文件中定义。
该文件位于 <em>OpenNMS Horizon</em> <code>etc</code> 目录中。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
此文件可以在文本编辑器中修改，并在每次加载 <em>监视视图</em> 页面时重新读取。
因此，对此文件的更改不需要重新启动 <em>OpenNMS Horizon</em>。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>默认配置如下所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;surveillance-view-configuration
  xmlns:this="http://www.opennms.org/xsd/config/surveillance-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opennms.org/xsd/config/surveillance-views http://www.opennms.org/xsd/config/surveillance-views.xsd"
  default-view="default" &gt;
  &lt;views &gt;
    &lt;view name="default" refresh-seconds="300" &gt;
      &lt;rows&gt;
        &lt;row-def label="Routers" &gt;
          &lt;category name="Routers"/&gt;
        &lt;/row-def&gt;
        &lt;row-def label="Switches" &gt;
          &lt;category name="Switches" /&gt;
        &lt;/row-def&gt;
        &lt;row-def label="Servers" &gt;
          &lt;category name="Servers" /&gt;
        &lt;/row-def&gt;
      &lt;/rows&gt;
      &lt;columns&gt;
        &lt;column-def label="PROD" &gt;
          &lt;category name="Production" /&gt;
        &lt;/column-def&gt;
        &lt;column-def label="TEST" &gt;
          &lt;category name="Test" /&gt;
        &lt;/column-def&gt;
        &lt;column-def label="DEV" &gt;
          &lt;category name="Development" /&gt;
        &lt;/column-def&gt;
      &lt;/columns&gt;
    &lt;/view&gt;
  &lt;/views&gt;
&lt;/surveillance-view-configuration&gt;</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
请注意，旧的 <code>report-category</code> 属性已弃用，不再受支持。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_配置监控视图">3.1.2. 配置监控视图</h4>
<div class="paragraph">
<p>也可以使用 <em>OpenNMS Horizon</em> <em>Admin</em> 页面上的 <em>监视视图配置</em> 功能修改 <em>监视视图</em> 配置。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/surveillance-view/02_surveillance-view-config-ui.png" alt="02 surveillance view config ui">
</div>
<div class="title">Figure 2. <em>监视视图配置</em> UI</div>
</div>
<div class="paragraph">
<p>此页面概括了已配置的 <em>监视视图</em>，并允许用户编辑，删除以及预览定义的 <em>监视视图</em>。
此外，可以使用 <em>DEFAULT</em> 列中的复选框选择默认的 <em>监视视图</em>。</p>
</div>
<div class="paragraph">
<p>编辑监视视图时，用户必须定义视图的标题以及连续刷新之间的时间间隔，以秒为单位。
在此对话框的左侧，列出已定义的行，右侧是已定义的列。
除了添加新条目，用户还可以修改或删除现有条目。
此外，可以使用 up/down 按钮修改条目的位置。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/surveillance-view/03_surveillance-view-config-ui-edit.png" alt="03 surveillance view config ui edit">
</div>
<div class="title">Figure 3. 编辑 <em>监视视图</em></div>
</div>
<div class="paragraph">
<p>编辑行或列定义需要为此条目选择唯一标签，并至少选择一个 <em>OpenNMS Horizon</em> 类别。
完成后，你可以点击 <em>Save</em> 按钮以保存修改的配置，或者 <em>Cancel</em> 关闭此对话框。</p>
</div>
</div>
<div class="sect3">
<h4 id="_分类设备">3.1.3. 分类设备</h4>
<div class="paragraph">
<p>要在监视视图中对节点进行分类，请选择一个节点，然后单击 <em>Surveillance Category Memberships</em> 旁边的 <em>Edit</em>。
返回 <em>监视视图</em>，选择两个代表一列和一行的类别，例如 <em>Servers</em> 和 <em>Test</em>，然后单击 <em>Add</em>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为用户和组创建视图">3.1.4. 为用户和组创建视图</h4>
<div class="paragraph">
<p>您可以将用户和组名称用于 <em>监视视图</em>。 调用 <em>监视视图</em> 页面时，根据以下条件选择要显示的 <em>监视视图</em>。
按顺序匹配：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>监视视图名称等于登录 OpenNMS Horizon 时使用的用户名。</p>
</li>
<li>
<p>监视视图名称等于用户指定的 OpenNMS Horizon 组名称。</p>
</li>
<li>
<p>监视视图名称等于 <code>surveillance-views.xml</code> 配置文件中的 <code>default-view</code> 属性。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-dashboard-view">3.2. Dashboard</h3>
<div class="paragraph">
<p>在网络运营中心 <em>NOC</em> 中，关于网络中的问题的概览很重要，通常被描述为 <em>Dashboards</em>。
大型网络具有不同职责的人员（操作员），<em>Dashboard</em> 应仅显示指定 <em>监控上下文</em> 的信息。
网络或服务器运营商需要自定义或过滤 <em>Dashboard</em> 上的信息。
<em>Dashboard</em> 作为一种概览，通常也用于监控系统提供的信息为更详细的诊断切入点。
<em>监视视图</em> 允许通过选择行，列和单元来缩减可见信息，以快速定位要导航的信息。</p>
</div>
<div class="sect3">
<h4 id="ga-dashboard-components">3.2.1. 组件</h4>
<div class="paragraph">
<p><em>Dashboard</em> 由五个组件构成:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>监视视图</em>: 允许为 <em>Dashboard</em> 建模 <em>监控上下文</em>。</p>
</li>
<li>
<p><em>告警</em>: 显示未确认的 <em>告警</em>，应由 <em>操作员</em> 升级。</p>
</li>
<li>
<p><em>通知</em>: 显示发送到 <em>Engineers</em> 的活动和未确认的通知。</p>
</li>
<li>
<p><em>设备状态</em>: 显示所有当前的网络 <em>故障</em>。</p>
</li>
<li>
<p><em>资源图视图</em>: 显示性能判断的性能时间序列报表。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下屏幕截图显示了已配置的 <em>Dashboard</em>，以及哪些信息显示在组件中。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/01_dashboard-overall.png" alt="01 dashboard overall">
</div>
<div class="title">Figure 4. Dashboard 配置了监视视图和当前故障</div>
</div>
<div class="paragraph">
<p>以下部分描述了每个组件中显示的信息。
所有其他组件都根据 <em>监视视图</em> 显示信息。</p>
</div>
<div class="sect4">
<h5 id="ga-dashboard-surveillance-view">监视视图</h5>
<div class="paragraph">
<p><em>监视视图</em> 具有多种功能。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>允许对 <em>监控上下文</em> 进行建模，并在矩阵视图中显示服务和节点 <em>故障</em>。</p>
</li>
<li>
<p>允许通过选择行，列和单元格来定位 <em>Dashboard</em> 中的信息。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>您可以选择列，行，单个单元格，当然还可以选择 <em>监视视图</em> 中的所有条目。
有关如何配置 <em>监视视图</em> 的详细信息，请参阅 <a href="#ga-surveillance-view">监视视图部分</a>。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/02_dashboard-surveillance-view.png" alt="02 dashboard surveillance view">
</div>
<div class="title">Figure 5. <em>监视视图</em> 构成了 <em>Dashboard</em> 页面的基础。</div>
</div>
</div>
<div class="sect4">
<h5 id="ga-dashboard-alarms">告警</h5>
<div class="paragraph">
<p><em>告警</em> 组件概括了严重性高于 <em>Normal(1)</em> 的所有未确认的 <em>告警</em>。
已确认 <em>告警</em> 将从 <em>操作员</em> 的职责中删除。
以下信息显示在：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/03_dashboard-alarms.png" alt="03 dashboard alarms">
</div>
<div class="title">Figure 6. <em>告警</em> 组件中显示的信息</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>设备</em>: <em>告警</em> 关联的设备名称</p>
</li>
<li>
<p><em>严重级别</em>: <em>告警</em> 的严重级别</p>
</li>
<li>
<p><em>UEI</em>: 显示 <em>告警</em> 的 <em>UEI</em></p>
</li>
<li>
<p><em>告警次数</em>: 通过 <em>告警</em> 压缩进行重复数据删除的 <em>告警</em> 数</p>
</li>
<li>
<p><em>最后发生时间</em>: 最后一次出现 <em>告警</em> 的时间</p>
</li>
<li>
<p><em>记录消息</em>: 来自 <em>事件</em> 的日志消息，它是此 <em>告警</em> 的来源。它在事件配置文件的 <code>&lt;logmsg /&gt;</code> 中指定</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>告警</em> 组件显示最新的 <em>告警</em>，并允许用户滚动查看最近 100 条 <em>告警</em>。</p>
</div>
</div>
<div class="sect4">
<h5 id="ga-dashboard-notifications">通知</h5>
<div class="paragraph">
<p>为了通知人们有关工作时间的通知，并强制采取措施立即修复或重新配置系统。
在 <em>OpenNMS Horizon</em> 中，可以确认通知，以查看谁在处理特定问题。
<em>Dashboard</em> 应在 <em>NOC</em> 中显示活动的通知，以提供概览并提供干预的可能性。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/04_dashboard-notifications.png" alt="04 dashboard notifications">
</div>
<div class="title">Figure 7. <em>通知</em> 组件中显示的信息</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>设备</em>: 与通知关联的受监视节点的名称</p>
</li>
<li>
<p><em>服务</em>: 与通知关联的服务的名称</p>
</li>
<li>
<p><em>信息</em>: 通知消息</p>
</li>
<li>
<p><em>发送时间</em>: 发送通知的时间</p>
</li>
<li>
<p><em>响应人</em>: 确认通知的用户名</p>
</li>
<li>
<p><em>响应时间</em>: 用户确认通知的时间</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>通知</em> 组件显示最近未确认的通知，并允许用户滚动查看最近 100 条 <em>通知</em>。</p>
</div>
</div>
<div class="sect4">
<h5 id="ga-dashboard-node-status">设备状态</h5>
<div class="paragraph">
<p>已确认的 <em>告警</em> 并不意味着故障必须已解决。
为了提供有关网络中活动 <em>故障</em> 的概述信息，<em>Dashboard</em> 显示 <em>设备状态</em> 组件中的故障列表。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/05_dashboard-outages.png" alt="05 dashboard outages">
</div>
<div class="title">Figure 8. <em>设备状态</em> 组件中显示的信息</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>设备</em>: 活动故障的监控设备的名称</p>
</li>
<li>
<p><em>目前的故障</em>: 具有故障的设备上的服务数量和受监控服务的总数，例如 这意味着 <em>"3 个服务中的 3 个受到影响"</em>。</p>
</li>
<li>
<p><em>24 小时可用性</em>: 过去24小时计算的设备提供的所有服务的可用性。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="ga-dashboard-resource-graph-viewer">资源图视图</h5>
<div class="paragraph">
<p>为了提供诊断性能问题快速入口，<em>资源图视图</em> 允许在 <em>监视视图</em> 的上下文中导航到过滤的时间序列数据报表。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/06_dashboard-resource-graphs.png" alt="06 dashboard resource graphs">
</div>
<div class="title">Figure 9. 使用 <em>资源图视图</em> 显示基于时间序列的性能数据</div>
</div>
<div class="paragraph">
<p>它允许按顺序浏览由 <em>监视视图</em> 上下文和选择过滤的设备提供的资源图，并显示一个图表报表。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-dashboard-advanced-configuration">3.2.2. 高级配置</h4>
<div class="paragraph">
<p><em>监视视图</em> 组件允许为不同的监视上下文建模多个视图。
它为网络运营商或服务器运营商提供了创建特殊视图的可能性。
<em>Dashboard</em> 仅显示 <strong><em>一个</em></strong> <a href="#ga-surveillance-view"><em>监视视图</em></a> 配置。
为了给不同的用户提供使用 <em>监视视图</em> 组件的可能性，可以将登录用户使用的 <em>监视视图</em> 映射到 <em>Dashboard</em> 中。</p>
</div>
<div class="paragraph">
<p><em>监视视图</em> 选择设备也可以使用 <a href="http://www.opennms.org/wiki/User_Restriction_Filters"><em>用户限制过滤器</em></a>。
如果您有一组用户，应该只看到设备的子集，<em>监视视图</em> 将过滤分配给用户组无关的设备。</p>
</div>
<div class="paragraph">
<p><em>Dashboard</em> 旨在将用户的视图集中，并因此也集中他们感兴趣的设备。
为此，添加了一个新角色，可以将其分配给用户，该用户将仅查看 <em>Dashboard</em>。</p>
</div>
<div class="sect4">
<h5 id="_使用_dashboard_角色">使用 <em>Dashboard</em> 角色</h5>
<div class="paragraph">
<p>以下示例说明了如何使用此 <em>Dashboard</em> 角色。
例如，用户 <code>drv4doe</code> 被分配了 dashboard 角色。
因此，当 <code>drv4doe</code> 登录时，用户将直接进入 <em>Dashboard</em> 页面，并根据 <code>drv4doe</code> 的 <em>监视视图</em> 定义显示自定义 <em>Dashboard</em>。</p>
</div>
<div class="sect5">
<h6 id="_第1步_创建用户">第1步: 创建用户</h6>
<div class="paragraph">
<p>以下示例将 Dashboard 分配给用户 "drv4doe" (路由器和交换机 jockey)，并限制用户导航到 OpenNMS Horizon WebUI 中的任何其它链接。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/07_dashboard-add-user.png" alt="07 dashboard add user">
</div>
<div class="title">Figure 10. 使用 OpenNMS Horizon WebUI 创建用户 <code>drv4doe</code></div>
</div>
</div>
<div class="sect5">
<h6 id="_第2步_更改安全角色">第2步: 更改安全角色</h6>
<div class="paragraph">
<p>现在，通过 WebUI 将 <code>ROLE_PROVISION</code> 角色添加到用户，或者在 <code>/opt/opennms/etc</code> 目录中的 <code>users.xml</code> 文件手动编辑用户 <code>drv4doe</code>。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/dashboard/08_dashboard-user-roles.png" alt="08 dashboard user roles">
</div>
<div class="title">Figure 11. 使用 OpenNMS Horizon WebUI 向用户 <code>drv4doe</code> 添加 dashboard 角色</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">&lt;user&gt;
    &lt;user-id&gt;drv4doe&lt;/user-id&gt;
    &lt;full-name&gt;Dashboard User&lt;/full-name&gt;
    &lt;password salt="true"&gt;6FOip6hgZsUwDhdzdPUVV5UhkSxdbZTlq8M5LXWG5586eDPa7BFizirjXEfV/srK&lt;/password&gt;
    &lt;role&gt;ROLE_DASHBOARD&lt;/role&gt;
&lt;/user&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_第3步_定义监视视图">第3步: 定义监视视图</h6>
<div class="paragraph">
<p>编辑 <code>$OPENNMS_HOME/etc/surveilliance-view.xml</code> 文件，为你在步骤1中创建的用户 <em>drv4doe</em> 添加定义。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;surveillance-view-configuration
  xmlns:this="http://www.opennms.org/xsd/config/surveillance-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.opennms.org/xsd/config/surveillance-views http://www.opennms.org/xsd/config/surveillance-views.xsd"
  default-view="default" &gt;
  &lt;views &gt;
    &lt;view name="drv4doe" refresh-seconds="300" &gt;
      &lt;rows&gt;
        &lt;row-def label="Servers" &gt;
          &lt;category name="Servers"/&gt;
        &lt;/row-def&gt;
      &lt;/rows&gt;
      &lt;columns&gt;
        &lt;column-def label="PROD" &gt;
          &lt;category name="Production" /&gt;
        &lt;/column-def&gt;
        &lt;column-def label="TEST" &gt;
          &lt;category name="Test" /&gt;
        &lt;/column-def&gt;
      &lt;/columns&gt;
    &lt;/view&gt;
   &lt;!-- default view here --&gt;
    &lt;view name="default" refresh-seconds="300" &gt;
      &lt;rows&gt;
        &lt;row-def label="Routers" &gt;
          &lt;category name="Routers"/&gt;
        &lt;/row-def&gt;
        &lt;row-def label="Switches" &gt;
          &lt;category name="Switches" /&gt;
        &lt;/row-def&gt;
        &lt;row-def label="Servers" &gt;
          &lt;category name="Servers" /&gt;
        &lt;/row-def&gt;
      &lt;/rows&gt;
      &lt;columns&gt;
        &lt;column-def label="PROD" &gt;
          &lt;category name="Production" /&gt;
        &lt;/column-def&gt;
        &lt;column-def label="TEST" &gt;
          &lt;category name="Test" /&gt;
        &lt;/column-def&gt;
        &lt;column-def label="DEV" &gt;
          &lt;category name="Development" /&gt;
        &lt;/column-def&gt;
      &lt;/columns&gt;
    &lt;/view&gt;
  &lt;/views&gt;
&lt;/surveillance-view-configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这种配置和设备分类的正确分配，将为所有用户生成默认的 <em>Dashboard</em>，除了 <code>drv4doe</code> 用户。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
你可以通过在 <em>OpenNMS Horizon</em> URL 的末尾指定 <code>?quiet=true;</code> 来隐藏所有页面的上部导航。
     在大型显示器或电视屏幕上使用 dashboard 进行大屏展示时，这非常方便。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>但是，但以 <code>drv4doe</code> 身份登录时，用户将直接进入 <em>Dashboard</em> 页面，并根据自定义 <em>监视视图</em> 显示 <em>Dashboard</em>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
不允许 <code>drv4doe</code> 用户导航到 <code>dashboard.jsp</code> URL 以外的链接。
      这样做会导致 <em>Access Denied</em> 错误。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_匿名_dashboards">匿名 dashboards</h5>
<div class="paragraph">
<p>你可以修改安全框架的配置文件，以便无需登录即可访问一个或多个 dashboards。
最后，你可以将浏览器指向特定 URL，像 <code><a href="http://&#8230;&#8203;/opennms/dashboard1" class="bare">http://&#8230;&#8203;/opennms/dashboard1</a></code> 或 <code><a href="http://&#8230;&#8203;/opennms/dashboard2" class="bare">http://&#8230;&#8203;/opennms/dashboard2</a></code>，通过无认证方式查看 dashboard。
首先，如上所述配置监视视图并创建 dashboard 用户。
例如，制作两个 dashboards 并创建两个名为 <code>dashboard1</code> 和 <code>dashboard2</code> 的用户。
测试您是否可以作为每个新用户登录并查看正确的 dashboard。
现在创建一些可用于区分 dashboards 的别名。
在 <code>/opt/opennms/jetty-webapps/opennms/WEB-INF</code> 中编辑 <code>web.xml</code>。
在第一个 <code>&lt;servlet-mapping&gt;</code> 标记之前，添加以下 servlet 条目：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;servlet&gt;
       &lt;servlet-name&gt;dashboard1&lt;/servlet-name&gt;
       &lt;jsp-file&gt;/dashboard.jsp&lt;/jsp-file&gt;
  &lt;/servlet&gt;

  &lt;servlet&gt;
       &lt;servlet-name&gt;dashboard2&lt;/servlet-name&gt;
       &lt;jsp-file&gt;/dashboard.jsp&lt;/jsp-file&gt;
  &lt;/servlet&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在第一个 <code>&lt;error-page&gt;</code> 标记之前，添加以下 servlet-mapping 条目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;servlet-mapping&gt;
       &lt;servlet-name&gt;dashboard1&lt;/servlet-name&gt;
       &lt;url-pattern&gt;/dashboard1&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

  &lt;servlet-mapping&gt;
       &lt;servlet-name&gt;dashboard2&lt;/servlet-name&gt;
       &lt;url-pattern&gt;/dashboard2&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在最后一个 <code>&lt;filter-mapping&gt;</code> 标记之后，添加以下 filter-mapping 条目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;filter-mapping&gt;
    &lt;filter-name&gt;AddRefreshHeader-120&lt;/filter-name&gt;
    &lt;url-pattern&gt;/dashboard.jsp&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;AddRefreshHeader-120&lt;/filter-name&gt;
    &lt;url-pattern&gt;/dashboard1&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;AddRefreshHeader-120&lt;/filter-name&gt;
    &lt;url-pattern&gt;/dashboard2&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>接下来编辑 <code>applicationContext-acegi-security.xml</code> 已对 <code>/dashboard1</code> and <code>/dashboard2</code> 别名启用匿名访问认证。
在文件顶部附近，找到 <code>&lt;bean id="filterChainProxy" &#8230;&#8203;&gt;</code>。
在 <code>/rss.jsp*</code> 条目下面，为每个 dashboard 别名添加一个条目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;bean id="filterChainProxy" class="org.acegisecurity.util.FilterChainProxy"&gt;
    &lt;property name="filterInvocationDefinitionSource"&gt;
      &lt;value&gt;
        CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON
        PATTERN_TYPE_APACHE_ANT
        /rss.jsp*=httpSessionContextIntegrationFilter,logoutFilter,authenticationProcessingFilter,basicProcessingFilter,securityContextHolderAwareRequestFilter,anonymousProcessingFilter,basicExceptionTranslationFilter,filterInvocationInterceptor
        /dashboard1*=httpSessionContextIntegrationFilter,logoutFilter,securityContextHolderAwareRequestFilter,dash1AnonymousProcessingFilter,filterInvocationInterceptor
        /dashboard2*=httpSessionContextIntegrationFilter,logoutFilter,securityContextHolderAwareRequestFilter,dash2AnonymousProcessingFilter,filterInvocationInterceptor
        /**=httpSessionContextIntegrationFilter,logoutFilter,authenticationProcessingFilter,basicProcessingFilter,securityContextHolderAwareRequestFilter,anonymousProcessingFilter,exceptionTranslationFilter,filterInvocationInterceptor

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>大约在文件一半的位置，查找 <code>&lt;bean id="filterInvocationInterceptor" &#8230;&#8203;&gt;</code>。
在 <code>/dashboard.jsp</code> 的条目下面，为每个别名添加一个条目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;bean id="filterInvocationInterceptor" class="org.acegisecurity.intercept.web.FilterSecurityInterceptor"&gt;

...

        /frontpage.htm=ROLE_USER,ROLE_DASHBOARD
        /dashboard.jsp=ROLE_USER,ROLE_DASHBOARD
        /dashboard1=ROLE_USER,ROLE_DASHBOARD
        /dashboard2=ROLE_USER,ROLE_DASHBOARD
        /gwt.js=ROLE_USER,ROLE_DASHBOARD

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，在文件底部附近，为每个别名添加一个新的 <code>AnonymousProcessingFilter</code> 实例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">  &lt;!-- Set the anonymous username to dashboard1 so the dashboard page
       can match it to a surveillance view of the same name. --&gt;
  &lt;bean id="dash1AnonymousProcessingFilter" class="org.acegisecurity.providers.anonymous.AnonymousProcessingFilter"&gt;
    &lt;property name="key"&gt;&lt;value&gt;foobar&lt;/value&gt;&lt;/property&gt;
    &lt;property name="userAttribute"&gt;&lt;value&gt;dashboard1,ROLE_DASHBOARD&lt;/value&gt;&lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="dash2AnonymousProcessingFilter" class="org.acegisecurity.providers.anonymous.AnonymousProcessingFilter"&gt;
    &lt;property name="key"&gt;&lt;value&gt;foobar&lt;/value&gt;&lt;/property&gt;
    &lt;property name="userAttribute"&gt;&lt;value&gt;dashboard2,ROLE_DASHBOARD&lt;/value&gt;&lt;/property&gt;
  &lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 OpenNMS Horizon，你应该在没有登录的情况下，在 <code><a href="http://&#8230;&#8203;/opennms/dashboard1" class="bare">http://&#8230;&#8203;/opennms/dashboard1</a></code> 上显示一个 dashboard。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
不关闭浏览器 (或删除 JSESSIONID session cookie) 就无法切换 dashboards。
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
如果你不小心点击了需要完全用户权限的链接 (例如，设备列表)，你将获得一个登录表单。
         进入登录表单后，如果不重新启动浏览器，则无法返回 dashboard。
         如果这个问题困扰你，你可以在你的 <code>userAttribute</code> 属性中在 <code>ROLE_DASHBOARD</code> 后添加 <code>ROLE_USER</code>。
         但是，这将使用户完全可以访问匿名浏览器。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-admin-ui-start-page">3.3. Grafana Dashboard Box</h3>
<div id="webui-grafana-dashboard-box" class="paragraph">
<p><a href="http://grafana.org/">Grafana</a> 提供了一个 API key，可以访问第三方应用程序，如 <em>OpenNMS Horizon</em>。
在 <em>Grafana Dashboard Box</em> 的开始页面上显示 <em>OpenNMS Horizon</em> 相关的 dashboards。
要过滤相关 dashboards，你可以使用 <em>tag</em> 来让 dashboards 可访问。
如果没有提供 <em>tag</em>，将显示 <em>Grafana</em> 中的所有 dashboards。</p>
</div>
<div class="paragraph">
<p>默认情况下，该功能停用，可以通过 <code>opennms.properties</code> 进行配置。请注意，
此功能适用于 <em>Grafana API v2.5.0</em>。</p>
</div>
<div class="paragraph">
<div class="title">从 OpenNMS Horizon 起始页面快速访问 Grafana dashboards</div>
<p><span class="image"><img src="images/webui/startpage/01_grafana-box.png" alt="01 grafana box"></span></p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 2. Grafana Dashboard 配置属性</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.show</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此设置控制是否在展示页面上显示可用 dashboards 的 grafana 框。
                                                           有两个有效选项是 <code>true</code> 或 <code>false</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.hostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果启用 box，则还需要指定
                                                           <em>Grafana</em> 服务器的主机名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Grafana</em> 服务器 ReST API 的端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.basePath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>Grafana</em> 基本路径</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.apiKey</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReST 调用需要 API key 才能工作</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当指定 <em>tag</em> 时，仅显示此给定 <em>tag</em> 的 dashboards。
                                                           如果没有给出 <em>tag</em>，则将显示所有 dashboards。</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">也可以指定 ReST 调用的协议</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.connectionTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">从 <em>Grafana</em> 服务器获取信息的超时，
                                                           以毫秒为单位</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.soTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket 超时</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.grafanaBox.dashboardLimit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要显示的最大条目数 (0 表示无限制)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
如果 <em>Grafana</em> 在代理后面，则可以通过 <code>org.opennms.grafanaBox.hostname</code> 访问。
     此主机名用于生成指向 <em>Grafana</em> dashboards 的链接。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>生成 <em>Grafana API Key</em> 的过程可以在 <a href="http://docs.grafana.org/reference/http_api/#create-api-token">HTTP API 文档</a> 中找到。
将 API Key 复制到 <code>opennms.properties</code> 文件中的 <code>org.opennms.grafanaBox.apiKey</code>。</p>
</div>
</div>
<div class="sect2">
<h3 id="ga-admin-ui-ops-board">3.4. Operator Board</h3>
<div class="paragraph">
<p>在网络操作中心 <em>(NOC)</em> 中，<em>Ops Board</em> 用于可视化监控信息。
各种用例的监视信息以可配置的 <em>Dashlets</em> 排列。
为了解决不同的用户组，可以创建多个 <em>Ops Boards</em>。</p>
</div>
<div class="paragraph">
<p>有两个可视化组件可以显示 <em>Dashlets</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Ops Panel</em>: 在一个屏幕上显示多个 <em>Dashlets</em>，例如 在 NOC 操作员工作站上</p>
</li>
<li>
<p><em>Ops Board</em>: 一次滚动显示一个 <em>Dashlet</em>，例如，用于 NOC 中的大屏幕</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/webui/opsboard/01_opspanel-concept.png" alt="01 opspanel concept">
</div>
<div class="title">Figure 12. 在 <em>Ops Panel</em> 中显示 <em>Dashlets</em> 的概念</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/webui/opsboard/02_opsboard-concept.png" alt="02 opsboard concept">
</div>
<div class="title">Figure 13. 在 <em>Ops Board</em> 上循环显示 <em>Dashlets</em> 的概念</div>
</div>
<div class="sect3">
<h4 id="_配置">3.4.1. 配置</h4>
<div class="paragraph">
<p>要创建和配置 <em>Ops Boards</em>，需要管理员权限。
配置部分位于 OpenNMS Horizon 的管理区域中，名称是 <em>Ops Board Config Web Ui</em>。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/webui/opsboard/03_admin-configure-opsboard.png" alt="03 admin configure opsboard">
</div>
<div class="title">Figure 14. 导航到 <em>Ops Board</em> 配置</div>
</div>
<div class="paragraph">
<p>以下屏幕截图中描述了创建和修改 <em>Ops Boards</em>。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/webui/opsboard/04_add-dashlet.png" alt="04 add dashlet">
</div>
<div class="title">Figure 15. 将 Dashlet 添加到现有的 <em>Ops Board</em></div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建一个新的 <em>Ops Board</em>，来组织和安排不同的 <em>Dashlets</em></p>
</li>
<li>
<p>用于标识 <em>Ops Board</em> 的名称</p>
</li>
<li>
<p>添加 <em>Dashlet</em> 以显示 OpenNMS Horizon 监控信息</p>
</li>
<li>
<p>显示整个 <em>Ops Board</em> 预览</p>
</li>
<li>
<p>可用的 <em>Dashlets</em> 列表</p>
</li>
<li>
<p><em>Dashlet</em> 在 <em>Ops Board</em> 中滚动的 <em>优先级</em>，较低优先级意味着它将更频繁地显示</p>
</li>
<li>
<p><em>Dashlet</em> 在 <em>Ops Board</em> 中滚动显示的 <em>持续时间</em>，以秒为单位</p>
</li>
<li>
<p>如果 <em>Dashlet</em> 处于告警状态，则更改 <em>优先级</em>，这是可选的，并且可能并非在所有 <em>Dashlets</em> 中都可用</p>
</li>
<li>
<p>如果 <em>Dashlet</em> 处于告警状态，则更改 <em>持续时间</em>，这是可选的，并且可能并非所有 <em>Dashlets</em> 中都可用</p>
</li>
<li>
<p>此 <em>Dashlet</em> 的配置属性</p>
</li>
<li>
<p>从 <em>Ops Board</em> 中删除此 <em>Dashlet</em></p>
</li>
<li>
<p><em>Dashlets</em> 在 <em>Ops Board</em> 上的滚动顺序，和在 <em>Ops Panel</em> 中的标题视图</p>
</li>
<li>
<p>显示整个 <em>Ops Board</em> 的预览</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>通过在主菜单中导航到 <em>Dashboard &#8594; Ops Board</em>，可用配置 <em>Ops Board</em>。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/webui/opsboard/05_opsboard-user.png" alt="05 opsboard user">
</div>
<div class="title">Figure 16. 导航到 <em>Ops Board</em></div>
</div>
</div>
<div class="sect3">
<h4 id="_dashlets">3.4.2. Dashlets</h4>
<div class="paragraph">
<p>在 <em>Dashlets</em> 中实现信息的可视化。
本节将介绍不同 <em>Dashlets</em> 具有的所有可用配置参数。</p>
</div>
<div class="paragraph">
<p><em>Dashlet</em> 要配置过滤信息，可用使用通用 <a href="#webui-opsboard-criteria-builder">Criteria Builder</a>。</p>
</div>
<div class="sect4">
<h5 id="_告警详情">告警详情</h5>
<div class="paragraph">
<p>此 <em>告警-详情 Dashlet</em> 显示一个包含告警和详细信息的表。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. 告警信息</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">字段</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>告警 ID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenNMS Horizon 的告警 ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>严重级别</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">告警严重性 (Cleared, Indeterminate, Normal, Warning, Minor, Major, Critical)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>设备名称</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发生告警的设备名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>告警次数</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">告警重复发生次数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>最后事件时间</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">告警最后发生时间</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>日志消息</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">告警的原因和详细日志消息</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以使用以下参数配置 <em>告警详情 Dashlet</em>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#webui-opsboard-dashlet-boosting">提升严重级别</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#webui-opsboard-criteria-builder">Criteria Builder</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_告警">告警</h5>
<div class="paragraph">
<p>此 <em>告警 Dashlet</em> 显示一个具有短告警描述的表。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 4. 告警信息</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">字段</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>时间</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">告警出现的绝对时间</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>设备名称</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发生告警的设备名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UEI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenNMS Horizon 告警的 <em>唯一事件标识符</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以使用以下参数配置 <em>告警 Dashlet</em>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#webui-opsboard-dashlet-boosting">提升严重级别</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#webui-opsboard-criteria-builder">Criteria Builder</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_图表">图表</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示现有 <a href="http://www.opennms.org/wiki/Chart-configuration.xml">图表</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Chart</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要显示的现有图表的名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Maximize Width</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重新缩放图像以填充显示宽度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Maximize Height</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重新缩放图像以填充显示高度</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_grafana">Grafana</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 在给定时间范围内显示 <em>Grafana Dashboard</em>。
配置文件 <code>opennms.properties</code> 中定义的 <a href="#webui-grafana-dashboard-box">Grafana Dashboard Box</a> 配置用于访问 <em>Grafana</em> 实例。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>title</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要显示的 Grafana dashboard 的标题</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要显示的 Grafana Dashboard 的 URI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>from</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">开始时间范围</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>to</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">结束时间范围</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_图片">图片</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 按给定的 URL 显示图像。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imageUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要在此 <em>Dashlet</em> 中显示的图像的 URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maximizeHeight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重新缩放图像以填充显示高度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maximizeWidth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重新缩放图像以填充显示宽度</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_ksc自定义报表">KSC（自定义报表）</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示现有的 <a href="http://www.opennms.org/wiki/KSC_Reports">KSC 报表</a>。
该视图与 <em>KSC 报表</em> 相同，使用同样的排列和时间范围。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KSC-Report</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要在此 <em>Dashlet</em> 中显示的 KSC 报表的名称</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_地图">地图</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示 <a href="http://www.opennms.org/wiki/Geographical_Maps">地理地图</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>search</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">预定义 <a href="http://www.opennms.org/wiki/Geographical_Maps#Searching">搜索</a> 此 <em>Dashlet</em> 中地理地图中显示的节点子集</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_rrd">RRD</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示一个或多个 RRD 图。
可以在多个列和行中排列和排序 RRD 图。
所有 RRD 图都使用给定的宽度和高度进行规划。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Columns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Dashlet</em> 中的列数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Rows</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Dashlet</em> 中的行数</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KSC Report</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">从现有 KSC 报表导入 RRD 图并重新排列。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Graph Width</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此 <em>Dashlet</em> 中所有 RRD 图的通用宽度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Graph Height</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此 <em>Dashlet</em> 中所有 RRD 图的通用高度</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Timeframe value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">给定 <code>Timeframe type</code> 的编号</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Timeframe type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RRD 图的，分，时，天，周，月和年</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_rtc">RTC</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示 OpenNMS Horizon 起始页中配置的 SLA 类别。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_摘要">摘要</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示给定时间范围内产生告警的趋势。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#webui-opsboard-dashlet-boosting">提升严重级别</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeslot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">以秒为单位的时间段，用于按严重级别和 <em>UEI</em> 评估告警趋势。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_监控">监控</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示给定的 <a href="http://www.opennms.org/wiki/Surveillance_View_%28af%29">监视视图</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viewName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">已配置的 <em>监视视图</em> 的名称</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_拓扑图">拓扑图</h5>
<div class="paragraph">
<p>此 <em>Dashlet</em> 显示 <a href="http://www.opennms.org/wiki/Topology_Maps">拓扑图</a>。
可以使用以下参数配置 <em>拓扑图</em>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>focusNodes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定哪个节点是拓扑图的焦点</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>provider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应该显示哪种拓扑图，例如 Linkd, VMware</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>szl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置拓扑图的缩放级别</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_url">URL</h5>
<div class="paragraph">
<p>该 <em>Dashlet</em> 显示网页或其它网络应用程序的内容，例如，给定 URL 的其它监控系统。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">提升支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果需要基本身份验证，则为可选密码</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web 应用程序或 web 网页的 URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果需要基本身份验证，则为可选用户名</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="webui-opsboard-dashlet-boosting">3.4.3. 提升 <em>Dashlet</em></h4>
<div class="paragraph">
<p>提升 <em>Dashlet</em> 的特性，是 <em>Dashlet</em> 用来显示关键监视信息的功能。
它可以提高在 <em>Ops Board</em> 中的优先级，以指示问题。
可以使用配置参数 <em>Boost Priority</em> 和 <em>Boost Duration</em> 配置此行为。
这些配置参数会影响 <em>Ops Board</em> 上的滚动行为。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Boost Priority</em>: 具有关键监视信息的 <em>Dashlet</em> 的绝对优先级。</p>
</li>
<li>
<p><em>Boost Duration</em>: 具有关键监视信息的 <em>Dashlet</em> 的绝对持续时间，单位秒。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="webui-opsboard-criteria-builder">3.4.4. Criteria Builder</h4>
<div class="paragraph">
<p><em>Criteria Builder</em> 是用于过滤 <em>Dashlet</em> 信息的通用组件。
某些 <em>Dashlets</em> 使用此组件来过滤 <em>Dashlet</em> 上显示的信息。
可以组合多个 <em>Criteria</em>，来仅显示指定 <em>Dashlet</em> 中的信息子集。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 5. 通用 <em>Criteria Builder</em> 配置选项</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">选项</th>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">值1</th>
<th class="tableblock halign-left valign-top">值2</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Asc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">升序</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Desc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">降序</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Between</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">值1和值2之间的数据子集</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Contains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择包含给定数据库属性中给定文本字符串的所有数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Distinct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择一个实例</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Eq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性等于 (<code>==</code>) 给定文本字符串的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性大于等于 (<code>&gt;=</code>) 给定文本值的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Gt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性大于 (<code>&gt;</code>) 给定文本值的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ilike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>unknown</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>In</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>unknown</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Iplike</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性与给定 IPLIKE 表达式匹配的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性为 null 的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IsNotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性 <strong>不</strong> 为 null 的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Le</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性小于等于 (<code>&#8656;</code>) 给定文本值的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Lt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性小于 (<code>&lt;</code>) 给定文本值的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Like</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性类似于 SQL <code>like</code> 的给定文本值的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将结果集限制为给定数字</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ne</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选择属性不等于 (<code>!=</code>) 给定文本值的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>unknown</em> 区别于 <code>Ne</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrderBy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库属性</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">按给定属性排序结果集</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-admin-ui-jmx-config-generator">3.5. JMX 配置生成器</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 实现 <em>JMX</em> 协议，以采集 <em>Java</em> 应用程序的长期性能数据。
可以的指标种类繁多，管理员必须要选择采集哪些信息。
<em>JMX 配置生成工具</em> 帮助构建生成 <em>OpenNMS Horizon</em> 的复杂 <em>JMX</em> 数据采集配置和 <em>RRD 图</em> 定义。</p>
</div>
<div class="paragraph">
<p>此工具有 CLI 和基于 web 的两个版本。</p>
</div>
<div class="sect3">
<h4 id="_基于_web_的工具">3.5.1. 基于 Web 的工具</h4>
<div class="paragraph">
<p>可以从基于 web 的工具生成复杂的 <em>JMX</em> 数据采集配置。
它从启用了 <em>JMX</em> 的 Java 应用程序中采集所有可用的 <em>MBean 属性</em> 或 <em>复合数据属性</em>。</p>
</div>
<div class="paragraph">
<p>该工具的工作流程是:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>通过 <em>JMX</em> 或 <em>JMXMP</em> 连接 <em>Java</em> 应用程序的相应 <em>MBean Server</em></p>
</li>
<li>
<p>从应用程序中检索所有 <em>MBean</em> 和 <em>复合数据</em></p>
</li>
<li>
<p>选择由 <em>OpenNMS Horizon</em> 需要采集的指定 <em>MBeans</em> 和 <em>复合数据</em> 对象</p>
</li>
<li>
<p>为 <em>OpenNMS Horizon</em> 生成 <em>JMX Collectd</em> 配置文件和 <em>RRD 图</em> 定义，并且可以作为档案下载</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>支持以下连接设置:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>能够使用基于 <em>RMI</em> 的 <em>JMX</em> 连接到 <em>MBean Server</em></p>
</li>
<li>
<p><em>JMX</em> 连接的身份验证凭据</p>
</li>
<li>
<p>可选: JMXMP 连接</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>基于 web 的配置工具是在 <em>OpenNMS Horizon Web 应用程序</em> 中的管理部分 <em>Admin &#8594; JMX Configuration Generator</em>。</p>
</div>
<div class="sect4">
<h5 id="_配置_jmx_连接">配置 JMX 连接</h5>
<div class="paragraph">
<p>首先，必须配置与 <em>Java</em> 应用程序的 <em>MBean Server</em> 的连接。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operation/jmx-config-generator/01-webui-connection.png" alt="01 webui connection">
</div>
<div class="title">Figure 17. JMX 连接配置窗口</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Service name</em>: 要为 <em>Collectd</em> 绑定 <em>JMX</em> 数据采集的服务名称</p>
</li>
<li>
<p><em>Host</em>: 连接到 <em>MBean Server</em> 的 IP 地址或 <em>FQDN</em>，将 <em>MBeans</em> and <em>复合数据</em> 加载到生成工具中</p>
</li>
<li>
<p><em>Port</em>: 用于连接 <em>MBean Server</em> 的端口</p>
</li>
<li>
<p><em>Authentication</em>: 使用用户名和密码启用 / 禁用 <em>JMX</em> 连接的身份验证</p>
</li>
<li>
<p><em>Skip non-number values</em>: 使用非数字值跳过属性</p>
</li>
<li>
<p><em>JMXMP</em>: 启用 / 禁用 <em>JMX Messaging Protocol</em>，而不是使用 <em>JMX</em> over <em>RMI</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过单击箭头 ( <em>&gt;</em> ) 将使用给定的连接设置检索 <em>MBeans</em> 和 <em>复合数据</em>。
数据被加载到 <em>MBeans 配置</em> 页面，该页面允许选择要采集的指标配置。</p>
</div>
</div>
<div class="sect4">
<h5 id="_选择_mbeans_和_复合数据">选择 MBeans 和 复合数据</h5>
<div class="paragraph">
<p><em>MBeans 配置</em> 部分用于将 <em>MBean</em> 和 <em>复合数据属性</em> 分配给 <em>RRD 域</em> 的指定数据类型和数据源名称。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operation/jmx-config-generator/02-webui-mbean-selection.png" alt="02 webui mbean selection">
</div>
<div class="title">Figure 18. 为 OpenNMS Horizon 数据集合选择 MBeans 或复合数据</div>
</div>
<div class="paragraph">
<p>左侧边栏显示数结构，其中包含从 <em>MBean Server</em> 检索到的 <em>JMX Domain</em>, <em>MBeans</em> 和 <em>复合数据</em> 层次结构。
要选择或取消选择所有属性，请使用 <em>鼠标右键单击 &#8594; select/deselect</em>。</p>
</div>
<div class="paragraph">
<p>右侧面板显示带有 <em>RRD</em> 特定映射的 <em>MBean 属性</em>，并允许为数据采集配置选择或取消选择特定的 <em>MBean 属性</em> 或 <em>复合数据属性</em>。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operation/jmx-config-generator/03-webui-mbean-details.png" alt="03 webui mbean details">
</div>
<div class="title">Figure 19. 为数据集合配置添加 MBean 属性</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operation/jmx-config-generator/04-webui-composite-details.png" alt="04 webui composite details">
</div>
<div class="title">Figure 20. 为数据集合配置添加复合属性</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>MBean Name</em> or <em>Composite Alias</em>: 标识 <em>MBean</em> 或 <em>复合数据</em> 对象</p>
</li>
<li>
<p><em>Selected</em>: 启用/禁用 <em>MBean 属性</em> 或 <em>复合成员</em> 以包含在数据采集配置中</p>
</li>
<li>
<p><em>Name</em>: <em>MBean 属性</em> 或 <em>复合成员</em> 的名称</p>
</li>
<li>
<p><em>Alias</em>: 用于在 <em>RRD</em> 或 <em>JRobin</em> 文件中存储指标度量的 <em>数据源名称</em></p>
</li>
<li>
<p><em>Type</em>: <em>Gauge</em> 或 <em>Counter</em> 数据类型，用于在 <em>RRD</em> 或 <em>JRobin</em> 文件中存储指标度量</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>MBean Name</em>, <em>Composite Alias</em> 和 <em>Name</em> 需要进行特殊字符验证。
对于 <em>Alias</em> 输入，要不超过19个字符，并且必须在数据采集配置中是唯一的。</p>
</div>
</div>
<div class="sect4">
<h5 id="_下载和引入配置">下载和引入配置</h5>
<div class="paragraph">
<p>最后一步是为 <em>OpenNMS Horizon</em> 生成以下配置文件:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>collectd-configuration.xml</em>: 生成的样本配置分配给匹配数据采集组的服务</p>
</li>
<li>
<p><em>jmx-datacollection-config.xml</em>: 使用选定的 <em>MBeans</em> 和 <em>复合数据</em> 生成 <em>JMX</em> 数据集合配置</p>
</li>
<li>
<p><em>snmp-graph.properties</em>: 为所有选定的指标生成默认的 <em>RRD</em> 图定义文件</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以复制和粘贴配置文件的内容，也可以将其下载为 <em>ZIP 存档</em>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果配置文件的内容超过2,500行，则只能将文件下载为 <em>ZIP 存档</em>。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cli_based_utility">3.5.2. CLI based utility</h4>
<div class="paragraph">
<p>The command line <em>(CLI)</em> based tool is not installed by default.
It is available as <em>Debian</em> and <em>RPM</em> package in the official repositories.</p>
</div>
<div class="sect4">
<h5 id="_installation">Installation</h5>
<div class="listingblock">
<div class="title">RHEL based installation with Yum</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">yum install opennms-jmx-config-generator</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Debian based installation with apt</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">apt-get install opennms-jmx-config-generator</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Installation from source</div>
<p>It is required to have the <em>Java 8 Development Kit</em> with <em>Apache Maven</em> installed.
The <code>mvn</code> binary has to be in the path environment.
After cloning the repository you have to enter the source folder and compile an executable <em>JAR</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">cd opennms/features/jmx-config-generator
mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the newly created <code>target</code> folder a file named <code>jmxconfiggenerator-&lt;VERSION&gt;-onejar.jar</code> is present.
This file can be invoked by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">java -jar target/jmxconfiggenerator-23.0.1-onejar.jar</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_usage">Usage</h5>
<div class="paragraph">
<p>After installing the the <em>JMX Config Generator</em> the tool&#8217;s wrapper script is located in the <code>${OPENNMS_HOME}/bin</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ cd /path/to/opennms/bin
$ ./jmx-config-generator</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When invoked without parameters the usage and help information is printed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>JMX Config Generator</em> uses sub-commands for the different configuration generation tasks.
Each of these sub-commands provide different options and parameters.
The command line tool accepts the following sub-commands.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sub-command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queries a <em>MBean Server</em> for certain <em>MBeans</em> and <em>attributes</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generate-conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a valid <code>jmx-datacollection-config.xml</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generate-graph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a <em>RRD</em> graph definition file with matching graph definitions for a given <code>jmx-datacollection-config.xml</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following global options are available in each of the sub-commands of the tool:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option/Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h (--help)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show help and usage information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v (--verbose)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables verbose mode for debugging purposes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sub_command_query">Sub-command: query</h5>
<div class="paragraph">
<p>This sub-command is used to query a <em>MBean Server</em> for it&#8217;s available <em>MBean</em> objects.
The following example queries the server <code>myserver</code> with the credentials <code>myusername/mypassword</code> on port <code>7199</code> for <em>MBean objects</em> in the <code>java.lang</code> domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">./jmx-config-generator query --host myserver --username myusername --password mypassword --port 7199 "java.lang:*"
java.lang:type=ClassLoading
	description: Information on the management interface of the MBean
	class name: sun.management.ClassLoadingImpl
	attributes: (5/5)
		TotalLoadedClassCount
			id: java.lang:type=ClassLoading:TotalLoadedClassCount
			description: TotalLoadedClassCount
			type: long
			isReadable: true
			isWritable: false
			isIs: false
		LoadedClassCount
			id: java.lang:type=ClassLoading:LoadedClassCount
			description: LoadedClassCount
			type: int
			isReadable: true
			isWritable: false
			isIs: false

&lt;output omitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following command line options are available for the <em>query</em> sub-command.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option/Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;filter criteria&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A filter criteria to query the <em>MBean Server</em> for.
                                 The format is <code>&lt;objectname&gt;[:attribute name]</code>.
                                 The <code>&lt;objectname&gt;</code> accepts the default <em>JMX</em> object name pattern to identify the <em>MBeans</em> to be retrieved.
                                 If <code>null</code> all domains are shown.
                                 If no key properties are specified, the domain&#8217;s <em>MBeans</em> are retrieved.
                                 To execute for certain attributes, you have to add <code>:&lt;attribute name&gt;</code>.
                                 The <code>&lt;attribute name&gt;</code> accepts regular expressions.
                                 When multiple <code>&lt;filter criteria&gt;</code> are provided they are <code>OR</code> concatenated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--host &lt;host&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname or IP address of the remote <em>JMX</em> host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ids-only</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only show the ids of the attributes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ignore &lt;filter criteria&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>&lt;filter criteria&gt;</code> to ignore while running.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--include-values</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include attribute values.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--jmxmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <em>JMXMP</em> and not <em>JMX over RMI</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password &lt;password&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for <em>JMX</em> authentication.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--port &lt;port&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of <em>JMX</em> service.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--show-domains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only lists the available domains.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--show-empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes <em>MBeans</em>, even if they do not have attributes.
                                 Either due to the <code>&lt;filter criteria&gt;</code> or while there are none.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--url &lt;url&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom connection <em>URL</em><br>
                                 <code>&lt;hostname&gt;:&lt;port&gt;</code><br>
                                 <code>service:jmx:&lt;protocol&gt;:&lt;sap&gt;</code><br>
                                 <code>service:jmx:remoting-jmx://&lt;hostname&gt;:&lt;port&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--username &lt;username&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for <em>JMX</em> authentication.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h (--help)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show help and usage information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v (--verbose)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables verbose mode for debugging purposes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sub_command_generate_conf">Sub-command: generate-conf</h5>
<div class="paragraph">
<p>This sub-command can be used to generate a valid <code>jmx-datacollection-config.xml</code> for a given set of <em>MBean objects</em> queried from a <em>MBean Server</em>.</p>
</div>
<div class="paragraph">
<p>The following example generate a configuration file <code>myconfig.xml</code> for <em>MBean</em> objects in the <code>java.lang</code> domain of the server <code>myserver</code> on port <code>7199</code> with the credentials <code>myusername/mypassword</code>.
You have to define either an <em>URL</em> or a hostname and port to connect to a <em>JMX</em> server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">jmx-config-generator generate-conf --host myserver --username myusername --password mypassword --port 7199 "java.lang:*" --output myconfig.xml
Dictionary entries loaded: '18'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following options are available for the <em>generate-conf</em> sub-command.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option/Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;attribute id&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of attribute Ids to be included for the generation of the configuration file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dictionary &lt;file&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to a dictionary file for replacing attribute names and part of <em>MBean</em> attributes.
                            The file should have for each line a replacement, e.g. Auxillary:Auxil.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--host &lt;host&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname or IP address of <em>JMX</em> host.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--jmxmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <em>JMXMP</em> and not <em>JMX over RMI</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--output &lt;file&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output filename to write generated <code>jmx-datacollection-config.xml</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password &lt;password&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for <em>JMX</em> authentication.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--port &lt;port&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port of <em>JMX</em> service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--print-dictionary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the used dictionary to <em>STDOUT</em>.
                            May be used with <code>--dictionary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--service &lt;value&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>Service Name</em> used as <em>JMX</em> data collection name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anyservice</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipDefaultVM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip default JavaVM Beans.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipNonNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip attributes with non-number values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--url &lt;url&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom connection <em>URL</em><br>
                            <code>&lt;hostname&gt;:&lt;port&gt;</code><br>
                            <code>service:jmx:&lt;protocol&gt;:&lt;sap&gt;</code><br>
                            <code>service:jmx:remoting-jmx://&lt;hostname&gt;:&lt;port&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--username &lt;username&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for <em>JMX</em> authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h (--help)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show help and usage information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v (--verbose)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables verbose mode for debugging purposes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The option <code>--skipDefaultVM</code> offers the ability to ignore the <em>MBeans</em> provided as standard by the <em>JVM</em> and just create configurations for the <em>MBeans</em> provided by the <em>Java Application</em> itself.
This is particularly useful if an optimized configuration for the JVM already exists.
If the <code>--skipDefaultVM</code> option is not set the generated configuration will include the MBeans of the JVM and the MBeans of the Java Application.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Check the file and see if there are <code>alias</code> names with more than 19 characters.
           This errors are marked with <code>NAME_CRASH_AS_19_CHAR_VALUE</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_sub_command_generate_graph">Sub-command: generate-graph</h5>
<div class="paragraph">
<p>This sub-command generates a <em>RRD</em> graph definition file for a given configuration file.
The following example generates a graph definition file <code>mygraph.properties</code> using the configuration in file <code>myconfig.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">./jmx-config-generator generate-graph --input myconfig.xml --output mygraph.properties
reports=java.lang.ClassLoading.MBeanReport, \
java.lang.ClassLoading.0TotalLoadeClassCnt.AttributeReport, \
java.lang.ClassLoading.0LoadedClassCnt.AttributeReport, \
java.lang.ClassLoading.0UnloadedClassCnt.AttributeReport, \
java.lang.Compilation.MBeanReport, \
&lt;output omitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following options are available for this sub-command.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option/Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--input &lt;jmx-datacollection.xml&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration file to use as input to generate the graph properties file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--output &lt;file&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output filename for the generated graph properties file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--print-template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the default template.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--template &lt;file&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template file using <a href="http://velocity.apache.org"><em>Apache Velocity</em></a> template engine to be used to generate the graph properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h (--help)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show help and usage information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v (--verbose)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables verbose mode for debugging purposes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_graph_templates">Graph Templates</h5>
<div class="paragraph">
<p>The <em>JMX Config Generator</em> uses a template file to generate the graphs.
It is possible to use a user-defined template.
The option <code>--template</code> followed by a file lets the <em>JMX Config Generator</em> use the external template file as base for the graph generation.
The following example illustrates how a custom template <code>mytemplate.vm</code> is used to generate the graph definition file <code>mygraph.properties</code> using the configuration in file <code>myconfig.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">./jmx-config-generator generate-graph --input myconfig.xml --output mygraph.properties --template mytemplate.vm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The template file has to be an <a href="http://velocity.apache.org"><em>Apache Velocity</em></a> template.
The following sample represents the template that is used by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>reports=#foreach( $report in $reportsList )
${report.id}#if( $foreach.hasNext ), \
#end
#end

#foreach( $report in $reportsBody )

#[[###########################################]]#
#[[##]]# $report.id
#[[###########################################]]#
report.${report.id}.name=${report.name}
report.${report.id}.columns=${report.graphResources}
report.${report.id}.type=interfaceSnmp
report.${report.id}.command=--title="${report.title}" \
 --vertical-label="${report.verticalLabel}" \
#foreach($graph in $report.graphs )
 DEF:${graph.id}={rrd${foreach.count}}:${graph.resourceName}:AVERAGE \
 AREA:${graph.id}#${graph.coloreB} \
 LINE2:${graph.id}#${graph.coloreA}:"${graph.description}" \
 GPRINT:${graph.id}:AVERAGE:" Avg \\: %8.2lf %s" \
 GPRINT:${graph.id}:MIN:" Min \\: %8.2lf %s" \
 GPRINT:${graph.id}:MAX:" Max \\: %8.2lf %s\\n" \
#end

#end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>JMX Config Generator</em> generates different types of graphs from the <code>jmx-datacollection-config.xml</code>.
The different types are listed below:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AttributeReport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For each attribute of any <em>MBean</em> a graph will be generated.
                             Composite attributes will be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MbeanReport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For each <em>MBean</em> a combined graph with all attributes of the <em>MBeans</em> is generated.
                             Composite attributes will be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompositeReport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For each composite attribute of every <em>MBean</em> a graph is generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompositeAttributeReport</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For each composite member of every <em>MBean</em> a combined graph with all composite attributes is generated.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-admin-ui-heatmap">3.6. Heatmap</h3>
<div class="paragraph">
<p>The <em>Heatmap</em> can be either be used to display unacknowledged alarms or to display ongoing outages of nodes.
Each of this visualizations can be applied on categories, foreign sources or services of nodes.
The sizing of an entity is calculated by counting the services inside the entity.
Thus, a node with fewer services will appear in a smaller box than a node with more services.</p>
</div>
<div class="paragraph">
<p>The feature is by default deactivated and is configured through <code>opennms.properties</code>.</p>
</div>
<div class="paragraph">
<div class="title">Heatmap visualizations of alarms</div>
<p><span class="image"><img src="images/webui/heatmap/heatmap.png" alt="heatmap"></span></p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 6. Heatmap dashboard configuration properties</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.heatmap.defaultMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There exist two options for using the heatmap: <code>alarms</code> and
                                                           <code>outages</code>. This option configures which are displayed per
                                                           default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alarms</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.heatmap.defaultHeatmap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option defines which <em>Heatmap</em> is displayed by default.
                                                           Valid options are <code>categories</code>, <code>foreignSources</code> and
                                                           <code>monitoredServices</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>categories</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.heatmap.categoryFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The following option is used to filter for categories to be
                                                           displayed in the <em>Heatmap</em>. This option uses the Java regular
                                                           expression syntax. The default is <code>.*</code> so all categories will
                                                           be displayed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.heatmap.foreignSourceFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The following option is used to filter for foreign sources
                                                           to be displayed in the <em>Heatmap</em>. This option uses the Java
                                                           regular expression syntax. The default is <code>.*</code> so all foreign
                                                           sources will be displayed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.heatmap.serviceFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The following option is used to filter for services to be
                                                           displayed in the <em>Heatmap</em>. This option uses the Java regular
                                                           expression syntax. The default is <code>.*</code> so all services will
                                                           be displayed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.heatmap.onlyUnacknowledged</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option configures whether only unacknowledged alarms
                                                           will be taken into account when generating the alarm-based
                                                           version of the <em>Heatmap</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.web.console.centerUrl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can also place the <em>Heatmap</em> on the landing page by
                                                           setting this option to <code>/heatmap/heatmap-box.jsp</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/surveillance-box.jsp</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use negative lookahead expressions for excluding categories you wish not to be displayed in the heatmap,
e.g. by using an expression like <code>^(?!XY).*</code> you can filter out entities with names starting with <code>XY</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-admin-ui-trend">3.7. Trend</h3>
<div class="paragraph">
<p>The <em>Trend</em> feature allows to display small inline charts of database-based statistics.
These chart are accessible in the <em>Status</em> menu of the <em>OpenNMS'</em> web application.
Furthermore it is also possible to configure these charts to be displayed on the <em>OpenNMS'</em> landing page.
To achieve this alter the <code>org.opennms.web.console.centerUrl</code> property to also include the entry <code>/trend/trend-box.htm</code>.</p>
</div>
<div class="paragraph">
<div class="title">Trend chart structure</div>
<p><span class="image"><img src="images/webui/trend/trend-chart.png" alt="trend chart"></span></p>
</div>
<div class="paragraph">
<p>These charts can be configured and defined in the <code>trend-configuration.xml</code> file in your <em>OpenNMS'</em> <code>etc</code> directory.
The following sample defines a <em>Trend</em> chart for displaying nodes with ongoing outages.</p>
</div>
<div class="listingblock">
<div class="title">Sample <em>Trend</em> chart XML definition for displaying nodes with outages</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-XML" data-lang="XML">   &lt;trend-definition name="nodes"&gt;
        &lt;title&gt;Nodes&lt;/title&gt; <i class="conum" data-value="1"></i><b>(1)</b>
        &lt;subtitle&gt;w/ Outages&lt;/subtitle&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        &lt;visible&gt;true&lt;/visible&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        &lt;icon&gt;glyphicon-fire&lt;/icon&gt; <i class="conum" data-value="4"></i><b>(4)</b>
        &lt;trend-attributes&gt; <i class="conum" data-value="5"></i><b>(5)</b>
            &lt;trend-attribute key="sparkWidth" value="100%"/&gt;
            &lt;trend-attribute key="sparkHeight" value="35"/&gt;
            &lt;trend-attribute key="sparkChartRangeMin" value="0"/&gt;
            &lt;trend-attribute key="sparkLineColor" value="white"/&gt;
            &lt;trend-attribute key="sparkLineWidth" value="1.5"/&gt;
            &lt;trend-attribute key="sparkFillColor" value="#88BB55"/&gt;
            &lt;trend-attribute key="sparkSpotColor" value="white"/&gt;
            &lt;trend-attribute key="sparkMinSpotColor" value="white"/&gt;
            &lt;trend-attribute key="sparkMaxSpotColor" value="white"/&gt;
            &lt;trend-attribute key="sparkSpotRadius" value="3"/&gt;
            &lt;trend-attribute key="sparkHighlightSpotColor" value="white"/&gt;
            &lt;trend-attribute key="sparkHighlightLineColor" value="white"/&gt;
        &lt;/trend-attributes&gt;
        &lt;descriptionLink&gt;outage/list.htm?outtype=current&lt;/descriptionLink&gt; <i class="conum" data-value="6"></i><b>(6)</b>
        &lt;description&gt;${intValue[23]} NODES WITH OUTAGE(S)&lt;/description&gt; <i class="conum" data-value="7"></i><b>(7)</b>
        &lt;query&gt; <i class="conum" data-value="8"></i><b>(8)</b>
            &lt;![CDATA[
                select (
                    select
                        count(distinct nodeid)
                    from
                        outages o, events e
                    where
                        e.eventid = o.svclosteventid
                        and iflostservice &lt; E
                        and (ifregainedservice is null
                            or ifregainedservice &gt; E)
                ) from (
                    select
                        now() - interval '1 hour' * (O + 1) AS S,
                        now() - interval '1 hour' * O as E
                    from
                        generate_series(0, 23) as O
                ) I order by S;
            ]]&gt;
        &lt;/query&gt;
    &lt;/trend-definition&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>title of the <em>Trend</em> chart, see below for supported variable substitutions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>subtitle of the <em>Trend</em> chart, see below for supported variable substitutions</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>defines whether the chart is visible by default</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>icon for the chart, see <a href="http://getbootstrap.com/components/#glyphicons">Glyphicons</a> for viable options</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>options for inline chart, see <a href="http://omnipotent.net/jquery.sparkline/#common">jQuery Sparklines</a> for viable options</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the description link</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>the description text, see below for supported variable substitutions</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>the SQL statement for querying the chart&#8217;s values</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Don&#8217;t forget to limit the SQL query&#8217;s return values!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to use values or aggregated values in the title, subtitle and description fields.
The following table describes the available variable substitutions.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 7. Variables usable in definition&#8217;s title, subtitle and description fields</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intMax}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer maximum value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleMax}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intMin}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer minimum value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleMin}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intAvg}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer average value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleAvg}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">average value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intSum}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer sum of values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleSum}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum of value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intValue[]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of integer result values for the given SQL query</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleValue[]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of result values for the given SQL query</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intValueChange[]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of integer value changes for the given SQL query</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleValueChange[]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">array of value changes for the given SQL query</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intLastValue}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">last integer value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleLastValue}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">last value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${intLastValueChange}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">last integer value change</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${doubleLastValueChange}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Double</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">last value change</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can also display a single graph in your JSP files by including the file <code>/trend/single-trend-box.jsp</code> and specifying the <code>name</code> parameter.</p>
</div>
<div class="listingblock">
<div class="title">Sample JSP snippet to include a single <em>Trend</em> chart with name 'example'</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-XML" data-lang="XML">&lt;jsp:include page="/trend/single-trend-box.jsp" flush="false"&gt;
    &lt;jsp:param name="name" value="example"/&gt;
&lt;/jsp:include&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-service-assurance">4. 服务保障</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本节将介绍 <em>OpenNMS Horizon</em> 如何监测应用程序或管理代理的可用性和延迟的基本功能。</p>
</div>
<div class="paragraph">
<p>在 <em>OpenNMS Horizon</em> 中，这个任务由一个 <em>服务监测器</em> 框架提供。
主要组件是 <em>Pollerd</em>，它提供以下功能:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>跟踪管理资源的可用性计算或应用程序的状态</p>
</li>
<li>
<p>度量服务质量的响应时间</p>
</li>
<li>
<p>基于 <a href="#ga-service-assurance-critical-service">关键服务</a> 的设备和接口故障的关联</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面的图片显示了可用性和响应时间的模型和表示。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/01_node-model.png" alt="01 node model">
</div>
<div class="title">Figure 21. 时延度量和可用性表示</div>
</div>
<div class="paragraph">
<p>此信息基于调度的 <em>服务监测器</em> ，并且由 <em>Pollerd</em> 执行。
<em>服务</em> 可以使用任意的名称，并与 <em>服务监测器</em> 相关联。
例如，我们可以定义两个 <em>服务</em> <em>HTTP</em> 和 <em>HTTP-8080</em>，两个都和 <em>HTTP 服务监测器</em> 关联，但是配置不同的 <em>TCP 端口</em> 参数。
下图显示了 <em>Pollerd</em> 如何与 <em>OpenNMS</em> 中的其它组件以及要监控的应用程序或代理进行交互。</p>
</div>
<div class="paragraph">
<p>可用性计算的是过去24时内的，在 <em>监测视图</em>, <em>SLA 分组</em> 和 <em>设备详情页面</em> 显示。
响应时间被显示在 <em>IP 接口</em> 的 <em>资源图表</em> 中，在 <em>设备详情页面</em>。
通过单击 <em>设备详情页面</em> 上的 <em>服务名称</em>，可以查看 <em>服务监测器</em> 的配置参数。
<em>服务</em> 的状态可以是 <em>Up</em> 或 <em>Down</em>。</p>
</div>
<div class="paragraph">
<p>当 <em>服务监测器</em> 检测到一个故障时， <em>Pollerd</em> 将发送一个 <em>事件</em> ，用来创建一个 <em>告警</em>。
<em>事件</em> 也可以用来生成 <em>通知</em> ，来联系网络管理员。
下面的图片显示了 <em>OpenNMS</em> 中 <em>Pollerd</em> 的交互。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/02_service-assurance.png" alt="02 service assurance">
</div>
<div class="title">Figure 22. 在 <em>OpenNMS</em> 平台中使用 <em>Pollerd</em> 监测服务</div>
</div>
<div class="paragraph">
<p>在 <em>OpenNMS Horizon</em> 中 <em>Pollerd</em> 可以生成以下 <em>事件</em>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">事件名称</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/nodes/nodeLostService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>关键服务</em> 从正常到服务不可用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/nodes/nodeRegainedService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务恢复正常</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/nodes/interfaceDown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP接口上的 <em>关键服务</em> 不可用或全部服务不可用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/nodes/interfaceUp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接口上的 <em>关键服务</em> 重新恢复正常</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/nodes/nodeDown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设备的全部IP接口的所有关键服务不可用。
                                                整个主机在网络上是不可达的。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/nodes/nodeUp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一些 <em>关键服务</em> 又恢复正常。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>生成 <em>interfaceDown</em> 和 <em>nodeDown</em> 事件的行为，在 <a href="#ga-service-assurance-critical-service">关键服务</a> 章节中进行了描述。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这假设启用了设备故障处理。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="ga-pollerd-configuration">4.1. Pollerd 配置</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 8. 与 Pollerd 相关的配置和日志文件。</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/poller-configuration.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监测器的配置文件和模块全局配置</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/logs/poller.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Pollerd</em> 自身和所有监测器的日志文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/response-graph.properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务响应时间的 RRD 图定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/events/opennms.events.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Pollerd</em> 的事件定义，例如 <em>nodeLostService</em>, <em>interfaceDown</em> 或 <em>nodeDown</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可以在 <code>poller-configuration.xml</code> 配置文件修改服务监测器的特性。
配置文件的结构如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>全局模块配置</em>: 定义并行执行 <em>服务监测器</em> 的 <em>线程池</em> 大小。
定义和配置 <em>设备事件相关</em> 的 <em>关键服务</em> 。</p>
</li>
<li>
<p><em>轮询包</em>: 允许对 <em>服务监测器</em> 的配置参数进行分组的包。</p>
</li>
<li>
<p><em>Downtime 模型</em>: 在检测到一个 <em>故障</em> 的情况下，配置 <em>Pollerd</em> 执行测试。</p>
</li>
<li>
<p><em>监测器服务关联</em>: 基于服务名称，分配应用程序和网络管理协议的实现。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Pollerd 的全局配置参数</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;poller-configuration threads="30" <i class="conum" data-value="1"></i><b>(1)</b>
                      pathOutageEnabled="false" <i class="conum" data-value="2"></i><b>(2)</b>
                      serviceUnresponsiveEnabled="false"&gt; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>要并行运行的 <em>服务监测器</em> 的 <em>线程池</em> 大小</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>基于网络路径中的 <em>关键设备</em> 启用或禁用 <em>路径故障</em> 功能</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>如果服务没有响应，则生成 <em>serviceUnresponsive</em> 事件，而不是故障。
它防止 <em>Downtime Model</em> 在30秒后重新测试服务，并且防止假告警。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>通过重新启动 <em>OpenNMS Horizon</em> 和 <em>Pollerd</em> 来应用配置更改。
还可以通过发送 <em>事件</em> 来让 <em>Pollerd</em> 重新加载配置。
可以通过 <em>CLI</em> 或 <em>Web 用户界面</em> 发送 <em>事件</em> 。</p>
</div>
<div class="listingblock">
<div class="title">通过 CLI 发送配置重新加载事件</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">cd $OPENNMS_HOME/bin
./send-event.pl uei.opennms.org/internal/reloadDaemonConfig --parm 'daemonName Pollerd'</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/04_send-event-WebUI.png" alt="04 send event WebUI">
</div>
<div class="title">Figure 23. 使用 Web 用户界面发送配置重新加载事件</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
如果你在 <code>poller-configuration.xml</code> 中 <strong>新</strong> 定义了服务，则必须重新启动 <em>OpenNMS Horizon</em> 。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-service-assurance-critical-service">4.2. 关键服务</h3>
<div class="paragraph">
<p>在 <em>IP 网络</em> 上监控服务可能会浪费大量资源，尤其是在其中许多服务不可用的情况下。
当服务处于脱机状态或无法到达时，监控系统花费大部分时间在等待重试和超时。</p>
</div>
<div class="paragraph">
<p>为了提高效率，如果关键服务为 <em>Down</em> ，则 <em>OpenNMS</em> 认为接口上的所有服务都是 <em>Down</em>。
默认情况下， <em>OpenNMS</em> 使用 <em>ICMP</em> 作为关键服务。</p>
</div>
<div class="paragraph">
<p>下面的图片显示了如何使用一个 <em>关键服务</em> 来生成这些事件。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/03_node-outage-correlation.png" alt="03 node outage correlation">
</div>
<div class="title">Figure 24. 在 <em>OpenNMS Horizon</em> 平台中使用 <em>Pollerd</em> 组件来轮询服务的可用性</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) <em>设备</em> 上的关键服务都是 <em>Up</em> 的，直到发出了 <em>nodeLostService</em> 事件。</p>
</li>
<li>
<p>(2) 许多 <em>IP 接口</em> 中的一个关键服务 <em>Down</em> ，就会发送 <em>interfaceDown</em> 事件。
所有其它服务都会被探测，并且不会发送任何事件，服务就被认为是不可达的。</p>
</li>
<li>
<p>(3) <em>设备</em> 上的所有关键服务 <em>Down</em> ，才会发送 <em>nodeDown</em> 事件。
对其它 <em>IP 接口</em> 的所有其它服务都不进行探测，不发送任何事件，这些服务被假定为不可达。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>关键服务</em> 用于将 <em>服务</em> 故障与 <em>nodeDown</em> 或 <em>interfaceDown</em> 事件关联起来。
它是 <em>Pollerd</em> 的全局配置，定义在 <code>poller-configuration.xml</code> 文件中。
<em>OpenNMS Horizon</em> 默认情况下，开启此功能。</p>
</div>
<div class="listingblock">
<div class="title">Pollerd 中的关键服务配置</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;poller-configuration threads="30"
                      pathOutageEnabled="false"
                      serviceUnresponsiveEnabled="false"&gt;

  &lt;node-outage status="on" <i class="conum" data-value="1"></i><b>(1)</b>
               pollAllIfNoCriticalServiceDefined="true"&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;critical-service name="ICMP" /&gt; <i class="conum" data-value="3"></i><b>(3)</b>
  &lt;/node-outage&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>开启 <em>设备故障</em> 关系到 <em>关键服务</em> 的功能</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>可选: 在没有 <em>关键服务</em> 功能的情况下，设备的监测行为。
如果设置为 <code>true</code>，则所有服务将被轮询。
如果设置为 <code>false</code>，则设备存在于轮询包的第一项服务将被轮询，并且直到服务恢复，然后所有服务恢复后，设备恢复。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>定义 <em>设备故障</em> 相关的 <em>关键服务</em></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-service-assurance-downtime-model">4.3. Downtime Model</h3>
<div class="paragraph">
<p>默认情况下，服务的轮询时间为5分钟。
例如，为了检测由自动网络重路由引起的短服务故障，可以使用宕机时间模型。
在检测到服务故障时，轮询间隔减少到30秒，并持续5分钟。
如果服务在5分钟内恢复，则记录短故障，那么对服务可用性的影响将小于5分钟。
这种行为被称为 <em>宕机时间模型</em> ，并且是可以配置的。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/01_downtime-model.png" alt="01 downtime model">
</div>
<div class="title">Figure 25. 宕机时间模型是用来解决不间断故障的</div>
</div>
<div class="paragraph">
<p>在图 <a href="#ga-service-assurance-downtime-model">故障和宕机时间模型</a> 中有两个故障。
第一次故障显示为短故障，在90秒后检测为 <em>up</em>。
第二次故障现在没有解决，监测器没有检测到可用的服务，并且在前5分钟内不可用 (10此30秒的轮询)。
调度器将轮询器间隔更改为5分钟。</p>
</div>
<div class="listingblock">
<div class="title">宕机时间模型的默认配置示例</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;downtime interval="30000" begin="0" end="300000" /&gt;&lt;!-- 30s, 0, 5m --&gt;<i class="conum" data-value="1"></i><b>(1)</b>
&lt;downtime interval="300000" begin="300000" end="43200000" /&gt;&lt;!-- 5m, 5m, 12h --&gt;<i class="conum" data-value="2"></i><b>(2)</b>
&lt;downtime interval="600000" begin="43200000" end="432000000" /&gt;&lt;!-- 10m, 12h, 5d --&gt;<i class="conum" data-value="3"></i><b>(3)</b>
&lt;downtime interval="3600000" begin="432000000" /&gt;&lt;!-- 1h, 5d --&gt;<i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>故障发生后0到5分钟，轮询间隔将设置为30秒</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>在持续故障5分钟后，直到12小时，轮询间隔将被设置为5分钟</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>在持续故障12小时后，直到5天，轮询间隔将被设置为10分钟</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>在持续故障5天之后，服务将从监控系统中删除</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-service-assurance-path-outage">4.4. Path Outages（路径故障）</h3>
<div class="paragraph">
<p>一个中心的核心组件的故障可能导致许多节点的故障。
<em>Path Outages（路径故障）</em> 可用来抑制对于网络中定义 <em>Critical Path （关键路径）</em> 依赖的 <em>设备</em> 的 <em>通知</em>。
<em>关键路径</em> 必须从监控系统的网络角度配置。
默认情况下， <em>Path Outage （路径故障）</em> 特性被禁用，可以在配置文件 <code>pollerd-configuration.xml</code> 中启用。</p>
</div>
<div class="paragraph">
<p>下图显示了一个网络拓扑结构示例。</p>
</div>
<div id="path-outage-example" class="imageblock">
<div class="content">
<img src="images/service-assurance/02_path-outage.png" alt="02 path outage" width="600">
</div>
<div class="title">Figure 26. 路径故障示例</div>
</div>
<div class="paragraph">
<p>从监控系统的角度看来，名为 <em>default-gw-01</em> 的路由器处于两个网络的 <em>关键路径</em> 上。
如果路由器 <em>default-gw-01</em> down，则两个网络后面的任何节点都不可达，并且它们也将都不可达。
在这种情况下，管理员希望只收到 <em>default-gw-01</em> 的一个通知，而不是后面其它 <em>设备</em> 的。
在 <em>OpenNMS Horizon</em> 中构建此配置需要以下信息：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Parent Foreign Source</em>: 父节点的 <em>Foreign Source</em> 。</p>
</li>
<li>
<p><em>Parent Foreign ID</em>: 这个节点所依赖的父 <em>节点</em> 的 <em>Foreign ID</em> 。</p>
</li>
<li>
<p>选择 <em>Primary</em> 的 <em>IP 接口</em> 作为 <em>Critical IP</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这个例子中所有 <em>节点</em> 定义都在同一个 <em>Provisioning Requisition</em> 中，名称是 <code>Network-ACME</code> ，并且 <em>Foreign ID</em> 和 <em>Node Label （设备名称）</em> 相同。</p>
</div>
<div class="paragraph">
<p>在 Web UI 进入 <em>Admin &#8594; Configure OpenNMS &#8594; Manage Provisioning Requisitions &#8594; Edit the Requisition &#8594; Edit the Node &#8594; Path Outage</em> 配置网络路径，设置 <em>Parent Foreign Source</em>, <em>Parent Foreign ID</em> 和 <em>Provisioned Node</em>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 9. Provisioning 的拓扑示例</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parent Foreign Source</th>
<th class="tableblock halign-left valign-top">Parent Foreign ID</th>
<th class="tableblock halign-left valign-top">Provisioned Node</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>not defined</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>not defined</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-gw-01</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Network-ACME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-gw-01</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>node-01</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Network-ACME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-gw-01</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>node-02</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Network-ACME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-gw-01</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-gw02</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Network-ACME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-gw-02</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>node-03</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Network-ACME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default-gw-02</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>node-04</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
选择 <em>Primary</em> 的 <em>IP Interface （IP接口）</em> 为 <em>Critical IP （关键IP）</em>.
           在这个例子中最重要的是在网络 <em>192.168.1.0/24</em> 中的 <em>default-gw-01</em> 上的 <em>IP 接口</em> 设置为 <em>Primary</em> 接口。
           在网络 <em>172.23.42.0/24</em> 中的 <em>default-gw-02</em> 上的IP接口设置为 <em>Primary</em> 接口。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-pollerd-packages">4.5. Polling Packages（轮询包）</h3>
<div class="paragraph">
<p>为了定义更复杂的监控配置，可以将 <em>服务</em> 配置分组到 <em>Polling Packages （轮询包）</em> 里。
它们允许分配 <em>设备</em> 到不同的 <em>服务配置</em> 里。
为了将 <em>轮询包</em> 分配给设备，可以使用 <a href="http://www.opennms.org/wiki/Filters">Rules/Filters</a> 语法。
每个 <em>轮询包</em> 可以包含自己的 <a href="#ga-service-assurance-downtime-model">Downtime 模型</a> 配置。</p>
</div>
<div class="paragraph">
<p>可以配置多个包，并且一个接口可以存在于多个包中。
这为确定服务级别提供了很大灵活性。</p>
</div>
<div class="listingblock">
<div class="title">分配给设备具有规则过滤器的轮询包</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;package name="example1"&gt;<i class="conum" data-value="1"></i><b>(1)</b>
  &lt;filter&gt;IPADDR != '0.0.0.0'&lt;/filter&gt;<i class="conum" data-value="2"></i><b>(2)</b>
  &lt;include-range begin="1.1.1.1" end="254.254.254.254" /&gt;<i class="conum" data-value="3"></i><b>(3)</b>
  &lt;include-range begin="::1" end="ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff" /&gt;<i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>轮询包名称必须唯一。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>过滤器可以基于 IP 地址，设备类别，或 <em>设备</em> 的资产属性，参考 <a href="http://www.opennms.org/wiki/Filters">Rules/Filters</a>。
过滤器会首先使用，并且是 <strong>必须的</strong>。
这个包用于所有 <em>IP 接口</em> ，除了 0.0.0.0 的 <em>IP 地址</em>，并且是 <strong>必须的</strong>。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>允许指定 <em>服务</em> 的配置是否应用于一个 <em>IP 接口</em> (IPv4 或 IPv6) 范围。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>可以添加一个或多个特定的 <em>IP-接口</em> 来代替 <code>include-range</code>:</p>
</div>
<div class="listingblock">
<div class="title">定义一个特定的 <em>IP 接口</em></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;specific&gt;192.168.1.59&lt;/specific&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以将 <em>IP 接口</em> 排除在外:</p>
</div>
<div class="listingblock">
<div class="title">排除 IP 接口</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;exclude-range begin="192.168.0.100" end="192.168.0.104"/&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="ga-pollerd-packages-response-time-config">4.5.1. 响应时间配置</h4>
<div class="paragraph">
<p>使用 <em>轮询包</em> 可以定义具有不同轮询间隔的相似范围。
所有响应时间值都保存在 <em>RRD 文件</em> 中，并且需要定义。
每个 <em>轮询包</em> 包含一个 <em>RRD</em> 定义</p>
</div>
<div class="listingblock">
<div class="title">轮询包 example1 的 RRD 配置</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;package name="example1"&gt;
  &lt;filter&gt;IPADDR != '0.0.0.0'&lt;/filter&gt;
  &lt;include-range begin="1.1.1.1" end="254.254.254.254" /&gt;
  &lt;include-range begin="::1" end="ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff" /&gt;
  &lt;rrd step="300"&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;<i class="conum" data-value="3"></i><b>(3)</b>
    &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;<i class="conum" data-value="4"></i><b>(4)</b>
    &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;<i class="conum" data-value="5"></i><b>(5)</b>
    &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;<i class="conum" data-value="6"></i><b>(6)</b>
&lt;/rrd&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>在这个 <em>轮询包</em> 中，所有服务的轮询间隔反映在300秒的步长中。
此包中的所有服务必须在5分钟内轮询完成，否则响应时间值不能正确存储。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>1 步长存储 2016 此: 1 * 5 min * 2016 = 7 天, 5 分钟精度存储 7 天。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>12 步长平均存储 1488 此: 12 * 5 min * 1488 = 62 天, 汇聚到 60 分钟，存储 62 天。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>288 步长平均存储 366 次: 288 * 5 min * 366 = 366 天, 汇聚至 24 小时，存储 366 天。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>288 步长最大值 24 小时，存储 366 天。</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>288 步长最小值 24 小时，存储 366 天。</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<em>RRD</em> 配置和服务轮询间隔必须均衡。
         否则，存储的响应时间数据不能在图表中正确显示。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
如果轮询间隔改变后，则需要用新定义的配置重新创建 <em>RRD</em> 文件。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ga-pollerd-packages-overlapping-service">4.5.2. 覆盖服务</h4>
<div class="paragraph">
<p>通过指定多个 <em>轮询包</em> ，可以多次使用与 <em>ICMP</em> 相同的 <em>服务</em> 。
当 <em>IP 接口</em> 匹配具有相同 <em>服务</em> 配置的多个 <em>轮询包</em> 时，如何定义 <code>poller-configuration.xml</code> 中 <em>轮询包</em> 的顺序非常重要。</p>
</div>
<div class="paragraph">
<p>下面的示例显示针对特定服务应用配置:</p>
</div>
<div class="listingblock">
<div class="title">重写</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;package name="less-specific"&gt;
  &lt;filter&gt;IPADDR != '0.0.0.0'&lt;/filter&gt;
  &lt;include-range begin="1.1.1.1" end="254.254.254.254" /&gt;
  &lt;include-range begin="::1" end="ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff" /&gt;
  &lt;rrd step="300"&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
  &lt;/rrd&gt;
  &lt;service name="ICMP" interval="300000" user-defined="false" status="on"&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;parameter key="retry" value="5" /&gt;<i class="conum" data-value="3"></i><b>(3)</b>
    &lt;parameter key="timeout" value="10000" /&gt;<i class="conum" data-value="4"></i><b>(4)</b>
    &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response" /&gt;
    &lt;parameter key="rrd-base-name" value="icmp" /&gt;
    &lt;parameter key="ds-name" value="icmp" /&gt;
  &lt;/service&gt;
  &lt;downtime interval="30000" begin="0" end="300000" /&gt;
  &lt;downtime interval="300000" begin="300000" end="43200000" /&gt;
  &lt;downtime interval="600000" begin="43200000" end="432000000" /&gt;
&lt;/package&gt;

&lt;package name="more-specific"&gt;
  &lt;filter&gt;IPADDR != '0.0.0.0'&lt;/filter&gt;
  &lt;include-range begin="192.168.1.1" end="192.168.1.254" /&gt;
  &lt;include-range begin="2600::1" end="2600:::ffff" /&gt;
  &lt;rrd step="30"&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;rra&gt;RRA:AVERAGE:0.5:1:20160&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:12:14880&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:288:3660&lt;/rra&gt;
    &lt;rra&gt;RRA:MAX:0.5:288:3660&lt;/rra&gt;
    &lt;rra&gt;RRA:MIN:0.5:288:3660&lt;/rra&gt;
  &lt;/rrd&gt;
  &lt;service name="ICMP" interval="30000" user-defined="false" status="on"&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;parameter key="retry" value="2" /&gt;<i class="conum" data-value="3"></i><b>(3)</b>
    &lt;parameter key="timeout" value="3000" /&gt;<i class="conum" data-value="4"></i><b>(4)</b>
    &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response" /&gt;
    &lt;parameter key="rrd-base-name" value="icmp" /&gt;
    &lt;parameter key="ds-name" value="icmp" /&gt;
  &lt;/service&gt;
  &lt;downtime interval="10000" begin="0" end="300000" /&gt;
  &lt;downtime interval="300000" begin="300000" end="43200000" /&gt;
  &lt;downtime interval="600000" begin="43200000" end="432000000" /&gt;
&lt;/package&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>包中的轮询间隔为 300 秒和 30 秒</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>服务 <em>ICMP</em> 的不同轮询间隔</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>服务 <em>ICMP</em> 的不同重试设置</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>服务 <em>ICMP</em> 的不同超时设置</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>服务的最后一个 <em>轮询包</em> 将被应用。
这可以用于为默认配置定义较少匹配的过滤器。
可以使用更具体的 <em>轮询包</em> 覆盖默认设置。
在上面的示例中，在 <em>192.168.1/24</em> 或 <em>2600:/64</em> 中所有的 <em>IP 接口</em> 将被具有不同轮询，重试和超时设置的 ICMP 轮询监控。</p>
</div>
<div class="paragraph">
<p>将哪个 <em>轮询包</em> 应用到 <em>IP 接口</em> 和 <em>服务</em> 可以在 <em>Web 用户界面</em> 找到。
<em>IP 接口</em> 和 <em>服务</em> 页面显示了哪个 <em>轮询包</em> 和 <em>服务</em> 配置应用于这个特定的服务。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/03_polling-package.png" alt="03 polling package">
</div>
<div class="title">Figure 27. 应用于 IP 接口和服务的轮询包</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-pollerd-packages-test-service-manually">4.5.3. 手动测试服务</h4>
<div class="paragraph">
<p>为了排除故障，可以在 <em>Karaf Shell</em> 上执行测试。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>ssh -p 8101 admin@localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>登录到 shell，你可以显示命令帮助如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>opennms&gt; poller:test --help
DESCRIPTION
        poller:test

        Execute a poller test from the command line using current settings from poller-configuration.xml

SYNTAX
        poller:test [options]

OPTIONS
        -s, --service
                Service name
        -p, --param
                Service parameter ~ key=value
        -i, --ipaddress
                IP Address to test
        -P, --package
                Poller Package
        -c, --class
                Monitor Class
        --help
                Display this help message</code></pre>
</div>
</div>
<div class="paragraph">
<p>下面的示例在特定的 <em>IP 接口</em> 上运行 <em>ICMP</em> 监测器。</p>
</div>
<div class="listingblock">
<div class="title">运行特定轮询包中定义的 ICMP 监测器配置</div>
<div class="content">
<pre class="prettyprint highlight"><code>opennms&gt; poller:test -i 10.23.42.1 -s ICMP -P example1</code></pre>
</div>
</div>
<div class="paragraph">
<p>允许调试模式的 <em>监测器</em> 配置。
重要的输出行，如下所示:</p>
</div>
<div class="listingblock">
<div class="title">在 CLI 上测试服务的重要输出</div>
<div class="content">
<pre class="prettyprint highlight"><code>Checking service ICMP on IP 10.23.42.1 <i class="conum" data-value="1"></i><b>(1)</b>
Package: example1 <i class="conum" data-value="2"></i><b>(2)</b>
Monitor: org.opennms.netmgt.poller.monitors.IcmpMonitor <i class="conum" data-value="3"></i><b>(3)</b>
Parameter ds-name : icmp <i class="conum" data-value="4"></i><b>(4)</b>
Parameter rrd-base-name : icmp <i class="conum" data-value="4"></i><b>(4)</b>
Parameter rrd-repository : /var/lib/opennms/rrd/response <i class="conum" data-value="4"></i><b>(4)</b>
Parameter retry : 2 <i class="conum" data-value="5"></i><b>(5)</b>
Parameter timeout : 3000 <i class="conum" data-value="5"></i><b>(5)</b>

Available ? true (status Up[1])</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>执行测试的 <em>服务</em> 和 <em>IP 接口</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>此测试的 <em>轮询包</em> 应用的 <em>服务</em> 配置</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>此测试使用的 <em>服务监测器</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>响应时间的 RRD 配置</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>此测试的重试和超时设置</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_在_karaf_shell_上测试过滤器">4.5.4. 在 Karaf Shell 上测试过滤器</h4>
<div class="paragraph">
<p>过滤器在具有 &lt;filter&gt; 语法的 opennms 配置中无处不在。
此 karaf shell 可用于验证过滤器。有关详细信息，请参阅 <a href="https://wiki.opennms.org/wiki/Filters">过滤器</a>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>ssh -p 8101 admin@localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>进入 shell 后，打印命令帮助如下</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>opennms&gt; filters:filter --help
DESCRIPTION
        filters:filter
	Enumerates nodes/interfaces that match a give filter
SYNTAX
        filters:filter filterRule
ARGUMENTS
        filterRule
                A filter Rule</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如：运行与 location（站点/位置）匹配的过滤规则</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>filters:filter  "location='MINION'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出显示如下</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>nodeId=2 nodeLabel=00000000-0000-0000-0000-000000ddba11 location=MINION
	IpAddresses:
		127.0.0.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>另一个例子：运行与设备位置和给定IP地址范围匹配的过滤器。
有关使用 IPLIKE 语法的详细信息，请参阅 <a href="https://wiki.opennms.org/wiki/IPLIKE">IPLIKE</a>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>filters:filter "location='Default' &amp; (IPADDR IPLIKE 172.*.*.*)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出显示如下</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>nodeId=3 nodeLabel=label1 location=Default
	IpAddresses:
		172.10.154.1
		172.20.12.12
		172.20.2.14
		172.01.134.1
		172.20.11.15
		172.40.12.18

nodeId=5 nodeLabel=label2 location=Default
	IpAddresses:
		172.17.0.111

nodeId=6 nodeLabel=label3 location=Default
	IpAddresses:
		172.20.12.22
		172.17.0.123</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
显示的设备信息将包含 nodeId, nodeLabel, location ，和可选的字段像 foreignId, foreignSource, categories ，如果存在。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-service-monitors">4.6. 服务监测器</h3>
<div class="paragraph">
<p>为了支持多种应用程序和管理代理， <em>Pollerd</em> 执行 <em>服务监测器</em>。
本节描述所有可用的内置 <em>服务监测器</em> ，并且可以通过配置完成复杂的监控。
关于如何扩展这些信息，请参考 <em>OpenNMS</em> 的 <em>开发指南</em> 。</p>
</div>
<div class="sect3">
<h4 id="ga-service-assurance-monitors-common-parameters">4.6.1. 常见配置参数</h4>
<div class="paragraph">
<p>应用程序或设备的对应 <em>监测器</em> 通常基于相应的常用 API，并且指定相应的配置参数。
这些最小配置参数可以在所有 <em>监测器</em> 中使用，并附加超时、重试等参数。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 10. 常用的配置参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">测试 <em>服务</em> 重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行 isReachable 方法的超时时间，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>invert-status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否反转监测器 up/down 状态</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
如果 <em>监测器</em> 正在使用 <em>SNMP 协议</em> ，那么 <code>timeout</code> 和 <code>retry</code> 默认使用的是 <em>SNMP 配置</em> (<code>snmp-config.xml</code>)。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="ga-service-assurance-monitors-minion-parameters">Minion 配置参数</h5>
<div class="paragraph">
<p>当使用非默认站点设备时，相关 <em>服务监测器</em> 将与 <em>Minion</em> 使用相同站点的配置。
如果在给定的站点有多个 <em>Minions</em> ，可以在当前任意一个 <em>Minions</em> 上执行 <em>服务监测器</em> 。
用户可以选择在特定的 <em>Minion</em> 上执行 <em>服务监测器</em> ，通过指定 <em>Minion</em> 的 <em>System ID</em> 。
这种机制用来让 <em>Minions</em> 单独监控。</p>
</div>
<div class="paragraph">
<p>可以使用以下参数来覆盖 <em>服务监测器</em> 执行的站点 <strong>位置</strong>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 11. Minion 配置参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定应该执行 <em>服务监测器</em> 的站点。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(设备关联的位置)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>system-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定应该执行 <em>服务监测器</em> 的 <em>System ID</em> 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(None)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-foreign-id-as-system-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用关联设备的外部源id，作为 <em>System ID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
当指定一个 <em>System ID</em> 时，该位置应该与系统设置的位置一致。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-service-assurance-monitors-placeholder-substitution-parameters">4.6.2. 在参数中使用占位符</h4>
<div class="paragraph">
<p>一些监测器参数支持占位符替换。
可以将某些设备、接口和资产记录属性封装在 <code>{</code> 和 <code>}</code> 中来引用它们。
支持的属性是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>nodeId</code></p>
</li>
<li>
<p><code>nodeLabel</code></p>
</li>
<li>
<p><code>foreignSource</code></p>
</li>
<li>
<p><code>foreignId</code></p>
</li>
<li>
<p><code>ipAddr</code> (或 <code>ipAddress</code>)</p>
</li>
<li>
<p>所有设备资产记录字段 (例如 <code>username</code>, <code>password</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>支持占位符替换的参数在监测器文档的 <strong>配置与使用</strong> 部分的 '占位符替换' 列中标记 'Yes'。</p>
</div>
</div>
<div class="sect3">
<h4 id="_availabilitymonitor">4.6.3. AvailabilityMonitor</h4>
<div class="paragraph">
<p>该监测器通过使用 <em>InetAddress</em> java 类的 <em>isReachable</em> 方法来测试设备的可达性。
如果 isReachable 返回 true，则认为服务可用。
参考 <a href="http://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#isReachable%28int%29">Oracle&#8217;s documentation</a> 更多的细节。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
该监测器与 <a href="#poller-icmp-monitor">IcmpMonitor</a> 监测器是不同的。你应该只在远程轮询器运行该监测器，并且使用不同的配置
 (有关详细信息，请参考 <a href="#poller-availability-monitor-vs-icmp-monitor">below</a> )。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.AvailabilityMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用">配置与使用</h5>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="AVAIL" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="5000"/&gt;
&lt;/service&gt;

&lt;monitor service="AVAIL" class-name="org.opennms.netmgt.poller.monitors.AvailabilityMonitor"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="poller-availability-monitor-vs-icmp-monitor">IcmpMonitor 与 AvailabilityMonitor</h5>
<div class="paragraph">
<p>这个监测器用来当 <a href="#poller-icmp-monitor">IcmpMonitor</a> 监测器不能在远程轮询上启用的，以弥补这个限制。
现在，使用 JNA ICMP 实现，在大多数配置下远程轮询都启用了 IcmpMonitor 监测器，并且应该不需要改监测器，除非你使用不同的配置运行远程轮询器 (参考 <a href="http://issues.opennms.org/browse/NMS-6735">issue NMS-6735</a> 查看更多信息)。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bgpsessionmonitor">4.6.4. BgpSessionMonitor</h4>
<div class="paragraph">
<p>此监测器检查 BGP-Session 两端 (相对等-ip)是否具备相关功能。
为了监控 BGP-Session（会话），使用 RFC1269 SNMP MIB，并使用以下 OIDs 测试会话的状态：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>BGP_PEER_STATE_OID = .1.3.6.1.2.1.15.3.1.2.&lt;peer-ip&gt;
BGP_PEER_ADMIN_STATE_OID = .1.3.6.1.2.1.15.3.1.3.&lt;peer-ip&gt;
BGP_PEER_REMOTEAS_OID = .1.3.6.1.2.1.15.3.1.9.&lt;peer-ip&gt;
BGP_PEER_LAST_ERROR_OID = .1.3.6.1.2.1.15.3.1.14.&lt;peer-ip&gt;
BGP_PEER_FSM_EST_TIME_OID = .1.3.6.1.2.1.15.3.1.16.&lt;peer-ip&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;peer-ip&gt;</code>（对等ip）是 BGP 会话结束点的远端IP地址。</p>
</div>
<div class="paragraph">
<p>一个 SNMP get 请求获取 <code>BGP_PEER_STATE_OID</code> 的结果，返回结果在 <code>1</code> 到 <code>6</code> 之间。
OpenNMS Horizon 的服务状态映射如下：</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">结果</th>
<th class="tableblock halign-left valign-top">状态描述</th>
<th class="tableblock halign-left valign-top">在 OpenNMS Horizon 的监控状态</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Idle</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Connect</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Active</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OpenSent</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OpenConfirm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Established</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UP</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_监测器定义_2">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.BgpSessionMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>为了定义映射关系，我们使用了来自 <a href="http://www.freesoft.org/CIE/RFC/1771/31.htm">RFC1771 BGP Finite State Machine</a> 的描述。</p>
</div>
</div>
<div class="sect4">
<h5 id="_配置与使用_2">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bgpPeerIp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">远端 BGP 对等会话的IP地址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_2">实例</h5>
<div class="paragraph">
<p>为了监控会话状态是否建立，需要在轮询配置文件 '$OPENNMS_HOME/etc/poller-configuration.xml' 中添加 service（服务），例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Example configuration poller-configuration.xml --&gt;
&lt;service name="BGP-Peer-99.99.99.99-AS65423" interval="300000"
         user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2" /&gt;
    &lt;parameter key="timeout" value="3000" /&gt;
    &lt;parameter key="port" value="161" /&gt;
    &lt;parameter key="bgpPeerIp" value="99.99.99.99" /&gt;
&lt;/service&gt;

&lt;monitor service="BGP-Peer-99.99.99.99-AS65423" class-name="org.opennms.netmgt.poller.monitors.BgpSessionMonitor" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_错误代码映射">错误代码映射</h5>
<div class="paragraph">
<p><em>BGP_PEER_LAST_ERROR_OID</em> 给出的是十六进制代码的错误表示。
为了增加可读性，给出了一个代码映射表：</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">错误代码</th>
<th class="tableblock halign-left valign-top">错误消息</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Header Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0101</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Header Error - Connection Not Synchronized</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0102</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Header Error - Bad Message Length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0103</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Header Error - Bad Message Type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPEN Message Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0201</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPEN Message Error - Unsupported Version Number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0202</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPEN Message Error - Bad Peer AS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0203</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPEN Message Error - Bad BGP Identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0204</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPEN Message Error - Unsupported Optional Parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0205</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPEN Message Error (deprecated)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0206</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPEN Message Error - Unacceptable Hold Time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0300</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0301</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Malformed Attribute List</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0302</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Unrecognized Well-known Attribute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0303</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Missing Well-known Attribute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0304</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Attribute Flags Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0305</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Attribute Length Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0306</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Invalid ORIGIN Attribute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0307</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error (deprecated)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0308</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Invalid NEXT_HOP Attribute</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0309</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Optional Attribute Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>030A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Invalid Network Field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>030B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPDATE Message Error - Malformed AS_PATH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0400</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold Timer Expired</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0500</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finite State Machine Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0600</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0601</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Maximum Number of Prefixes Reached</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0602</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Administrative Shutdown</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0603</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Peer De-configured</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0604</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Administrative Reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0605</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Connection Rejected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0606</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Other Configuration Change</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0607</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Connection Collision Resolution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0608</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cease - Out of Resources</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>代替十六进制代码，错误消息将显示在服务 down 的日志消息中。
为了提高一些附加信息，日志消息也包含</p>
</div>
<div class="literalblock">
<div class="content">
<pre>BGP-Peer Adminstate
BGP-Peer Remote AS
BGP-Peer established time in seconds</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_调试">调试</h5>
<div class="paragraph">
<p>如果要检查或监控 BGP 会话有问题，可以使用以下命令找出问题原因。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">snmpwalk -v 2c -c &lt;myCommunity&gt; &lt;myRouter2Monitor&gt; .1.3.6.1.2.1.15.3.1.2.99.99.99.99</code></pre>
</div>
</div>
<div class="paragraph">
<p>用你的 BGP-Peer IP 替换 <code>99.99.99.99</code>。
结果应该是 <code>1</code> 到 <code>6</code> 之间的整数。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bsfmonitor">4.6.5. BSFMonitor</h4>
<div class="paragraph">
<p>此监测器运行 <em>Bean Scripting Framework</em> <a href="http://commons.apache.org/proper/commons-bsf/">BSF</a> 兼容的脚本来确定服务的状态。
用户可以编写脚本来执行高度定制的服务检查。
这个监测器没有进行优化。
它用于少量的自定义检查或原型的监控。</p>
</div>
<div class="sect4">
<h5 id="_bsfmonitor_与_systemexecutemonitor">BSFMonitor 与 SystemExecuteMonitor</h5>
<div class="paragraph">
<p><em>BSFMonitor</em> 避免了由 <em>SystemExecuteMonitor</em> 使用的 <em>fork(2)</em> 的开销。
<em>BSFMonitor</em> 还授予对脚本中使用 <em>OpenNMS Horizon</em> 内部方法和类的访问权。</p>
</div>
</div>
<div class="sect4">
<h5 id="_监测器定义_3">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.BSFMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_3">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 12. 监测器 <em>BSFMonitor</em> 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚本文件的路径。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bsf-engine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSF 引擎运行不同脚本语言<br>
                      <em>Bean Shell</em>: <code>bsh.util.BeanShellBSFEngine</code><br>
                      <em>Groovy</em>: <code>org.codehaus.groovy.bsf.GroovyEngine</code> <br>
                      <em>Jython</em>: <code>org.apache.bsf.engines.jython.JythonEngine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>run-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eval</code> 或 <code>exec</code> 之一</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eval</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lang-class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSF 语言类，像 <code>groovy</code> 或 <code>beanshell</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认情况下解析文件扩展名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file-extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">逗号分隔列表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 13. 可以在脚本中使用的 Beans</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Map&lt;String, Object&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>map</em> 包含从 <code>poller-configuration.xml</code> 配置文件的
                                                    service（服务）中定义的传递到监测器的各种参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ip_addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前轮询的 IP 地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>node_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>int</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ip_addr</code> 所属的设备的ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>node_label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ip_addr</code> 和服务所属的设备名称。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>svc_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要轮询的服务名称。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bsf_monitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>BSFMonitor</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>BSFMonitor</em> 对象调用的脚本实例。
                                                    通过它的 log(String sev, String fmt, Object... args) 方法进行日志记录。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>results</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HashMap&lt;String, String&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将脚本结果 put 到这个对象。
                                                    状态标识应该组合成键值对加入，key 使用 <code>status</code>。
                                                    如果状态不是 <code>OK</code>，那么使用 key 为 <code>reason</code> 添加问题描述。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>times</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>LinkedHashMap&lt;String, Number&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">脚本希望 put 一个或多个响应时间到这个对象。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>此外，添加到 <code>poller-configuration.xml</code> 中的 service（服务）定义的每个参数都可以作为脚本中的 <em>String</em> 对象。
参数的 key 属性表示 <em>String</em> 对象的名称，value 属性表示 <em>String</em> 对象的值。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
请注意，这些参数也可以通过 <em>map</em> bean 访问。
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
避免参数使用 non-character 的名称，以免在脚本语言中出现问题。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_响应代码">响应代码</h5>
<div class="paragraph">
<p>脚本必须提供表示关联服务状态的状态代码。
定义了下列状态代码：</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 14. 状态码</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">代码</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OK</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务可用</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UNK</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务状态未知</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UNR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务无响应</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>NOK</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务不可用</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_响应时间跟踪">响应时间跟踪</h5>
<div class="paragraph">
<p>默认情况下，<em>BSFMonitor</em> 执行脚本文件消耗的全部时间作为响应时间。
如果要存储响应时间，则需要添加以下参数：</p>
</div>
<div class="listingblock">
<div class="title">在 <code>poller-configuration.xml</code> 中定义 service（服务）的 RRD 响应时间</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- where in the filesystem response times are stored --&gt;
&lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response" /&gt;

&lt;!-- name of the rrd file --&gt;
&lt;parameter key="rrd-base-name" value="minimalbshbase" /&gt;

&lt;!-- name of the data source in the rrd file --&gt;
&lt;!-- by default "response-time" is used as ds-name --&gt;
&lt;parameter key="ds-name" value="myResponseTime" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>还可以直接从脚本返回一个或多个响应时间。
若要添加自定义响应时间或重写默认值，请向 <em>times</em> 对象添加条目。
这些条目使用 <em>String</em> 类型 key 的数据源，并且 value 是数值的响应时间。
若要覆盖默认响应时间数据源，请将一个名为 <code>response-time</code> 的条目添加到 <code>times</code> 中。</p>
</div>
</div>
<div class="sect4">
<h5 id="_超时与重试">超时与重试</h5>
<div class="paragraph">
<p><em>BSFMonitor</em> 本身不执行任何超时或重试处理。
如果需要重试和超时行为，则必须在脚本中实现。</p>
</div>
</div>
<div class="sect4">
<h5 id="_脚本的要求运行类型">脚本的要求（运行类型）</h5>
<div class="paragraph">
<p>根据 <code>run-type</code>，脚本必须以不同的方式提供结果。
对于简单逻辑的小脚本 <code>run-type</code> 使用 <code>eval</code>。
在 <code>eval</code> 模式下运行的脚本必须返回一个匹配 <code>status codes</code> 的 <em>String</em>。</p>
</div>
<div class="paragraph">
<p>如果你的脚本不是简单的，则 run-type` 配置为 <code>exec</code>。
在 <code>exec</code> 模式下运行的脚本不需要返回任何内容，但是它们必须向 <em>results</em> 对象添加带有 <code>status code</code> 的 <code>status</code> 条目。
此外，<em>results</em> 对象还可以携带一个 "reason":"message" 条目，用于非 <code>OK</code> 状态。</p>
</div>
</div>
<div class="sect4">
<h5 id="_常用语言设置">常用语言设置</h5>
<div class="paragraph">
<p><em>BSF</em> 支持多种语言，下表提供了常用语言所需的设置。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 15. <em>BSF</em> 语言设置</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">语言</th>
<th class="tableblock halign-left valign-top">语言名</th>
<th class="tableblock halign-left valign-top">bsf-引擎</th>
<th class="tableblock halign-left valign-top">所需库</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.beanshell.org">BeanShell</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>beanshell</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bsh.util.BeanShellBSFEngine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">supported by default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://groovy.codehaus.org">Groovy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>groovy</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.codehaus.groovy.bsf.GroovyEngine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy-all-[version].jar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.jython.org">Jython</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>jython</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.bsf.engines.jython.JythonEngine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jython-[version].jar</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_bean_shell_实例">Bean Shell 实例</h5>
<div class="listingblock">
<div class="title"><em>BeanShell</em> 在 <code>poller-configuration.xml</code> 中配置实例</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="MinimalBeanShell" interval="300000" user-defined="true" status="on"&gt;
  &lt;parameter key="file-name"  value="/tmp/MinimalBeanShell.bsh"/&gt;
  &lt;parameter key="bsf-engine" value="bsh.util.BeanShellBSFEngine"/&gt;
&lt;/service&gt;

&lt;monitor service="MinimalBeanShell" class-name="org.opennms.netmgt.poller.monitors.BSFMonitor" /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">BeanShell 实例， <code>MinimalBeanShell.bsh</code> 脚本文件</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">bsf_monitor.log("ERROR", "Starting MinimalBeanShell.bsf", null);
File testFile = new File("/tmp/TestFile");
if (testFile.exists()) {
  return "OK";
} else {
  results.put("reason", "file does not exist");
  return "NOK";
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groovy_实例">Groovy 实例</h5>
<div class="paragraph">
<p>要使用 Groovy 语言，需要一个额外的库。
将兼容的 groovy-all.jar 拷贝到 <code>opennms/lib</code> 文件夹，并重新启动 <em>OpenNMS Horizon</em>。</p>
</div>
<div class="listingblock">
<div class="title"><em>Groovy</em> 在配置文件 <code>poller-configuration.xml</code> 中的实例，默认 <code>run-type</code> 设置为 <code>eval</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="MinimalGroovy" interval="300000" user-defined="true" status="on"&gt;
  &lt;parameter key="file-name"  value="/tmp/MinimalGroovy.groovy"/&gt;
  &lt;parameter key="bsf-engine" value="org.codehaus.groovy.bsf.GroovyEngine"/&gt;
&lt;/service&gt;

&lt;monitor service="MinimalGroovy" class-name="org.opennms.netmgt.poller.monitors.BSFMonitor" /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><em>Groovy</em> 的实例 <code>MinimalGroovy.groovy</code> 脚本文件，<code>run-type</code> 配置为 <code>eval</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">bsf_monitor.log("ERROR", "Starting MinimalGroovy.groovy", null);
File testFile = new File("/tmp/TestFile");
if (testFile.exists()) {
  return "OK";
} else {
  results.put("reason", "file does not exist");
  return "NOK";
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Groovy 在 <code>poller-configuration.xml</code> 中的实例，<code>run-type</code> 设置为 <code>exec</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="MinimalGroovy" interval="300000" user-defined="true" status="on"&gt;
  &lt;parameter key="file-name"  value="/tmp/MinimalGroovy.groovy"/&gt;
  &lt;parameter key="bsf-engine" value="org.codehaus.groovy.bsf.GroovyEngine"/&gt;
  &lt;parameter key="run-type" value="exec"/&gt;
&lt;/service&gt;

&lt;monitor service="MinimalGroovy" class-name="org.opennms.netmgt.poller.monitors.BSFMonitor" /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><em>Groovy</em> 实例 <code>MinimalGroovy.groovy</code> 脚本文件，<code>run-type</code> 设置为 <code>exec</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">bsf_monitor.log("ERROR", "Starting MinimalGroovy", null);
def testFile = new File("/tmp/TestFile");
if (testFile.exists()) {
  results.put("status", "OK")
} else {
  results.put("reason", "file does not exist");
  results.put("status", "NOK");
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jython_实例">Jython 实例</h5>
<div class="paragraph">
<p>要使用 <em>Jython</em> (<em>Python</em> 的 <em>Java</em> 实现) 语言，需要一个额外的库。
将一个兼容的 <code>jython-x.y.z.jar</code> 拷贝到 <code>opennms/lib</code> 文件夹中，并重新启动 <em>OpenNMS Horizon</em>。
这样，<em>BSFMonitor</em> 就可以使用 <em>Jython</em> 了。</p>
</div>
<div class="listingblock">
<div class="title">Jython 在 <code>poller-configuration.xml</code> 中的配置实例，<code>run-type</code> 配置为 <code>exec</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="MinimalJython" interval="300000" user-defined="true" status="on"&gt;
  &lt;parameter key="file-name"  value="/tmp/MinimalJython.py"/&gt;
  &lt;parameter key="bsf-engine" value="org.apache.bsf.engines.jython.JythonEngine"/&gt;
  &lt;parameter key="run-type" value="exec"/&gt;
&lt;/service&gt;

&lt;monitor service="MinimalJython" class-name="org.opennms.netmgt.poller.monitors.BSFMonitor" /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><em>Jython</em> 实例 <code>MinimalJython.py</code> 脚本文件，<code>run-type</code> 设置为 <code>exec</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-python" data-lang="python">from java.io import File

bsf_monitor.log("ERROR", "Starting MinimalJython.py", None);
if (File("/tmp/TestFile").exists()):
        results.put("status", "OK")
else:
        results.put("reason", "file does not exist")
        results.put("status", "NOK")</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这里必须将 <code>run-type</code> 设置为 <code>exec</code>，因为在 <code>eval</code> 模式下，<em>Jython</em> 将阻塞在 import 关键字。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
为了证明这是真正的 <em>Python</em>，注意在日志调用中将 <em>Python&#8217;s</em> None 值替换为 Java&#8217;s null 。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_高级实例">高级实例</h5>
<div class="paragraph">
<p>下面的示例引用向脚本公开的所有 beans，包括自定义参数。</p>
</div>
<div class="listingblock">
<div class="title"><em>Groovy</em> 在 <code>poller-configuration.xml</code> 中配置实例</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="MinimalGroovy" interval="30000" user-defined="true" status="on"&gt;
  &lt;parameter key="file-name"  value="/tmp/MinimalGroovy.groovy"/&gt;
  &lt;parameter key="bsf-engine" value="org.codehaus.groovy.bsf.GroovyEngine"/&gt;

  &lt;!-- custom parameters (passed to the script) --&gt;
  &lt;parameter key="myParameter" value="Hello Groovy" /&gt;

  &lt;!-- optional for response time tracking --&gt;
  &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response" /&gt;
  &lt;parameter key="rrd-base-name" value="minimalgroovybase" /&gt;
  &lt;parameter key="ds-name" value="minimalgroovyds" /&gt;
&lt;/service&gt;

&lt;monitor service="MinimalGroovy" class-name="org.opennms.netmgt.poller.monitors.BSFMonitor" /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><em>Groovy</em> 实例 <em>Bean</em> 引用脚本文件</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">bsf_monitor.log("ERROR", "Starting MinimalGroovy", null);

//list of all available objects from the BSFMonitor
Map&lt;String, Object&gt; map = map;
bsf_monitor.log("ERROR", "---- map ----", null);
bsf_monitor.log("ERROR", map.toString(), null);

String ip_addr = ip_addr;
bsf_monitor.log("ERROR", "---- ip_addr ----", null);
bsf_monitor.log("ERROR", ip_addr, null);

int node_id = node_id;
bsf_monitor.log("ERROR", "---- node_id ----", null);
bsf_monitor.log("ERROR", node_id.toString(), null);

String node_label = node_label;
bsf_monitor.log("ERROR", "---- node_label ----", null);
bsf_monitor.log("ERROR", node_label, null);

String svc_name = svc_name;
bsf_monitor.log("ERROR", "---- svc_name ----", null);
bsf_monitor.log("ERROR", svc_name, null);

org.opennms.netmgt.poller.monitors.BSFMonitor bsf_monitor = bsf_monitor;
bsf_monitor.log("ERROR", "---- bsf_monitor ----", null);
bsf_monitor.log("ERROR", bsf_monitor.toString(), null);

HashMap&lt;String, String&gt; results = results;
bsf_monitor.log("ERROR", "---- results ----", null);
bsf_monitor.log("ERROR", results.toString(), null);

LinkedHashMap&lt;String, Number&gt; times = times;
bsf_monitor.log("ERROR", "---- times ----", null);
bsf_monitor.log("ERROR", times.toString(), null);

// reading a parameter from the service definition
String myParameter = myParameter;
bsf_monitor.log("ERROR", "---- myParameter ----", null);
bsf_monitor.log("ERROR", myParameter, null);

// minimal example
def testFile = new File("/tmp/TestFile");
if (testFile.exists()) {
  bsf_monitor.log("ERROR", "Done MinimalGroovy ---- OK ----", null);
  return "OK";
} else {

  results.put("reason", "file does not exist");
  bsf_monitor.log("ERROR", "Done MinimalGroovy ---- NOK ----", null);
  return "NOK";
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ciscoipslamonitor">4.6.6. CiscoIpSlaMonitor</h4>
<div class="paragraph">
<p>这个监测器可以用来检测 Cisco 设备上的 IP SLA 配置。
此监测器支持以下的 SNMP OIDS <a href="http://tools.cisco.com/Support/SNMP/do/BrowseOID.do?local=en&amp;translate=Translate&amp;objectInput=1.3.6.1.4.1.9.9.42">CISCO-RTT-MON-MIB</a>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>RTT_ADMIN_TAG_OID = .1.3.6.1.4.1.9.9.42.1.2.1.1.3
RTT_OPER_STATE_OID = .1.3.6.1.4.1.9.9.42.1.2.9.1.10
RTT_LATEST_OPERSENSE_OID = .1.3.6.1.4.1.9.9.42.1.2.10.1.2
RTT_ADMIN_THRESH_OID = .1.3.6.1.4.1.9.9.42.1.2.1.1.5
RTT_ADMIN_TYPE_OID = .1.3.6.1.4.1.9.9.42.1.2.1.1.4
RTT_LATEST_OID = .1.3.6.1.4.1.9.9.42.1.2.10.1.1</pre>
</div>
</div>
<div class="paragraph">
<p>监测器可以在两种情况下运行。
第一个测试 <em>RTT_LATEST_OPERSENSE</em> 是一个用于最新 RTT 操作的完成状态的传感代码。
如果 <em>RTT_LATEST_OPERSENSE</em> 返回 <em>ok(1)</em> ，则服务被标记为 <em>up</em>。</p>
</div>
<div class="paragraph">
<p>第二种方案是检测在 <em>IP SLA</em> 协议中的阀值配置。
如果 <em>RTT_LATEST_OPERSENSE</em> 返回 <em>overThreshold(3)</em> ，则服务被标记为 <em>down</em>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_4">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.CiscoIpSlaMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_4">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 16. 监测器 CiscoIpSlaMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin-tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag</code> 属性用于你想检测的 <em>IP SLA</em> 的配置。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ignore-thresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值表示是否只检测状态或配置的阀值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_http_和_icmp_应答示例">HTTP 和 ICMP 应答示例</h5>
<div class="paragraph">
<p>在这个例子中，我们配置了一个 IP SLA 记录，用 Cisco 设备来检测 Google 网站的 <em>HTTP GET</em> 请求。
我们使用 8.8.8.8 作为 DNS 解析器。
在我们的例子中，我们的 SLA 显示我们可以在200毫秒之内到达 Google 的网站。
为了通知同事这个监测器条目用于监控，我将所有者设置为 <em>OpenNMS</em>。
标签 <code>tag</code> 用于标识 SNMP 表后面的检测条目。</p>
</div>
<div class="listingblock">
<div class="title">Cisco 设备配置 <em>HTTP GET</em> 请求的 IP SLA 实例</div>
<div class="content">
<pre class="prettyprint highlight"><code>ip sla monitor 1
 type http operation get url http://www.google.de name-server 8.8.8.8
 timeout 3000
 threshold 200
 owner OpenNMS
 tag Google Website
ip sla monitor schedule 3 life forever start-time now</code></pre>
</div>
</div>
<div class="paragraph">
<p>在第二个示例中，我们配置一个 IP SLA 来测试从 Cisco 设备的角度，来自 www.opennms.org IP地址是否可以通过 ICMP 访问。
像上面的例子一样，我们有一个门限和一个超时.</p>
</div>
<div class="listingblock">
<div class="title">Cisco 设备配置 <em>ICMP</em> 检测的 IP SLA 实例</div>
<div class="content">
<pre class="prettyprint highlight"><code>ip sla 1
 icmp-echo 64.146.64.212
 timeout 3000
 threshold 150
 owner OpenNMS
 tag OpenNMS Host
ip sla schedule 1 life forever start-time now</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
重新配置 IP SLA 条目是不可能的。
         如果要更改参数，则必须删除整个配置并用新参数重新配置它.
         手动备份你的 Cisco 配置请参考 <a href="http://www.shrubbery.net/rancid/">RANCID</a>。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要检测这两个服务，要在 <code>poller-configuration.xml</code> 中配置两个实例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="IP-SLA-WEB-Google" interval="300000"
  user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2" /&gt;
    &lt;parameter key="timeout" value="3000" /&gt;
    &lt;parameter key="admin-tag" value="Google Website" /&gt;
    &lt;parameter key="ignore-thresh" value="false" /&gt;<i class="conum" data-value="1"></i><b>(1)</b>
&lt;/service&gt;
&lt;service name="IP-SLA-PING-OpenNMS" interval="300000"
  user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2" /&gt;
    &lt;parameter key="timeout" value="3000" /&gt;
    &lt;parameter key="admin-tag" value="OpenNMS Host" /&gt;
    &lt;parameter key="ignore-thresh" value="true" /&gt;<i class="conum" data-value="2"></i><b>(2)</b>
&lt;/service&gt;

&lt;monitor service="IP-SLA-WEB-Google" class-name="org.opennms.netmgt.poller.monitors.CiscoIpSlaMonitor" /&gt;
&lt;monitor service="IP-SLA-PING-OpenNMS" class-name="org.opennms.netmgt.poller.monitors.CiscoIpSlaMonitor" /&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>如果 IP SLA 状态为 <em>ok(1)</em>，则服务为 <em>up</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>如果 IP SLA 状态为 <em>overThreshold(3)</em>，则服务为 <em>down</em></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ciscopingmibmonitor">4.6.7. CiscoPingMibMonitor</h4>
<div class="paragraph">
<p>这个轮询器是使用 <em>ciscoPingTable</em> 来检测 <em>Cisco IOS</em> 设备，支持信息参考 <a href="http://tools.cisco.com/Support/SNMP/do/BrowseMIB.do?local=en&amp;mibName=CISCO-PING-MIB">CISCO-PING-MIB</a>。
这些检测项可以远程让 <em>IOS</em> 设备配置一组参数执行 IPv4 或 IPv6 地址 ping 命令。
在 <em>IOS</em> 设备完成 ping 操作之后，轮询监测器查询 <em>IOS</em> 设备，以确定结果。
如果结果和服务配置参数指示一致，则监测器报告服务可用，并且将可用性计算结果时间序列化(RRD)存储。
如果结果指示失败，则报告服务不可用，并描述原因代码。
如果在设置检测项或之后查询状态期间出现错误，则监测器的服务报告 <em>unknown</em> 状态。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
与大多数轮询器不同， <em>CiscoPingMibMonitor</em> 不接受 <code>timeout</code> 和 <code>retries</code> 参数。
参数 <code>packet-count</code> 和 <code>packet-timeout</code> 是提供给远程 <em>IOS</em> 设备，执行命令使用。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><em>CISCO_PING_MIB</em> 支持的 <em>MIB OIDs</em></div>
<div class="content">
<pre class="prettyprint highlight"><code> ciscoPingEntry             1.3.6.1.4.1.9.9.16.1.1.1
 ciscoPingSerialNumber      1.3.6.1.4.1.9.9.16.1.1.1.1
 ciscoPingProtocol          1.3.6.1.4.1.9.9.16.1.1.1.2
 ciscoPingAddress           1.3.6.1.4.1.9.9.16.1.1.1.3
 ciscoPingPacketCount       1.3.6.1.4.1.9.9.16.1.1.1.4
 ciscoPingPacketSize        1.3.6.1.4.1.9.9.16.1.1.1.5
 ciscoPingPacketTimeout     1.3.6.1.4.1.9.9.16.1.1.1.6
 ciscoPingDelay             1.3.6.1.4.1.9.9.16.1.1.1.7
 ciscoPingTrapOnCompletion  1.3.6.1.4.1.9.9.16.1.1.1.8
 ciscoPingSentPackets       1.3.6.1.4.1.9.9.16.1.1.1.9
 ciscoPingReceivedPackets   1.3.6.1.4.1.9.9.16.1.1.1.10
 ciscoPingMinRtt            1.3.6.1.4.1.9.9.16.1.1.1.11
 ciscoPingAvgRtt            1.3.6.1.4.1.9.9.16.1.1.1.12
 ciscoPingMaxRtt            1.3.6.1.4.1.9.9.16.1.1.1.13
 ciscoPingCompleted         1.3.6.1.4.1.9.9.16.1.1.1.14
 ciscoPingEntryOwner        1.3.6.1.4.1.9.9.16.1.1.1.15
 ciscoPingEntryStatus       1.3.6.1.4.1.9.9.16.1.1.1.16
 ciscoPingVrfName           1.3.6.1.4.1.9.9.16.1.1.1.17</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_准备条件">准备条件</h5>
<div class="ulist">
<ul>
<li>
<p>一个或多个 <em>Cisco</em> 设备，并且运行比较新版本 <em>IOS</em> ；任何 12.2 或更新版本都是可以的。
即使是非常低端的设备也支持 CISCO-PING-MIB。</p>
</li>
<li>
<p>执行远程 pings 命令的 <em>IOS</em> 设备通过 <em>SNMP 写团体名</em> 进行配置，OpenNMS Horizon 服务器包含源地址访问列表，<em>ciscoPingTable</em> 包含检测项 OID。</p>
</li>
<li>
<p>相应的 <em>SNMP 写团体名</em> 字符串可以在 <code>snmp-config.xml</code> 文件中顶层 <code>&lt;snmp-config&gt;</code> 元素上使用 <code>write-community</code> 属性进行配置，也可以在要执行远程 pings 的 <em>IOS</em> 设备的 <em>SNMP-primary</em> 接口对应的 <code>&lt;definition&gt;</code> 子元素上配置。</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_扩展信息">扩展信息</h5>
<div class="paragraph">
<p>这个监测器相当多时间是在等待状态，等待远程 <em>IOS</em> 设备完成 ping 操作。
监测器在计算创建 <em>ciscoPingTable</em> 检测项和它第一次尝试检索 ping 操作结果之间的延迟要是保守的&#8201;&#8212;&#8201;它至少要等待 (<code>packet-count * (packet-timeout + packet-delay)</code>) 毫秒，在检查远程 pings 是否完成之前。
因此，如果使用过大的 <code>packet-count</code>, <code>packet-timeout</code>, 和/或 <code>packet-delay</code> 参数值，则容易过多占用轮询器线程。
将这些值保持在使用范围内，以避免不必要地绑定查询线程。</p>
</div>
<div class="paragraph">
<p>此监测器通常使用 UNIX 计时方式标记 <em>ciscoPingTable</em> 检测项的创建时间。
使用一个带符号 32-bit 整数表示这个对象，放弃精度。
最好混合毫秒时间的最低有效字节，以代替整秒值的最低有效字节，以避免冲突。
<em>IOS</em> 似乎在 ping 操作完成后，几分钟内清理这个表中的记录。</p>
</div>
</div>
<div class="sect4">
<h5 id="_监测器定义_5">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.CiscoPingMibMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_5">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 17. 监测器 <em>CiscoPingMibMonitor</em> 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">超时，以毫秒为单位，如果需要可以在
                                  <code>snmp-config.xml</code> 文件中配置。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置在 <code>snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">失败重试次数。
                                  如果需要可以在 <code>snmp-config.xml</code> 文件中配置。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置在 <code>snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP 协议版本 (1, 2c, 或 3) ，用于该服务监测器执行操作。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置在 <code>snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>packet-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">远程 <em>IOS</em> 设备应该发送的 ping 数据包的数量。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>packet-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">远程 <em>IOS</em> 设备应该发送的每个 ping 数据包的字节大小。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>100</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>packet-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">远程 <em>IOS</em> 设备发送的每个 ping 数据包的超时，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>packet-delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">延迟，单位毫秒，是远程 <em>IOS</em> 设备发送 ping 数据包之间的延迟。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entry-owner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个字符串值，是该服务设置 ciscoPingEntryOwner 项。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS CiscoPingMibMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vrf-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置 VRF (VLAN) 名称的字符串值，远程 <em>IOS</em> 设备在其上下文中应该为该服务执行 pings 操作。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>空字符串</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proxy-node-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">主 SNMP 接口的设备数据库标识符应该用作该服务的 <em>代理</em>。
                                  如果连同
                                 <code>proxy-node-foreign-source</code>, <code>proxy-node-foreign-id</code>, 和/或 <code>proxy-ip-addr</code> 这些参数一起，
                                  将是更好的方式。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proxy-node-foreign-source</code><br>
  <code>proxy-node-foreign-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">主 SNMP 接口的设备 <code>foreign-source</code> 名称和 <code>foreign-ID</code> 应该用作该服务的 "代理"。
                                  这两个参数是非常关键的。
                                  如果它们与相关的 <code>proxy-ip-addr</code> 一起出现，这些参数将是有效的。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proxy-ip-addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接口的 IP 地址应该用作这个服务的代理。
                                  只有在 <code>proxy-node-id</code>, <code>proxy-node-foreign-source</code>, nor
                                  <code>proxy-node-foreign-id</code> 都不出现时才有效。
                                  <code>${ipaddr}</code> 的值将被监测器服务的接口IP地址替换。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target-ip-addr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">远程 <em>IOS</em> 设备要 ping 的IP地址。<code>${ipaddr}</code> 的值将被监测器服务出现的IP地址替换。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>success-percent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个 pings 成功率百分比 (从远程
                                  <em>IOS</em> 设备的角度来看) ，以便该服务被认为是可用的。
                                  例如，如果 <code>packet-count</code> 使用默认值 <code>5</code>，
                                  你希望即使五个 pings 中只有一个成功，服务也是可用的，
                                  那么将该参数的值设置为 <code>20</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>100</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-repository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RRD 存储库的根目录，
                                  存储该服务监测器的响应时间采样值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ds-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RRD 数据源 (DS) 名称，用于存储该服务检测响应时间采样值；
                                  RRD文件的基本名称 (去掉 <code>.rrd</code> 或
                                  <code>.jrb</code> file extension) within the specified rrd-repository path in which this service
                                  该服务监测器的响应时间采样值将被持久化</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<div class="paragraph">
<p>如果你可以在配置中使用变量，这里可以忽略</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 18. 可用于配置的变量</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${ipaddr}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">该值将被监测器服务出现的接口的 IP 地址替换。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_示例_从客户foo的所有路由器中提取相同的不可路由地址">示例: 从客户Foo的所有路由器中提取相同的不可路由地址</h5>
<div class="paragraph">
<p>服务提供商的客户，Foo 公司，在多个地点有网络服务。
在每个 Foo 位置，销售点系统的静态 IPv4 地址是 192.168.255.1。
Foo 想要随时通知销售点系统变得不可达。
使用 OpenNMS Horizon 的远程位置监测器是不可行的。
所有的 Foo 公司的 CPE 路由器必须是 <em>Cisco IOS</em> 设备，以便在这种情况下实现完全覆盖。</p>
</div>
<div class="paragraph">
<p>实现这一要求的一种方法是将所有 Foo 公司的前端路由器配置为监测类别 Customer_Foo, CPE, 和 Routers，并使用过滤器来创建仅适用于这些路由器的轮询包。
我们将使用特殊值 <code>${ipaddr}</code> 作为 <code>proxy-ip-addr</code> 参数，以便在每个 Foo CPE 路由器上提供 pings。
用于我们希望每个 Foo CPE 路由器 ping 相同的 IP 地址 192.168.255.1，所以我们静态地列出 <code>target-ip-addr</code> 地址的值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;package name="ciscoping-foo-pos"&gt;
  &lt;filter&gt;catincCustomer_Foo &amp; catincCPE &amp; catincRouters &amp; nodeSysOID LIKE '.1.3.6.1.4.1.9.%'&lt;/filter&gt;
  &lt;include-range begin="0.0.0.0" end="254.254.254.254" /&gt;
  &lt;rrd step="300"&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
  &lt;/rrd&gt;
  &lt;service name="FooPOS" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response" /&gt;
    &lt;parameter key="rrd-base-name" value="ciscoping" /&gt;
    &lt;parameter key="ds-name" value="ciscoping" /&gt;
    &lt;parameter key="proxy-ip-addr" value="${ipaddr}" /&gt;
    &lt;parameter key="target-ip-addr" value="192.168.255.1" /&gt;
  &lt;/service&gt;
  &lt;downtime interval="30000" begin="0" end="300000" /&gt;&lt;!-- 30s, 0, 5m --&gt;
  &lt;downtime interval="300000" begin="300000" end="43200000" /&gt;&lt;!-- 5m, 5m, 12h --&gt;
  &lt;downtime interval="600000" begin="43200000" end="432000000" /&gt;&lt;!-- 10m, 12h, 5d --&gt;
  &lt;downtime begin="432000000" delete="true" /&gt;&lt;!-- anything after 5 days delete --&gt;
&lt;/package&gt;

&lt;monitor service="FooPOS" class-name="org.opennms.netmgt.poller.monitors.CiscoPingMibMonitor" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_示例_从单个_ios_设备_ping_每个可路由的客户路由器">示例: 从单个 IOS 设备 Ping 每个可路由的客户路由器。</h5>
<div class="paragraph">
<p>服务提供商的客户端，中心有限，在多个位置提供网络服务。
虽然 OpenNMS Horizon' 提供世界级的服务保障是足够的，中心也希望随时通知一个前端路由器从 <em>IOS</em> 设备的主数据中心角度某位置不可达。
在这种情况下，一些或所有受限的中心 CPE 路由器可能是非思科设备。</p>
</div>
<div class="paragraph">
<p>为了满足这一要求，我们的方法是将中心限制的前端路由器配置为监测类别 Customer_Bar, CPE, 和 Routers，并使用过滤器来创建仅适用于这类路由器的轮询器包。
但是，这次我们不在 <code>proxy-ip-addr</code> 参数中使用 <code>${ipaddr}</code> 特殊值，而是在 <code>target-ip-addr</code> 参数中使用特殊值，以便为每个中心 CPE 路由器执行远程 pings。
由于我们希望使用相同的 <em>IOS</em> 设备 20.11.5.11 来 ping CPE 路由器，所以我们静态地列出 <code>proxy-ip-addr</code> 地址的值。
附 <code>poller-configuration.xml</code> 配置实例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;package name="ciscoping-bar-cpe"&gt;
  &lt;filter&gt;catincCustomer_Bar &amp; catincCPE &amp; catincRouters&lt;/filter&gt;
  &lt;include-range begin="0.0.0.0" end="254.254.254.254" /&gt;
  &lt;rrd step="300"&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
  &lt;/rrd&gt;
  &lt;service name="BarCentral" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response" /&gt;
    &lt;parameter key="rrd-base-name" value="ciscoping" /&gt;
    &lt;parameter key="ds-name" value="ciscoping" /&gt;
    &lt;parameter key="proxy-ip-addr" value="20.11.5.11" /&gt;
    &lt;parameter key="target-ip-addr" value="${ipaddr}" /&gt;
  &lt;/service&gt;
  &lt;downtime interval="30000" begin="0" end="300000" /&gt;&lt;!-- 30s, 0, 5m --&gt;
  &lt;downtime interval="300000" begin="300000" end="43200000" /&gt;&lt;!-- 5m, 5m, 12h --&gt;
  &lt;downtime interval="600000" begin="43200000" end="432000000" /&gt;&lt;!-- 10m, 12h, 5d --&gt;
  &lt;downtime begin="432000000" delete="true" /&gt;&lt;!-- anything after 5 days delete --&gt;
&lt;/package&gt;

&lt;monitor service="BarCentral" class-name="org.opennms.netmgt.poller.monitors.CiscoPingMibMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_citrixmonitor">4.6.8. CitrixMonitor</h4>
<div class="paragraph">
<p>此监测器用于检测 Citrix&#174; Server 或 XenApp Server&#174; 是否在 TCP 1494 端口上提供 <em>Independent Computing Architecture</em> (<em>ICA</em>) 协议。
监测器开启一个 TCP socket ，然后检测 <code>ICA</code> 回应，如果没有回应，则服务不可用。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_6">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.CitrixMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_6">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 19. 监测器 CitrixMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试打开连接并获得回应的重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在尝试下一次之前，等待从TCP连接获取 <code>ICA</code> 回应的时间。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3000 ms</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP 端口， <em>ICA</em> 协议的监听端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1494</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
如果你使用 <em>Session Reliability</em> 配置 <em>Metaframe Presentation Server Client</em> ，TCP 端口为 2598，而不是 1494。
你可以在 <a href="http://support.citrix.com/article/CTX104147">CTX104147</a> 找到附加选项。
在这种情况下，监测器能否工作没有得到验证。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_实例_3">实例</h5>
<div class="paragraph">
<p>下面的示例配置 OpenNMS Horizon 来监控 TCP 1494 端口上的 ICA 协议，重试2次，等待5秒。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="Citrix-TCP-ICA" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2" /&gt;
    &lt;parameter key="timeout" value="5000" /&gt;
&lt;/service&gt;

&lt;monitor service="Citrix-TCP-ICA" class-name="org.opennms.netmgt.poller.monitors.CitrixMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dhcpmonitor">4.6.9. DhcpMonitor</h4>
<div class="paragraph">
<p>此监测器用于监控 <a href="http://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP servers</a> 的可用性和功能。
这个监测器有两个部分，第一部分是由 <em>Pollerd</em> 执行的监测器类 <em>DhcpMonitor</em> ，和第二部分 OpenNMS Horizon JVM 的后台模块 <em>Dhcpd</em>，侦听 DHCP 响应。
通过发送一个 <em>DISCOVER</em> 发现消息来探测 DHCP 服务器。
如果 DHCP 服务器返回 <em>OFFER</em> 响应，则服务被标记为 up。
默认情况下禁用 <em>Dhcpd</em> 系统模块，可以通过配置 OpenNMS Horizon 的 <code>service-configuration.xml</code> 文件中的 <code>service enabled="true"</code>，来激活。
在 <code>dhcp-configuration.xml</code> 配置文件中可以修改探测 DHCP 服务器的行为。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
在使用此功能之前，需要安装 <code>opennms-plugin-protocol-dhcp</code> 。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">安装 opennms-plugin-protocol-dhcp 包</div>
<div class="content">
<pre>{apt-get,yum} install {opennms-package-base-name}-plugin-protocol-dhcp</pre>
</div>
</div>
<div class="paragraph">
<p>如果在没有安装 <em>opennms-plugin-protocol-dhcp</em> 的情况下启动 OpenNMS Horizon ，将看到下面的错误信息日志，在日志文件 <code>output.log</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>An error occurred while attempting to start the "OpenNMS:Name=Dhcpd" service (class org.opennms.netmgt.dhcpd.jmx.Dhcpd).  Shutting down and exiting.
java.lang.ClassNotFoundException: org.opennms.netmgt.dhcpd.jmx.Dhcpd</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
确保在 OpenNMS Horizon 服务器上没有 DHCP 客户端运行，并且占用端口 UDP/68。
         如果 UDP/68 已经被使用，你将在 manager.log 日志文件中找到错误消息。
         你也可以测试一下是否有进程占用了 udp/68 端口，使用 <code>sudo ss -lnpu sport = :68</code>。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_7">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.protocols.dhcp.monitor.DhcpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 20. 服务监测器的配置参数，配置文件 <code>poller-configuration.xml</code></caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控服务的重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待服务器 DHCP 响应的时间，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-repository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">写入 RRD 数据的位置。通常不需要更改此默认值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/share/rrd/response</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-base-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要写入的 RRD 文件的名称 (去掉扩展名, .rrd 或 .jrb)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dhcp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ds-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">这是 RRD 文件中，该数据源的引用名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dhcp</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_dhcpd_配置"><em>Dhcpd</em> 配置</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 21. <em>Dhcpd</em> 配置参数，配置文件 <code>dhcp-configuration.xml</code>。</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">描述</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认值</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义你的 dhcp 服务器正在使用的端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5818</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>macAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenNMS Horizon 用于 dhcp 请求的 MAC 地址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00:06:0D:BE:9C:B2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>myIpAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">该参数通常被设置为 OpenNMS Horizon 服务器的IP地址，
                       这使 DHCP 轮询器处于 <code>relay</code> 中继模式，而不是 <code>broadcast</code> 广播模式。
                       在 <code>relay</code> 中继模式下，被轮询的 DHCP 服务器，将直接将响应单播回由
                        <code>myIpAddress</code> 指定的IP地址，而不是广播其响应。
                       这允许即使与 OpenNMS Horizon 服务器不在相同的子网，
                       也可以轮询 DHCP 服务器，并且没有外部中继的帮助。
                       <em>用法:</em> <code>myIpAddress="10.11.12.13"</code> 或 <code>myIpAddress="broadcast"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>broadcast</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extendedMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当扩展模式 extendedMode 为 false 时，DHCP 轮询器将发送一个 DISCOVER ，并且期望
                       返回一个 OFFER 。当扩展模式 extendedMode 为 true 时，DHCP 轮询器将首先发送一个
                       DISCOVER。如果没有收到有效的响应，它将发送一个通知 INFORM。
                       如果没有收到有效的响应，它将发送一个请求 REQUEST。在扩展模式下，OFFER, ACK, 和 NAK
                       都被认为是有效的响应。
                       <em>用法:</em> <code>extendedMode="true"</code> 或 <code>extendedMode="false"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestIpAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此参数仅适用于扩展模式 extendedMode 为 true 时，发送到 DHCP 服务器的请求 REQUEST 查询。
                       如果指定了IP地址，则将请求查询该IP地址。
                       如果指定了 <code>targetHost</code> ，将请求 DHCP 服务器自己的 IP 地址。
                       由于管理良好的服务器可能不会响应对自己IP的请求，
                       所以这个参数也可以设置为 <code>targetSubnet</code>。
                       这与 <code>targetHost</code> 类似，除了 DHCP 服务器的 IP 地址是递增或递减1，
                       以获得在同一子网上的IP地址。
                       (如果 DHCP 服务器的子网是
                        /32 或 /31，则结果地址将不在同一子网上。)
                       <em>用法:</em> <code>requestIpAddress="10.77.88.99"</code> 或 <code>requestIpAddress="targetHost"</code>
                       或 <code>requestIpAddress="targetSubnet"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/monitors/02_01_dhcp-monitor-messages-broadcast.png" alt="02 01 dhcp monitor messages broadcast">
</div>
<div class="title">Figure 28. 广播模式下 DHCP 消息流展示</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/monitors/02_02_dhcp-monitor-messages-unicast.png" alt="02 02 dhcp monitor messages unicast">
</div>
<div class="title">Figure 29. 中继模式下 DHCP 消息流展示</div>
</div>
</div>
<div class="sect4">
<h5 id="_同一子网中_dhcp_服务器的实例测试">同一子网中 DHCP 服务器的实例测试</h5>
<div class="paragraph">
<p>示例如何在 <code>poller-configuration.xml</code> 配置文件中，配置监测器。
监测器将尝试发送最大的3个 <em>DISCOVER</em> 消息，并等待3秒钟从 DHCP 服务器返回 <em>OFFER</em> 消息。</p>
</div>
<div class="listingblock">
<div class="title">步骤1: 在 <code>poller-configuration.xml</code> 中配置 DHCP 服务</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="DHCP" interval="300000" user-defined="false" status="on"&gt;
 &lt;parameter key="retry" value="2" /&gt;
 &lt;parameter key="timeout" value="3000" /&gt;
 &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response" /&gt;
 &lt;parameter key="rrd-base-name" value="dhcp" /&gt;
 &lt;parameter key="ds-name" value="dhcp" /&gt;
&lt;/service&gt;

&lt;monitor service="DHCP" class-name="org.opennms.protocols.dhcp.monitor.DhcpMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">步骤2: 在 <code>service-configuration.xml</code> 中开启 OpenNMS Horizon 的 <em>Dhcpd</em> 模块</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service enabled="true"&gt;
  &lt;name&gt;OpenNMS:Name=Dhcpd&lt;/name&gt;
  &lt;class-name&gt;org.opennms.netmgt.dhcpd.jmx.Dhcpd&lt;/class-name&gt;
  &lt;invoke method="start" pass="1" at="start"/&gt;
  &lt;invoke method="status" pass="0" at="status"/&gt;
  &lt;invoke method="stop" pass="0" at="stop"/&gt;
&lt;/service&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">步骤3: 配置 <em>Dhcpd</em> 来测试 DHCP 服务器与 OpenNMS Horizon 服务器是否处于相同的子网。</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;DhcpdConfiguration
       port="5818"
       macAddress="00:06:0D:BE:9C:B2"
       myIpAddress="broadcast
       extendedMode="false"
       requestIpAddress="127.0.0.1"&gt;
&lt;/DhcpdConfiguration&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_扩展模式下在不同子网中测试_dhcp_服务器示例">扩展模式下在不同子网中测试 DHCP 服务器示例</h5>
<div class="paragraph">
<p>在上面的示例中，可以使用 <code>poller-configuration.xml</code> 中的相同监测器。</p>
</div>
<div class="listingblock">
<div class="title">配置 <em>Dhcpd</em> 来测试 DHCP 服务器处于不同子网。DHCP 服务器的 OFFER 被发送到 <code>myIpAddress</code>。</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;DhcpdConfiguration
       port="5818"
       macAddress="00:06:0D:BE:9C:B2"
       myIpAddress="10.4.1.234"
       extendedMode="true"
       requestIpAddress="targetSubnet"&gt;
&lt;/DhcpdConfiguration&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果在扩展模式中 <code>extendedMode</code>，轮询无响应节点所需的时间要增加3倍。
      因此，将重试次数限制为一个小数字，是一个好选择。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_diskusagemonitor">4.6.10. DiskUsageMonitor</h4>
<div class="paragraph">
<p>DiskUsageMonitor 监测器可以用来测试在某个设备上可用空间的数量。
监测器通过检查 <a href="http://tools.ietf.org/html/rfc1514">HOST-RESOURCES-MIB</a> 的 <em>hrStorageTable</em> 获取有关可用存储空间的信息。
存储器的描述 (在对应的 <em>hrStorageDescr</em> 对象中找到) 必须与要检查的 <code>disk</code> 和 <code>match-type</code> 参数相匹配。
使用 <em>hrStorageSize</em> 和 <em>hrStorageUsed</em> 对象计算存储的可用空闲空间。</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<em>hrStorageUsed</em> 不考虑文件系统保留块 (例如 超级用户)，因此，DiskUsageMonitor 仅在空闲磁盘空间实际上低于
         <code>free</code> 减去预留文件系统块的百分比时，才报告服务不可用。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>该监测器使用 <em>SNMP</em> 来完成工作。
因此，要监控的系统必须在 SNMP agent 代理上支持 <em>HOST-RESOURCES-MIB</em> 并配置。
大多数现代 <em>SNMP agents</em>, 包括大部分发行版 <em>Net-SNMP agent</em> 和 <em>Microsoft Windows</em> 系统自带的 <em>SNMP service</em> ，都支持这个 <em>MIB</em>。
在商业化的 <em>Unix</em> 操作系统中，对于 <em>HOST-RESOURCES-MIB</em> 的支持比较少。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_8">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.DiskUsageMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否， 依赖SNMP配置。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_7">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 22. 监测器 DiskUsageMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对要进行计算的磁盘，通过存储描述 (<em>hrStorageDescr</em>) 进行匹配。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>free</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与匹配相符的空闲空间的最小值必须是可用的。
                 此参数用来判断实际存储情况的最大容量百分比。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>match-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如何将 <code>disk</code> 参数与指定的存储描述相比较，
                 必须是下列符号运算符之一:<br>
                 <code>endswith</code>   : <code>disk</code> 参数的值与存储描述字符串进行比较，
                                并且以此结束;<br>
                 <code>exact</code>      : <code>disk</code> 参数的值与存储描述字符串进行比较，
                                必须精确匹配;<br>
                 <code>regex</code>      : <code>disk</code> 参数的值与存储描述字符串进行正则表达式计算，
                                ;<br>
                 <code>startswith</code> : <code>disk</code> 参数的值与存储描述的字符串进行比较，
                                并且以此开始。<br>
                 Note: 比较是区分大小写的</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exact</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要发送 SNMP 请求的目的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>配置文件 snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">过时的。
                 与 <code>retry</code> 相同。
                 参数 <code>retry</code> 优先，在设置两个参数时。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>配置文件 snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试轮询的次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>配置文件 snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求超时，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>from snmp-config.xml</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_4">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Make sure there's at least 5% of free space available on storages ending with "/home" --&gt;
&lt;service name="DiskUsage-home" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="timeout" value="3000" /&gt;
  &lt;parameter key="retry" value="2" /&gt;
  &lt;parameter key="disk" value="/home" /&gt;
  &lt;parameter key="match-type" value="endsWith" /&gt;
  &lt;parameter key="free" value="5" /&gt;
&lt;/service&gt;
&lt;monitor service="DiskUsage-home" class-name="org.opennms.netmgt.poller.monitors.DiskUsageMonitor" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_diskusagemonitor_与_thresholds_门限">DiskUsageMonitor 与 thresholds (门限)</h5>
<div class="paragraph">
<p>如果你已经采集了这些数据，也可以使用门限检查存储空间的可用性。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dnsmonitor">4.6.11. DnsMonitor</h4>
<div class="paragraph">
<p>该监测器是用来测试远程IP接口上的 <em>DNS service</em> 的可用性的。
监测器通过向 DNS 服务器发送资源记录类型的 DNS 查询，来测试服务可用性的。</p>
</div>
<div class="paragraph">
<p>如果 <em>DNS Server</em> 能够向监测器发送有效响应，则监控被标记为 <em>up</em>。
对于多个记录，可以测试响应的数量是否在给定的范围内。</p>
</div>
<div class="paragraph">
<p>监测器可以用命令行工具 <code>host</code> 进行模拟:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>~ % host -v -t a www.google.com 8.8.8.8
Trying "www.google.com"
Using domain server:
Name: 8.8.8.8
Address: 8.8.8.8#53
Aliases:

;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 9324
;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;www.google.com.			IN	A

;; ANSWER SECTION:
www.google.com.		283	IN	A	74.125.232.17
www.google.com.		283	IN	A	74.125.232.20
www.google.com.		283	IN	A	74.125.232.19
www.google.com.		283	IN	A	74.125.232.16
www.google.com.		283	IN	A	74.125.232.18

Received 112 bytes from 8.8.8.8#53 in 41 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>TIP:
此监测器用于测试 DNS 服务的可用性。
如果希望从客户端的角度检测某些设备的 DNS 解析，请使用 <a href="#poller-dns-resolution-monitor">DNSResolutionMonitor</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_9">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.DnsMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_8">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 23. 监测器 DnsMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务检测的重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">从服务器等待响应记录的时间，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS 服务器的 UDP 端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>53</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于测试 DNS 的查找 <em>记录</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fatal-response-codes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个逗号分隔的数字 DNS 响应代码列表，
                           如果存在于服务器的响应中，将被认为故障。默认值是 <code>2</code>，对应于 <em>Server Failed</em>。
                           可以在 <a href="http://tools.ietf.org/html/rfc2929">RFC 2929</a> 列表中找到相应代码及其含义</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-answers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS 服务器响应中给定查找的最小记录数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-answers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS 服务器响应中给定查找的最大记录数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_5">实例</h5>
<div class="paragraph">
<p>给出的示例显示了如何检测给定的 DNS 服务器的IP接口是否解析 DNS 请求。
该服务应该绑定到 DNS 服务器，该 DNS 服务器应该能够为 <em>www.google.com</em> 的 DNS 请求。
如果 DNS 服务器在 <code>1</code> 和 <code>10</code> 之间提供响应记录，则服务为 <em>up</em> 。</p>
</div>
<div class="listingblock">
<div class="title">示例配置检测给定的 www.google.com 服务器的 DNS 请求</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="DNS-www.google.com" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="lookup" value="www.google.com" /&gt;
    &lt;parameter key="fatal-response-code" value="2" /&gt;
    &lt;parameter key="min-answers" value="1" /&gt;
    &lt;parameter key="max-answers" value="10" /&gt;
&lt;/service&gt;

&lt;monitor service="DNS-www.google.com" class-name="org.opennms.netmgt.poller.monitors.DnsMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="poller-dns-resolution-monitor">4.6.12. DNSResolutionMonitor</h4>
<div class="paragraph">
<p>DNS 解析监测器，测试一个 OpenNMS Horizon 设备的设备名称是否可以被解析。
此监测器使用来自轮询器配置或 OpenNMS Horizon 在其上运行的操作系统的名称解析器配置。
它可以用于测试给定主机名的客户端行为。
例如: 创建一个带有节点名称 www.google.com 的设备以及IP接口。
在 IP 接口上指定 DNS 解析的监测器，用来测试 www.google.com 是否能够使用轮询器定义的 DNS 配置进行解析。
来自 A 记录查找的响应，可以是任何地址，它不用指定监测器的 OpenNMS Horizon IP 接口上的地址进行验证。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_10">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.DNSResolutionMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_9">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 24. 监测器 DNSResolutionMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resolution-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设备名称测试记录的类型。<br>
                      允许值<br>
                      <code>v4</code> 用于 <em>A 记录</em>,<br>
                      <code>v6</code> 用于 <em>AAAA 记录</em>,<br>
                      <code>both</code> <em>A</em> 和 <em>AAAA 记录</em> 都可用,<br>
                      <code>either</code> <em>A</em> 或 <em>AAAA 记录</em> 可用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>either</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>record-types</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">交替的DNS记录类型进行搜索。<br>
                      逗号分隔的列表可以包含 <code>A</code>,<br>
                      <code>AAAA</code>, <code>CNAME</code>, <code>NS</code>, <code>MX</code>, <code>PTR</code>, <code>SOA</code>,<br>
                      <code>SRV</code>, 或 <code>TXT</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">交替DNS记录查找</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设备名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nameserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS 服务器查询记录。构成主机名的字符串可以是：hostname:port， 或 [ipv6address]:port。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用运行 OpenNMS Horizon 的系统服务器定义</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_6">实例</h5>
<div class="paragraph">
<p>下面的示例显示了对 IPv4 和/或 IPv6 进行服务配置的可用配置:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Assigned service test if the node label is resolved for an A record --&gt;
&lt;service name="DNS-Resolution-v4" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="resolution-type" value="v4"/&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
    &lt;parameter key="rrd-base-name" value="dns-res-v4"/&gt;
    &lt;parameter key="ds-name" value="dns-res-v4"/&gt;
&lt;/service&gt;

&lt;!-- Assigned service test if www.google.com is resolved for an A record --&gt;
&lt;service name="DNS-Resolution-v4-lookup" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="resolution-type" value="v4"/&gt;
    &lt;parameter key="lookup" value="www.google.com"/&gt;
&lt;/service&gt;

&lt;!-- Assigned service test if the node label is resolved for an AAAA record using a specific DNS server --&gt;
&lt;service name="DNS-Resolution-v6" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="resolution-type" value="v6"/&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
    &lt;parameter key="rrd-base-name" value="dns-res-v6"/&gt;
    &lt;parameter key="ds-name" value="dns-res-v6"/&gt;
    &lt;parameter key="nameserver" value="8.8.8.8"/&gt;
&lt;/service&gt;

&lt;!-- Use parameter substitution for nameserver and lookup parameter values --&gt;
&lt;service name="DNS-Resolution-Sub" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="resolution-type" value="v6"/&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
    &lt;parameter key="rrd-base-name" value="dns-res-v6"/&gt;
    &lt;parameter key="ds-name" value="dns-res-v6"/&gt;
    &lt;parameter key="nameserver" value="{ipAddr}"/&gt;
    &lt;parameter key="lookup" value="{nodeLabel}"/&gt;
&lt;/service&gt;

&lt;!-- Assigned service test if the node label is resolved for an AAAA record AND A record --&gt;
&lt;service name="DNS-Resolution-v4-and-v6" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="resolution-type" value="both"/&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
    &lt;parameter key="rrd-base-name" value="dns-res-both"/&gt;
    &lt;parameter key="ds-name" value="dns-res-both"/&gt;
&lt;/service&gt;

&lt;!-- Assigned service test if the node label is resolved for an AAAA record OR A record --&gt;
&lt;service name="DNS-Resolution-v4-or-v6" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="resolution-type" value="either"/&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
    &lt;parameter key="rrd-base-name" value="dns-res-either"/&gt;
    &lt;parameter key="ds-name" value="dns-res-either"/&gt;
&lt;/service&gt;

&lt;!-- Assigned service test if the node label is resolved for an CNAME record AND MX record --&gt;
&lt;service name="DNS-Resolution-CNAME-and-MX" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="record-types" value="CNAME,MX"/&gt;
    &lt;parameter key="lookup" value="www.google.comm"/&gt;
    &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
    &lt;parameter key="rrd-base-name" value="dns-res-cname-mx"/&gt;
    &lt;parameter key="ds-name" value="dns-res-cname-mx"/&gt;
&lt;/service&gt;

&lt;monitor service="DNS-Resolution-v4" class-name="org.opennms.netmgt.poller.monitors.DNSResolutionMonitor" /&gt;
&lt;monitor service="DNS-Resolution-v4-lookup" class-name="org.opennms.netmgt.poller.monitors.DNSResolutionMonitor" /&gt;
&lt;monitor service="DNS-Resolution-v6" class-name="org.opennms.netmgt.poller.monitors.DNSResolutionMonitor" /&gt;
&lt;monitor service="DNS-Resolution-Sub" class-name="org.opennms.netmgt.poller.monitors.DNSResolutionMonitor" /&gt;
&lt;monitor service="DNS-Resolution-v4-and-v6" class-name="org.opennms.netmgt.poller.monitors.DNSResolutionMonitor" /&gt;
&lt;monitor service="DNS-Resolution-v4-or-v6" class-name="org.opennms.netmgt.poller.monitors.DNSResolutionMonitor" /&gt;
&lt;monitor service="DNS-Resolution-CNAME-and-MX" class-name="org.opennms.netmgt.poller.monitors.DNSResolutionMonitor" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>要使用名称解析的响应时间图，必须在 '$OPENNMS_HOME/etc/response-graph.properties' 目录下，为给定的数据源名称配置 RRD 图 (<code>dns-res-v4</code>, <code>dns-res-v6</code>, <code>dns-res-both</code>, <code>dns-res-either</code>)。</p>
</div>
</div>
<div class="sect4">
<h5 id="_dnsresolutionmonitor_与_dnsmonitor">DNSResolutionMonitor 与 DnsMonitor</h5>
<div class="paragraph">
<p>DNSResolutionMonitor 监测器用于从客户端的角度测试可用性和名称解析的记录故障。
该服务主要用于网站或类似的公共可用资源。
它可以与页面序列监测器结合使用，以提示网站是否因为 DNS 原因而无法使用。</p>
</div>
<div class="paragraph">
<p>另一方面，DnsMonitor 是针对特定的 DNS 服务器的测试。
在 OpenNMS Horizon 中，DNS 服务器是一个设备，DnsMonitor 向 DNS 服务器 IP 地址发送给定的 A 记录查询请求。
如果 DNS 服务器的区域数据库中没有有效的 A 记录，或者解析 A 记录有其它问题，服务故障。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ftpmonitor">4.6.13. FtpMonitor</h4>
<div class="paragraph">
<p>FtpMonitor 监测器可以验证 ftp 连接拨号过程。
监测器可以在多个端口和特定登录数据上测试 ftp 服务器。</p>
</div>
<div class="paragraph">
<p>如果 FTP 服务器返回 200 到 299 之间的响应代码，则测试的服务为 <em>up</em> 。
对于特殊情况，服务也被标示为 425 到 530。</p>
</div>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_11">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.FtpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_10">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 25. 监测器 FtpMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试获取有效 FTP response/response-text 的重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试连接的 TCP 端口列表。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code>,<code>21</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此参数用来与 <code>user</code> 参数一起进行基本身份验证。
                           此参数指定要使用的密码。
                           当 <code>basic-authentication</code> 参数被定义时，<code>user</code> 和 <code>password</code> 参数被忽略。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>empty string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>userid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此参数用来与 <code>password</code> 参数一起进行基本身份验证。
                           此参数指定要使用的 用户ID。
                           当 <code>basic-authentication</code> 参数被定义时，<code>user</code> 和 <code>password</code> 参数被忽略。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_7">实例</h5>
<div class="paragraph">
<p>监测器配置示例，配置文件 'poller-configuration.xml'</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="FTP" interval="300000" user-defined="false" status="on"&gt;
 &lt;parameter key="retry" value="1"/&gt;
 &lt;parameter key="timeout" value="3000"/&gt;
 &lt;parameter key="port" value="21"/&gt;
 &lt;parameter key="userid" value=""/&gt;
 &lt;parameter key="password" value=""/&gt;
&lt;/service&gt;

&lt;service name="FTP-With-Auth-From-Asset" interval="300000" user-defined="false" status="on"&gt;
 &lt;parameter key="retry" value="1"/&gt;
 &lt;parameter key="timeout" value="3000"/&gt;
 &lt;parameter key="port" value="21"/&gt;
 &lt;parameter key="userid" value="{username}"/&gt;
 &lt;parameter key="password" value="{password}"/&gt;
&lt;/service&gt;

&lt;service name="FTP-Customer" interval="300000" user-defined="false" status="on"&gt;
 &lt;parameter key="retry" value="1"/&gt;
 &lt;parameter key="timeout" value="3000"/&gt;
 &lt;parameter key="port" value="21"/&gt;
 &lt;parameter key="userid" value="Customer"/&gt;
 &lt;parameter key="password" value="MySecretPassword"/&gt;
&lt;/service&gt;

&lt;monitor service="FTP" class-name="org.opennms.netmgt.poller.monitors.FtpMonitor"/&gt;
&lt;monitor service="FTP-With-Auth-From-Asset" class-name="org.opennms.netmgt.poller.monitors.FtpMonitor"/&gt;
&lt;monitor service="FTP-Customer" class-name="org.opennms.netmgt.poller.monitors.FtpMonitor"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_提示">提示</h5>
<div class="paragraph">
<p><strong>FtpMonitor 源码注释</strong></p>
</div>
<div class="paragraph">
<p>也希望接受以下一些 FTP 服务器在没有成功登录的情况下，按照 QUIT 命令生成的 ERROR 消息:
"530 QUIT : 用户未登录。请先使用用户、密码登录。"</p>
</div>
<div class="paragraph">
<p>也希望接受以下一些 FTP 服务器在没有成功登录的情况下，按照 QUIT 命令生成的 ERROR 消息:
"425 会话断开。"</p>
</div>
<div class="paragraph">
<p>参见: <a href="http://tools.ietf.org/html/rfc959" class="bare">http://tools.ietf.org/html/rfc959</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hostresourceswrunmonitor">4.6.14. HostResourceSwRunMonitor</h4>
<div class="paragraph">
<p>此监测器测试一个或多个进程的运行状态。
它通过SNMP检查 <a href="http://www.ietf.org/rfc/rfc2790">HOST-RESOURCES-MIB</a> 的 <em>hrSwRunTable</em> 来实现。
该检测是通过给定的 <em>hrSwRunName</em> 进程名，与 <em>hrSwRunState</em> 状态值匹配完成的。</p>
</div>
<div class="paragraph">
<p>该监测器使用 <em>SNMP</em> 来完成工作。
因此，要完成监控，必须在系统上安装和配置 SNMP 代理。
此外，系统上的 <em>SNMP agent</em> 必须支持 <em>HOST-RESOURCES-MIB</em>。
大多数现代 <em>SNMP agents</em>, 包括大部分发行版 <em>Net-SNMP agent</em> 和 <em>Microsoft Windows</em> 系统自带的 <em>SNMP service</em> ，都支持这个 <em>MIB</em>。
在商业化的 <em>Unix</em> 操作系统中，对于 <em>HOST-RESOURCES-MIB</em> 的支持比较少。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_12">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.HostResourceSwRunMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_11">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 26. 监测器 HostResourceSwRunMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要测试的服务器 <em>SNMP agent</em> 的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>配置文件 snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>service-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要检测的进程名。此参数是区分大小写的，
                         并且是精确匹配。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>match-all</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果进程名在 <em>hrSwRunTable</em> 中多次出现，并且该参数被设置为
                         <code>true</code>，那么命名进程的所有实例必须匹配
                         <code>run-level</code> 指定的值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>run-level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">状态 <em>hrSWRunStatus</em> 中最大允许值<br>
                         <em>running(1)</em>,<br>
                         <em>runnable(2)</em> = 等待资源<br>
                         <em>notRunnable(3)</em> = 加载，但等待事件<br>
                         <em>invalid(4)</em> = 未加载</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>service-name-oid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询进程名的数字对象标识符 (OID)。
                         默认为 <em>hrSwRunName</em> ，通常情况不需要修改。
                         也就是说，将其更改为 <em>hrSwRunParameters</em> (<code>.1.3.6.1.2.1.25.4.2.1.5</code>) ，
                         通常有利于在 <em>Java Virtual Machines</em> 下处理运行的进程，
                         这些进程都具有相同的进程名 <em>java</em>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.25.4.2.1.2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>service-status-oid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询运行状态的数字对象标识符 (OID)。
                         默认为 <em>hrSwRunStatus</em> ，通常不需要改变。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.25.4.2.1.7</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_8">实例</h5>
<div class="paragraph">
<p>下面的示例，演示了如何使用这个监测器，监控在服务器上运行的名为 <em>httpd</em> 的进程。
在配置文件 <code>poller-configuration.xml</code> 中定义以下内容:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="Process-httpd" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="3"/&gt;
    &lt;parameter key="timeout" value="3000"/&gt;
    &lt;parameter key="service-name" value="httpd"/&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;parameter key="run-level" value="3"/&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;parameter key="match-all" value="true"/&gt;<i class="conum" data-value="3"></i><b>(3)</b>
&lt;/service&gt;

&lt;monitor service="Process-httpd" class-name="org.opennms.netmgt.poller.monitors.HostResourceSwRunMonitor"/&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>系统进程名称</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>如果进程处于有效状态，则测试该状态，即 <code>run-level</code> 不高于 <em>notRunnable(3)</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>如果 <em>httpd</em> 进程运行多次，则对进程的每个实例进行测试。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="poller-http-monitor">4.6.15. HttpMonitor</h4>
<div class="paragraph">
<p>HTTP 监测器在特定 HTTP 'GET' 命令上测试 HTTP 服务器的响应。
在轮询期间，尝试连接指定端口。
监测器可以在多个端口上测试 web 服务器。
默认情况下，对端口 80, 8080 和 8888 进行测试。
如果连接请求成功，则向接口发送 HTTP 'GET' 命令。
解析响应并提取验证返回代码。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_13">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.HttpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_12">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 27. 监测器 HttpMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>basic-authentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于执行基本身份验证的身份凭据。<br>
                           凭据应符合 <a href="http://www.rfc-editor.org/rfc/rfc1945.txt">RFC1945</a> 第 11.1 节，没有 Base64 编码部分。<br>
                           这是一个字符串连接:<br>
                           1- 用户 ID;<br>
                           2- 一个冒号;<br>
                           3- 密码。<br>
                          <code>basic-authentication</code> 优先于 <code>user</code> 和 <code>password</code> 参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>header[0-9]+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与请求一起发送的附加头信息。<br>
                           有效参数名称的示例是<br>
                           <code>header0</code>, <code>header1</code> 和 <code>header180</code>。 <code>header</code> 不是一个有效的参数名。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定 <em>Host</em> 头的值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodelabel-host-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果未设置 <code>host-name</code> 参数，则将 <code>resolve-ip</code> 参数设置为 <code>false</code>,<br>
                           如果这个参数设置为 <code>true</code>，则 OpenNMS Horizon 将使用设备名称来设置 <em>Host</em> 头的值。<br>
                           否则，OpenNMS Horizon 将使用设备接口的IP地址作为<br>
                            <em>Host</em> 头的值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此参数用来与 <code>user</code> 参数一起执行基本身份验证。<br>
                           此参数指定要使用的密码。<br>
                           当 <code>basic-authentication</code> 参数被定义时，<code>user</code> 和 <code>password</code> 参数被忽略。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>empty string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要尝试连接的 TCP 端口列表。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>80</code>,<code>8080</code>,<code>8888</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取有效 HTTP response/response-text 的尝试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resolve-ip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果未设置 <code>host-name</code> 参数，并将该参数设置为 <code>true</code>， OpenNMS Horizon 将<br>
                           使用 DNS 解析设备接口的IP地址，并使用该结果来设置 <em>Host</em><br>
                           头的值。当设置为 <code>false</code> ，而未设置 <code>host-name</code> 参数时， OpenNMS Horizon 将<br>
                           尝试使用 <code>nodelabel-host-name</code> 参数来设置 <em>Host</em> 头的值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>response</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可接受的 HTTP 响应代码范围，使用逗号分隔。
                           例如: <code>200-202,299</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果 <code>url</code> 参数设置为 <code>/</code>，<br>
                           则此参数的默认值为 <code>100-499</code>，否则为 <code>100-399</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>response-text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在响应体中查找文本。这将与每一行记录进行匹配，<br>
                           并且第一次成功匹配则返回。如果参数起始 <code>~</code> ，<br>
                           则字符串的其余部分将作为正则表达式模式匹配，否则将作为子字符串匹配。<br>
                           正则表达式匹配被标记在行的开始和结尾，<br>
                           所有你可能需要在匹配模式的两侧都加上 <code>.*</code> ，<br>
                           除非要进行整行匹配。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过 HTTP 'GET' 命令检索的 URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此参数与 <code>password</code> 参数一起执行基本身份验证。<br>
                           此参数指定要使用的用户 ID 。<br>
                           当 <code>basic-authentication</code> 参数被定义时，<code>user</code> 和 <code>password</code> 参数被忽略。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许你设置 <em>User-Agent</em> HTTP 头 (参考 <a href="http://www.rfc-editor.org/rfc/rfc2616.txt">RFC2616</a> 第 14.43 章节)。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS HttpMonitor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当设置为 <em>true</em> 时，将记录客户端和 webserver 之间的通信日志<br>
                           (日志级别为 <code>DEBUG</code>)。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_9">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Test HTTP service on port 80 only --&gt;
&lt;service name="HTTP" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="port" value="80"/&gt;
  &lt;parameter key="url" value="/"/&gt;
&lt;/service&gt;

&lt;!-- Test for virtual host opennms.com running --&gt;
&lt;service name="OpenNMSdotCom" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="port" value="80"/&gt;
  &lt;parameter key="host-name" value="opennms.com"/&gt;
  &lt;parameter key="url" value="/solutions"/&gt;
  &lt;parameter key="response" value="200-202,299"/&gt;
  &lt;parameter key="response-text" value="~.*[Cc]onsulting.*"/&gt;
&lt;/service&gt;

&lt;!-- Test for instance of OpenNMS 1.2.9 running --&gt;
&lt;service name="OpenNMS-129" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="port" value="8080"/&gt;
  &lt;parameter key="url" value="/opennms/event/list"/&gt;
  &lt;parameter key="basic-authentication" value="admin:admin"/&gt;
  &lt;parameter key="response" value="200"/&gt;
&lt;/service&gt;

&lt;!-- Test for instance of OpenNMS 1.2.9 with parameter substitution in basic-authentication parameter --&gt;
&lt;service name="OpenNMS-22" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="port" value="8080"/&gt;
  &lt;parameter key="url" value="/opennms/event/list"/&gt;
  &lt;parameter key="basic-authentication" value="{username}:{password}"/&gt;
  &lt;parameter key="response" value="200"/&gt;
&lt;/service&gt;
&lt;monitor service="HTTP" class-name="org.opennms.netmgt.poller.monitors.HttpMonitor" /&gt;
&lt;monitor service="OpenNMSdotCom" class-name="org.opennms.netmgt.poller.monitors.HttpMonitor" /&gt;
&lt;monitor service="OpenNMS-129" class-name="org.opennms.netmgt.poller.monitors.HttpMonitor" /&gt;
&lt;monitor service="OpenNMS-22" class-name="org.opennms.netmgt.poller.monitors.HttpMonitor" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_使用_httpmonitor_测试过滤代理">使用 HttpMonitor 测试过滤代理</h5>
<div class="paragraph">
<p>如果你有一个过滤代理服务器，该服务器应该允许检索某些 URLs，但是拒绝其它 URL，可以使用 HttpMonitor 来验证此功能。</p>
</div>
<div class="paragraph">
<p>假如我们的代理服务器运行在 TCP 端口 3128，并且我们应该能够检索 <a href="http://www.opennms.org/" class="bare">http://www.opennms.org/</a> ，但是不能检索 <a href="http://www.myspace.com/。" class="bare">http://www.myspace.com/。</a>
为了测试这种功能，监测器 <em>HttpMonitor</em> 配置如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="HTTP-Allow-opennms.org" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="port" value="3128"/&gt;
  &lt;parameter key="url" value="http://www.opennms.org/"/&gt;
  &lt;parameter key="response" value="200-399"/&gt;
&lt;/service&gt;

&lt;service name="HTTP-Block-myspace.com" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="port" value="3128"/&gt;
  &lt;parameter key="url" value="http://www.myspace.com/"/&gt;
  &lt;parameter key="response" value="400-599"/&gt;
&lt;/service&gt;

&lt;monitor service="HTTP-Allow-opennms.org" class-name="org.opennms.netmgt.poller.monitors.HttpMonitor"/&gt;
&lt;monitor service="HTTP-Block-myspace.com" class-name="org.opennms.netmgt.poller.monitors.HttpMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httppostmonitor">4.6.16. HttpPostMonitor</h4>
<div class="paragraph">
<p>如果要将 <em>HTTP POST</em> 任意的内容发送到远程的 <em>URI</em> ，则可以使用 HttpPostMonitor 。
这是一个 HTTP POST 到 SOAP endpoint 端点。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_14">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.HttpPostMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_13">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 28. 监测器 HttpPostMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST 的内容，例如 XML 格式。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于 HTTP BASIC auth 的密码。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于 HTTP BASIC auth 的用户名。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>banner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与 HTTP POST 响应匹配的字符串。
                   如果输出包含 banner，则服务确定为 up。
                   以 <code>~</code> 开头，指定正则表达式。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>charset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置 POST 的字符集。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UTF-8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mimetype</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置 POST 的 mimetype 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>text/xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送 POST 到服务器的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheme</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接使用的 scheme 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usesslfilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用或禁用 SSL 证书验证。 <code>true - false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送 POST 的 uri 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-system-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应该使用系统范围的代理设置吗？
                   可以在 <a href="#ga-opennms-system-properties">opennms.conf</a> 中配置系统代理设置</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_10">实例</h5>
<div class="paragraph">
<p>下面的示例将创建一个包含 <em>Word</em> 的 POST。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="MyServlet" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="banner" value="Hello"/&gt;
  &lt;parameter key="port" value="8080"/&gt;
  &lt;parameter key="uri" value="/MyServlet"&gt;
  &lt;parameter key="payload" value="World"/&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="30000"/&gt;
&lt;/service&gt;
&lt;monitor service="MyServlet" class-name="org.opennms.netmgt.poller.monitors.HttpPostMonitor"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果是这样:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">POST /MyServlet HTTP/1.1
Content-Type: text/xml; charset=utf-8
Host: &lt;ip_addr_of_interface&gt;:8080
Connection: Keep-Alive

World</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpsmonitor">4.6.17. HttpsMonitor</h4>
<div class="paragraph">
<p>HTTPS 监测器测试启用 SSL-enabled 的 HTTP 服务器的响应。
HTTPS 监测器是启用 SSL-enabled 的扩展 HTTP 监测器，默认 TCP 端口是 443。
所有 HttpMonitor 参数都适用，所以请参阅 <a href="#poller-http-monitor">HttpMonitor&#8217;s documentation</a> 获取更多信息。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_15">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.HttpsMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_14">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 29. 监测器 HttpsMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试连接的 TCP 端口列表。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>443</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_实例_11">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Test HTTPS service on port 8443 --&gt;
&lt;service name="HTTPS" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="port" value="8443"/&gt;
  &lt;parameter key="url" value="/"/&gt;
&lt;/service&gt;

&lt;monitor service="HTTPS" class-name="org.opennms.netmgt.poller.monitors.HttpsMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="poller-icmp-monitor">4.6.18. IcmpMonitor</h4>
<div class="paragraph">
<p>ICMP 监测器通过发送 <em>echo request</em> ICMP 消息，测试 ICMP 服务的可用性。
当设备在指定的时间内返回一个 <em>echo reply</em> ICMP 消息，服务被认为是可用的。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_16">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.IcmpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">支持，但是有一些限制 (参见 <a href="#poller-icmp-monitor-remote">below</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_15">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 30. 监测器 IcmpMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待响应的时间，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>800</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allow-fragmentation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否在输出数据包上设置 "Don&#8217;t Fragment" 位</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dscp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSCP 流量控制值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>packet-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要发送的 ICMP 数据包的字节数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thresholding-enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用 ICMP 门限。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_12">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="ICMP" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="icmp"/&gt;
  &lt;parameter key="ds-name" value="icmp"/&gt;
&lt;/service&gt;
&lt;monitor service="ICMP" class-name="org.opennms.netmgt.poller.monitors.IcmpMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Advanced example: set DSCP bits and send a large packet with allow-fragmentation=false --&gt;
&lt;service name="ICMP" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="dscp" value="0x1C"/&gt; &lt;!-- AF32: Class 3, Medium drop probability --&gt;
  &lt;parameter key="allow-fragmentation" value="false"/&gt;
  &lt;parameter key="packet-size" value="2048"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="icmp"/&gt;
  &lt;parameter key="ds-name" value="icmp"/&gt;
&lt;/service&gt;
&lt;monitor service="ICMP" class-name="org.opennms.netmgt.poller.monitors.IcmpMonitor"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="poller-icmp-monitor-remote">远程轮询注意事项</h5>
<div class="paragraph">
<p>在远程轮询上 IcmpMonitor 监测器需要 JNA ICMP 功能实现。
但是，有些情况下 IcmpMonitor 监测器无法在远程轮询上工作。
例如: 当 Windows 有 administrator 管理员，远程轮询不能运行，还有 ARM / Rasperry Pi 上运行Linux。
在远程轮询中，JNA 是 ICMP 的默认实现。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="poller-imap-monitor">4.6.19. ImapMonitor</h4>
<div class="paragraph">
<p>此监测器检查 IMAP 服务器是否正常工作。
测试是通过初始化一个非常简单的 IMAP 会话来完成的。
ImapMonitor 建立一个 TCP 连接，发送一个 logout 命令并测试 IMAP 服务器响应。</p>
</div>
<div class="paragraph">
<p>可以使用 <code>telnet</code> 来模拟行为:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>telnet mail.myserver.de 143
Trying 62.108.41.197...
Connected to mail.myserver.de.
Escape character is '^]'.
* OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE STARTTLS LOGINDISABLED] Dovecot ready. <i class="conum" data-value="1"></i><b>(1)</b>
ONMSPOLLER LOGOUT <i class="conum" data-value="2"></i><b>(2)</b>
* BYE Logging out <i class="conum" data-value="3"></i><b>(3)</b>
ONMSPOLLER OK Logout completed.
Connection closed by foreign host.</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>测试 IMAP 服务器回应，并且必须以 <code>* OK</code> 开头，则表示 <em>up</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>发送 <code>ONMSPOLLER LOGOUT</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>测试服务器响应，必须是 <code>* BYE</code> 开头，则表示 <em>up</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如果上述测试项中的一项失败，则服务将被标记为 <em>down</em>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_17">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.ImapMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_16">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 31. 监测器 ImapMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获得有效 IMAP 响应的尝试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP 服务器的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>143</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_13">实例</h5>
<div class="paragraph">
<p>监测器的配置示例，配置文件 <code>poller-configuration.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Test IMAP service on port 143 only --&gt;
&lt;service name="IMAP" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="port" value="143"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
&lt;/service&gt;

&lt;monitor service="IMAP" class-name="org.opennms.netmgt.poller.monitors.ImapMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_imapsmonitor">4.6.20. ImapsMonitor</h4>
<div class="paragraph">
<p>IMAPS 监测器是在开启 SSL-enabled 的情况下测试 IMAP 服务器响应。
IMAPS 监测器是在开启 SSL-enabled 的 IMAP 监测器的扩展，默认 TCP 端口是 993。
所有 ImapMonitor 参数都适用，请参阅 <a href="#poller-imap-monitor">ImapMonitor&#8217;s documentation</a> 查看更多信息。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_18">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.ImapsMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_17">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 32. 监测器 ImapsMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要尝试连接的目的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>993</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_14">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- IMAPS service at OpenNMS.org is on port 9993 --&gt;
&lt;service name="IMAPS" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="port" value="9993"/&gt;
  &lt;parameter key="version" value="3"/&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="imaps"/&gt;
  &lt;parameter key="ds-name" value="imaps"/&gt;
&lt;/service&gt;

&lt;monitor service="IMAPS" class-name="org.opennms.netmgt.poller.monitors.ImapsMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jcifsmonitor">4.6.21. JCifsMonitor</h4>
<div class="paragraph">
<p>该监测器可以测试基于 CIFS/SMB 协议的文件共享服务。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
默认情况下不会安装此监测器。
你可以从 OpenNMS Horizon 安装存储库安装 <code>opennmms-plugin-protocol-cifs</code> 。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>使用 <em>JCIFS</em> 监测器，你可以测试不同的 <em>JCIFS</em> 服务的可用性:</p>
</div>
<div class="paragraph">
<p>使用 <em>JCifsMonitor</em> 可以运行下面用例的测试:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>网络共享</p>
</li>
<li>
<p>共享中是否存在一个文件</p>
</li>
<li>
<p>共享中是否存在一个文件夹</p>
</li>
<li>
<p>一个文件夹中至少包含一个 (1) 文件</p>
</li>
<li>
<p>一个文件夹不包含 (0) 文件</p>
</li>
<li>
<p>通过对文件和文件夹进行测试，可以使用正则表达式忽略测试中的特定文件和文件夹</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在 SMB 中的网络资源，文件或文件夹地址类似 <a href="https://en.wikipedia.org/wiki/Path_%28computing%29#Uniform_Naming_Convention">UNC Path</a>。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>\\server\share\folder\file.txt</pre>
</div>
</div>
<div class="paragraph">
<p><em>jCIFS</em> 是 <em>CIFS/SMB</em> 网络协议的 Java 实现，使用 <em>SMB</em> URLs 访问网络资源。
与我们的示例中相同的资源是 <a href="http://www.iana.org/assignments/uri-schemes/prov/smb">SMB URL</a>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>smb://workgroup;user:password@server/share/folder/file.txt</pre>
</div>
</div>
<div class="paragraph">
<p><em>JCifsMonitor</em> <strong>不</strong> 能测试:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>文件包含特定内容</p>
</li>
<li>
<p>文件夹中的特定文件数，例如文件夹精确包含 / 多于或少于 x 文件</p>
</li>
<li>
<p>文件或文件夹的时长或修改时间戳</p>
</li>
<li>
<p>文件或文件夹的权限或其它属性</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_监测器定义_19">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.JCifsMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_18">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 33. 监测器 JCifsMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户所在 Windows 域。如果使用本地用户账户，则不必使用域参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">空字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过网络访问资源的用户名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">空字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">空字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要测试的资源路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">空字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">具有下列测试模式选项<br>
                        <code>path_exist</code>: 如果资源可以访问，则服务是 <em>up</em> <br>
                        <code>path_not_exist</code>: 如果资源 <strong>不可</strong> 访问，则服务是 <em>up</em> <br>
                        <code>folder_empty</code>: 如果文件夹为空 (0 files)，则服务是 <em>up</em> <br>
                        <code>folder_not_empty</code>: 如果文件夹至少有一个文件，则服务是 <em>up</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path_exist</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smbHost</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">覆盖 SMB url 的IP地址，检查不同共享文件服务器。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">空字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>folderIgnoreFiles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">忽略文件夹中指定的文件正则表达式。
                        此参数仅用于 <code>folder_empty</code> 和 <code>folder_not_empty</code>，否则被忽略。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
重试大于 <code>1</code> 是没有意义的。
     在监控过程中是非常浪费资源的。
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
请注意，如果你使用 Mac OSX 访问共享，你会对隐藏文件 '.DS_Store.' 产生影响。
     在监控过程中它会带来错误，你可以使用 <code>folderIgnoreFiles</code> 参数避免错误。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_测试文件存在的实例">测试文件存在的实例</h5>
<div class="paragraph">
<p>这个例子展示了如何配置 <em>JCifsMonitor</em> 来测试在网络上共享文件是否可用。
对于这个示例，我们可以访问错误日志的共享，如果文件夹中有任何错误日志文件，则产生故障。
共享的名为 <em>log</em>。
如果删除错误日志文件，或者文件夹为空，则服务恢复正常。</p>
</div>
<div class="listingblock">
<div class="title">JCifsMonitor 配置来测试共享文件夹是否为空</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="CIFS-ErrorLog" interval="30000" user-defined="true" status="on"&gt;
    &lt;parameter key="retry" value="1" /&gt;
    &lt;parameter key="timeout" value="3000" /&gt;
    &lt;parameter key="domain" value="contoso" /&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;parameter key="username" value="MonitoringUser" /&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;parameter key="password" value="MonitoringPassword" /&gt;<i class="conum" data-value="3"></i><b>(3)</b>
    &lt;parameter key="path" value="/fileshare/log/" /&gt;<i class="conum" data-value="4"></i><b>(4)</b>
    &lt;parameter key="mode" value="folder_empty" /&gt;<i class="conum" data-value="5"></i><b>(5)</b>
&lt;/service&gt;

&lt;monitor service="CIFS-ErrorLog" class-name="org.opennms.netmgt.poller.monitors.JCifsMonitor" /&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>SMB 或 Microsoft Windows 域的名称</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>服务共享的用户</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>访问共享的密码</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>共享文件夹的路径，用作 SMB URL</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>模式设置为 <code>folder_empty</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdbcmonitor">4.6.22. JDBCMonitor</h4>
<div class="paragraph">
<p><em>JDBCMonitor</em> 检查是否可以连接到数据库，并且是否可以从数据库 (DBMS) 获得数据库目录。
它是基于 <a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html">JDBC</a> 技术与数据库进行连接和通信。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_20">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.JDBCMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_19">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 34. 监测器 JDBCMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC 驱动程序类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.postgresql.Driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接的 JDBC Url。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc:postgresql://:OPENNMS_JDBC_HOSTNAME/opennms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据库用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postgres</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>empty string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重试连接次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 <em>url</em> 参数中，将 <em>OPENNMS_JDBC_HOSTNAME</em> 替换为被监测的接口的IP或解析主机名。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_提供数据库驱动程序">提供数据库驱动程序</h5>
<div class="paragraph">
<p><em>JDBCMonitor</em> 基于 <em>JDBC</em> ，并且需要一个 JDBC 驱动程序来与数据库通信。
由于 OpenNMS Horizon 本身使用 PostgreSQL 数据库，所以 PostgreSQL JDBC 驱动已经可以使用。
对于其它的数据库系统，必须提供一个兼容的 JDBC 驱动程序的 <em>jar-file</em> 文件提供给 OpenNMS Horizon 。
将 JDBC 驱动程序 <em>driver-jar</em> 放到 OpenNMS Horizon 系统的 <code>opennms/lib</code> 目录下。
如果远程轮询使用 <em>JDBCMonitor</em> ，文件 <em>driver-jar</em> 也必须提供给 <em>远程轮询</em> 。
当使用 <em>Java Webstart Remote Poller</em> 时，这可能是很麻烦的，因为需要代码签名。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_15">实例</h5>
<div class="paragraph">
<p>下面的示例检查 OpenNMS Horizon 使用的 PostgreSQL 数据库是否可用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-DBMS" interval="30000" user-defined="true" status="on"&gt;
  &lt;parameter key="driver" value="org.postgresql.Driver"/&gt;
  &lt;parameter key="url" value="jdbc:postgresql://OPENNMS_JDBC_HOSTNAME:5432/opennms"/&gt;
  &lt;parameter key="user" value="opennms"/&gt;
  &lt;parameter key="password" value="opennms"/&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-DBMS" class-name="org.opennms.netmgt.poller.monitors.JDBCMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdbcstoredproceduremonitor">4.6.23. JDBCStoredProcedureMonitor</h4>
<div class="paragraph">
<p>监测器 <em>JDBCStoredProcedureMonitor</em> 检查远程数据库中存储过程的结果。
存储过程的结果必须是布尔值 (用 true 或 false 表示)。
如果存储过程返回 true，则监测服务标记为 up，其它情况都标记为 down。
它是基于 <a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html">JDBC</a> 技术与数据库进行连接和通信。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_21">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.JDBCStoredProcedureMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_20">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 35. 监测器 JDBCStoredProcedureMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 JDBC 驱动程序类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.postgresql.Driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC URL 连接。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc:postgresql://:OPENNMS_JDBC_HOSTNAME/opennms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database 用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postgres</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database 密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>empty string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">测试重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stored-procedure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要调用的数据库存储过程名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含存储过程的数据库模式名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 url 参数中， OPENNMS_JDBC_HOSTNAME 将被监测服务的接口的IP或解析主机名替换。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_提供数据库驱动程序_2">提供数据库驱动程序</h5>
<div class="paragraph">
<p>监测器 <em>JDBCStoredProcedureMonitor</em> 基于 <em>JDBC</em> ，需要 JDBC 驱动程序与数据库进行通信。
由于 OpenNMS Horizon 本身使用 PostgreSQL 数据库，所以 PostgreSQL JDBC 驱动程序已经可以使用。
对于其它的数据库系统，必须提供一个兼容的 JDBC 驱动程序的 <em>jar-file</em> 文件提供给 OpenNMS Horizon 。
将 JDBC 驱动程序 <em>driver-jar</em> 放到 OpenNMS Horizon 系统的 <code>opennms/lib</code> 目录下。
如果远程轮询使用 <em>JDBCStoredProcedureMonitor</em> ，文件 <em>driver-jar</em> 也必须提供给 <em>远程轮询</em> 。
当使用 <em>Java Webstart Remote Poller</em> 时，这可能是很麻烦的，因为需要代码签名。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_16">实例</h5>
<div class="paragraph">
<p>下面的示例检查添加到 OpenNMS Horizon 所用的 <em>PostgreSQL</em> 数据库的存储过程。
只要在 OpenNMS Horizon 的事件表中少于 250000 条事件，储存过程就返回 true。</p>
</div>
<div class="listingblock">
<div class="title">监测器中使用的储存过程</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-sql" data-lang="sql">CREATE OR REPLACE FUNCTION eventlimit_sp() RETURNS boolean AS
$BODY$DECLARE
num_events integer;
BEGIN
	SELECT COUNT(*) into num_events from events;
	RETURN num_events &gt; 250000;
END;$BODY$
LANGUAGE plpgsql VOLATILE NOT LEAKPROOF
COST 100;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-DB-SP-Event-Limit" interval="300000" user-defined="true" status="on"&gt;
  &lt;parameter key="driver" value="org.postgresql.Driver"/&gt;
  &lt;parameter key="url" value="jdbc:postgresql://OPENNMS_JDBC_HOSTNAME:5432/opennms"/&gt;
  &lt;parameter key="user" value="opennms"/&gt;
  &lt;parameter key="password" value="opennms"/&gt;
  &lt;parameter key="stored-procedure" value="eventlimit_sp"/&gt;
  &lt;parameter key="schema" value="public"/&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-DB-SP-Event-Limit" class-name="org.opennms.netmgt.poller.monitors.JDBCStoredProcedureMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdbcquerymonitor">4.6.24. JDBCQueryMonitor</h4>
<div class="paragraph">
<p>监测器 <em>JDBCQueryMonitor</em> 可用对数据库执行 SQL 查询，并且可以验证查询结果。
通过只读连接运行 SQL 查询，因此数据库中的数据不会更改。
它是基于It is based on the <a href="http://www.oracle.com/technetwork/java/javase/jdbc/index.html">JDBC</a> 技术与数据库进行连接和通信。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_22">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.JDBCQueryMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_21">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 36. 监测器 JDBCQueryMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 JDBC 驱动程序类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.postgresql.Driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDBC URL 连接。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc:postgresql://:OPENNMS_JDBC_HOSTNAME/opennms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database 用户</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postgres</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database 密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>empty string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的 SQL 查询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行动作</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>row_count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>column</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">结果列</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于比较的运算符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operand</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与 SQL 查询结果进行比较的操作数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取决于操作</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果服务失败，要使用的消息。
               操作数和运算符都将添加到消息中。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">依赖于动作的通用消息</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">测试重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 url 参数中， OPENNMS_JDBC_HOSTNAME 将被监测服务的接口的IP或解析主机名替换。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 37. 可用的 <em>操作</em> 参数及其默认 <em>操作数</em></caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">默认操作数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>row_count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将返回行的数目进行比较，而不是结果行的值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compare_string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">比较字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compare_int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">比较结果第一行一列的整数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 38. 可用 <em>操作</em> 参数</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">XML 配置中的元素</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;lt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8656;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;lt;=</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;gt;=</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_运算_运算符_运算数">运算 - 运算符 - 运算数</h5>
<div class="paragraph">
<p>只有 SQL 查询返回的第一行结果进行运算。
与 SQL 查询中一列的值或行数进行计算。</p>
</div>
</div>
<div class="sect4">
<h5 id="_提供数据库驱动程序_3">提供数据库驱动程序</h5>
<div class="paragraph">
<p>监测器 <em>JDBCQueryMonitor</em> 基于 <em>JDBC</em> ，需要 JDBC 驱动程序与数据库进行通信。
由于 OpenNMS Horizon 本身使用 PostgreSQL 数据库，所以 PostgreSQL JDBC 驱动程序已经可以使用。
对于其它的数据库系统，必须提供一个兼容的 JDBC 驱动程序的 <em>jar-file</em> 文件提供给 OpenNMS Horizon 。
将 JDBC 驱动程序 <em>driver-jar</em> 放到 OpenNMS Horizon 系统的 <code>opennms/lib</code> 目录下。
如果远程轮询使用 <em>JDBCQueryMonitor</em> ，文件 <em>driver-jar</em> 也必须提供给 <em>远程轮询</em> 。
当使用 <em>Java Webstart Remote Poller</em> 时，这可能是很麻烦的，因为需要代码签名。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_17">实例</h5>
<div class="paragraph">
<p>下面的示例检查 OpenNMS Horizon 数据库中的事件数是否小于 250000。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-DB-Event-Limit" interval="30000" user-defined="true" status="on"&gt;
  &lt;parameter key="driver" value="org.postgresql.Driver"/&gt;
  &lt;parameter key="url" value="jdbc:postgresql://OPENNMS_JDBC_HOSTNAME:5432/opennms"/&gt;
  &lt;parameter key="user" value="opennms"/&gt;
  &lt;parameter key="password" value="opennms"/&gt;
  &lt;parameter key="query" value="select eventid from events" /&gt;
  &lt;parameter key="action" value="row_count" /&gt;
  &lt;parameter key="operand" value="250000" /&gt;
  &lt;parameter key="operator" value="&amp;lt;" /&gt;
  &lt;parameter key="message" value="too many events in OpenNMS database" /&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-DB-Event-Limit" class-name="org.opennms.netmgt.poller.monitors.JDBCQueryMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="poller-jmx-monitor">4.6.25. JmxMonitor</h4>
<div class="paragraph">
<p><em>JMX</em> 监测器可以测试 Java 应用程序的服务可用性。
监测器提供以下功能:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过 <em>JMX</em> 测试应用程序的连通性</p>
</li>
<li>
<p>存在的管理 beans</p>
</li>
<li>
<p>测试单个或多个管理 beans 的状态，并评估他们的值</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_监测器定义_23">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.Jsr160Monitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_22">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 39. 监测器 JmxMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取响应的重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待响应的毫秒时间</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送 <em>JMX</em> 请求的目的端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件 <code>jmx-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>factory</code>              </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果需要凭证，将设置为 <code>PASSWORD-CLEAR</code>   </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STANDARD</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code>            </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <em>JMX</em> 连接字符串中使用的协议              </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rmi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>urlPath</code>              </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <em>JMX</em> 连接字符串中使用的路径                      </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/jmxrmi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rmiServerPort</code>        </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RMI</em> 端口                                                 </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>45444</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remoteJMX</code>            </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用替代的 <em>JMX</em> URL 方案                        </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beans.&lt;variable&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义要访问的 <em>mbeans</em> 对象名。
                            变量名 ´&lt;variable&gt;´ 是任意的。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tests.&lt;variable&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">测试 <em>mbeans</em> 属性值。
                            变量名 ´&lt;variable&gt;´ 是任意的。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_实例_18">实例</h5>
<div class="listingblock">
<div class="title">测试是否可以建立一个 <em>JMX</em> 连接</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="JMX-Connection-Test" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="3"/&gt;
    &lt;parameter key="timeout" value="3000"/&gt;
    &lt;parameter key="port" value="18980"/&gt;
&lt;/service&gt;
&lt;monitor service="JMX-Connection-Test" class-name="org.opennms.netmgt.poller.monitors.JmxMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试特定管理 bean 的值</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="JMX-BeanValue-Test" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="3"/&gt;
    &lt;parameter key="timeout" value="3000"/&gt;
    &lt;parameter key="port" value="18980"/&gt;
    &lt;parameter key="beans.connected" value="org.opennms.workflow:name=client.onms.connected"/&gt;
    &lt;parameter key="tests.isConnected" value="connected.get(&amp;quot;Value&amp;quot;) == true"/&gt;
&lt;/service&gt;
&lt;monitor service="JMX-BeanValue-Test" class-name="org.opennms.netmgt.poller.monitors.Jsr160Monitor"/&gt;</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<em>XML</em> 的保留字，像 <strong>&gt;</strong>, <strong>&lt;</strong>, <strong>"</strong> 需要进行转义。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jolokiabeanmonitor">4.6.26. JolokiaBeanMonitor</h4>
<div class="paragraph">
<p>监测器 <em>JolokiaBeanMonitor</em> 是一个专门用于 <a href="http://www.jolokia.org">Jolokia framework</a> 的 JMX 监测器。
<em>JolokiaBeanMonitor</em> 可以通过 <em>JMX</em> 执行一个方法，或通过 <em>JMX</em> 轮询属性。
它需要在 JVM 容器中完全安装和配置 <em>Jolokia agent</em> 。
如果需要，可以提供属性名称，路径和方法作为额外参数。
为了确定服务状态， <em>JolokiaBeanMonitor</em> 依赖响应输出。
如果输出中包含标识，则状态为 up。
如果输出中不包含标识，则状态为 <em>down</em>。
标识匹配支持正则表达式和子串匹配。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_24">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.JolokiaBeanMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_23">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 40. 监测器 JolokiaBeanMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>beanname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要查询的 bean 名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>attrname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要获取的 JMX 属性名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选 (<code>attrname</code> 或 <code>methodname</code> 必须设置)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>attrpath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">属性路径。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于 HTTP BASIC auth 的用户名。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>auth-password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于 HTTP BASIC auth 的密码。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>banner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">系统调用输出相匹配的字符串。如果输出包含标识，<br>
                    则服务为 <em>up</em>。 正则表达式以 <code>~</code> 开头。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法输入</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">方法输入</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>methodname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的 bean 方法的名称，输出将与标识进行比较。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选 (<code>attrname</code> 或 <code>methodname</code> 必须设置)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jolokia agent 的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jolokia agent 的 url。 默认为 "http://&lt;ipaddr&gt;:&lt;port&gt;/jolokia"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 41. 可用的配置变量</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${ipaddr}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务接口绑定的 IP 地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${port}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务绑定的端口。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_实例_19">实例</h5>
<div class="paragraph">
<p>监测器配置示例，配置文件 <code>poller-configuration.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parameter key="url" value="http://${ipaddr}:${port}/jolokia"/&gt;
&lt;parameter key="url" value="https://${ipaddr}:${port}/jolokia"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_attrname_与_methodname">AttrName 与 MethodName</h5>
<div class="paragraph">
<p>监测器 JolokiaBeanMonitor 有两种操作模式。它可以从 bean 获取属性，或者执行方法，并将输出与标识进行比较。当你的应用程序有自己的测试方法，并且想通过 OpenNMS Horizon 触发执行。</p>
</div>
<div class="paragraph">
<p>执行一个称为 "superTest" 的测试方法，并且使用字符串作为输入如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parameter key="beanname" value="MyBean" /&gt;
&lt;parameter key="methodname" value="superTest" /&gt;
&lt;parameter key="input1" value="someString"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>从同一个 bean 获取属性如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parameter key="beanname" value="MyBean" /&gt;
&lt;parameter key="attrname" value="upTime" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="poller-ldap-monitor">4.6.27. LdapMonitor</h4>
<div class="paragraph">
<p>LDAP 监测器对 LDAP 服务可用性进行测试。
LDAP 监测器首先尝试在指定端口上建立 TCP 连接。
如果成功，将尝试建立 LDAP 连接并进行简单搜索。
如果在指定超时时间内返回搜索结果，则该服务可用。
LDAP 搜索范围仅限于基本对象的直接下级。
默认情况下，LDAP 搜索是匿名的。
LDAP 监测器使用了 <em>com.novell.ldap.LDAPConnection</em> 类。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_25">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.LdapMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_24">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 42. 监测器 LdapMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果搜索需要身份验证，则需要使用特别的名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果搜索需要身份验证，需要使用密码。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试连接的目的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>389</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取搜索结果的尝试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchbase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要搜索的基本名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchfilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP 搜索的过滤器。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(objectclass=*)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用 LDAP 协议的版本，是一个整数。
                    Note: 目前只支持 LDAPv3 版本。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_20">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- OpenNMS.org --&gt;
&lt;service name="LDAP" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="port" value="389"/&gt;
  &lt;parameter key="version" value="3"/&gt;
  &lt;parameter key="searchbase" value="dc=opennms,dc=org"/&gt;
  &lt;parameter key="searchfilter" value="uid=ulf"/&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="ldap"/&gt;
  &lt;parameter key="ds-name" value="ldap"/&gt;
&lt;/service&gt;
&lt;monitor service="LDAP" class-name="org.opennms.netmgt.poller.monitors.LdapMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ldapsmonitor">4.6.28. LdapsMonitor</h4>
<div class="paragraph">
<p>LDAPS 监测器测试启用 SSL-enabled 的 LDAP 服务器响应。
LDAPS 监测器是启用 SSL-enabled 的 LDAP 监测器的扩展，默认 TCP 端口是 636。
所有的 LdapMonitor 参数都适用，请参阅 <a href="#poller-ldap-monitor">LdapMonitor&#8217;s 文档</a> 获取更多信息。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_26">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.LdapsMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_25">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 43. 监测器 LdapsMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试连接的目的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>636</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_21">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- LDAPS service at OpenNMS.org is on port 6636 --&gt;
&lt;service name="LDAPS" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="port" value="6636"/&gt;
  &lt;parameter key="version" value="3"/&gt;
  &lt;parameter key="searchbase" value="dc=opennms,dc=org"/&gt;
  &lt;parameter key="searchfilter" value="uid=ulf"/&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="ldaps"/&gt;
  &lt;parameter key="ds-name" value="ldaps"/&gt;
&lt;/service&gt;

&lt;monitor service="LDAPS" class-name="org.opennms.netmgt.poller.monitors.LdapsMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_memcachedmonitor">4.6.29. MemcachedMonitor</h4>
<div class="paragraph">
<p>这个监测器可以检测 <a href="http://memcached.org">Memcached</a>，一个分布式内存对象缓存系统。
为了检测服务可用性，监测器测试 <em>Memcached</em> 统计数据是否可以请求。
统计数据被处理并存储在 RRD 文件。
采集以下指标度量:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 44. 使用 MemcachedMonitor 监测器采集指标度量</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">指标</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>uptime</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Memcached</em> 服务器已经运行时间，从上次重新启动以来，单位秒。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>rusageuser</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务器进程的用户时间，单位秒。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>rusagesystem</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务器进程的系统时间，单位秒。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>curritems</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此服务器缓存数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>totalitems</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此服务器上的存储数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>bytes</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当前使用缓存的字节数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>limitmaxbytes</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置的最大缓存。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>currconnections</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此 <em>Memcached</em> 的打开连接数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>totalconnections</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自启动以来，成功连接到该服务器的次数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>connectionstructure</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务器当前持有的内部连接句柄数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cmdget</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自服务器启动以来，接收到的 <em>GET</em> 命令数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cmdset</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自服务器启动以来，接收到的 <em>SET</em> 命令数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>gethits</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自从启动以来，成功执行 <em>GET</em> 命令 (缓存命中) 数量。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>getmisses</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">失败的 <em>GET</em> 请求数，因为没有缓存。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>evictions</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">从缓存中移除的对象数，以释放内存。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>bytesread</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">从网络接收的字节数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>byteswritten</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送到网络的字节数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>threads</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此服务器使用的线程数。</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_监测器定义_27">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.MemcachedMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_26">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 45. 监测器 MemcachedMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试建立 Memcached 连接的次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接到 Memcached 的 TCP 端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11211</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_22">实例</h5>
<div class="paragraph">
<p>下面的示例显示了 <code>poller-configuration.xml</code> 文件的配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="Memcached" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="port" value="11211" /&gt;
  &lt;parameter key="retry" value="2" /&gt;
  &lt;parameter key="timeout" value="3000" /&gt;
  &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response" /&gt;
  &lt;parameter key="ds-name" value="memcached" /&gt;
  &lt;parameter key="rrd-base-name" value="memcached" /&gt;
&lt;/service&gt;

&lt;monitor service="Memcached" class-name="org.opennms.netmgt.poller.monitors.MemcachedMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netscalergrouphealthmonitor">4.6.30. NetScalerGroupHealthMonitor</h4>
<div class="paragraph">
<p>该监测器是针对检测 <em>Citrix&#174; NetScaler&#174;</em> 负载均衡而设计开发的。
它检测负载均衡服务上分配给特定组的服务器是否超过 x 百分比。
所需的数据通过 SNMP 从 <em>NetScaler&#174;</em> 获取。
服务器的状态由 <em>NetScaler&#174;</em> 决定。
所提供的服务本身不是检查的内容。
这个监测器的基础是 <em>SnmpMonitorStrategy</em>。
OpenNMS Horizon 系统中需要一个有效 SNMP 配置，来监控 <em>NetScaler&#174;</em> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
一个 <em>NetScaler&#174;</em> 可以管理每个应用程序的多组服务器。
这个监测器一次只能监控一个组。
如果有多个组要监控，则每个组要定义一个监测器。
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
这个监测器没有检测负载均衡自身的服务。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_28">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.NetScalerGroupHealthMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_27">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 46. 监测器 NetScalerGroupHealthMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要监控的服务器组的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group-health</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">活动服务器和组的总服务器的百分比，整数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_23">实例</h5>
<div class="paragraph">
<p>下面的示例监控一个名为 <em>central_webfront_http</em> 的服务器组。
如果大于 70% 的服务器是活动的，则服务是 up。
如果少于 70% 的服务器是活动的，则服务器是 down。
下面的示例是 <code>poller-configuration.xml</code> 中的配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="NetScaler_Health" interval="300000" user-defined="false" status="on"&gt;
   &lt;parameter key="group-name" value="central_webfront_http" /&gt;
   &lt;parameter key="group-health" value="70" /&gt;
&lt;/service&gt;

&lt;monitor service="NetScaler_Health" class-name="org.opennms.netmgt.poller.monitors.NetScalerGroupHealthMonitor” /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_有关使用_snmp_检测的详细信息">有关使用 SNMP 检测的详细信息</h5>
<div class="paragraph">
<p>监测器使用 <em>NS-ROOT-MIB</em> 里的 <em>svcGrpMemberState</em> 检测服务器组的状态。
<em>svcGrpMemberState</em> 是 <em>serviceGroupMemberTable</em> 的一部分。
<em>serviceGroupMemberTable</em> 使用 <em>svcGrpMemberGroupName</em> 和 <em>svcGrpMemberName</em> 作为联合索引。
对 <code>group-name</code> 进行初始查找。
先使用 walked 遍历 <em>serviceGroupMemberTable</em> ，然后再查找服务器组的数字表示。
监测器将服务器状态码 <em>7-up</em> ，作为活动服务器。
其它状态码，像 <em>2-unknown</em> 或 <em>3-busy</em> 用来统计服务器总数。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nrpemonitor">4.6.31. NrpeMonitor</h4>
<div class="paragraph">
<p>此监测器可以测试 <a href="http://exchange.nagios.org/directory/Addons/Monitoring-Agents/NRPE&#8212;&#8203;2D-Nagios-Remote-Plugin-Executor/details">Nagios Remote Plugin Executor</a> (<em>NRPE</em>) 框架的插件和检查运行状态。
监测器可以测试 <em>NRPE</em> 执行的检查命令，通过输出判断可用状态。
在 OpenNMS Horizon 和 <em>Nagios</em> 之间存在一些概念差异。
在 OpenNMS Horizon 中，服务只能是可用或不可用的，并且计算服务的响应时间。
<em>Nagios</em> 将服务可用性，性能数据采集和门限判断组合在一个检测命令中。
因此，一个 <em>Nagios</em> 检测命令可以有多个状态，像 <em>OK</em> 和 <em>CRITICAL</em>。
监测器 <em>NrpeMonitor</em> 检测命令结果时，除了 <em>OK</em> ，其它都是 <em>down</em>。
检测命令的完整输出消息将发送给 OpenNMS Horizon 的服务 down 事件。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
需要在服务器上配置 <em>NRPE</em> ，并且需要配置检测命令，即 <code>command[check_apt]=/usr/lib/nagios/plugins/check_apt</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
OpenNMS Horizon 在一个 Java 线程中执行 <em>NRPE</em> 检测命令，而不是使用 <em>fork()</em> 进程，这样资源共容易共享。
         即使这样，还是可以运行一些外部程序的 <em>NRPE</em>  插件，像 <code>sed</code>, <code>awk</code> 或 <code>cut</code> 的组合命令。
         请注意，每个命令在分支附件进程中结束。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_29">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.NrpeMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_28">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 47. 监测器 NrpeMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检测服务的重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>command</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">命令配置 `command[{check_name}]="/path/to/plugin/check-script" 的 {check_name} 检测名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">远程服务器上 <em>NRPE</em> 的访问端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5666</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>padding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发给 <em>NRPE</em> 代理的准备命令。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usessl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">实现网络通信的加密。 <em>NRPE</em> 使用匿名 DH 的 SSL ，
              并且使用 <em>TLS_DH_anon_WITH_AES_128_CBC_SHA</em> 加密方案。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_例子_使用_nrpe_的_check_apt">例子: 使用 <em>NRPE</em> 的 <em>check_apt</em></h5>
<div class="paragraph">
<p>这个例子展示了怎样配置 <em>NrpeMonitor</em> 来运行 <em>NRPE</em> 上的 <em>check_apt</em> 命令。</p>
</div>
<div class="listingblock">
<div class="title">配置 <em>NRPE</em> 的检测命令在代理文件 'nrpe.cfg'</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">command[check_apt]=/usr/lib/nagios/plugins/check_apt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置 <em>NrpeMonitor</em> 检测 <em>NRPE</em> 插件</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="NRPE-Check-APT" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="3" /&gt;
  &lt;parameter key="timeout" value="3000" /&gt;
  &lt;parameter key="port" value="5666" /&gt;
  &lt;parameter key="command" value="check_apt" /&gt;
  &lt;parameter key="padding" value="2" /&gt;
&lt;/service&gt;

&lt;monitor service="NRPE-Check-APT" class-name="org.opennms.netmgt.poller.monitors.NrpeMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ntpmonitor">4.6.32. NtpMonitor</h4>
<div class="paragraph">
<p>NTP 监测器对 NTP 服务可用性进行检测。
在轮询期间，会生成 NTP 请求查询包。
如果收到响应，则对其进行解析和验证。
如果是有效的 NTP 响应，则认为服务可用。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_30">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.NtpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_29">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 48. 监测器 NtpMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送 NTP 请求的目的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>123</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">试图获得响应的次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待响应的时间，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_24">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Fast NTP server --&gt;
&lt;service name="NTP" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="1000"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="ntp"/&gt;
  &lt;parameter key="ds-name" value="ntp"/&gt;
&lt;/service&gt;
&lt;monitor service="NTP" class-name="org.opennms.netmgt.poller.monitors.NtpMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="OmsaStorageMonitor">4.6.33. OmsaStorageMonitor</h4>
<div class="paragraph">
<p>使用 OmsaStorageMonitor 可用检测 <a href="http://de.community.dell.com/techcenter/systems-management/w/wiki/438.dell-openmanage-server-administrator-omsa.aspx">Dell OpenManaged</a> 服务器 RAID 阵列状态。
监测器支持下列 <a href="http://support.dell.com/support/systemsinfo/document.aspx?~file=/software/svradmin/2.2/en/snmp/snmpc22.htm">STORAGEMANAGEMENT-MIB</a> 的 OIDS:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>virtualDiskRollUpStatus                     .1.3.6.1.4.1.674.10893.1.20.140.1.1.19
arrayDiskLogicalConnectionVirtualDiskNumber .1.3.6.1.4.1.674.10893.1.20.140.3.1.5
arrayDiskNexusID                            .1.3.6.1.4.1.674.10893.1.20.130.4.1.26
arrayDiskLogicalConnectionArrayDiskNumber   .1.3.6.1.4.1.674.10893.1.20.140.3.1.3
arrayDiskState                              .1.3.6.1.4.1.674.10893.1.20.130.4.1.4</pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>virtualDiskRollUpStatus</code> 来检测磁盘阵列的状态， 。
如果 <code>virtualDiskRollUpStatus</code> 的检查结果不是 <code>3</code>，则监测器标记为 <em>down</em>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 49. 虚拟磁盘上卷状态的可能结果值</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">结果值</th>
<th class="tableblock halign-left valign-top">状态描述</th>
<th class="tableblock halign-left valign-top">{product-title} 中的检测状态</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>other</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>unknown</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ok</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>non-critical</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>critical</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>non-recoverable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOWN</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
你需要知道在你的环境中可能存在的最大逻辑磁盘数量。
             例如: 如果你有3个 RAID 阵列，则需要每个逻辑磁盘阵列都要有轮询服务。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>为了在磁盘阵列错误的情况下提供更详细的信息，监测器尝试使用其它 OIDs 识别问题。
该值用来挖掘服务 down 事件的错误原因。
通过以下状态表，将磁盘阵列状态值解析为可读信息。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 50. 可能的磁盘阵列状态错误</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">值</th>
<th class="tableblock halign-left valign-top">状态</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Ready</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Failed</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Online</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Offline</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Degraded</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Recovering</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Removed</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Resynching</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Rebuilding</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>noMedia</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Formating</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Running Diagnostics</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>35</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Initializing</em></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_监测器定义_31">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.OmsaStorageMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_30">配置与使用</h5>
<div class="paragraph">
<p>监测器 OmsaStorageMonitor 的特定参数</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtualDiskNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">磁盘阵列 RAID 的磁盘索引</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenManage 监听的 TCP 端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件 <code>snmp-config.xml</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_25">实例</h5>
<div class="paragraph">
<p>一些监测器的配置示例，配置文件 <code>poller-configuration.xml</code>。
配置检测你的第一个阵列 <em>RAID</em> 的配置为 <code>virtualDiskNumber = 1</code> ，如下所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OMSA-Disk-Array-1" interval="300000" user-defined="false" status="on"&gt;
 &lt;parameter key="retry" value="3"/&gt;
 &lt;parameter key="timeout" value="6000"/&gt;
 &lt;parameter key="virtualDiskNumber" value="1"/&gt;
&lt;/service&gt;

&lt;monitor service="OMSA-Disk-Array-1" class-name="org.opennms.netmgt.poller.monitors.OmsaStorageMonitor"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果有多个 RAID 阵列要监测，则需要添加一个配置。
这时 <code>virtualDiskNumber = 2</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OMSA-Disk-Array-2" interval="300000" user-defined="false" status="on"&gt;
 &lt;parameter key="retry" value="3"/&gt;
 &lt;parameter key="timeout" value="6000"/&gt;
 &lt;parameter key="virtualDiskNumber" value="2"/&gt;
&lt;/service&gt;

&lt;monitor service="OMSA-Disk-Array-2" class-name="org.opennms.netmgt.poller.monitors.OmsaStorageMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openmanagechassismonitor">4.6.34. OpenManageChassisMonitor</h4>
<div class="paragraph">
<p>OpenManageChassis 监测器通过查询 Dell chassis 的 SNMP 代理来获取状态。
监测器轮询设备的 SNMP OID .1.3.6.1.4.1.674.10892.1.300.10.1.4.1 (MIB-Dell-10892::chassisStatus)。
如果值为 <em>OK</em> (3)，则该服务可用。</p>
</div>
<div class="paragraph">
<p>该监测器使用 SNMP，查询设备的 SNMP 配置在文件 <em>snmp-config.xml</em>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_32">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.OpenManageChassisMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_31">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 51. 监测器 OpenManageChassisMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要连接的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件 <code>snmp-config.xml</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_26">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Overriding default SNMP config --&gt;
&lt;service name="OMA-Chassis" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="3"/&gt;
  &lt;parameter key="timeout" value="5000"/&gt;
&lt;/service&gt;

&lt;monitor service="OMA-Chassis" class-name="org.opennms.netmgt.poller.monitors.OpenManageChassisMonitor" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dell_mibs">Dell MIBs</h5>
<div class="paragraph">
<p>Dell MIBs 可以在 <a href="ftp://ftp.us.dell.com/sysman">这里</a> 找到。
下载你的 OpenManage 代理对应的 DCMIB&lt;version&gt;.zip 或 DCMIB&lt;version&gt;.exe 文件。
最新版应该兼容以前的版本。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pagesequencemonitor">4.6.35. PageSequenceMonitor</h4>
<div class="paragraph">
<p>监测器 <em>PageSequenceMonitor</em> (PSM) 让 OpenNMS 可以检测 web 应用程序。
这个监测器可以通过一些配置选项来应对 <em>IPv4</em>, <em>IPv6</em> 以及处理域名解析。
为了增加灵活性，设备名称和IP地址可以作为变量传递给监测器。
这样，监测器可以依赖设备配置来运行。
除了用单个 <em>URL</em> 测试 web 应用程序之外，还可以通过 web 应用程序测试一个路径。
通过 web 应用程序测试路径，过程如下:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>登录到某个 web 应用程序</p>
</li>
<li>
<p>登录后执行操作</p>
</li>
<li>
<p>注销</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果这个过程成功完成，服务状态是 <em>up</em> 。
如果在某个地方出现错误，要注意你的应用程序，并且服务状态为 <em>down</em>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_33">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.PageSequenceMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_32">配置与使用</h5>
<div class="paragraph">
<p>这个监测器的配置由几个部分组成。
首先是 <code>retries</code> 和 <code>timeouts</code> 的全局配置。
通过 web 应用的整个路径是全局参数。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/monitors/03_page-sequence-monitor-config.png" alt="03 page sequence monitor config">
</div>
<div class="title">Figure 30. <em>PSM</em> 的配置概述</div>
</div>
<div class="paragraph">
<p>监测器配置的总体布局比较复杂。
另外，可以配置一个页面序列，包含通过 web 应用程序的路径。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 52. 监测器 PageSequenceMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">每页的重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strict-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义一个在尝试重试之前的等待计时器。
                     只有在重试至少是一 (1) 时才使用。
                     如果 <code>retry &gt;= 1</code> 并且 <code>strict-timeout</code> 是 <code>true</code>，则下一次尝试被延迟，同时 <em>Poller Daemon</em>
                     要等待 <code>NOW - InitialAttempt ms + Timeout ms</code> 毫秒。
                     对于 <code>strict-timout = false</code> 时，下一次尝试是在失败后立即启动。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page-sequence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要执行的页面序列的定义，请参阅 <em>页面序列参数</em> 表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sequence-retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">整个页面序列的重试参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-system-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应该使用系统范围的代理设置吗？
                     可以在 <a href="#ga-opennms-system-properties">opennms.conf</a> 中配置系统代理设置。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 53. 页面序列参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">页面序列的名称。 <strong>(Is this relevant/used?)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HTTP</em> 请求方法，例如 <em>GET</em> 或 <em>POST</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http-version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HTTP</em> 协议版本号， 0.9, 1.0 或 1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HTTP/1.1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <em>HTTP</em> 头设置 <em>user agent</em> 来标识 OpenNMS 监测器</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS PageSequenceMonitor (服务名: "${SERVICE NAME}")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual-host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <em>HTTP</em> 头中设置 <em>virtual host</em> 字段。
                               对于 HTTPS 请求，这也是虚拟域作为 <em>TLS</em> 协议的一部分来发送，
                               称为服务器名标识 (<em>SNI</em>)
                               (参考: <a href="https://www.ietf.org/rfc/rfc3546.txt">RFC3546</a> section 3.1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求中调用的相对 URL 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scheme</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义 <em>URL</em> 方案为 <code>http</code> 或 <code>https</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user-info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <em>HTTP</em> 头中设置 <em>user info</em> 字段</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <em>HTTP</em> 头中设置 <em>host</em> 字段</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>服务的IP接口地址</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requireIPv6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通信需要连接到一个 <em>IPv6</em> 地址。 (<code>true</code> 或 <code>false</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requireIPv4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通信需要连接到一个 <em>IPv4</em> 地址。 (<code>true</code> 或 <code>false</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disable-ssl-verification</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对 <em>HTTPS</em> 测试启用或禁用 <em>SSL</em> 证书验证。
                               请仔细使用此选项，因为自签名证书在 JVM 中导入 CA 证书，
                               而不只是禁用它。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接到 web 服务器的端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>80</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">??</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failureMatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在响应体中查找文本。
                               这是一个针对每行匹配的 <em>正则表达式</em> ，如果匹配到信息将视为失败，
                               并且设置该服务为 <em>Down</em>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failureMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">失败消息用于构造原因代码。
                               <code>${n}</code> 值可用于从 <code>failureMatch</code> 正则表达式中的匹配组中提取信息。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>successMatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在响应体中查找文本。
                               这是一个每行匹配的 <em>正则表达式</em> ，如果匹配到信息，则将视为成功的，
                               并且将该服务设置为 <em>Up</em>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locationMatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果相对 URL 可用被加载，那么请求就是成功的。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>response-range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许的 HTTP 响应错误代码范围。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>session-variable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将正则表达式匹配组的值分配给 user-defined 名称的会话变量。
                               匹配组由数字指定，必须大于等于零。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>response-range</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个逗号分隔的 <em>HTTP</em> 响应代码范围 (<code>200-202,299</code>)。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>100-399</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
如果设置 <code>requireIPv4</code> <strong>和</strong> <code>requireIPv6</code> 为 false ，则用于连接的主机IP将从系统域名解析器中解析，并且忽略来自 IP 接口的相关IP地址。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 54. 可用配置变量</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${nodelabel}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监测器关联的设备名称。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_会话变量">会话变量</h5>
<div class="paragraph">
<p>可用页面中将检索到的字符串指定给变量，这些变量稍后可以在相同序列的页面参数中使用。
首先，在 <code>successMatch</code> 表达式中指定一个或多个匹配组 (参考 <a href="http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java Class Pattern</a> 获得更多关于 Java 正则表达式的信息)。
然后，通过使用 session-variable 参数将匹配的值指定给变量名，并在稍后的页面加载中使用。</p>
</div>
</div>
<div class="sect4">
<h5 id="_页面响应时间">页面响应时间</h5>
<div class="paragraph">
<p>序列中各个页面采集的响应时间。
要使用此功能，每个页面跟踪加载时必须将 <code>ds-name</code> 属性添加进去。
每个页面的响应时间将通过 <code>rrd-base-name</code> 参数指定的数据源名存储在对应服务的相同 <em>RRD</em> 文件中。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
当向已经存储响应时间数据的页面序列中添加 <code>ds-name</code> 属性使，需要删除现有的 <em>RRD</em> 文件，并使用新的数据源列表重新创建。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_实例_27">实例</h5>
<div class="paragraph">
<p>下面的示例演示如何使用多种机制监控 <em>OpenNMS</em> web 应用程序。
它首先执行 <code>${ipaddr}/opennms</code> 的 <em>HTTP GET</em> 命令，(按照浏览器的重定向)，然后检查页面输出结果中是否包含 <code>Password</code> 字段。
下一步，使用尝试使用 <em>HTTP POST</em> 提交数据登录到 <em>URL</em>  (通常，是 <em>URL</em> 的表单操作指向)。
参数 (<code><em>j_username</em></code> 和 <code><em>j_password</em></code>) 标识要提交表单的数据和值。
在活动页面结果之后，先验证页面的 <code>failureMatch</code> 属性指定的表达式，如果匹配到该表达式，则表示页面失败。
如果在页面结果中没有匹配到 <code>failureMatch</code> 表达式，然后再匹配页面的 <code>successMatch</code> 属性指定表达式，之后检查匹配结果。
如果页面上没有匹配到 <code>successMatch</code> 表达式，则页面失败。
如果监测器能够成功登录，则处理下一页。
在该示例中，监测器导航到事件页面，试图在页面上查找 <em>事件查询</em> 。
最后，监测器调用注销 URL 来关闭会话。
通过使用 <code>locationMatch</code> 参数，验证是否注销成功并触发重定向。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
每个页面中在验证表达式 <code>failureMatch</code>, <code>successMatch</code>, 和 <code>locationMatch</code> 之前，首先检查 <em>HTTP</em> 响应代码是否符合 <code>response-range</code> 的配置值。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">配置测试登录到 OpenNMS Web 应用程序</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-Web-Login" interval="30000" user-defined="true" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="5000"/&gt;
  &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
  &lt;parameter key="ds-name" value="opennmslogin"/&gt;
  &lt;parameter key="page-sequence"&gt;
    &lt;page-sequence&gt;
      &lt;page path="/opennms/login.jsp"
            port="8980"
            successMatch="Password" /&gt;
      &lt;page path="/opennms/j_spring_security_check"
            port="8980"
            method="POST"&gt;
        &lt;parameter key="j_username" value="admin"/&gt;
        &lt;parameter key="j_password" value="admin"/&gt;
      &lt;/page&gt;
      &lt;page path="/opennms/index.jsp"
            port="8980"
            successMatch="Log Out" /&gt;
      &lt;page path="/opennms/event/index"
            port="8980" successMatch="Event Queries" /&gt;
      &lt;page path="/opennms/j_spring_security_logout"
            port="8980"
            method="POST"
            response-range="300-399"
            locationMatch="/opennms" /&gt;
    &lt;/page-sequence&gt;
  &lt;/parameter&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-Web-Login" class-name="org.opennms.netmgt.poller.monitors.PageSequenceMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试页面序列中的混合 HTTP 和 HTTPS</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-Web-Login" interval="30000" user-defined="true" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="5000"/&gt;
  &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
  &lt;parameter key="ds-name" value="opennmslogin"/&gt;
  &lt;parameter key="page-sequence"&gt;
    &lt;page-sequence&gt;
      &lt;page scheme="http"
            host="ecomm.example.com"
            port="80"
            path="/ecomm/jsp/Login.jsp"
            virtual-host="ecomm.example.com"
            successMatch="eComm Login"
            timeout="10000"
            http-version="1.1"/&gt;
      &lt;page scheme="https"
            method="POST"
            host="ecomm.example.com" port="443"
            path="/ecomm/controller"
            virtual-host="ecomm.example.com"
            successMatch="requesttab_select.gif"
            failureMessage="Login failed: ${1}"
            timeout="10000"
            http-version="1.1"&gt;
        &lt;parameter key="action_name" value="XbtnLogin"/&gt;
        &lt;parameter key="session_timeout" value=""/&gt;
        &lt;parameter key="userid" value="EXAMPLE"/&gt;
        &lt;parameter key="password" value="econ"/&gt;
      &lt;/page&gt;
      &lt;page scheme="http"
            host="ecomm.example.com" port="80"
            path="/econsult/controller"
            virtual-host="ecomm.example.com"
            successMatch="You have successfully logged out of eComm"
            timeout="10000" http-version="1.1"&gt;
        &lt;parameter key="action_name" value="XbtnLogout"/&gt;
      &lt;/page&gt;
    &lt;/page-sequence&gt;
  &lt;/parameter&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-Web-Login" class-name="org.opennms.netmgt.poller.monitors.PageSequenceMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用动态凭证的会话变量测试登录</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-Web-Login" interval="30000" user-defined="true" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="5000"/&gt;
  &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
  &lt;parameter key="ds-name" value="opennmslogin"/&gt;
  &lt;parameter key="page-sequence"&gt;
    &lt;page-sequence name="opennms-login-seq-dynamic-credentials"&gt;
      &lt;page path="/opennms"
            port="80"
            virtual-host="demo.opennms.org"
            successMatch="(?s)User:.*&lt;strong&gt;(.*?)&lt;/strong&gt;.*?Password:.*?&lt;strong&gt;(.*?)&lt;/strong&gt;"&gt;
        &lt;session-variable name="username" match-group="1" /&gt;
        &lt;session-variable name="password" match-group="2" /&gt;
      &lt;/page&gt;
      &lt;page path="/opennms/j_acegi_security_check"
            port="80"
            virtual-host="demo.opennms.org"
            method="POST"
            failureMatch="(?s)Your log-in attempt failed.*Reason: ([^&lt;]*)"
            failureMessage="Login Failed: ${1}"
            successMatch="Log out"&gt;"
        &lt;parameter key="j_username" value="${username}" /&gt;
        &lt;parameter key="j_password" value="${password}" /&gt;
      &lt;/page&gt;
      &lt;page path="/opennms/event/index.jsp"
            port="80"
            virtual-host="demo.opennms.org"
            successMatch="Event Queries" /&gt;
      &lt;page path="/opennms/j_acegi_logout"
            port="80"
            virtual-host="demo.opennms.org"
            successMatch="logged off" /&gt;
    &lt;/page-sequence&gt;
  &lt;/parameter&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-Web-Login" class-name="org.opennms.netmgt.poller.monitors.PageSequenceMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">不用 username 和 password 登录 to demo.opennms.org</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-Demo-Login" interval="300000" user-defined="true" status="on"&gt;
  &lt;parameter key="page-sequence"&gt;
    &lt;page-sequence&gt;
      &lt;page path="/opennms"
            port="80"
            virtual-host="demo.opennms.org"
            successMatch="(?s)User:.*&lt;strong&gt;(.*?)&lt;/strong&gt;.*?Password:.*?&lt;strong&gt;(.*?)&lt;/strong&gt;"&gt;
        &lt;session-variable name="username" match-group="1" /&gt;
        &lt;session-variable name="password" match-group="2" /&gt;
      &lt;/page&gt;
      &lt;page path="/opennms/j_acegi_security_check"
            port="80"
            virtual-host="demo.opennms.org"
            method="POST"
            successMatch="Log out"&gt;"
        &lt;parameter key="j_username" value="${username}" /&gt;
        &lt;parameter key="j_password" value="${password}" /&gt;
      &lt;/page&gt;
      &lt;page path="/opennms/j_acegi_logout"
            port="80"
            virtual-host="demo.opennms.org"
            successMatch="logged off" /&gt;
    &lt;/page-sequence&gt;
  &lt;/parameter&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-Demo-Login" class-name="org.opennms.netmgt.poller.monitors.PageSequenceMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">每个页面响应时间示例</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="OpenNMS-Login" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="opennmslogin"/&gt;
  &lt;parameter key="ds-name" value="overall"/&gt;
  &lt;parameter key="page-sequence"&gt;
    &lt;page-sequence&gt;
      &lt;page path="/opennms/acegilogin.jsp"
            port="8980"
            ds-name="login-page"/&gt;
      &lt;page path="/opennms/event/index.jsp"
            port="8980"
            ds-name="event-page"/&gt;
    &lt;/page-sequence&gt;
  &lt;/parameter&gt;
&lt;/service&gt;

&lt;monitor service="OpenNMS-Login" class-name="org.opennms.netmgt.poller.monitors.PageSequenceMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_percmonitor">4.6.36. PercMonitor</h4>
<div class="paragraph">
<p>此监测器测试 PERC RAID 阵列的状态。</p>
</div>
<div class="paragraph">
<p>监测器首先轮询 RAID-Adapter-MIB::logicaldriveTable (1.3.6.1.4.1.3582.1.1.2) 来检索要监控的 RAID 阵列的状态。
如果相应 logicaldriveEntry 的状态对象的值不是 2，则磁盘阵列被降级，
并且监测器进一步轮询 RAID-Adapter-MIB::physicaldriveTable (1.3.6.1.4.1.3582.1.1.3) ，以检测失败的驱动器。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
这个监测器要求将老版本的 persnmpd 软件安装在轮询设备上。
           请尽可能使用 <a href="#OmsaStorageMonitor">OmsaStorageMonitor</a> 监测器。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_34">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.PercMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false (依赖 SNMP 配置)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_33">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 55. 监测器 PercMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要监控的 RAID 阵列。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要连接的 UDP 端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>from snmp-config.xml</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_28">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Monitor 1st RAID arrays using configuration from snmp-config.xml --&gt;
&lt;service name="PERC" interval="300000" user-defined="false" status="on" /&gt;

&lt;monitor service="PERC" class-name="org.opennms.netmgt.poller.monitors.PercMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pop3monitor">4.6.37. Pop3Monitor</h4>
<div class="paragraph">
<p>POP3 监测器对设备上的 POP3 服务可用性进行测试。
监测器首先尝试在指定端口上建立 TCP 连接。
如果连接被建立，则应该接收到服务回应。
监测器确保服务回应是一个有效的 POP3 响应 (例如: 以 "+OK" 开头)。
如果回应有效，则监测器发送 <em>QUIT</em> POP3 命令，并确定服务是否进行有效回应 (例如: 以 "+OK" 开头的响应)。
如果服务的对_QUIT_的回应是有效的，那么服务被认为是可用的。</p>
</div>
<div class="paragraph">
<p>可用用 <code>telnet</code> 来模拟操作过程:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ telnet mail.opennms.org 110
Trying 192.168.0.100
Connected to mail.opennms.org.
Escape character is '^]'.
+OK &lt;21860.1076718099@mail.opennms.org&gt;
quit
+OK
Connection closed by foreign host.</pre>
</div>
</div>
<div class="sect4">
<h5 id="_监测器定义_35">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.Pop3Monitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_34">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 56. 监测器 Pop3Monitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要连接的 TCP 端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>110</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">探测服务的重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strict-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值
                         如果设置为 <code>true</code>，则要在尝试探测之前等待 <code>timeout</code> 毫秒值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_29">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="POP3" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="pop3"/&gt;
  &lt;parameter key="ds-name" value="pop3"/&gt;
&lt;/service&gt;
&lt;monitor service="POP3" class-name="org.opennms.netmgt.poller.monitors.Pop3Monitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prtablemonitor">4.6.38. PrTableMonitor</h4>
<div class="paragraph">
<p><em>PrTableMonitor</em> 监测器测试 net-snmp SNMP 代理的 <a href="http://www.net-snmp.org/docs/mibs/ucdavis.html#prTable">prTable</a> 。</p>
</div>
<div class="quoteblock">
<div class="title">prTable 定义</div>
<blockquote>
<div class="paragraph">
<p>一个包含运行程序/守护进程信息的表，配置在代理的 snmpd.conf 文件中。
违反代理配置的进程会用数字和文本错误进行描述。</p>
</div>
</blockquote>
<div class="attribution">
&#8212; UCD-SNMP-MIB
</div>
</div>
<div class="paragraph">
<p>监测器查找该表的 <em>prErrorFlag</em> 记录。
如果该表中的 <em>prErrorFlag</em> 记录值被设置为 "1" ，该服务被认为是不可用的。</p>
</div>
<div class="quoteblock">
<div class="title">prErrorFlag 定义</div>
<blockquote>
<div class="paragraph">
<p>错误标志，用于指示进程的故障。
如果有错误，则为1；如果没有错误，则为0。</p>
</div>
</blockquote>
<div class="attribution">
&#8212; UCD-SNMP-MIB
</div>
</div>
<div class="sect4">
<h5 id="_监测器定义_36">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.PrTableMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_35">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 57. 监测器 PrTableMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要尝试连接的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件 <code>snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>过时的</strong>.
              与 <code>retry</code> 相同。
              参数 <code>retry</code> 优先，如果两者都被设置。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件 <code>snmp-config.xml</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_30">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Overriding default SNMP config --&gt;
&lt;service name="Process-Table" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="3"/&gt;
  &lt;parameter key="timeout" value="5000"/&gt;
&lt;/service&gt;

&lt;monitor service="Process-Table" class-name="org.opennms.netmgt.poller.monitors.PrTableMonitor" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ucd_snmp_mib">UCD-SNMP-MIB</h5>
<div class="paragraph">
<p>UCD-SNMP-MIB 可以在 <a href="http://www.net-snmp.org/docs/mibs/UCD-SNMP-MIB.txt">这里</a> 找到。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_radiusauthmonitor">4.6.39. RadiusAuthMonitor</h4>
<div class="paragraph">
<p>这个监测器可以测试 <a href="http://freeradius.org/rfc/rfc2865.html">RADIUS</a> 认证系统的功能。
可用性测试是通过发送一个 <em>AUTH</em> 数据包到 <em>RADIUS 服务器</em>。
如果接收到一个有效的 <em>ACCEPT</em> 响应，则 <em>RADIUS</em> 服务被认为是 <em>up</em> 和可用的。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
要使用这个监测器，需要为 OpenNMS Horizon 安装 <em>RADIUS</em> 协议。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">{apt-get,yum} install {opennms-package-base-name}-plugin-protocol-radius</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用命令行工具 <code>radtest</code> 来模拟测试 <em>RADIUS</em> 服务器的操作过程。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">root@vagrant:~# radtest "John Doe" hello 127.0.0.1 1812 radiuspassword
Sending Access-Request of id 49 to 127.0.0.1 port 1812
	User-Name = "John Doe"
	User-Password = "hello"
	NAS-IP-Address = 127.0.0.1
	NAS-Port = 1812
	Message-Authenticator = 0x00000000000000000000000000000000
rad_recv: Access-Accept packet from host 127.0.0.1 port 1812, id=49, length=37 <i class="conum" data-value="1"></i><b>(1)</b>
	Reply-Message = "Hello, John Doe"</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>监测器分析 <code>Access-Accept</code> 消息。</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_37">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.protocols.radius.monitor.RadiusAuthMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_36">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 58. 监测器 RadiusAuthMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待 <em>RADIUS</em> 服务的毫秒值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监测器重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RADIUS</em> 认证端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1812</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>acctport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RADIUS</em> 计费端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1813</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份验证的用户名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">身份验证的密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于在 <em>client/NAS</em> 和 <em>RADIUS</em> 服务器之前通信的 <em>RADIUS</em> 共享密钥。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authtype</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RADIUS</em> 认证类型。
               支持以下身份认证类型：<code>chap</code>, <code>pap</code>, <code>mschapv1</code>, <code>mschapv2</code>, <code>eapmd5</code>, <code>eapmschapv2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nasid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://freeradius.org/rfc/rfc2865.html#NAS-Identifier">网络访问服务器标识符</a>
               源于 <em>Access-Request</em>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opennms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inner-protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当使用 EAP-TTLS 认证时，此属性指示隧道的认证类型。
                     目前只支持 <code>pap</code>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inner-user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用 EAP-TTLS 隧道时，`pap`认证的用户名。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Inner-OpenNMS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_31">实例</h5>
<div class="paragraph">
<p>在 <code>poller-configuration.xml</code> 中监测器配置示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="Radius-Authentication" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="3" /&gt;
  &lt;parameter key="timeout" value="3000" /&gt;
  &lt;parameter key="user" value="John Doe" /&gt;
  &lt;parameter key="password" value="hello" /&gt;
  &lt;parameter key="secret" value="radiuspassword" /&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response" /&gt;
  &lt;parameter key="ds-name" value="radiusauth" /&gt;
&lt;/service&gt;

&lt;monitor service="Radius-Authentication" class-name="org.opennms.protocols.radius.monitor.RadiusAuthMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_smbmonitor">4.6.40. SmbMonitor</h4>
<div class="paragraph">
<p>该监测器用于测试微软 Windows 环境下的 <em>NetBIOS over TCP/IP</em> 名字解析服务。
监测器试图检索接口IP地址的 <em>NetBIOS 名称</em> 。
微软Windows 提供的 <em>NetBIOS</em> 名字服务端口是 137/UDP 或 137/TCP。</p>
</div>
<div class="paragraph">
<p>指定服务使用的接口IP地址给监测器。
如果指定的 IP 地址注册了 <em>NetBIOS name</em> 服务并且成功解析，那么服务标记为 <em>up</em>。</p>
</div>
<div class="paragraph">
<p>有关故障排除，请参阅微软 Windows 命令行工具 <code>nbtstat</code> 或 Linux 上的 <code>nmblookup</code>。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
微软放弃使用 <em>NetBIOS</em>。
         Windows Server 2000 <em>DNS</em> 作为一个默认名称解析。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_38">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.SmbMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_37">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 59. 监测器 SmbMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>do-node-status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试获取给定地址的 NetBIOS 设备的状态类型</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_32">实例</h5>
<div class="paragraph">
<p>配置文件 <code>poller-configuration.xml</code> 中的监测器配置示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="SMB" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
&lt;/service&gt;

&lt;monitor service="SMB" class-name="org.opennms.netmgt.poller.monitors.SmbMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snmpmonitor">4.6.41. SnmpMonitor</h4>
<div class="paragraph">
<p>SNMP 监测器提供了监控 SNMP 代理的状态和结果通用功能。
该监测器有两种基本操作模式:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>测试一个指定 <em>OID</em> (标量对象标识符) 的响应值;</p>
</li>
<li>
<p>测试整个 <em>table</em> 中的多个值。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要确定使用哪种模式，可以通过 <code>walk</code> 和 <code>match-all</code> 参数指定。</p>
</div>
<div class="paragraph">
<p>有关这些操作模式的更多信息，请参阅下面的 <code>操作模式选择'' 和 </code>监测器 SnmpMonitor 的特定参数'' 的列表。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 60. 操作模式选择</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">walk</th>
<th class="tableblock halign-left valign-top">match-all</th>
<th class="tableblock halign-left valign-top">操作模式</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表格, 所有值必须匹配</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表格，任何值必须匹配</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定的最小和最大对象对应的值</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scalar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scalar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表格中 <code>最小</code> 和 <code>最大</code> 值必须匹配</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
此监测器不能用于 OpenNMS Horizon 的远程轮询。
远程轮询目前不能访问中心 OpenNMS Horizon 的 SNMP 配置。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_39">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.SnmpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当监测器配置为存储响应时间时，它将统计获得成功响应所花费的总时间，包括重试。
它不会存储最后一次成功尝试的时间。</p>
</div>
</div>
<div class="sect4">
<h5 id="_配置与使用_38">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 61. 监测器 SnmpMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定要检测的值应该用十六进制表示进行比较。
                      当被检测的值是不可打印字符时非常有用。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>match-all</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以设置为:<br>
                      <code>count</code>: 指定在遍历中遇到的最小和最大对象的值与
                       <code>operand</code> 和 <code>operator</code> 指定的匹配。<br>
                      <code>true</code> 和 <code>walk</code> 设置为 <code>true</code>: 指定在遍历中遇到的 <strong>每个</strong> 对象
                      的值必须与 <code>operand</code> 和 <code>operator</code> 参数指定值匹配。<br>
                      <code>false</code> 和 <code>walk</code> 设置为 <code>true</code>: 指定在遍历中遇到的 <strong>任何</strong> 对象
                      必须与 <code>operand</code> 和 <code>operator</code> 参数指定的值匹配。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maximum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只有当 <code>match-all</code> 设置为 <code>count</code> 时有效，否则被忽略。
                      应该与 <code>minimum</code> 参数一起使用。指定在遍历中遇到的 <em>最多</em> <code>maximum</code> 对象的值，
                      与 <code>operand</code> 和 <code>operator</code> 参数指定的条件匹配。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minimum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">只有当 <code>match-all</code> 设置为 <code>count</code> 时有效，否则被忽略。
                      应该与 <code>maximum</code> 参数一起使用。指定在遍历中遇到的 <em>最少</em> <code>minimum</code> 对象的值，
                      与 <code>operand</code> 和 <code>operator</code> 参数指定的值匹配。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要检测的 <em>MIB</em> 对象的标识符。
                      如果没有其它参数，则监测器只判断该对象的响应值是否为非空
                      (与 error, no-such-name, 或 end-of-view
                      相反) 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.1.2.0</code> (SNMPv2-MIB::SysObjectID)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operand</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要与被检测对象的实际值进行比较的值。
                      Note: 如果没有设置 <code>operand</code> 和 <code>operator</code> 参数，
                            并且检测值为非空，则比较为成功。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于将检测对象与 <code>operand</code> 参数进行比较的运算符。
                      必须是下列运算符之一:<br>
                      <code>&amp;lt;</code> (&lt;): 小于。操作数和观察对象值都必须是数字。<br>
                      <code>&amp;gt;</code> (&gt;): 大于。操作数和观察对象值都必须是数字。<br>
                      <code>&amp;lt;=</code> (&#8656;): 小于或等于。操作数和观察对象值都必须是数字。<br>
                      <code>&amp;gt;=</code> (&gt;=): 大于或等于。操作数和观察对象值都必须是数字。<br>
                      <code>=</code>: 等于。如果操作数和观察对象值都是数字，则引用数字计算，
                           否则，进行字符串精确匹配，区分大小写。<br>
                      <code>!=</code>: 不等于。如果操作数和观察对象值都是数字，则引用数字计算，
                            否则，进行字符串精确匹配，区分大小写。<br>
                      <code>~</code>:  正则表达式匹配。应用于字符串上下文。<br>
                      Note: 如果不设置 <code>operand</code> 和 <code>operator</code> 参数，并且检测值非空，
                            则比较始终返回成功。
                      请注意，必须要将所有 &lt; 和 &gt; 字符转义为 XML 字符 (分别是 <code>&amp;lt;</code> 和 <code>&amp;gt;</code>
                      )</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送 SNMP 请求的目的端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件 <code>snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reason-template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果服务不可用，用户提供的模板由于监测器返回原因代码。
                      如果未设置，返回默认值。
                      请参阅下面对可能模板参数的说明。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">取决于操作模式</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>过时的</strong> 与 <code>retry</code> 相同。参数 <code>retry</code> 优先，如果两者都设置。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件 <code>snmp-config.xml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>walk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code>: 监测器将轮询标量对象，除非 <code>match-all</code> 参数
                      设置为 <code>count</code>，这时 <code>match-all</code> 参数优先。<br>
                      <code>true</code>: 监测器将轮询表对象，其中 <code>match-all</code> 参数定义表对象的值必须与
                       <code>operator</code> 和 <code>operand</code> 参数定义的值匹配。
                      也请参考 <code>match-all</code>, <code>minimum</code>, 和 <code>maximum</code> 参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 62. 可用于原因模板 reason-template 参数的变量</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${hex}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">十六进制 <code>hex</code> 参数值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${ipaddr}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">轮询的 IP 地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${matchAll}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">匹配所有 <code>match-all</code> 参数的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${matchCount}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">当 <code>match-all</code> 设置为 <code>count</code>，包含匹配实例的数目。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${maximum}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最大 <code>maximum</code> 参数的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${minimum}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最小 <code>minimum</code> 参数的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${observedValue}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使监测器成功或失败的轮询值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${oid}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oid</code> 参数的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${operand}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operand</code> 参数的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${operator}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>operator</code> 参数的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${port}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">端口 <code>port</code> 参数的值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${retry}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重试次数 <code>retry</code> 参数值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${timeout}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">超时 <code>timeout</code> 参数值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${walk}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>walk</code> 参数值。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_标量对象检测示例">标量对象检测示例</h5>
<div class="paragraph">
<p>作为一个演示示例，我们要检测提供热力系统风扇状态的标识对象 ID。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cpqHeThermalSystemFanStatus .1.3.6.1.4.1.232.6.2.6.4.0</pre>
</div>
</div>
<div class="paragraph">
<p>制造商 <em>MIB</em> 提供以下信息:</p>
</div>
<div class="listingblock">
<div class="title">从 <a href="http://h18013.www1.hp.com/products/servers/management/hpsim/mibkit.html">CPQHLTH-MIB</a> 中描述 cpqHeThermalSystemFanStatus</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-asn1" data-lang="asn1">SYNTAX 	INTEGER  {
    other    (1),
    ok       (2),
    degraded (3),
    failed   (4)
}
ACCESS 	read-only
DESCRIPTION
"The status of the fan(s) in the system.

This value will be one of the following:
other(1)
Fan status detection is not supported by this system or driver.

ok(2)
All fans are operating properly.

degraded(3)
A non-required fan is not operating properly.

failed(4)
A required fan is not operating properly.

If the cpqHeThermalDegradedAction is set to shutdown(3) the
system will be shutdown if the failed(4) condition occurs."</code></pre>
</div>
</div>
<div class="paragraph">
<p>监测器 SnmpMonitor 被配置为测试风扇状态是否返回 <em>ok(2)</em>。如果返回，则将服务标记为 <em>up</em>。
任何其它值都指示热力风扇状态的问题，并标记该服务为 <em>down</em>。</p>
</div>
<div class="listingblock">
<div class="title">检测器 SnmpMonitor 示例作为 HP InsightManager 风扇检测，配置文件 poller-configuration.xml 中的配置</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="HP-Insight-Fan-System" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="oid" value=".1.3.6.1.4.1.232.6.2.6.4.0"/&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;parameter key="operator" value="="/&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;parameter key="operand" value="2"/&gt;<i class="conum" data-value="3"></i><b>(3)</b>
    &lt;parameter key="reason-template" value="System fan status is not ok. The state should be ok(${operand}) the observed value is ${observedValue}. Please check your HP Insight Manager. Syntax: other(1), ok(2), degraded(3), failed(4)"/&gt;<i class="conum" data-value="4"></i><b>(4)</b>
&lt;/service&gt;

&lt;monitor service="HP-Insight-Fan-System" class-name="org.opennms.netmgt.poller.monitors.SnmpMonitor" /&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>测试的标量对象 ID</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>用于测试响应值的运算符</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>整数2，作为测试的操作数</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>在 <em>MIB</em> 状态原因编码中，如果服务 down，则给出更详细的信息</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_示例测试匹配所有值的_snmp_表">示例测试匹配所有值的 SNMP 表</h5>
<div class="paragraph">
<p>第二种模式显示了如何检测整个 SNMP 表的值。
作为实际监控情况，检测一组物理驱动器的状态。
此示例配置显示了 <a href="http://h18013.www1.hp.com/products/servers/management/hpsim/mibkit.html">CPQIDA-MIB</a> 的状态监控。</p>
</div>
<div class="paragraph">
<p>我们使用一个标量对象 id，由下面的表格 OID 给出的物理驱动器状态:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cpqDaPhyDrvStatus .1.3.6.1.4.1.232.3.2.5.1.1.6</pre>
</div>
</div>
<div class="listingblock">
<div class="title">CPQIDA-MIB 中的 cpqDaPhyDrvStatus 对象 id 描述</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-asn1" data-lang="asn1">SYNTAX 	INTEGER  {
    other             (1),
    ok                (2),
    failed            (3),
    predictiveFailure (4)
}
ACCESS 	read-only
DESCRIPTION
Physical Drive Status.
This shows the status of the physical drive.
The following values are valid for the physical drive status:

other (1)
 Indicates that the instrument agent does not recognize
 the drive.  You may need to upgrade your instrument agent
 and/or driver software.

ok (2)
 Indicates the drive is functioning properly.

failed (3)
 Indicates that the drive is no longer operating and
 should be replaced.

predictiveFailure(4)
 Indicates that the drive has a predictive failure error and
 should be replaced.</code></pre>
</div>
</div>
<div class="paragraph">
<p>在我们的监测器配置中将测试所有物理驱动器状态 <em>ok(2)</em>。</p>
</div>
<div class="listingblock">
<div class="title">示例监测器 SnmpMonitor 监控 HP Insight 物理驱动器在配置文件 poller-configuration.xml 中的配置</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="HP-Insight-Drive-Physical" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="oid" value=".1.3.6.1.4.1.232.3.2.5.1.1.6"/&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;parameter key="walk" value="true"/&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;parameter key="operator" value="="/&gt;<i class="conum" data-value="3"></i><b>(3)</b>
    &lt;parameter key="operand" value="2"/&gt;<i class="conum" data-value="4"></i><b>(4)</b>
    &lt;parameter key="match-all" value="true"/&gt;<i class="conum" data-value="5"></i><b>(5)</b>
    &lt;parameter key="reason-template" value="One or more physical drives are not ok. The state should be ok(${operand}) the observed value is ${observedValue}. Please check your HP Insight Manager. Syntax: other(1), ok(2), failed(3), predictiveFailure(4), erasing(5), eraseDone(6), eraseQueued(7)"/&gt;<i class="conum" data-value="6"></i><b>(6)</b>
&lt;/service&gt;

&lt;monitor service="HP-Insight-Drive-Physical" class-name="org.opennms.netmgt.poller.monitors.SnmpMonitor" /&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>SNMP 表中用于获取所有物理驱动器状态的 OID</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>启用 <em>walk 模式</em> 测试表里的每条记录</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>整数的检验运算符</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>整数 <code>2</code> 作为测试的操作数</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>测试中 <em>walk 模式</em> 必须表中的每条记录进行匹配</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>在 <em>MIB</em> 状态原因编码中，如果服务 down，则提供更详细的信息。</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_示例测试所有匹配值的_snmp_表">示例测试所有匹配值的 SNMP 表</h5>
<div class="paragraph">
<p>此示例演示如何使用 SnmpMonitor 监测器来测试静态路由的数量是否在给定的边界内。
如果在网络设备上设置至少3个和最大10个静态路由，则服务标记为 <em>up</em> 。
可以通过轮询 <a href="http://www.ietf.org/rfc/rfc1213.txt">RFC1213-MIB2</a> 的 <em>ipRouteProto</em> 表来检测该状态。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ipRouteProto 1.3.6.1.2.1.4.21.1.9</pre>
</div>
</div>
<div class="paragraph">
<p>下面的 <em>MIB</em> 描述提供了以下信息:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-asn1" data-lang="asn1">SYNTAX 	INTEGER  {
    other(1),
    local(2),
    netmgmt(3),
    icmp(4),
    egp(5),
    ggp(6),
    hello(7),
    rip(8),
    is-is(9),
    es-is(10),
    ciscoIgrp(11),
    bbnSpfIgp(12),
    ospf(13),
    bgp(14)}
}
ACCESS 	read-only
DESCRIPTION
"The routing mechanism via which this route was learned.
Inclusion of values for gateway routing protocols is not
intended to imply that hosts should support those protocols."</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了值检测本地路由，只测试 <em>ipRouteProto</em> 表中值为 <code>2</code> 的记录。
必须计算整个 <em>ipRouteProto</em> 表的记录数，并且必须应用数字的边界。</p>
</div>
<div class="listingblock">
<div class="title">示例 SnmpMonitor 监测器用于测试本地静态路由记录的数量是否介于3或10之间。</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="All-Static-Routes" interval="300000" user-defined="false" status="on"&gt;
 &lt;parameter key="oid" value=".1.3.6.1.2.1.4.21.1.9" /&gt;<i class="conum" data-value="1"></i><b>(1)</b>
 &lt;parameter key="walk" value="true" /&gt;<i class="conum" data-value="2"></i><b>(2)</b>
 &lt;parameter key="operator" value="=" /&gt;<i class="conum" data-value="3"></i><b>(3)</b>
 &lt;parameter key="operand" value="2" /&gt;<i class="conum" data-value="4"></i><b>(4)</b>
 &lt;parameter key="match-all" value="count" /&gt;<i class="conum" data-value="5"></i><b>(5)</b>
 &lt;parameter key="minimum" value="3" /&gt;<i class="conum" data-value="6"></i><b>(6)</b>
 &lt;parameter key="maximum" value="10" /&gt;<i class="conum" data-value="7"></i><b>(7)</b>
&lt;/service&gt;

&lt;monitor service="All-Static-Routes" class-name="org.opennms.netmgt.poller.monitors.SnmpMonitor" /&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>SNMP 表 <em>ipRouteProto</em> 的 OID</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>启用 <em>walk 模式</em> 来测试表中的每条记录</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>整数的建议运算符</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>整数 <code>2</code> 作为操作数，测试本地路由记录数</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>测试在 <em>walk 模式</em> 中设置的 <code>count</code> 参数，与表中符合 <code>operator</code> 和 <code>operand</code> 匹配的记录数</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>最低边界数设置为 <code>3</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>最高边界数设置为 <code>10</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sshmonitor">4.6.42. SshMonitor</h4>
<div class="paragraph">
<p>SSH 监测器测试 SSH 服务的可用性。
在轮询过程中，先连接指定的端口。如果连接成功，则认为服务 up。
可选地，在认为服务 up 情况下，可以对服务返回的输出信息与表达式进行批评。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_40">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.SshMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_39">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 63. 监测器 SshMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>banner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正则表达式，来匹配服务的输出。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client-banner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">客户端标记， OpenNMS Horizon 将在服务上标识自己。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SSH-1.99-OpenNMS_1.5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>match</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正则表达式，来匹配服务的输出。<br>
                    已过时，请使用 <code>banner</code> 参数代替。<br>
                    注意，这个参数优先于 <code>banner</code> 参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH 连接的 TCP 端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">尝试建立 SSH 连接的次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_33">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="SSH" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="1"/&gt;
  &lt;parameter key="banner" value="SSH"/&gt;
  &lt;parameter key="client-banner" value="OpenNMS poller"/&gt;
  &lt;parameter key="timeout" value="5000"/&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="ssh"/&gt;
  &lt;parameter key="ds-name" value="ssh"/&gt;
&lt;/service&gt;
&lt;monitor service="SSH" class-name="org.opennms.netmgt.poller.monitors.SshMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sslcertmonitor">4.6.43. SSLCertMonitor</h4>
<div class="paragraph">
<p>此监测器用于测试远程网络服务的 SSL 证书是否有效。
如果证书的初始时间在当前时间之前，或者还有7天时间到期 (配置的)，则该证书无效。
监测器只支持 SSL socket，不支持之上的高级协议。
此外，它不支持服务器名称指示 (SNI)，因此如果要在同一连接上呈现不同的证书，则无法验证它们。</p>
</div>
<div class="paragraph">
<p>你可以通过运行这些命令来模拟操作:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo | openssl s_client -connect &lt;site&gt;:&lt;port&gt; 2&gt;/dev/null | openssl x509 -noout -dates</pre>
</div>
</div>
<div class="paragraph">
<p>输出显示证书有效的时间范围:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>notBefore=Dec 24 14:11:34 2013 GMT
notAfter=Dec 25 10:37:40 2014 GMT</pre>
</div>
</div>
<div class="paragraph">
<p>你可以按天在 <code>notAfter</code> 日期上配置一个门限。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_41">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.SSLCertMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_40">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 64. 监测器 SSLCertMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">带有 SSL 证书的服务 TCP 端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">获取证书状态的尝试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>days</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">证书过期的剩余天数，我们将服务标记为失败。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>server-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">这是作为 <em>TLS</em> 规范的一部分发送的 DNS 主机名，称为服务器名称指示
                   (<em>SNI</em>)
                  (参考: <a href="https://www.ietf.org/rfc/rfc3546.txt">RFC3546</a> 第 3.1 章节)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 65. 可以在 <code>server-name</code> 中配置的变量</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${ipaddr}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设备的 IP 地址</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${nodeid}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设备的 ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${nodelabel}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与监测器关联的设备的名称。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${svcname}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务名称</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
监测器不支持在 SSL 会话层之上的其它协议层进行通信。
它不能为 HTTPS 发送主机头，或者发出 IMAP, POP3, SMTP, FTP, XMPP, LDAP, 或 NNTP 的 STARTTLS 命令。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_实例_34">实例</h5>
<div class="paragraph">
<p>下面的示例演示如何监控 IMAPS, SMTPS 和 HTTPS 等服务上的 SSL 证书。
如果证书还剩30天过期，服务标记为 down ，并且在监测器的原因下指示此问题。
在这个例子中，监测器间隔被缩短为2小时 (7,200,000 毫秒).
配置文件 <code>poller-configuration.xml</code> 中的配置如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="SSL-Cert-IMAPS-993" interval="7200000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="port" value="993"/&gt;
    &lt;parameter key="days" value="30"/&gt;
&lt;/service&gt;
&lt;service name="SSL-Cert-SMTPS-465" interval="7200000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="2000"/&gt;
    &lt;parameter key="port" value="465"/&gt;
    &lt;parameter key="days" value="30"/&gt;
&lt;/service&gt;
&lt;service name="SSL-Cert-HTTPS-443" interval="7200000" user-defined="false" status="on"&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="3000"/&gt;
    &lt;parameter key="port" value="443"/&gt;
    &lt;parameter key="days" value="30"/&gt;
    &lt;parameter key="server-name" value="${nodelabel}.example.com"/&gt;
&lt;/service&gt;

&lt;monitor service="SSL-Cert-IMAPS-993" class-name="org.opennms.netmgt.poller.monitors.SSLCertMonitor" /&gt;
&lt;monitor service="SSL-Cert-SMTPS-465" class-name="org.opennms.netmgt.poller.monitors.SSLCertMonitor" /&gt;
&lt;monitor service="SSL-Cert-HTTPS-443" class-name="org.opennms.netmgt.poller.monitors.SSLCertMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_strafepingmonitor">4.6.44. StrafePingMonitor</h4>
<div class="paragraph">
<p>该监测器使用 <em>ICMP</em> 监控 <a href="http://en.wikipedia.org/wiki/Packet_delay_variation">分组延迟变化</a> 到特定端点。
主要用来监控 <em>WAN</em> 端点，并可视化分组丢包和 <em>ICMP</em> 分组往返时间偏差。
监测器 <em>StrafePingMonitor</em> 执行多个 <em>ICMP echo requests</em> (ping) ，并将每个回波请求的响应时间 response-time 以及分组丢包存储在 <em>RRD</em> 文件中。
归功于 Tobias Oetiker，因为这个图形工具是在他开发的 <a href="http://oss.oetiker.ch/smokeping/">SmokePing</a> 上改进的。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/service-assurance/monitors/01_strafeping.png" alt="01 strafeping">
</div>
<div class="title">Figure 31. StrafePingMonitor 监控结果的图形可视化</div>
</div>
<div class="sect4">
<h5 id="_监测器定义_42">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.StrafePingMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_41">配置与使用</h5>
<div class="paragraph">
<p>监测器 StrafePingMonitor 的特定参数</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待分组响应的时间，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>800</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在给定的超时中数据包无法响应的尝试重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ping-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行 pings 的次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failure-ping-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在多少 pings 失败次数使，则标记服务 down</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allow-fragmentation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否在输出数据包上设置 "Don&#8217;t Fragment" 位</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dscp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSCP 流量控制值。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>packet-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要发送的 ICMP 数据包的字节数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>64</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wait-interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待每个 <em>ICMP</em> <em>echo-request</em> 包之间的毫秒时间</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-repository</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">写入 <em>RRD 数据</em> 的位置。通常，不需要修改此默认值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/share/rrd/response</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-base-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要写入的 RRD 文件名称 (去掉扩展名，<code>.rrd</code> 或 <code>.jrb</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strafeping</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_35">实例</h5>
<div class="paragraph">
<p>监测器 <em>StrafePingMonitor</em> 通常用于广域网连接，而不是你的网络中的每个开启 ICMP 的设备。
此外，这个监测器比单一的 ICMP 响应时间测量和简单 RRD 图展示要消耗更多的 I/O 资源。
默认情况下，你可以在 'poller-configuration.xml' 配置文件中找到一个叫 <em>strafer</em> 的单独 <em>poller package</em> 。
配置 <code>include-range</code> 或 <code>filter</code> 来监控具有 <em>StrafePing</em> 服务的设备。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
不要忘记在指定IP接口上计划 <em>StrafePing</em> 服务。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>下面的示例实现了对 10.0.0.1 到 10.0.0.20 范围内的IP接口上的 <em>StrafePing</em> 服务的监控。
此外，设备必须在一个叫 <code>Latency</code> 的 <em>监控分类</em> 中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;package name="strafer" &gt;
   &lt;filter&gt;categoryName == 'Latency'&lt;/filter&gt;
   &lt;include-range begin="10.0.0.1" end="10.0.0.20"/&gt;
   &lt;rrd step="300"&gt;
     &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
     &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
     &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
     &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
     &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
   &lt;/rrd&gt;
   &lt;service name="StrafePing" interval="300000" user-defined="false" status="on"&gt;
     &lt;parameter key="retry" value="0"/&gt;
     &lt;parameter key="timeout" value="3000"/&gt;
     &lt;parameter key="ping-count" value="20"/&gt;
     &lt;parameter key="failure-ping-count" value="20"/&gt;
     &lt;parameter key="wait-interval" value="50"/&gt;
     &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
     &lt;parameter key="rrd-base-name" value="strafeping"/&gt;
   &lt;/service&gt;
   &lt;downtime interval="30000" begin="0" end="300000"/&gt;
   &lt;downtime interval="300000" begin="300000" end="43200000"/&gt;
   &lt;downtime interval="600000" begin="43200000" end="432000000"/&gt;
   &lt;downtime begin="432000000" delete="true"/&gt;
 &lt;/package&gt;
 &lt;monitor service="StrafePing" class-name="org.opennms.netmgt.poller.monitors.StrafePingMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tcpmonitor">4.6.45. TcpMonitor</h4>
<div class="paragraph">
<p>该监测器用来测试 IP 层，第4层的 TCP 连接。
监测器建立与指定端口的 TCP 连接。
为了测试服务的可用性，要检查应用程序的表达式匹配。
该操作可以通过 <code>telnet</code> 命令来简单测试，示例所示。</p>
</div>
<div class="listingblock">
<div class="title">用 <code>telnet</code> 模拟监测器的操作过程</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">root@vagrant:~# telnet 127.0.0.1 22
Trying 127.0.0.1...
Connected to 127.0.0.1.
Escape character is '^]'.
SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>服务响应输出</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_43">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.TcpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_42">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 66. 监测器 TcpMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应用程序的 TCP 端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务检测的重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>banner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用正则表达式对服务连接响应输出进行匹配。默认情况下，
              任意输出都有效。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_36">实例</h5>
<div class="paragraph">
<p>这个示例显示了在 TCP 端口 1494 测试 <a href="https://en.wikipedia.org/wiki/Independent_Computing_Architecture">ICA</a> 服务是否可用。
测试响应输出是否以 <code>ICA</code> 开头。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="TCP-Citrix-ICA" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="0" /&gt;
  &lt;parameter key="banner" value="ICA" /&gt;
  &lt;parameter key="port" value="1494" /&gt;
  &lt;parameter key="timeout" value="3000" /&gt;
  &lt;parameter key="rrd-repository" value="/var/lib/opennms/rrd/response" /&gt;
  &lt;parameter key="rrd-base-name" value="tcpCitrixIca" /&gt;
  &lt;parameter key="ds-name" value="tcpCitrixIca" /&gt;
&lt;/service&gt;

&lt;monitor service="TCP-Citrix-ICA" class-name="org.opennms.netmgt.poller.monitors.TcpMonitor" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_systemexecutemonitor">4.6.46. SystemExecuteMonitor</h4>
<div class="paragraph">
<p>如果需要执行系统调用或运行脚本来确定服务状态，则可以使用 SystemExecuteMonitor 监测器。
它调用脚本或系统命令，如果需要，还可以提供额外的参数。
监测器 SystemExecuteMonitor 通过系统调用的0或非0代码，来确定服务的状态。
另外一种情况，可以通过系统调用的输出与表达式匹配。
如果输出与表达式匹配成功，则服务 up。
如果输出与表达式匹配失败，则服务 down。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_44">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.SystemExecuteMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_43">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 67. 监测器 SystemExecuteMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">系统调用执行。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>args</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提交给系统调用的参数。它支持变量替换，见下文。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>banner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与系统调用输出匹配的字符串。如果输出包含匹配字符，
              则服务为 <em>UP</em>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>参数 <code>args</code> 支持下列变量替换。</p>
</div>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 68. 可用的配置变量</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">变量</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${timeout}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于服务的配置，超时的毫秒值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${timeoutsec}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于服务的配置，超时的秒值。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${retry}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于服务的配置，重试次数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${svcname}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于服务配置的服务名称。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${ipaddr}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务绑定的IP地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${nodeid}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监测器关联的设备的ID。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${nodelabel}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监测器关联的设备的名称。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_实例_37">实例</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parameter key="args" value="-i ${ipaddr} -t ${timeout}"/&gt;
&lt;parameter key="args" value="http://${nodelabel}/${svcname}/static"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_systemexecutemonitor_与_gpmonitor">SystemExecuteMonitor 与 GpMonitor</h5>
<div class="paragraph">
<p>监测器 SystemExecuteMonitor 继承于 GpMonitor。主要区别是:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>参数 args 的变量替换</p>
</li>
<li>
<p>系统调用没有固定的参数</p>
</li>
<li>
<p>监测器 <em>SystemExecuteMonitor</em> 支持 <em>远程轮询</em> 部署</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>若要将服务从 <em>GpMonitor</em> 迁移到 <em>SystemExecuteMonitor</em> ，需要更改参数 args。
匹配参数 <code>hostAddress</code> 对应 <code>hoption</code>，<code>timeoutInSeconds</code> 对应 <code>toption</code>。
监测器 <em>GpMonitor</em> 相对的调用参数如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parameter key="args" value="--hostname ${ipaddr} --timeout ${timeoutsec}" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>要迁移 GpMonitor 参数 <code>hoption</code> 和 <code>toption</code>，只需要直接替换 <code>args</code> 参数中的 <code>--hostname</code> 和 <code>--timeout</code>。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vmwarecimmonitor">4.6.47. VmwareCimMonitor</h4>
<div class="paragraph">
<p>此监测器是 <em>Provisiond</em> 提供的 VMware 集成的一部分。
监测器专门检查从所有 <em>Host System</em> (host) 传感器提供的健康状态。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
此监测器只有在主机接通电源时执行。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
该监测器需要从 <em>Provisiond</em> 和 <em>VMware</em> 导入功能导入主机。
           OpenNMS Horizon 需要通过网络访问 <em>VMware vCenter</em> 和主机。
           要获得传感器数据，要使用 <em>vmware-config.xml</em> 配置文件的凭证信息连接 <em>vCenter</em> 。
           下面的资产字段由 <em>Provisiond</em> 的导入功能提供:
           <em>VMware Management Server</em>, <em>VMware Managed Entity Type</em> 和包含内部 <em>VMware vCenter Identifier</em> 的 <em>foreignId</em>。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>通过测试所有可用的主机传感器，然后评估每个传感器的状态，来确定全局健康状况。
传感器状态可以表示如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Unknown(0)</em></p>
</li>
<li>
<p><em>OK(5)</em></p>
</li>
<li>
<p><em>Degraded/Warning(10)</em></p>
</li>
<li>
<p><em>Minor failure(15)</em></p>
</li>
<li>
<p><em>Major failure(20)</em></p>
</li>
<li>
<p><em>Critical failure(25)</em></p>
</li>
<li>
<p><em>Non-recoverable error(30)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果 <strong>全部</strong> 传感器状态是 <em>OK(5)</em>，则该服务为 <em>up</em>。
如果任何传感器给出的不是 <em>OK(5)</em> 状态，那么服务为 <em>down</em>。
监测器错误原因包含所有未返回 <em>OK(5)</em> 状态的传感器列表。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在使用 <a href="http://www.vmware.com/files/pdf/Distributed-Power-Management-vSphere.pdf">分布式电源管理</a> 的情况下，备用状态会导致服务 <em>down</em>。
      健康状态通过与主机的直接连接进行监控，如果连接不可用，则服务为 <em>down</em>。
      为了处理备用状态，可以使用 <em>ignoreStandBy</em> 配置。
      在备用状态下，该服务被看作 <em>up</em>。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>参见 <code>ignoreStandBy</code> 配置参数的状态改变。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_45">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.VmwareCimMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_44">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 69. 监测器 VmwareCimMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控服务的重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ignoreStandBy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将电源 <em>备用</em> 状态处理为 <em>up</em>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_38">实例</h5>
<div class="paragraph">
<p>监测器在 <code>poller-configuration.xml</code> 配置文件的一些配置示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="VMwareCim-HostSystem" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
&lt;/service&gt;

&lt;monitor service="VMwareCim-HostSystem" class-name="org.opennms.netmgt.poller.monitors.VmwareCimMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vmwaremonitor">4.6.48. VmwareMonitor</h4>
<div class="paragraph">
<p>此监测器是 <em>Provisiond</em> 中提供的 VMware 集成的一部分，用于测试虚拟机 virtual machine (VM) 或主机系统 (host) 的电源状态。
如果 VM 或主机 host 的电源状态为 <em>poweredOn</em> ，则服务为 <em>up</em>。
如果 VM 或 Host 上的服务状态是 <em>off</em> ，则被标记为 <em>down</em>。
默认情况下，<em>备用</em> 状态也被认为是 <em>down</em>。
在使用 <a href="http://www.vmware.com/files/pdf/Distributed-Power-Management-vSphere.pdf">分布式电源管理</a> 的情况下，使用 <code>ignoreStandBy</code> 配置参数，可以改变 <em>备用</em> 状态。</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
要使用 <em>vmware-config.xml</em> 中配置的凭证信息，从 <em>VMware vCenter</em> 采集虚拟机的状态信息。
         还需要获得分配给导入虚拟机和主机系统的特定资产字段。
         需要以下资产字段，它们由 <em>Provisiond</em> 集成的 <em>VMware</em> 来填充: <em>VMware Management Server</em>, <em>VMware Managed Entity Type</em> 和内部包含 <em>foreignId</em> 的 <em>VMware vCenter Identifier</em>。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_监测器定义_46">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.VmwareMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_45">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 70. 监测器 VmwareMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控服务的重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ignoreStandBy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将电源 <em>备用</em> 状态处理为 <em>up</em>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reportAlarms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">检查 vSphere 的未确认告警，使用逗号分隔告警级别列表 (red, yellow, green, gray)。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">``</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_39">实例</h5>
<div class="paragraph">
<p>检测器在配置文件 <code>poller-configuration.xml</code> 中的一些配置示例。
如果此管理实体存在红色或黄色级别的未确认 vSphere 告警，则监测器将标记为 <em>down</em>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="VMware-ManagedEntity" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="retry" value="2"/&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="reportAlarms" value="red, yellow"/&gt;
&lt;/service&gt;

&lt;monitor service="VMware-ManagedEntity" class-name="org.opennms.netmgt.poller.monitors.VmwareMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_webmonitor">4.6.49. WebMonitor</h4>
<div class="sect4">
<h5 id="_监测器定义_47">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.WebMonitor</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_46">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 71. 配置参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-system-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应该使用系统范围的代理设置吗？
                    可以在 <a href="#ga-opennms-system-properties">opennms.conf</a> 中配置系统代理设置</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_win32servicemonitor">4.6.50. Win32ServiceMonitor</h4>
<div class="paragraph">
<p>监测器 Win32ServiceMonitor 可以让 OpenNMS Horizon 监控任何 Windows 服务。
使用微软 Windows&#174; SNMP 代理提供的 <a href="http://technet.microsoft.com/en-us/library/cc977581.aspx">LAN Manager MIB-II</a> 来监控服务状态。
因此，需要 SNMP 代理和 OpenNMS Horizon 正确配置要查询的 <em>MIB</em> 数。
通过轮询来监控服务的状态</p>
</div>
<div class="literalblock">
<div class="content">
<pre>svSvcOperatingState = 1.3.6.1.4.1.77.1.2.3.1.3</pre>
</div>
</div>
<div class="paragraph">
<p>给定服务的显示名称。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_48">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.Win32ServiceMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_47">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 72. 监测器 Win32ServiceMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>service-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">服务的名称，应该是在服务 <em>MSC snap-in</em> 管理单元中监控 Windows 服务的确切名称。
                    短名称，使用这些可能导致你的网络启动 <strong>无法</strong> 工作。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Server</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
非英语 Windows
<code>service-name</code> 有时使用英语以外的语言编码。
像使用法语， <em>Task Scheduler</em> 服务是 <em>Planificateur de tâche</em>。
由于 "â" (非英语字符)， OID 值被编码为六进制 (0x50 6C 61 6E 69 66 69 63 61 74 65 75 72 20 64 65 20 74 C3 A2 63 68 65 73)。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_故障排除">故障排除</h5>
<div class="paragraph">
<p>如果你创建了一个 <em>Win32ServiceMonitor</em> 轮询器，并且在主机上无法正常监控，那么可能你创建的服务名称和注册表中的实际名称存在差异。</p>
</div>
<div class="paragraph">
<p>例如，我要监控我们的一个生产服务器上的一个叫 <em>Example Service</em> 的进程。
我从服务管理器中查找 <em>显示名称</em>，并使用 <em>显示名称</em> 中的确切名称在 <code>poller-configuration.xml</code> 配置文件中创建配置选项。</p>
</div>
<div class="paragraph">
<p>但是，我没有看到在服务显示名称末尾的额外空间，当执行以下操作时将显示该额外空间:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>snmpwalk -v 2c -c &lt;communitystring&gt; &lt;hostname&gt; .1.3.6.1.4.1.77.1.2.3.1.1</pre>
</div>
</div>
<div class="paragraph">
<p>这里提供了我错失的关键信息:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>iso.3.6.1.4.1.77.1.2.3.1.1.31.83.116.97.102.102.119.97.114.101.32.83.84.65.70.70.86.73.69.87.32.66.97.99.107.103.114.111.117.110.100.32 = STRING: "Example Service "</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
注意引号内的额外空字符。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在服务管理器 GUI 中很难注意到名称末尾的额外空格字符，但是在 <code>snmpwalk</code> 输出中很容易看到。
解决这个问题的正确方法是在服务器上更正服务 <em>显示名称</em> 字段，然而，这个过程中建议使用 <code>snmpwalk</code>，而不是使用服务管理器 GUI 来验证真名。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_40">实例</h5>
<div class="paragraph">
<p>监控一个 英文版本微软 Windows&#174; Server 的服务 <em>Task Scheduler</em> 的运行状态，至少要在 <code>poller-configuration.xml</code> 配置文件添加以下配置项。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="Windows-Task-Scheduler" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="service-name" value="Task Scheduler"/&gt;
&lt;/service&gt;

&lt;monitor service="Windows-Task-Scheduler" class-name="org.opennms.netmgt.poller.monitors.Win32ServiceMonitor"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wsmanmonitor">4.6.51. WsManMonitor</h4>
<div class="paragraph">
<p>此监测器可以发出 WS-Man <em>Get</em> 命令，并使用 <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/expressions.html">SPEL</a> 表达式验证结果。
该监测器实现 <a href="#ga-service-assurance-monitors-placeholder-substitution-parameters">参数值中的占位符替换</a>。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_49">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.WsManMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_48">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 73. 监测器 WsManMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">占位符替换</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resource-uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">资源 URI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rule</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPEL 表达式应用于 <em>Get</em> 的输出结果</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selector.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于过滤结果集。所有选择器 selectors 必须以 <code>selector.</code> 开头</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(None)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_41">实例</h5>
<div class="paragraph">
<p>下面的监测器将对配置资源发出 <em>Get</em> 命令，并验证是否返回了正确的服务标记:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="WsMan-ServiceTag-Check" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="resource-uri" value="http://schemas.dell.com/wbem/wscim/1/cim-schema/2/root/dcim/DCIM_ComputerSystem"/&gt;
  &lt;parameter key="selector.CreationClassName" value="DCIM_ComputerSystem"/&gt;
  &lt;parameter key="selector.Name" value="srv:system"/&gt;
  &lt;parameter key="rule" value="#IdentifyingDescriptions matches '.*ServiceTag' and #OtherIdentifyingInfo matches 'C7BBBP1'"/&gt;
&lt;/service&gt;

&lt;monitor service="WsMan-ServiceTag-Check" class-name="org.opennms.netmgt.poller.monitors.WsManMonitor/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xmpmonitor">4.6.52. XmpMonitor</h4>
<div class="paragraph">
<p><a href="http://www.opennms.org/wiki/XMP">XMP</a> 监测器通过建立 <em>XMP</em> 会话，并查询 <em>Core MIB</em> 中的 <em>sysObjectID</em> 变量来监控 <em>XMP service/agent</em> 的可用性。
当会话成功建立并且代理返回 <em>sysObjectID</em> 的值，同时没有错误时，该服务被认为是可用的。</p>
</div>
<div class="sect4">
<h5 id="_监测器定义_50">监测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.poller.monitors.XmpMonitor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否支持远程轮询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_49">配置与使用</h5>
<div class="paragraph">
<p>这些参数可以在配置文件 <em>collectd-configuration.xml</em> 中的 <em>XMP</em> service 元素中设置，并且可以覆盖 <em>xmp-config.xml</em> 中的配置。
另外，不要忘记在 <em>response-graph.properties</em> 中添加配置，这样响应值就可以绘制出图表。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 74. 监测器 XmpMonitor 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待会话连接成功的时间，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authenUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于 XMP 会话的 authenUser 参数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xmpUser</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建 XMP 会话的 TCP 连接端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5270</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要查询的 MIB 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>core</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要查询的 MIB 对象名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sysObjectID</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>该监测器实现 <a href="#ga-service-assurance-monitors-common-parameters">公共配置参数</a>。</p>
</div>
</div>
<div class="sect4">
<h5 id="_实例_42">实例</h5>
<div class="listingblock">
<div class="title">在配置文件 collectd-configuration.xml 中添加配置示例</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="XMP" interval="300000" user-defined="false" status="on"&gt;
  &lt;parameter key="timeout" value="3000"/&gt;
  &lt;parameter key="rrd-repository" value="/opt/opennms/share/rrd/response"/&gt;
  &lt;parameter key="rrd-base-name" value="xmp"/&gt;
  &lt;parameter key="ds-name" value="xmp"/&gt;
&lt;/service&gt;
&lt;monitor service="XMP" class-name="org.opennms.netmgt.poller.monitors.XmpMonitor"/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在 response-graph.properties 中添加条目</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">reports=icmp, \
xmp, \ . . . .

report.xmp.name=XMP
report.xmp.columns=xmp
report.xmp.type=responseTime
report.xmp.command=--title="XMP Response Time" \
 --vertical-label="Seconds" \
 DEF:rtMills={rrd1}:xmp:AVERAGE \
 DEF:minRtMills={rrd1}:xmp:MIN \
 DEF:maxRtMills={rrd1}:xmp:MAX \
 CDEF:rt=rtMills,1000,/ \
 CDEF:minRt=minRtMills,1000,/ \
 CDEF:maxRt=maxRtMills,1000,/ \
 LINE1:rt#0000ff:"Response Time" \
 GPRINT:rt:AVERAGE:" Avg  \\: %8.2lf %s" \
 GPRINT:rt:MIN:"Min  \\: %8.2lf %s" \
 GPRINT:rt:MAX:"Max  \\: %8.2lf %s\\n"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-performance-mgmt">5. 性能管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>在 <em>OpenNMS Horizon</em> 中性能数据的采集是由 <em>Collectd</em> 模块完成的。
<em>采集器</em> 实现了 <em>管理代理</em> 和协议访问性能数据功能。
<em>Collectd</em> 模块中，这些 <em>采集器</em> 在一个全局定义的 <em>线程池</em> 调度并运行。</p>
</div>
<div class="paragraph">
<p>本节描述了 <em>OpenNMS Horizon</em> 如何配置 <em>Collectd</em> 的 <em>采集器</em> 来采集性能数据。</p>
</div>
<div class="sect2">
<h3 id="ga-collectd-configuration">5.1. Collectd 配置</h3>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 75. Collectd 相关配置和日志文件</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/collectd-configuration.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Collectd</em> 模块的全局配置文件和 <em>采集器</em> 配置</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/logs/collectd.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">所有 <em>采集器</em> 和全局 <em>Collectd</em> 模块的日志文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/snmp-graph.properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <em>Web UI</em> 上展示的性能指标数据 的 <em>RRD</em> 图表定义</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/snmp-graph.properties.d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RRD</em> 图表定义目录，用于定义在 <em>Web UI</em> 上展示设备和应用的性能指标数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/events/opennms.events.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Collectd</em> 的事件定义, 即 <em>dataCollectionSucceeded</em>, 和 <em>dataCollectionFailed</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc/resource-types.d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储通用资源类型定义的目录.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>若要更改性能数据采集的行为，可以修改 <code>collectd-configuration.xml</code> 文件。
配置文件由以下部分构成：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>全局模块配置</em>: 定义 <em>采集器</em> 并行运行的 <em>线程池</em> 大小。</p>
</li>
<li>
<p><em>采集包</em>: 包允许对 <em>采集器</em> 的配置参数进行分组。</p>
</li>
<li>
<p><em>采集服务关联</em>: 基于采集服务的名称，分配应用程序和网络管理协议的实现。</p>
</li>
</ul>
</div>
<div id="ga-performance-management-collectd-overview" class="imageblock">
<div class="content">
<img src="images/performance-management/01_collectd-overview.png" alt="01 collectd overview">
</div>
<div class="title">Figure 32. Collectd 相关文件和配置概述</div>
</div>
<div class="paragraph">
<p><em>Collectd</em> 指定的全局 <em>线程池</em> 大小, 配置在 <code>collectd-configuration.xml</code> 中。</p>
</div>
<div class="listingblock">
<div class="title">Collectd 全局配置参数</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;collectd-configuration
        threads="50"&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>采集器</em> 并行运行的 <em>线程池</em> 大小</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ga-performance-management-collectd-resource-types">5.1.1. 资源类型</h4>
<div class="paragraph">
<div class="title">资源类型</div>
<p>资源类型用于将性能指标数据的集合分组方式存储，索引和在 <em>Web UI</em> 显示。
每个资源类型都有唯一的名称，用于在 <em>Web UI</em> 显示的标签，以及用于长时间分析的存档指标的策略定义。</p>
</div>
<div class="paragraph">
<p>资源类型有两个标签。
第一个是 <code>label</code>, 用于在 <em>Web UI</em> 显示的字符串。
第二个 <code>resourceLabel</code>, 作为一个模板用于定义唯一的分组指标名称的资源类型。</p>
</div>
<div class="paragraph">
<p>资源类型有两种类型的策略定义，持久化选择器和存储策略。
持久化选择器策略将组索引过滤到磁盘上存储的子集。
存储策略用于将索引转换为持久性的资源路径标签。
有两个没有资源类定义的特殊资源类型。
它们是 <code>node</code> 和 <code>ifIndex</code>。</p>
</div>
<div class="paragraph">
<p>资源类型可以在 <code>$OPENNMS_HOME/etc/resource-types.d</code> 或 <code>$OPENNMS_HOME/etc/datacollection</code> 文件中定义, 后者具体用于 SNMP。</p>
</div>
<div class="paragraph">
<p>以下是 diskIOIndex 资源类型在 <code>$OPENNMS_HOME/etc/datacollection/netsnmp.xml</code> 中的定义:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;resourceType name="diskIOIndex" label="Disk IO (UCD-SNMP MIB)" resourceLabel="${diskIODevice} (index ${index})"&gt;
  &lt;persistenceSelectorStrategy class="org.opennms.netmgt.collection.support.PersistRegexSelectorStrategy"&gt;
    &lt;parameter key="match-expression" value="not(#diskIODevice matches '^(loop|ram).*')" /&gt;
  &lt;/persistenceSelectorStrategy&gt;
  &lt;storageStrategy class="org.opennms.netmgt.dao.support.SiblingColumnStorageStrategy"&gt;
    &lt;parameter key="sibling-column-name" value="diskIODevice" /&gt;
    &lt;parameter key="replace-all" value="s/^-//" /&gt;
    &lt;parameter key="replace-all" value="s/\s//" /&gt;
    &lt;parameter key="replace-all" value="s/:\\.*//" /&gt;
  &lt;/storageStrategy&gt;
&lt;/resourceType&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_持久化选择策略">持久化选择策略</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 76. 持久化选择策略</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.collectd.PersistAllSelectorStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储所有索引</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.collectd.PersistRegexSelectorStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于 JEXL 的存储索引</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_persistregexselectorstrategy">PersistRegexSelectorStrategy</h6>
<div class="paragraph">
<p>PersistRegexSelectorStrategy 类有一个 <code>match-expression</code> 参数, 用来定义 JEXL 表达式。
在这时候，表达式返回 true, 将存储索引，如果为 false, 丢弃数据。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_存储策略">存储策略</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 77. 存储策略</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">类</th>
<th class="tableblock halign-left valign-top">存储路径值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.collection.support.IndexStorageStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">索引</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.collection.support.JexlIndexStorageStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JexlExpression 表达式计算值</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.collection.support.ObjectNameStorageStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JexlExpression 表达式计算值</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.dao.support.FrameRelayStorageStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">接口标签 + '.' + dlci</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.dao.support.HostFileSystemStorageStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用 hrStorageTable 表里的 hrStorageDescr 列的值，基于 unix 文件系统处理后。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.netmgt.dao.support.SiblingColumnStorageStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用同列名参数的 OID 的 SNMP 值，基于 unix 文件系统处理后。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.opennms.protocols.xml.collector.XmlStorageStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">索引, 基于 unix 文件系统处理后。</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_indexstoragestrategy">IndexStorageStrategy</h6>
<div class="paragraph">
<p>IndexStorageStrategy 不带任何参数。</p>
</div>
</div>
<div class="sect5">
<h6 id="_jexlindexstoragestrategy">JexlIndexStorageStrategy</h6>
<div class="paragraph">
<p>JexlIndexStorageStrategy 采用两个参数, <code>index-format</code> 是必须的, <code>clean-output</code> 是可选的。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">index-format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JexlExpression 表达式的值</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean-output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">布尔值指示是否清空索引值。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果索引值被处理，那么它的包含的所有空白，冒号，斜杠和反斜杠，以及垂直条将用下划线替换。所有等号都会删除。</p>
</div>
<div class="paragraph">
<p>可以通过重写类的  <code>updateContext</code> 方法来扩展自定义存储策略，以便在 <code>index-format</code> 模板中设置附加的 键/值 对。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">public class ExampleStorageStrategy extends JexlIndexStorageStrategy {

    private static final Logger LOG = LoggerFactory.getLogger(ExampleStorageStrategy.class);
    public ExampleStorageStrategy() {
        super();
    }

    @Override
    public void updateContext(JexlContext context, CollectionResource resource) {
        context.set("Example", resource.getInstance());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_objectnamestoragestrategy">ObjectNameStorageStrategy</h6>
<div class="paragraph">
<p><em>ObjectNameStorageStrategy</em> 继承 <em>JexlIndexStorageStrategy</em>, 因此它的要求是相同的。
额外的 键/值 对被添加到 JexlContext ，然后可以在 <code>index-format</code> 模板中使用。
原始索引字符串被转换为一个 ObjectName ，可以用 <code>${ObjectName}</code> 引用。
<em>ObjectName</em> 中的 <em>domain</em> 可以用 <code>${domain}</code> 引用。
ObjectName 中的 <em>key 属性</em> 可以通过 <code>${key}</code> 引用。</p>
</div>
<div class="paragraph">
<p>这种存储策略通常与 <em>JMX MBean</em> 数据采集一起使用，其中多个 <em>MBeans</em> 可以返回相同的属性集合。到了 OpenNMS Horizon 20，只支持 <em>HTTP</em> 到 <em>JMX</em> 代理，使用 <em>XmlCollector</em> ，因为 <em>JmxCollector</em> 还不支持索引组。</p>
</div>
<div class="paragraph">
<p>给定一个 <em>MBean</em> 像 <code>java.lang:type=MemoryPool,name=Survivor Space</code>, 存储策略例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;storageStrategy class="org.opennms.netmgt.collection.support.ObjectNameStorageStragegy"&gt;
  &lt;parameter key="index-format" value="${domain}_${type}_${name}" /&gt;
  &lt;parameter key="clean-output" value="true" /&gt;
&lt;/storageStrategy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后索引值应该是 <code>java_lang_MemoryPool_Survivor_Space</code> 。</p>
</div>
</div>
<div class="sect5">
<h6 id="_framerelaystoragestrategy">FrameRelayStorageStrategy</h6>
<div class="paragraph">
<p>FrameRelayStorageStrategy 不带任何参数。</p>
</div>
</div>
<div class="sect5">
<h6 id="_hostfilesystemstoragestrategy">HostFileSystemStorageStrategy</h6>
<div class="paragraph">
<p>HostFileSystemStorageStrategy 不带任何参数。
这个类被标记为过期，然后可以用如下代替：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;storageStrategy class="org.opennms.netmgt.dao.support.SiblingColumnStorageStrategy"&gt;
  &lt;parameter key="sibling-column-name" value="hrStorageDescr" /&gt;
  &lt;parameter key="replace-first" value="s/^-$/_root_fs/" /&gt;
  &lt;parameter key="replace-all" value="s/^-//" /&gt;
  &lt;parameter key="replace-all" value="s/\\s//" /&gt;
  &lt;parameter key="replace-all" value="s/:\\\\.*//" /&gt;
&lt;/storageStrategy&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_siblingcolumnstoragestrategy">SiblingColumnStorageStrategy</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sibling-column-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于索引的替换字符串</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replace-first</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正在表达式，只替换第一个匹配</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replace-all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正在表达式，只替换所有匹配</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>replace-first</code>, 和 <code>replace-all</code> 的值必须匹配 <em>s/regex/replacement/</em> 模式，否则将抛出错误。</p>
</div>
</div>
<div class="sect5">
<h6 id="_xmlstoragestrategy">XmlStorageStrategy</h6>
<div class="paragraph">
<p>XmlStorageStrategy 不带任何参数。
索引值的所有空白，冒号，斜杠和反斜杠，以及垂直条将用下划线替换。
所有等号都会删除。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-collectd-packages">5.2. 采集包</h3>
<div class="paragraph">
<p>为了定义更复杂的集合配置，可以将分组的 <em>服务</em> 性能指标配置提供给 <em>采集包</em> 。
它们允许分配 <em>设备</em> 不同的 <em>服务配置</em> 来区分性能指标和连接设置的集合。
要给设备指定一个 <em>采集包</em> ，可以使用 <a href="http://www.opennms.org/wiki/Filters">Rules/Filters</a> 语法。</p>
</div>
<div class="paragraph">
<p>可以配置多个包，并且一个接口可用存在于多个包中。
这位给定设备的服务级别确定提供了很大的灵活性。
当 <em>IP接口</em> 与多个 <em>采集包</em> 的相同 <em>服务</em> 配置匹配时，如何定义 <em>采集包_的顺序是很重要的。
将在服务上应用最后匹配的 _采集包</em> 。
这可以用来定义一个默认的配置，匹配所有的过滤器。
可以使用具体的 <em>采集包</em> 来覆盖默认设置。</p>
</div>
<div class="listingblock">
<div class="title">采集包属性</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;package name="package1"&gt;<i class="conum" data-value="1"></i><b>(1)</b>
  &lt;filter&gt;IPADDR != '0.0.0.0'&lt;/filter&gt;<i class="conum" data-value="2"></i><b>(2)</b>
  &lt;include-range begin="1.1.1.1" end="254.254.254.254"/&gt;<i class="conum" data-value="3"></i><b>(3)</b>
  &lt;include-range begin="::1" end="ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"/&gt;<i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>采集包的唯一名称。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>将这个包应用到配置 <em>IPv4</em> 地址的所有 <em>IP 接口</em> (不等于 <code>0.0.0.0</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>采集 <em>IPv4 规则</em> 限定的所有 <em>IPv4 接口</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>采集 <em>IPv6 规则</em> 限定的所有 <em>IPv6 接口</em></td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ga-collectd-packages-services">5.2.1. 服务(Service)配置</h4>
<div class="paragraph">
<p><em>服务(Service)配置</em> 定义使用什么 <em>采集器</em> 和需要采集哪些性能指标。
<em>服务(Service)配置</em> 包含公共 <em>服务属性</em> 以及采集器特定参数。</p>
</div>
<div class="listingblock">
<div class="title">服务(Service)配置属性</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="SNMP"<i class="conum" data-value="1"></i><b>(1)</b>
         interval="300000"<i class="conum" data-value="2"></i><b>(2)</b>
         user-defined="false"<i class="conum" data-value="3"></i><b>(3)</b>
         status="on"&gt;<i class="conum" data-value="4"></i><b>(4)</b>
  &lt;parameter key="collection" value="default"/&gt;<i class="conum" data-value="5"></i><b>(5)</b>
  &lt;parameter key="thresholding-enabled" value="true"/&gt;<i class="conum" data-value="6"></i><b>(6)</b>
&lt;/service&gt;

&lt;collector service="SNMP" class-name="org.opennms.netmgt.collectd.SnmpCollector"/&gt;<i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>映射特定采集器实现的服务配置名称</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>采集服务的间隔。(单位毫秒)。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>标记服务是否用户定义的，用于 UI 上定义的。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>服务只有在 on 状态才会采集。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>分配名为 <code>default</code> 的性能数据采集指标组。</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>启用对该服务提供指标的门限处理。</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>运行名为 <code>SNMP</code> 服务的实现 <em>SnmpCollector</em></td>
</tr>
</table>
</div>
<div id="ga-performance-management-collectd-configuration-xml" class="imageblock">
<div class="content">
<img src="images/performance-management/02_collectd-configuration-xml.png" alt="02 collectd configuration xml">
</div>
<div class="title">Figure 33. Collectd 数据采集配置概述</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-performance-mgmt-collectors">5.3. 采集器</h3>
<div class="sect3">
<h4 id="_snmpcollector">5.3.1. SnmpCollector</h4>
<div class="paragraph">
<p><em>SnmpCollector</em> 采集器通过 <em>SNMP 协议</em> 采集性能数据。
通过 <em>Web 用户界面</em> 配置访问 <em>SNMP Agent</em> 的 <em>SNMP 参数</em> 。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.SnmpCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code> (通过 SNMP 代理)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 78. SnmpCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>SNMP 采集集合</em> 名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thresholding-enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">采集的性能数据是否进行门限测试。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP 响应的超时，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SNMP</em> configuration</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_snmp_采集集合配置">SNMP 采集集合配置</h5>
<div class="paragraph">
<p><em>SNMP 采集集合</em> 定义在 <code>etc/datacollection-config.xml</code> 和 <code>etc/datacollection.d/*.xml</code> 文件中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;datacollection-config rrd-repository="/var/lib/opennms/rrd/snmp/"&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;snmp-collection name="default"<i class="conum" data-value="2"></i><b>(2)</b>
                     snmpStorageFlag="select"&gt;<i class="conum" data-value="3"></i><b>(3)</b>
        &lt;rrd step="300"&gt;<i class="conum" data-value="4"></i><b>(4)</b>
            &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
            &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
            &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
            &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
            &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
        &lt;/rrd&gt;

        &lt;include-collection dataCollectionGroup="MIB2"/&gt;<i class="conum" data-value="5"></i><b>(5)</b>
        &lt;include-collection dataCollectionGroup="3Com"/&gt;
        ...
        &lt;include-collection dataCollectionGroup="VMware-Cim"/&gt;
    &lt;/snmp-collection&gt;
&lt;/datacollection-config&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>在文件系统上存储 <em>RRD</em> 文件，如果使用 <em>NewTS</em> 存储时间序列数据，则忽略。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>SNMP</em> 引用的数据 <em>集合包</em> 定义在 <code>collectd-configuration.xml</code> 中。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>配置 SNMP MIB-II 接口指标采集动作: <em>all</em> 表示从所有接口采集数据， <em>primary</em> 仅从原始 <em>primary</em> 接口采集, <em>select</em> 仅采集从  <em>Web UI</em> 选择的接口。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><em>RRD</em> 归档配置用于性能指标设置，如果使用 <em>NewTS</em> 作为存储，忽略这项配置。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>包含设备或应用要采集性能数据的 <em>OIDS</em> 。</td>
</tr>
</table>
</div>
<div id="ga-performance-management-collectors-snmp-datacollection-configuration" class="imageblock">
<div class="content">
<img src="images/performance-management/collectors/01_snmp-datacollection-configuration.png" alt="01 snmp datacollection configuration">
</div>
<div class="title">Figure 34. SNMP数据采集配置概述</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpcollector">5.3.2. HttpCollector</h4>
<div class="paragraph">
<p><em>HttpCollector</em> 利用 <em>HTTP</em> 和 <em>HTTPS</em> 采集性能数据。
使用正则表达式从 <em>HTTP</em> 响应中提取属性。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_2">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.HttpCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_2">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 79. HttpCollector 采集器的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>HTTP 采集集合</em> 名称。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thresholding-enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">采集的性能数据是否进行门限测试</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">覆盖所有 URIs 中的默认端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接超时，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-system-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应该使用系统范围的代理设置吗？
                           可以在 <a href="#ga-opennms-system-properties">opennms.conf</a> 中配置系统代理</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_http_采集集合配置">HTTP 采集集合配置</h5>
<div class="paragraph">
<p><em>HTTP 采集集合</em> 定义在 <code>etc/http-datacollection-config.xml</code> 中。</p>
</div>
<div class="paragraph">
<p>下面的代码段，是 <code>opennms-copyright</code> 定义的集合:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;http-collection name="opennms-copyright"&gt;
  &lt;rrd step="300"&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
  &lt;/rrd&gt;
  &lt;uris&gt;
    &lt;uri name="login-page"&gt;
      &lt;url path="/opennms/login.jsp"
           matches=".*2002\-([0-9]+).*" response-range="100-399" dotall="true" &gt;
      &lt;/url&gt;
      &lt;attributes&gt;
        &lt;attrib alias="copyrightYear" match-group="1" type="gauge"/&gt;
      &lt;/attributes&gt;
    &lt;/uri&gt;
  &lt;/uris&gt;
&lt;/http-collection&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一旦添加到 <code>etc/http-datacollection-config.xml</code> 中，就可以在 <em>Karaf Shell</em> 中使用 <code>collect</code> 命令来测试它:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect org.opennms.netmgt.collectd.HttpCollector 127.0.0.1 collection=opennms-copyright port=8980</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdbccollector">5.3.3. JdbcCollector</h4>
<div class="paragraph">
<p><em>JdbcCollector</em> 通过 <em>JDBC</em> 驱动采集性能数据。
属性是通过 <em>SQL</em> 查询检索的。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_3">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.JdbcCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code> (参见限制)</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_minion_上的限制"><em>Minion</em> 上的限制</h6>
<div class="paragraph">
<p>当在 <em>Minion</em> 中运行时，无法引用 <code>opennms-datasources.xml</code> 中的数据源。
相反，需要使用服务参数来设置 <em>JDBC</em> 连接。</p>
</div>
<div class="paragraph">
<p>此外，必须在 <em>Minion</em> 容器中正确加载 <em>JDBC</em> 驱动。
默认情况下，只有 <em>PostgreSQL</em> 的 <em>JDBC</em> 驱动可用。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_采集器参数_3">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 80. JdbcCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>JDBC 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(empty)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data-source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用 opennms-datasources.xml 中定义的现有数据源</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NO_DATASOURCE_FOUND</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">驱动类名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.postgresql.Driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>JDBC</em> URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://:OPENNMS_JDBC_HOSTNAME/opennms</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>JDBC</em> 用户名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>JDBC</em> 密码</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(empty string)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_jdbc_采集集合配置">JDBC 采集集合配置</h5>
<div class="paragraph">
<p><em>JDBC 采集集合</em> 定义在 <code>etc/jdbc-datacollection-config.xml</code> 中。</p>
</div>
<div class="paragraph">
<p>下面代码段，是一个名为 <code>opennms-stats</code> 的集合:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;jdbc-collection name="opennms-stats"&gt;
  &lt;rrd step="300"&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
  &lt;/rrd&gt;
  &lt;queries&gt;
    &lt;query name="opennmsQuery" ifType="ignore"&gt;
      &lt;statement data-source="opennms"&gt;
        &lt;queryString&gt;select count(*) as event_count from events;&lt;/queryString&gt;
      &lt;/statement&gt;
      &lt;columns&gt;
        &lt;column name="event_count" data-source-name="event_count" alias="event_count" type="GAUGE"/&gt;
      &lt;/columns&gt;
    &lt;/query&gt;
  &lt;/queries&gt;
&lt;/jdbc-collection&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置添加到 <code>etc/jdbc-datacollection-config.xml</code> 之后，你就可以在 <em>Karaf Shell</em> 中使用 <code>collect</code> 命令测试它:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect org.opennms.netmgt.collectd.JdbcCollector 127.0.0.1 collection=opennms-stats data-source=opennms</code></pre>
</div>
</div>
<div class="paragraph">
<p>要在 <em>Minion</em> 上测试这个集合，必须指定 <em>JDBC</em> 设置的服务属性，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect -l MINION org.opennms.netmgt.collectd.JdbcCollector 127.0.0.1 collection=opennms-stats driver=org.postgresql.Driver url=jdbc:postgresql://localhost:5432/opennms user=opennms password=opennms</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jmxcollector">5.3.4. JmxCollector</h4>
<div class="paragraph">
<p><em>JmxCollector</em> 通过 <em>JMX</em> 采集性能数据。
属性是从可用的 <em>MBeans</em> 中提取的。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_4">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.Jsr160Collector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_4">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 81. Jsr160Collector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>JMX 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thresholding-enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">采集的性能数据是否进行门限测试</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>friendlyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">存储指标的路径的名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of the port, or 'jsr160' if no port is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>factory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用密码策略。
                           支持的值是: <code>STANDARD</code> (用于认证),
                           <code>PASSWORD_CLEAR</code> (与 <code>STANDARD</code> 相同) 和 <code>SASL</code> (如果需要安全连接)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STANDARD</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接 url, 例如 <code>service:jmx:rmi:localhost:18980</code>.
                           可以替换IP地址。这时候使用 <code>${ipaddr}</code> , 例如:
                            <code>service:jmx:rmi:${ipaddr}:18980</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果需要身份验证，需要的用户名。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果需要身份验证，需要的密码。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>已过期</strong>。 JMX 端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1099</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>已过期</strong>。 <code>JMX</code> 连接字符串中使用的协议。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rmi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>urlPath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>已过期</strong>。 <code>JMX</code> 连接字符串中使用的路径。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/jmxrmi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rmiServerPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>已过期</strong>。 RMI 端口。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>45444</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remoteJMX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>已过期</strong>。 使用另一种 <code>JMX</code> URL 方案。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
参数 <code>port</code>, <code>protocol</code>, <code>urlPath</code>, <code>rmiServerPort</code> 和 <code>remoteJMX</code> 都已弃用，应该用 <code>url</code> 参数替代。
如果未定义 <code>url</code> ，则采集器改为 _传统模式 _ ，并且使用弃用的参数来构建连接 url。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果服务需要不同的配置，可以在 <code>$OPENNMS_HOME/etc/jmx-config.xml</code> 中覆盖配置。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_jmx_采集集合配置">JMX 采集集合配置</h5>
<div class="paragraph">
<p><em>JMX 采集集合</em> 定义在 <code>etc/jmx-datacollection-config.xml</code> 和 <code>etc/jmx-datacollection-config.d/</code> 中。</p>
</div>
<div class="paragraph">
<p>下面代码段，是一个名为 <code>opennms-poller</code> 的集合定义:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;jmx-collection name="opennms-poller"&gt;
    &lt;rrd step="300"&gt;
        &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
        &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
        &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
        &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
        &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
    &lt;/rrd&gt;
    &lt;mbeans&gt;
        &lt;mbean name="OpenNMS Pollerd" objectname="OpenNMS:Name=Pollerd"&gt;
            &lt;attrib name="NumPolls" alias="ONMSPollCount" type="counter"/&gt;
        &lt;/mbean&gt;
    &lt;/mbeans&gt;
&lt;/jmx-collection&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置添加到 <code>etc/jmx-datacollection-config.xml</code> 之后，你就可以在 <em>Karaf Shell</em> 中使用 <code>collect</code> 命令来测试它:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>collection:collect org.opennms.netmgt.collectd.Jsr160Collector 127.0.0.1 collection=opennms-poller port=18980</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_通用资源类型">通用资源类型</h5>
<div class="paragraph">
<p>为了支持 objectname 中的通配符(*)，JMX 采集器支持通用资源类型。
jmx 配置需要进行两次更改。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在 <code>etc/resource-types.d/</code> 中创建自定义资源类型
例如: 在 <code>jmx-resource.xml</code> 中定义一个 kafka lag 定制资源</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;resource-types&gt;
    &lt;resourceType name="kafkaLag" label="Kafka Lag"
                  resourceLabel="${index}"&gt;
      &lt;persistenceSelectorStrategy class="org.opennms.netmgt.collection.support.PersistAllSelectorStrategy"/&gt;
      &lt;storageStrategy class="org.opennms.netmgt.dao.support.SiblingColumnStorageStrategy"&gt;
		   &lt;parameter key="sibling-column-name" value="name" /&gt;
      &lt;/storageStrategy&gt;
    &lt;/resourceType&gt;
&lt;/resource-types&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>在 mbean 定义中将 <code>resource-type</code> 指定为 resourceType 的名称</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;mbean name="org.opennms.core.ipc.sink.kafka.heartbeat" resource-type="kafkaLag" objectname="org.opennms.core.ipc.sink.kafka:name=OpenNMS.Sink.*.Lag"&gt;
   &lt;attrib name="Value" alias="Lag" type="gauge"/&gt;
&lt;/mbean&gt;</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_资源定义">资源定义</h6>
<div class="paragraph">
<p>JMX objectname 是 Mbean 的全称，像 <code>( domain:key=value, key=value, ..)</code> 的形式。</p>
</div>
<div class="paragraph">
<p>根据通配符定义，使用 <code>SiblingColumnStorageStrategy</code> 来提取资源标签。
如果值中存在通配符(通常情况下)，则使用相应的 <code>key</code> 作为 <code>sibling-column-name</code> 参数。例如：
<code>org.apache.activemq:BrokerName=*,Type=Queue,Destination=com.mycompany.myqueue</code></p>
</div>
<div class="paragraph">
<p>这里的 <code>BrokerName</code> 可以定义为 SiblingColumnStorageStrategy 参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   &lt;parameter key="sibling-column-name" value="BrokerName" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>从通配符中提取 BrokerNames，资源文件夹会是 <code>nodeId/resourceTypeName/{resource-label}</code> 形式</p>
</div>
<div class="paragraph">
<p>通配符也可能存在于 domain（域）中，例如：<code>org.apache.*:BrokerName=trap, Type=Queue</code>。
那么，<code>domain</code> 可以定义为 <code>sibling-column-name</code> 参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  &lt;parameter key="sibling-column-name" value="domain" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><code>objectname</code> 本身可以用作资源标签，在 <code>resource-type</code> 定义中简单的使用 <code>IndexStorageStrategy</code> 作为存储策略。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_第三方_jmx_服务">第三方 JMX 服务</h5>
<div class="paragraph">
<p>一些 java 应用程序提供它们自己的 JMX 实现，并要求在 classpath 中包含某些库，例如 java 应用服务器 Wildfly。
为了成功采集数据，可能需要以下步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将 jmx 客户端 lib 放到 $OPENNMS_HOME/lib 文件夹 (例如 jboss-cli-client.jar)</p>
</li>
<li>
<p>相应配置 JMX-Collector（采集器） (见下文)</p>
</li>
<li>
<p>相应配置 collection（集合） (见上文)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">实例</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;service name="JMX-WILDFLY" interval="300000" user-defined="false" status="on"&gt;
    &lt;parameter key="url" value="service:jmx:http-remoting-jmx://${ipaddr}:9990"/&gt;
    &lt;parameter key="retry" value="2"/&gt;
    &lt;parameter key="timeout" value="3000"/&gt;
    &lt;parameter key="factory" value="PASSWORD-CLEAR"/&gt;
    &lt;parameter key="username" value="admin"/&gt;
    &lt;parameter key="password" value="admin"/&gt;
    &lt;parameter key="rrd-base-name" value="java"/&gt;
    &lt;parameter key="collection" value="jsr160"/&gt;
    &lt;parameter key="thresholding-enabled" value="true"/&gt;
    &lt;parameter key="ds-name" value="jmx-wildfly"/&gt;
    &lt;parameter key="friendly-name" value="jmx-wildfly"/&gt;
&lt;/service&gt;
&lt;collector service="JMX-WILDFLY" class-name="org.opennms.netmgt.collectd.Jsr160Collector"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nsclientcollector">5.3.5. NSClientCollector</h4>
<div class="paragraph">
<p><em>NSClientCollector</em> 通过 <em>HTTP</em> 从 <em>NSClient++</em> 采集性能数据。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_5">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.protocols.nsclient.collector.NSClientCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opennms-plugin-protocol-nsclient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_5">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 82. NSClientCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>NSClient 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_tcacollector">5.3.6. TcaCollector</h4>
<div class="paragraph">
<p><em>TcaCollector</em> 采集器从Juniper TCA 设备采集特殊 SNMP 数据。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_6">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.tca.TcaCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opennms-plugin-collector-juniper-tca</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_6">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 83. TcaCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>TCA 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_vmwarecimcollector">5.3.7. VmwareCimCollector</h4>
<div class="paragraph">
<p><em>VmwareCimCollector</em> 从 <em>vCenter</em> 采集 <em>ESXi</em> 主机和传感器指标。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_7">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.VmwareCimCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_7">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 84. VmwareCimCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用的 <em>VMWare CIM 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接超时，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_vmwarecollector">5.3.8. VmwareCollector</h4>
<div class="paragraph">
<p><em>VmwareCollector</em> 从 <em>vCenter</em> 采集管理实体的性能指标。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_8">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.VmwareCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_8">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 85. VmwareCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用的 <em>VMWare 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接超时，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_wmicollector">5.3.9. WmiCollector</h4>
<div class="paragraph">
<p><em>WmiCollector</em> 从 <em>Windows</em> 系统使用 Windows Management Instrumentation (WMI) 采集性能指标。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_9">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.WmiCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_9">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 86. WmiCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用的 <em>WMI 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ga-performance-mgmt-collectors-wsman-collector">5.3.10. WsManCollector</h4>
<div class="paragraph">
<p><em>WsManCollector</em> 使用 Web Services-Management (WS-Management) 协议采集性能度量数据。</p>
</div>
<div class="paragraph">
<p>Web Services-Management (WS-Management) 是 DMTF 开放标准，定义了基于 SOAP 协议管理服务器、设备、应用程序和各种 Web 服务的方式。
Windows Remote Management (WinRM) 是 WS-Management 协议的微软的实现。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_10">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collectd.WsManCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_10">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 87. 采集器 WsManCollector 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 <em>WS-Man Collection（集合）</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ga-performance-mgmt-collectors-wsman-setup">WS-Management 设置</h5>
<div class="paragraph">
<p>在设置 OpenNMS Horizon 与 WS-Management 代理通信之前，请确认它已正确配置并且 OpenNMS Horizon 系统可以访问。
如果需要启用 WS-Management 代理的帮助，请参考制造商的文档。
以下是一些有用的资源链接：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa384372(v=vs.85).aspx">Installation and Configuration for Windows Remote Management</a></p>
</li>
<li>
<p><a href="http://www.hurryupandwait.io/blog/understanding-and-troubleshooting-winrm-connection-and-authentication-a-thrill-seekers-guide-to-adventure">Troubleshooting WinRM connection and authentication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>我们建议使用 <a href="https://github.com/Openwsman/openwsman/wiki/openwsman-command-line-client">Openwsman 命令行客户端</a> 验证身份验证和连接。
<code>wsmancli</code> 可用于大多数发行版。</p>
</div>
<div class="paragraph">
<p>例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">wsman identify -h localhost -P 5985 -u wsman -p secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>验证成功后，将代理的特定信息添加到 OpenNMS Horizon 配置中，在下一节中定义。</p>
</div>
<div class="sect5">
<h6 id="_故障排除和命令">故障排除和命令</h6>
<div class="paragraph">
<p>对于故障排除，您可以在 <em>Microsoft Windows Server 2012</em> 上使用一组 Powershell_ 命令验证。</p>
</div>
<div class="listingblock">
<div class="title">在 PowerShell 中启用 <em>WinRM</em></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">Enable-PSRemoting</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置 WinRM 的 HTTP 通过 Firewall</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">netsh advfirewall firewall add rule name="WinRM-HTTP" dir=in localport=5985 protocol=TCP action=allow</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置 WinRM 的 HTTPS 通过 Firewall</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">netsh advfirewall firewall add rule name="WinRM-HTTPS" dir=in localport=5986 protocol=TCP action=allow</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在本地 Windows Server 上测试 WinRM</div>
<div class="content">
<pre>winrm id</pre>
</div>
</div>
<div class="listingblock">
<div class="title">在 Windows Server 上显示 WinRM 配置</div>
<div class="content">
<pre>winrm get winrm/config</pre>
</div>
</div>
<div class="listingblock">
<div class="title">在 Windows Server 上显示监听配置</div>
<div class="content">
<pre>winrm e winrm/config/listener</pre>
</div>
</div>
<div class="listingblock">
<div class="title">从 Linux 系统测试连通性</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">nc -z -w1 &lt;windows-server-ip-or-host&gt; 5985;echo $?</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
在生产环境中仅使用带有可验证证书的 <em>WinRM</em> over <em>HTTPS</em> 使用 BasicAuthentication。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">启用 BasicAuthentication</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">winrm set winrm/config/client/auth '@{Basic="true"}'
winrm set winrm/config/service/auth '@{Basic="true"}'
winrm set winrm/config/service '@{AllowUnencrypted="true"}'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ga-performance-mgmt-collectors-wsman-agent-config">WS-Management 代理配置</h5>
<div class="paragraph">
<p>代理特定的配置信息保存在 <code>etc/wsman-config.xml</code>。
该文件与 <code>etc/snmp-config.xml</code> 的结构类似，用户可能已经熟悉了。</p>
</div>
<div class="paragraph">
<p>当连接到 WS-Man 代理时，将读取此文件。
如果代理的IP地址匹配到了 <code>range</code>, <code>specific</code> 或 <code>ip-match</code> 的定义，则该定义的属性将用于连接。
否则，将使用 <code>wsman-config</code> 外部定义的属性。</p>
</div>
<div class="paragraph">
<p>当修改后，这个 <code>etc/wsman-config.xml</code> 文件会自动重新加载。</p>
</div>
<div class="paragraph">
<p>下面是几个定义的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;wsman-config retry="3" timeout="1500" ssl="true" strict-ssl="false" path="/wsman"&gt;
    &lt;definition ssl="true" strict-ssl="false" path="/wsman" username="root" password="calvin" product-vendor="Dell" product-version="iDRAC 6"&gt;
        &lt;range begin="192.168.1.1" end="192.168.1.10"/&gt;
    &lt;/definition&gt;
    &lt;definition ssl="false" port="5985" path="/wsman" username="Administrator" password="P@ssword"&gt;
        &lt;ip-match&gt;172.23.1-4.1-255&lt;/ip-match&gt;
        &lt;specific&gt;172.23.1.105&lt;/specific&gt;
    &lt;/definition&gt;
&lt;/wsman-config&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 88. 采集器配置属性</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HTTP</em> 连接的响应超时，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HTTP</em> client default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于基本身份验证的用户名。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于基本身份验证的密码。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HTTP/S</em> 端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Default for protocol</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-elements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">单个请求中要检索的最大元素数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no limit</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用 <em>SSL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strict-ssl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行 <em>SSL</em> 证书验证。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WS-Management 服务的 URL 中的路径。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>product-vendor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于覆盖检测到的产品供应商。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>product-version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于覆盖检测到的产品版本。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gss-auth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用 GSS 认证。
                      启用后，将对目标 IP 地址执行反向查找，
                      以确定规范的主机名。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果视图连接 <em>Microsoft Windows Server</em> ，请保设置了 <em>WinRM</em> 连接端口。
默认情况下，<em>Microsoft Windows Server</em> 使用端口 <code>TCP/5985</code> 的纯文本，并且 <em>SSL</em> 连接端口是 <code>TCP/5986</code>。.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_ws_management_collection集合配置">WS-Management Collection（集合）配置</h5>
<div class="paragraph">
<p>WS-Management 采集器的配置存储在 <code>etc/wsman-datacollection-config.xml</code> 和 <code>etc/wsman-datacollection.d/*.xml</code> 文件。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这些文件的内容在更改时自动合并，并重新加载。
      默认 <code>default</code> 的 WS-Management collection（集合）如下：
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;wsman-datacollection-config rrd-repository="${install.share.dir}/rrd/snmp/"&gt;
    &lt;collection name="default"&gt;
        &lt;rrd step="300"&gt;
            &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
            &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
            &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
            &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
            &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
        &lt;/rrd&gt;

        &lt;!--
             Include all of the available system definitions
         --&gt;
        &lt;include-all-system-definitions/&gt;
    &lt;/collection&gt;
&lt;/wsman-datacollection-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>元素 <code>&lt;include-all-system-definitions/&gt;</code> 具有强大功能，该元素自动将所有系统定义导入到集合组中。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果需要，可以使用 <code>&lt;include-system-definition&gt;sys-def-name&lt;/include-system-definition&gt;</code> 来导入特定的 system-definition（系统定义）。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>可以在根 <code>etc/wsman-datacollection-config.xml</code> 文件中定义系统定义和相关组，但是，最好将设备特定配置添加到 <code>etc/wsman-datacollection-config.d/*.xml</code> 文件中。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
避免修改任何发布配置文件，而是创建新的配置文件来添加特定配置。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>以下是 <em>Dell iDRAC</em> 的一个示例配置文件:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;wsman-datacollection-config&gt;
    &lt;group name="drac-system"
           resource-uri="http://schemas.dell.com/wbem/wscim/1/cim-schema/2/root/dcim/DCIM_ComputerSystem"
           resource-type="node"&gt;
        &lt;attrib name="OtherIdentifyingInfo" index-of="#IdentifyingDescriptions matches '.*ServiceTag'" alias="serviceTag" type="String"/&gt;
    &lt;/group&gt;

    &lt;group name="drac-power-supply"
           resource-uri="http://schemas.dmtf.org/wbem/wscim/1/*"
           dialect="http://schemas.microsoft.com/wbem/wsman/1/WQL"
           filter="select InputVoltage,InstanceID,PrimaryStatus,SerialNumber,TotalOutputPower from DCIM_PowerSupplyView where DetailedState != 'Absent'"
           resource-type="dracPowerSupplyIndex"&gt;
        &lt;attrib name="InputVoltage" alias="inputVoltage" type="Gauge"/&gt;
        &lt;attrib name="InstanceID" alias="instanceId" type="String"/&gt;
        &lt;attrib name="PrimaryStatus" alias="primaryStatus" type="Gauge"/&gt;
        &lt;attrib name="SerialNumber" alias="serialNumber" type="String"/&gt;
        &lt;attrib name="TotalOutputPower" alias="totalOutputPower" type="Gauge"/&gt;
    &lt;/group&gt;

    &lt;system-definition name="Dell iDRAC (All Version)"&gt;
        &lt;rule&gt;#productVendor matches '^Dell.*' and #productVersion matches '.*iDRAC.*'&lt;/rule&gt;
        &lt;include-group&gt;drac-system&lt;/include-group&gt;
        &lt;include-group&gt;drac-power-supply&lt;/include-group&gt;
    &lt;/system-definition&gt;
&lt;/wsman-datacollection-config&gt;</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="ga-performance-mgmt-collectors-wsman-system-definitions">System Definitions (系统定义)</h6>
<div class="paragraph">
<p>系统定义中的规则是使用 <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/expressions.html">SpEL</a> 表达式编写的。</p>
</div>
<div class="paragraph">
<p>该表达式在上下文中访问以下变量:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(root)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>org.opennms.netmgt.model.OnmsNode</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>org.opennms.netmgt.collection.api.CollectionAgent</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">productVendor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>java.lang.String</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">productVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>java.lang.String</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果特定代理与相关规则匹配，则采集器将从代理采集引用的组。</p>
</div>
</div>
<div class="sect5">
<h6 id="ga-performance-mgmt-collectors-wsman-group-definitions">组定义</h6>
<div class="paragraph">
<p>通过针对特定的 <code>Resource URI</code> 发送枚举命令并解析结果来检索组。
枚举命令可以包括 <code>filter</code> 选项，来过滤返回的记录和属性。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在配置过滤器时，还必须指定特殊用处。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>组使用的资源类型必须是 <code>node</code> 或 通用资源类型。
不支持接口级资源。</p>
</div>
<div class="paragraph">
<p>当使用通用资源类型时，由于记录没有相关索引，所以不能使用 <code>IndexStorageStrategy</code>。
相应，你必须使用一个替代方案，例如，<code>SiblingColumnStorageStrategy</code>。</p>
</div>
<div class="paragraph">
<p>如果记录包括多值键，则可以使用 <code>index-of</code> 表达式在特定索引采集值。
这里使用一个例子来说明。假设我们想从下面的记录中采集 <code>ServiceTag</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;IdentifyingDescriptions&gt;CIM:GUID&lt;/IdentifyingDescriptions&gt;
&lt;IdentifyingDescriptions&gt;CIM:Tag&lt;/IdentifyingDescriptions&gt;
&lt;IdentifyingDescriptions&gt;DCIM:ServiceTag&lt;/IdentifyingDescriptions&gt;
&lt;OtherIdentifyingInfo&gt;45454C4C-3700-104A-8052-C3C01BB25031&lt;/OtherIdentifyingInfo&gt;
&lt;OtherIdentifyingInfo&gt;mainsystemchassis&lt;/OtherIdentifyingInfo&gt;
&lt;OtherIdentifyingInfo&gt;C8BBBP1&lt;/OtherIdentifyingInfo&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>只指定属性名 <code>OtherIdentifyingInfo</code> 是不够的，因为该键有多个值。
然而，我们只需要 <code>IdentifyingDescriptions</code> 设置为 <code>DCIM:ServiceTag</code> 的相同索引的 <code>OtherIdentifyingInfo</code> 键的值。</p>
</div>
<div class="paragraph">
<p>这可以通过以下属性定义来实现:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;attrib name="OtherIdentifyingInfo" index-of="#IdentifyingDescriptions matches '.*ServiceTag'" alias="serviceTag" type="String"/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xmlcollector">5.3.11. XmlCollector</h4>
<div class="paragraph">
<p><em>XmlCollector</em> 从 <em>XML</em> 和 <em>JSON</em> 文档中采集和提取指标数据。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_11">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.protocols.xml.collector.XmlCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code> (参见限制)</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_minion_上的限制_2"><em>Minion</em> 上的限制</h6>
<div class="paragraph">
<p>下面的处理程序，目前 <em>Minion</em> 不支持:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DefaultJsonCollectionHandler</p>
</li>
<li>
<p>Sftp3gppXmlCollectionHandler</p>
</li>
<li>
<p>Sftp3gppVTDXmlCollectionHandler</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_采集器参数_11">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 89. XmlCollector 采集器特定的参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用的 <em>XML 采集集合</em> 名词</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>handler-class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于执行采集的类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.protocols.xml.collector.DefaultXmlCollectionHandler</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可用的处理程序包括:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.opennms.protocols.xml.collector.DefaultXmlCollectionHandler</code></p>
</li>
<li>
<p><code>org.opennms.protocols.xml.collector.Sftp3gppXmlCollectionHandler</code></p>
</li>
<li>
<p><code>org.opennms.protocols.xml.vtdxml.DefaultVTDXmlCollectionHandler</code></p>
</li>
<li>
<p><code>org.opennms.protocols.xml.vtdxml.Sftp3gppVTDXmlCollectionHandler</code></p>
</li>
<li>
<p><code>org.opennms.protocols.json.collector.DefaultJsonCollectionHandler</code></p>
</li>
<li>
<p><code>org.opennms.protocols.http.collector.HttpCollectionHandler</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_xml_采集集合配置">XML 采集集合配置</h5>
<div class="paragraph">
<p><em>XML 采集集合</em> 定义在 <code>etc/xml-datacollection-config.xml</code> 和 <code>etc/xml-datacollection/</code> 中。</p>
</div>
<div class="paragraph">
<p>下面的代码段，是一个名为 <code>xml-opennms-nodes</code> 的集合定义:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xml-collection name="xml-opennms-nodes"&gt;
  &lt;rrd step="300"&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:1:2016&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:12:1488&lt;/rra&gt;
    &lt;rra&gt;RRA:AVERAGE:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MAX:0.5:288:366&lt;/rra&gt;
    &lt;rra&gt;RRA:MIN:0.5:288:366&lt;/rra&gt;
  &lt;/rrd&gt;
  &lt;xml-source url="http://admin:admin@{ipaddr}:8980/opennms/rest/nodes"&gt;
     &lt;request method="GET"&gt;
        &lt;parameter name="use-system-proxy" value="true"/&gt;
      &lt;/request&gt;
    &lt;import-groups&gt;xml-datacollection/opennms-nodes.xml&lt;/import-groups&gt;
  &lt;/xml-source&gt;
&lt;/xml-collection</code></pre>
</div>
</div>
<div class="paragraph">
<p>请求元素可以具有以下子元素:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">参数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">描述</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认值</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接超时，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">请求重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-system-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应该使用系统范围的代理设置吗？
                            可以在 <a href="#ga-opennms-system-properties">opennms.conf</a> 中配置系统代理设置</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>引用 <code>opennms-nodes.xml</code> 文件内容:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;xml-groups&gt;
    &lt;xml-group name="nodes" resource-type="node" resource-xpath="/nodes"&gt;
        &lt;xml-object name="totalCount" type="GAUGE" xpath="@totalCount"/&gt;
    &lt;/xml-group&gt;
&lt;/xml-groups&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置完成后，可以在 <em>Karaf Shell</em> 上使用 <code>collect</code> 命令来测试它:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect -n 1 org.opennms.protocols.xml.collector.XmlCollector 127.0.0.1 collection=xml-opennms-nodes</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_提示_2">提示</h5>
<div class="paragraph">
<p>处理程序 <code>org.opennms.protocols.json.collector.DefaultJsonCollectionHandler</code> 需要获取文档的单个元素类型对象，来完成 xpath 查询工作。
如果根元素是一个数组，它将被封装在一个对象中，而元素数组可以通过 <code>/elements</code> 访问。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xmpcollector">5.3.12. XmpCollector</h4>
<div class="paragraph">
<p><em>XmpCollector</em> 通过 X/Open 管理协议 API (XMP) 采集性能指标。</p>
</div>
<div class="sect4">
<h5 id="_采集器定义_12">采集器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.protocols.xmp.collector.XmpCollector</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">包</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opennms-plugin-protocol-xmp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 是否支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>No</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_采集器参数_12">采集器参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 90. XmpCollector 采集器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用的 <em>XMP 采集集合</em> 名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">代理通信的 TCP 端口</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authenUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于对代理进行身份验证的用户名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与代理通信时的超时</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">超时过期时允许重试次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-performance-mgmt-shell">5.4. Shell Commands</h3>
<div class="paragraph">
<p>许多 <em>Karaf Shell</em> 上的命令可用于帮助管理和诊断与性能数据采集有关的问题。</p>
</div>
<div class="paragraph">
<p>要使用这些命令，请先登录到系统的 <em>Karaf Shell</em> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>ssh -p 8101 admin@localhost</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Karaf shell 与 web 界面使用相同的凭证。
      具有 <code>ADMIN</code> 角色的用户才能访问 shell。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In order to keep the session open while executing long-running tasks without any user input add <code>-o ServerAliveInterval=10</code> to your ssh command.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ga-performance-mgmt-adhoc-collection">5.4.1. 点对点采集</h4>
<div class="paragraph">
<p>在 <em>Karaf Shell</em> 上执行 <code>collection:collect</code>  命令可以用来触发和执行一次数据采集，针对任何可用采集器。</p>
</div>
<div class="paragraph">
<p>结果集 (也称为 "采集集合") 在成功采集后将在控制台显示。
获取的结果集不被持久化存储，也不会应用任何门限。</p>
</div>
<div class="paragraph">
<p>列出所有可用采集器:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:list-collectors</code></pre>
</div>
</div>
<div class="paragraph">
<p>调用 <code>SnmpCollector</code> 对接口 <code>127.0.0.1</code> 设备 <code>NODES:n1</code> 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect -n NODES:n1 org.opennms.netmgt.collectd.SnmpCollector 127.0.0.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>调用 <code>SnmpCollector</code> 对接口 <code>127.0.0.1</code> 设备 <code>NODES:n1</code> 位置 <code>MINION</code> 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect -l MINION -n NODES:n1 org.opennms.netmgt.collectd.SnmpCollector 127.0.0.1</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
在命令上设置位置将覆盖设备的位置。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果在远程位置调用采集器时出现 <code>RequestTimedOutException</code> 错误时，请考虑增加存活时间。
      默认情况下， <code>collectd</code> 将使用服务间隔作为存活时间。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>调用 <code>JdbcCollector</code> 对接口 <code>127.0.0.1</code> ，同时指定一些采集参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect org.opennms.netmgt.collectd.JdbcCollector 127.0.0.1 collection=PostgreSQL driver=org.postgresql.Driver url=jdbc:postgresql://OPENNMS_JDBC_HOSTNAME/postgres user=postgres</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
某些采集器, 像 <code>JdbcCollector</code>, 可以在不指定设备的情况下调用。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>保存采集数据：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect -l MINION -n NODES=n1 -p org.opennms.netmgt.collectd.SnmpCollector 127.0.0.1</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>-p/--persist</code> 选项将引入额外数据点来存储采集数据集合，而不是之前配置的数据采集间隔。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>完整的可用选项列表:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>collection:collect --help</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_输出说明">5.4.2. 输出说明</h4>
<div class="paragraph">
<p>采集成功之后，采集集合将通过以下格式显示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>resource a
  group 1
    attribute
    attribute
  group 2
    attribute
resource b
  group 1
    attribute
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>资源，组和属性的描述可能对不同的采集器有所不同。
此输出与正在使用的持久化存储策略无关。</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-performance-mgmt-stress-testing">5.4.3. 压力测试</h4>
<div class="paragraph">
<p><em>Karaf Shell</em> 上的 <code>metrics:stress</code> 命令可以用来模拟存储策略上的负载能力，无论是 <code>RRDtool</code>, <code>JRobin</code>, 或 <code>Newts</code>。</p>
</div>
<div class="paragraph">
<p>该工具通过生成数据集合来工作，类似于在执行数据采集时构建的集合，并将它们发送到数据持久化层。
通过使用持久化层，我们确保使用相同的写路径，这是提供给实际的数据采集服务使用的。</p>
</div>
<div class="paragraph">
<p>每 <strong>15秒</strong> 生成 <strong>10 个设备</strong> 的样本，并每隔 <strong>30 秒</strong> 打印一次统计报告:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>metrics:stress -n 10 -i 15 -r 30</code></pre>
</div>
</div>
<div class="paragraph">
<p>激活时，命令将继续生成并保存数据集。
在此期间，你可以监视系统 I/O 和其它相关的统计数据。</p>
</div>
<div class="paragraph">
<p>完成后，使用 <strong>CTRL+C</strong> 停止压力测试工具。</p>
</div>
<div class="paragraph">
<p>可用选项完整列表:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>metrics:stress --help</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_解释输出">5.4.4. 解释输出</h4>
<div class="paragraph">
<p>工具输出的统计数据如下解释:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">numeric-attributes-generated</dt>
<dd>
<p>向持久层发送的数字属性的数量。
我们不能保证这些是否真的存储。</p>
</dd>
<dt class="hdlist1">string-attributes-generated</dt>
<dd>
<p>发送到持久层的字符串属性的数目。
我们不能保证这些是否真的存储。</p>
</dd>
<dt class="hdlist1">batches</dt>
<dd>
<p>该计数用于指示将多个批次集合 (每个间隔的一个) 发送到持久层。
计时器显示花费多少时间来生成批次，并将批次发送到持久层。</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-events">6. 事件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>事件功能是 <em>OpenNMS Horizon</em> 操作平台的核心，因此对这个主题有一个牢固的把握是至关重要的。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
每当 <em>OpenNMS Horizon</em> 系统完成某些神奇的功能时，很可能背后是事件模块的功劳。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="ga-events-anatomy-of-an-event">6.1. 事件分析</h3>
<div class="paragraph">
<p>事件是 <em>OpenNMS Horizon</em> 系统内部和管理设备、接口、服务产生的结构化历史记录。
每个事件都有多个固定的 <strong>字段</strong> 和 0或多个 <strong>参数</strong>。</p>
</div>
<div class="dlist">
<div class="title">强制字段</div>
<dl>
<dt class="hdlist1">UEI (通用事件标识符)</dt>
<dd>
<p>唯一标识事件类型的字符串。
UEIs 通常以 URI 格式出现，唯一的要求是以 <code>uei.</code> 字符串开头。</p>
</dd>
<dt class="hdlist1">事件标签</dt>
<dd>
<p>一个简短的静态标签，概况了这个事件的实例要点。</p>
</dd>
<dt class="hdlist1">描述</dt>
<dd>
<p>描述此事件的所有实例的详细信息。</p>
</dd>
<dt class="hdlist1">日志信息</dt>
<dd>
<p>描述此事件的详细日志信息，可以选择包含字段和参数，当实例化该事件时会填充这些参数。</p>
</dd>
<dt class="hdlist1">级别</dt>
<dd>
<p>此事件类型的级别。
可能值范围从 <code>Cleared</code> 到 <code>Critical</code>。</p>
</dd>
<dt class="hdlist1">事件 ID</dt>
<dd>
<p><em>OpenNMS Horizon</em> 系统中用于标识事件的数字符号。</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">值得注意的可选字段</div>
<dl>
<dt class="hdlist1">操作指令</dt>
<dd>
<p>一组操作指令集，需要对这种类型的事件作出适当的响应。</p>
</dd>
<dt class="hdlist1">告警数据</dt>
<dd>
<p>如果为事件提供了该字段， <em>OpenNMS Horizon</em> 系统将根据告警数据的细节创建，更新或清除 <strong>告警</strong> 。
有关告警和它们如何与事件关联的更多信息，请参阅 <a href="#alarms-introduction">[alarms-introduction]</a>。</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="ga-events-sources-of-events">6.2. 事件源</h3>
<div class="paragraph">
<p>事件可能来源于 OpenNMS Horizon 系统本身或来自外部。</p>
</div>
<div class="paragraph">
<p>内部产生的事件可以是平台监控和管理功能的结果 (<em>例如</em>，一个监控的设备变成完全不可用，就会产生一个 UEI 为 <code>uei.opennms.org/nodes/nodeDown</code> 的事件) 或者它们可以作为内部协调处理过程的输入或输出。</p>
</div>
<div class="paragraph">
<p>下面的小节汇总了处理外部事件的机制。</p>
</div>
<div class="sect3">
<h4 id="ga-events-sources-snmp-traps">6.2.1. SNMP Traps</h4>
<div class="paragraph">
<p>如果支持 SNMP 功能的网络设备，配置发送 <strong>traps</strong> 消息到 OpenNMS Horizon，这些 traps 可以根据预先配置的规则转换为系统事件。默认情况下，OpenNMS Horizon 开启了 <code>Trapd</code> 模块的功能，以便随时接收 SNMP traps。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
禁用 <code>Trapd</code> 系统模块将导致 OpenNMS Horizon 系统无法接收到 SNMP traps。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>目前，OpenNMS Horizon 已经预定义了许多设备厂商的 traps 事件规则。</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-events-sources-syslog">6.2.2. Syslog 消息</h4>
<div class="paragraph">
<p>通过网络发送到 OpenNMS Horizon 系统的 Syslog 消息，可以更加预先配置的规则转换为系统事件。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
首先必须启用 <code>Syslogd</code> 功能模块，才能让 OpenNMS Horizon 系统可以正常接收 syslog 消息。默认情况下，此功能模块是 <strong>禁用</strong> 的。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_解析器">解析器</h5>
<div class="paragraph">
<p>使用不同的解析器可以将 syslog 消息字段转换为 OpenNMS Horizon 事件的相应字段。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">解析器</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.syslogd.CustomSyslogParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认解析器，通过使用正则表达式解析 syslog 头。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.syslogd.RadixTreeSyslogParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过使用一个内部的 <em>grok</em>-类型 的清单来解析 syslog 头。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.syslogd.SyslogNGParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">严格的通过默认的 syslog-ng 模式解析消息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.syslogd.Rfc5424SyslogParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">严格的通过 RFC 5424 格式解析 syslog 消息。</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_radixtreesyslogparser_解析器">RadixTreeSyslogParser 解析器</h6>
<div class="paragraph">
<p>通常，解析器 <code>RadixTreeSyslogParser</code> 使用一组内部定义模式来解析多种 syslog 消息格式。
如果你想使用自定义模式集合，可以将准备好的的模式集合保存到 <code>syslog-grok-patterns.txt</code> 文件中， 并将文件放到 OpenNMS Horizon 系统的 <code>etc</code> 目录下。</p>
</div>
<div class="paragraph">
<p><em>grok</em>-类型定义的表达式模式一般类似于 <code>%{PATTERN:semantic}</code> 语句。
表达式模式中的空白使用 0&#8230;&#8203;n 匹配空白字符，并且模式中的直接字符将匹配相应的字符。
'%' 字符必须使用反斜杠转义，即 '\%'。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
基于 <em>grok</em> 的解析器 RadixTreeSyslogParser 仅支持有限的模式表达式。但是，这些模式表达式应该足以解析任何 syslog 消息格式。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这些模式表达式在文件中的排序应该从最特殊到最不特殊，因为如果第一个模式表达式匹配成功，将直接用来构造 OpenNMS Horizon 系统事件。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">模式</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">正整数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MONTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3个英文字符月缩写。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOSPACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不包含空白的字符串。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STRING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串。因为这与任何字符匹配，所以必须在模式字符串后跟随分隔符。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">语义符合</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>day</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2位数的月 (1-31)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>facilityPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Facility-priority 优先级整数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">主机名字符串 (不限制 或 FQDN), IPv4 地址, 或 IPv6 地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hour</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2位数的小时表示 (0-23)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">余下的字符串消息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messageId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">消息 ID 字符串。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2位数的分钟表示 (0-59)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2位数的月份表示 (1-12)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>processId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">进程 ID 字符串。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>processName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">进程名称字符串。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>second</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2位数的秒表示 (0-59)。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secondFraction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1到6位数的小数秒值字符串。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timezone</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">时区值字符串。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">版本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4位数的年表示。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-events-sources-rest">6.2.3. ReST</h4>
<div class="paragraph">
<p>将 XML 格式的事件发送到 <em>OpenNMS Horizon</em> 系统的 ReST API 接口也可以生成相应事件，这项操作类似于 XML-TCP 接口。</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-events-sources-xml-tcp">6.2.4. XML-TCP</h4>
<div class="paragraph">
<p>任何应用程序或脚本都可以创建 <em>OpenNMS Horizon</em> 自定义事件，由正确的 XML 数据格式通过 TCP socket 发送。</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-events-sources-eif">6.2.5. 接收 IBM Tivoli 收集整合的事件</h4>
<div class="paragraph">
<p><em>{product-title}</em> 可以配置接收由 <a href="https://www.ibm.com/support/knowledgecenter/SSSHTQ_7.3.1/com.ibm.netcool_OMNIbus.doc_7.3.1/omnibus/wip/eifsdk/concept/kaa24487.html">Tivoli Event Integration Facility</a> 处理的 <em>事件</em>。
使用预先配置的规则将这些 EIF 事件转换为 OpenNMS 事件。生成的 UEI 使用 <code>uei.opennms.org/vendor/IBM/EIF/</code> 命名空间，EIF 事件名称可以参考 <a href="https://www.ibm.com/support/knowledgecenter/SSSHTQ_7.3.1/com.ibm.netcool_OMNIbus.doc_7.3.1/omnibus/wip/eifsdk/concept/ecoemst16.html">event class</a> 。</p>
</div>
<div class="paragraph">
<p>以一个叫 <code>OMEGAMON_BASE</code> 的事件类为例，将其添加到 OpenNMS 中。</p>
</div>
<div class="sect4">
<h5 id="ga-events-sources-eif-configuring">配置 EIF 适配器</h5>
<div class="paragraph">
<p><em>{product-title}</em> 系统启动之后，就可以访问 <em>Karaf</em> shell，你可以安装 <em>EIF 适配器</em> 功能特性，然后配置它监听的接口和端口。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认情况下， <em>EIF 适配器</em> 被配置为监听在所有接口上，并使用 TCP 的 1828 端口。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><em>OSGi</em> 登录，安装和配置 <em>EIF 适配器</em></div>
<div class="content">
<pre class="prettyprint highlight"><code>[root@localhost /root]# $ ssh -p 8101 admin@localhost
...
opennms&gt; feature:install eif-adapter
opennms&gt; config:edit org.opennms.features.eifadapter
opennms&gt; config:property-set interface 0.0.0.0
opennms&gt; config:property-set port 1828
opennms&gt; config:update</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可以使用 <code>camel:*</code> 命令检查路径状态，和/或使用 <code>log:tail</code> 查看日志是否有明显错误。
该功能特性具有 debug 级别的日志记录，可以用于调试操作。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="http://karaf.apache.org/manual/latest/#_using_the_console">文档</a> 是介绍 <em>{product-title}</em> 内置的 <em>OSGi</em> 控制台的如何使用，并且命令可以参考 <a href="http://camel.apache.org/karaf.html">camel 命令</a>。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
通过 Karaf shell 安装的功能特性被完整的保存在 <code>${OPENNMS_HOME}/data</code> 目录下。要想一直启用该特性，可以将它添加到 <code>${OPENNMS_HOME}/etc/org.apache.karaf.features.cfg</code> 文件的 <code>featuresBoot</code> 列表中。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>现在，你应该能够配置你的 EIF 转发到这个目标地址，他们的事件将被翻译成 OpenNMS 事件，并且写入 <em>事件总线</em>。</p>
</div>
</div>
<div class="sect4">
<h5 id="ga-events-sources-eif-troubleshooting">故障排除</h5>
<div class="paragraph">
<p>如果事件没有到达 <em>{product-title}</em> 系统，首先检查事件源 (<em>EIF 转发器</em>) 是否配置正确。
检查你的事件目标地址配置。特别是检查 <code>主机地址</code> 和 <code>端口</code> 参数。还要检查转发到 EIF 目标的配置。</p>
</div>
<div class="paragraph">
<p>如果验证 <em>EIF 转发器</em> 到 <em>{product-title}</em> 系统的通信配置端口 (默认值 1828) 都是正确的。</p>
</div>
<div class="paragraph">
<p>还可以通过 <code>log:tail</code> 命令查看 OSGi 日志或查看 <code>camel:*</code> 命令结果。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-events-sources-tl1">6.2.6. TL1 自主消息</h4>
<div class="paragraph">
<p>自主消息可以从某些启用 TL1 的设备中检索并转换为事件。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
必须启用 <em>OpenNMS Horizon</em> 的 <code>Tl1d</code> 功能模块，才能接收 TL1 自主消息。默认情况下，此功能模块是 <strong>禁用</strong> 的。
:imagesdir: ../../../images
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ga-events-sources-sink-api">6.2.7. Sink</h4>
<div class="paragraph">
<p>事件也可以通过转发到 Kafka_ / <em>ActiveMQ</em> 上来创建特定的标题。</p>
</div>
<div class="paragraph">
<p>标题名称应该是 <code>OpenNMS</code>.Sink.Events，其中 <code>OpenNMS</code> 是 OpenNMS Horizon 的默认实例 id。
实例 id 可以通过系统属性 <code>org.opennms.instance.id</code> 来配置。</p>
</div>
<div class="paragraph">
<p>为了让 Sink API 能够处理事件，需要添加以下系统属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'org.opennms.netmgt.eventd.sink.enable=true' &gt; "$OPENNMS_HOME/etc/opennms.properties.d/event-sink.properties"</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于从 <em>Kafka</em> 处理的事件，应该通过以下命令将 sink 策略更改为 kafka。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'org.opennms.core.ipc.sink.strategy=kafka
org.opennms.core.ipc.sink.kafka.bootstrap.servers=127.0.0.1:9092' &gt;&gt; "$OPENNMS_HOME/etc/opennms.properties.d/kafka.properties"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-events-event-bus">6.3. 事件总线</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 系统的核心是一个 <strong>事件总线</strong>。
<em>OpenNMS Horizon</em> 系统的任何组件都可以向总线发布事件，并且所有组件也都可以订阅总线上有用的事件。
这样的发布-订阅模型可以让组件间通过事件相互发送消息。
例如，当 <em>OpenNMS Horizon</em> 的子系统探针模块向系统添加了一个新设备时，同时会发布一个 <em>设备已添加</em> 事件。
对新设备感兴趣并订阅了 <em>设备已添加</em> 事件的子系统将自动接收到这些事件，因此，他们就知道开始根据配置的规则监控和管理新设备了。
发布者和订阅者不需要相互了解，这样当向 <em>OpenNMS Horizon</em> 添加新子系统或修改现有功能时，可以有一个明确的分工并且减轻编程负担。</p>
</div>
<div class="sect3">
<h4 id="_将事件关联到指定设备">6.3.1. 将事件关联到指定设备</h4>
<div class="paragraph">
<p>将一个存在的设备发送到总线时，有两种方法将设备关联到给定事件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将设备的 <strong>nodeId</strong> 设置到事件。</p>
</li>
<li>
<p>对于引入的设备，可以设置 <strong>_foreignSource</strong> 和 <strong>_foreignId</strong> 参数到事件。
  然而，对于没有 <strong>nodeId</strong> 也没有这两个参数的事件将触发查询数据操作，如果找到了设备，则将 <strong>nodeId</strong> 属性动态设置到事件中，不管哪种方法已经用来将它发送到 <strong>事件总线</strong>。
:imagesdir: ../../images</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-events-event-configuration">6.4. 事件配置</h3>
<div class="paragraph">
<p>围绕事件的后端的配置分为两个方面：<code>Eventd</code> 本身的配置，和 OpenNMS Horizon 已配置的所有事件类型。</p>
</div>
<div class="sect3">
<h4 id="_配置文件_eventd_configuration_xml">6.4.1. 配置文件 eventd-configuration.xml</h4>
<div class="paragraph">
<p><code>Eventd</code>（事件模块）的全局特性在配置文件 <code>OPENNMS_HOME/etc/eventd-configuration.xml</code> 中进行配置。
此文件在大多数安装中不需要更改。
可配置项目包括：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TCPAddress</dt>
<dd>
<p><code>Eventd</code> XML/TCP 侦听器绑定到 IP 地址。默认地址是 <code>127.0.0.1</code>。</p>
</dd>
<dt class="hdlist1">TCPPort</dt>
<dd>
<p><code>Eventd</code> XML/TCP 侦听器绑定在 <code>TCPAddress</code> 地址的 TCP 端口号。默认端口是 <code>5817</code>。</p>
</dd>
<dt class="hdlist1">UDPAddress</dt>
<dd>
<p><code>Eventd</code> XML/UDP 侦听器绑定的 IP 地址。默认是 <code>127.0.0.1</code>。</p>
</dd>
<dt class="hdlist1">UDPPort</dt>
<dd>
<p><code>Eventd</code> XML/UDP 侦听器绑定的 <code>TCPAddress</code> 地址的 UDP 端口号。默认端口是 <code>5817</code>。</p>
</dd>
<dt class="hdlist1">receivers</dt>
<dd>
<p>分配的线程数，由 <code>Eventd</code> 完成事件接收工作。</p>
</dd>
<dt class="hdlist1">queueLength</dt>
<dd>
<p>可以排队等待处理的最大事件数。其它超出事件将被删除。默认为无限制。</p>
</dd>
<dt class="hdlist1">getNextEventID</dt>
<dd>
<p>用于检索下一个新建事件 ID 的 SQL 查询语句。不建议修改此设置。</p>
</dd>
<dt class="hdlist1">socketSoTimeoutRequired</dt>
<dd>
<p>是否在 <code>Eventd</code> 接收 socket 上设置超时值。</p>
</dd>
<dt class="hdlist1">socketSoTimeoutPeriod</dt>
<dd>
<p>socket 超时，以毫秒为单位，当 <code>socketSoTimeoutRequired</code> 设置为 <code>yes</code>，才有效。</p>
</dd>
<dt class="hdlist1">logEventSummaries</dt>
<dd>
<p>是否在 <code>INFO</code> 级别下记录每个事件的简单 (精简) 摘要信息。在繁忙的生产系统上开启 <code>DEBUG</code> 日志不实际，但这个选项对事件的故障处理很有用。</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_配置文件_eventconf_xml_及其分支配置">6.4.2. 配置文件 eventconf.xml 及其分支配置</h4>
<div class="paragraph">
<p>已知事件集合在 <code>OPENNMS_HOME/etc/eventconf.xml</code> 中配置。
该文件以 <code>&lt;global&gt;</code> 元素开始，该元素的 <code>&lt;security&gt;</code> 子元素用来定义哪些事件字段不得重写，对于 <code>Eventd</code> 侦听器提交的事件的主体中。
这种机制阻止仿冒，例如，发送事件的 <code>operator-action</code> 字段用来钓鱼攻击。</p>
</div>
<div class="paragraph">
<p>在 <code>&lt;global&gt;</code> 元素之后，该文件由一系列 <code>&lt;event-file&gt;</code> 元素组成。
每个 <code>&lt;event-file&gt;</code> 元素的内容指定 <strong>分支文件</strong> 的路径，该文件的内容将被读取并合并到事件配置中。
这些路径相对于 <code>OPENNMS_HOME/etc</code> 目录进行解析；不允许绝对路径。</p>
</div>
<div class="paragraph">
<p>每个 <strong>分支文件</strong> 都包含一个顶层 <code>&lt;events&gt;</code> 元素，下面是一个或多个 <code>&lt;event&gt;</code> 子元素。
重点说明以下事件定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">   &lt;event&gt;
      &lt;uei&gt;uei.opennms.org/nodes/nodeLostService&lt;/uei&gt;
      &lt;event-label&gt;OpenNMS-defined node event: nodeLostService&lt;/event-label&gt;
      &lt;descr&gt;&amp;lt;p&gt;A %service% outage was identified on interface
            %interface% because of the following condition: %parm[eventReason]%.&amp;lt;/p&gt; &amp;lt;p&gt;
            A new Outage record has been created and service level
            availability calculations will be impacted until this outage is
            resolved.&amp;lt;/p&gt;&lt;/descr&gt;
      &lt;logmsg dest="logndisplay"&gt;
            %service% outage identified on interface %interface%.
        &lt;/logmsg&gt;
      &lt;severity&gt;Minor&lt;/severity&gt;
      &lt;alarm-data reduction-key="%uei%:%dpname%:%nodeid%:%interface%:%service%" alarm-type="1" auto-clean="false"/&gt;
   &lt;/event&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>每个事件定义都具有相同的基本结构。
有关结构元素的说明，请参阅 <a href="#ga-events-anatomy-of-an-event">事件剖析</a>。</p>
</div>
<div class="paragraph">
<div class="title">关于级别（告警严重程度）说明</div>
<p>在设置事件的严重性时，将每个事件作为一个整体考虑在基础设施上下文中是很重要的。
事件在某个设备上需要是 critical（严重）级别，而在整个企业网络视图中未必需要是 <code>Critical</code>（严重）的级别的。
由于具有 <code>Critical</code> 严重级别的事件已经不能升级告警级别了，因此通常是对业务具有非常关键影响的事件才设置为 critical（严重）级别。
Rock legend Nigel Tufnel 为这个主题提供了 <a href="https://www.youtube.com/watch?v=4xgx4k83zzc">一些指导</a>。</p>
</div>
<div class="paragraph">
<div class="title">标签替换</div>
<p>在每个事件的描述、日志信息、操作指令和自动操作中可以包含各种标签。
在构造事件的文本中，这些标签将被当前事件的值替换。
并非所有事件都具有所有标签值，有些专门引用信息仅从 SNMP traps 派生的事件中可用。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%eventid%</code></dt>
<dd>
<p>事件的数据库数字 ID</p>
</dd>
<dt class="hdlist1"><code>%uei%</code></dt>
<dd>
<p>事件的通用事件标识符。</p>
</dd>
<dt class="hdlist1"><code>%source%</code></dt>
<dd>
<p>事件的源 (OpenNMS Horizon 的系统模块创建了它)。</p>
</dd>
<dt class="hdlist1"><code>%time%</code></dt>
<dd>
<p>事件发生的时间。</p>
</dd>
<dt class="hdlist1"><code>%dpname%</code></dt>
<dd>
<p>接收到事件的 Minion (原来的分布式轮询) 的 ID。</p>
</dd>
<dt class="hdlist1"><code>%nodeid%</code></dt>
<dd>
<p>引发事件的设备的 ID，如果有的话。</p>
</dd>
<dt class="hdlist1"><code>%nodelabel%</code></dt>
<dd>
<p>如果可用，则在 <code>%nodeid%</code> 给出的设备的名称。</p>
</dd>
<dt class="hdlist1"><code>%host%</code></dt>
<dt class="hdlist1"><code>%interface%</code></dt>
<dd>
<p>与事件关联的 IP 接口，如果存在。</p>
</dd>
<dt class="hdlist1"><code>%interfaceresolv%</code></dt>
<dd>
<p>对 <code>%interface%</code> 进行反向查询，如果可用则返回其名称。</p>
</dd>
<dt class="hdlist1"><code>%service%</code></dt>
<dd>
<p>与事件关联的服务，如果存在。</p>
</dd>
<dt class="hdlist1"><code>%severity%</code></dt>
<dd>
<p>事件的严重级别。</p>
</dd>
<dt class="hdlist1"><code>%snmphost%</code></dt>
<dd>
<p>生成事件的 SNMP 代理的主机。</p>
</dd>
<dt class="hdlist1"><code>%id%</code></dt>
<dd>
<p>事件的 SNMP Enterprise OID。</p>
</dd>
<dt class="hdlist1"><code>%idtext%</code></dt>
<dd>
<p>解码事件 (可读的) SNMP Enterprise OID (?)。</p>
</dd>
<dt class="hdlist1"><code>%ifalias%</code></dt>
<dd>
<p>接口的 SNMP ifAlias。</p>
</dd>
<dt class="hdlist1"><code>%generic%</code></dt>
<dd>
<p>事件的通用(Generic) trap-type 号。</p>
</dd>
<dt class="hdlist1"><code>%specific%</code></dt>
<dd>
<p>事件的特定(Specific) trap-type 号。</p>
</dd>
<dt class="hdlist1"><code>%community%</code></dt>
<dd>
<p>Trap 的团体名(community string)。</p>
</dd>
<dt class="hdlist1"><code>%version%</code></dt>
<dd>
<p>Trap 的 SNMP 版本。</p>
</dd>
<dt class="hdlist1"><code>%snmp%</code></dt>
<dd>
<p>与事件关联的 SNMP 信息。</p>
</dd>
<dt class="hdlist1"><code>%operinstruct%</code></dt>
<dd>
<p>该事件的操作员指令。</p>
</dd>
<dt class="hdlist1"><code>%mouseovertext%</code></dt>
<dd>
<p>事件的鼠标悬浮文本。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">参数标签</div>
<p>许多事件在 <strong>参数</strong> 中携带附加信息 (参见 <a href="#ga-events-anatomy-of-an-event">事件剖析 </a>)。
这些参数可以在 SNMP trap <strong>variable bindings（变量绑定）</strong> 或 <strong>varbinds</strong> 简写中。
可以使用 <code>parm</code> 替换标签访问事件中的参数，该标签具有多种形式：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>%parm[all]%</code></dt>
<dd>
<p>通过类似 <code>parmName1="parmValue1" parmName2="parmValue2"</code> 方式列出所有参数值。</p>
</dd>
<dt class="hdlist1"><code>%parm[values-all]%</code></dt>
<dd>
<p>列出事件关联的所有参数值 (不包含参数名)。</p>
</dd>
<dt class="hdlist1"><code>%parm[names-all]%</code></dt>
<dd>
<p>列出事件关联的所有参数名称 (不包含参数值)。</p>
</dd>
<dt class="hdlist1"><code>%parm[&lt;name&gt;]%</code></dt>
<dd>
<p>如果存在，将返回 <code>&lt;name&gt;</code> 名称的参数值。</p>
</dd>
<dt class="hdlist1"><code>%parm[##]%</code></dt>
<dd>
<p>返回参数总数。</p>
</dd>
<dt class="hdlist1"><code>%parm[#&lt;num&gt;]%</code></dt>
<dd>
<p>将返回第 <code>&lt;num&gt;</code> (一个索引) 个参数的值。</p>
</dd>
<dt class="hdlist1"><code>%parm[name-#&lt;num&gt;]%</code></dt>
<dd>
<p>将返回相应名称第 <code>&lt;num&gt;</code> (一个索引) 个参数的值。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">关于 <code>eventconf.xml</code> 分支文件的结构</div>
<p>事件定义的排序非常重要，因为接收的事件会按照顺序与它们匹配。
对于给定事件可以匹配多个事件定义的情况，例如，基于 SNMP trap 变量绑定值进行区分，是很有用的。</p>
</div>
<div class="paragraph">
<p>通过 <code>&lt;event-file&gt;</code> 标签引入的分支文件可以用来区分供应商。当 OpenNMS Horizon 启动时，每个分支文件会按顺序加载。
每个分支文件内事件的顺序也会保留。</p>
</div>
<div class="paragraph">
<p>在配置文件 <code>eventconf.xml</code> 的末尾列出的分支文件包含匹配所有事件的定义。
当放置自己的事件定义时，请注意不要将它们放在这些 catch-all（匹配所有）分支文件的下面；否则你的事件定义将不可访问。</p>
</div>
<div class="ulist">
<div class="title">关键点</div>
<ul>
<li>
<p>为了节省内存和缩短启动时间，你可能希望删除不需要的事件定义文件。</p>
</li>
<li>
<p>如果需要在缺省分支文件中自定义一些事件，则可能希望将自定义事件放在一个文件中，并将该文件放在原始文件的上方；这样将更容易维护定制文件，在将来使用新版本 OpenNMS Horizon 时。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_重新加载事件配置">6.4.3. 重新加载事件配置</h4>
<div class="paragraph">
<p>在对 <code>OPENNMS_HOME/etc/eventconf.xml</code> 或其它任何分支文件手动更改之后，可以通过在 OpenNMS Horizon 服务器上发出以下命令来触发事件配置重建加载：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">OPENNMS_HOME/bin/send-event.pl uei.opennms.org/internal/reloadDaemonConfig -p 'daemonName Eventd'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_调试_2">6.5. 调试</h3>
<div class="paragraph">
<p>在调试事件时，降低 <code>Eventd</code> 的日志级别是有帮助的，默认级别是 <code>WARN</code>。
若要更改此设置，请编辑 <code>OPENNMS_HOME/etc/log4j2.xml</code> 文件，并找到相关记录行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">        &lt;KeyValuePair key="eventd"               value="WARN" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>更改 <code>log42.xml</code> 配置后将在60秒内生效，不需要额外操作。
在 <code>DEBUG</code> 级别，<code>Eventd</code>（事件模块）将记录它所处理的每个事件的详细描述，并保存到 <code>OPENNMS_HOME/logs/eventd.log</code>。
在繁忙的系统中，这样设置可能会产生太多困扰并且不利于工作。
在这种情况下，可以通过设置 <code>Eventd</code> 设置 <code>INFO</code> 日志级别并且在 <code>OPENNMS_HOME/etc/eventd-configuration.xml</code> 中设置 <code>logEventSummaries="yes"</code> 来获得简洁的事件摘要。
注意，更改 <code>eventd-configuration.xml</code> 文件后需要重新启动 OpenNMS Horizon。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-alarms">7. 告警</h2>
<div class="sectionbody">
<div id="ga-alarmd-introduction" class="paragraph">
<p><em>OpenNMS Horizon</em> 能够监控其托管实体 (ME)，它们的资源，它们提供的服务以及它们托管的应用程序的问题状态；或者更简单地说，监控网络。</p>
</div>
<div class="paragraph">
<div class="title">首先，是事件</div>
<p>在 Alarmd 创建告警之前，OpenNMS 的事件(或消息)不仅用作进程间通信消息(IPC)，而且还用作网络中问题的指示。
即使到今天，OpenNMS 事件仍然带有问题状态属性，例如：确认和严重级别。
然而，由于告警被用作网络中问题的指示，这些属性功能早就被弃用了 (参见相关 <a href="#ga-bsm-introduction">业务服务</a>)。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
随着 Horizon 23.0.0 (H23) 版本发布，发生了明显的变化。
在 H23 之前，并且自从 OpenNMS 引入告警以来，Alarmd 就被设计成使用两种告警来跟踪问题的状态；<em>Down</em> 和 <em>Up</em> 告警。
现在，OpenNMS 的设计意图是使用单个告警来跟踪问题的状态。
可以通过设置系统属性 org.opennms.alarmd.legacyAlarmState = true 来重新启用旧的特性。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_单告警跟踪问题状态">7.1. 单告警跟踪问题状态</h3>
<div class="paragraph">
<div class="title">首次出现服务 Down 问题 (SNMP)，产生告警</div>
<p><span class="image"><img src="images/alarms/single_alarm_1.png" alt="single alarm 1"></span></p>
</div>
<div class="paragraph">
<div class="title">轮询器的服务 Down 事件 (通过单击告警次数)</div>
<p><span class="image"><img src="images/alarms/single_alarm_2.png" alt="single alarm 2"></span></p>
</div>
<div class="paragraph">
<div class="title">告警立即清除 (不再为正常状态创建单独的告警)</div>
<p><span class="image"><img src="images/alarms/single_alarm_3.png" alt="single alarm 3"></span></p>
</div>
<div class="paragraph">
<div class="title">轮询器中服务 Down 和服务恢复两个事件</div>
<p><span class="image"><img src="images/alarms/single_alarm_4.png" alt="single alarm 4"></span></p>
</div>
<div class="paragraph">
<div class="title">第二次出现服务 Down 问题 (SNMP)，告警压缩</div>
<p><span class="image"><img src="images/alarms/single_alarm_5.png" alt="single alarm 5"></span></p>
</div>
<div class="paragraph">
<div class="title">轮询器中服务 Down 事件和之前服务恢复事件</div>
<p><span class="image"><img src="images/alarms/single_alarm_6.png" alt="single alarm 6"></span></p>
</div>
<div class="paragraph">
<div class="title">告警再次立即清除 (告警次数不递增)</div>
<p><span class="image"><img src="images/alarms/single_alarm_7.png" alt="single alarm 7"></span></p>
</div>
<div class="paragraph">
<div class="title">服务 Down 和恢复事件</div>
<p><span class="image"><img src="images/alarms/single_alarm_8.png" alt="single alarm 8"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_告警模块">7.2. 告警模块</h3>
<div class="paragraph">
<p>Alarmd 是告警服务模块，用来处理网络中表现问题的事件的基本功能。
首先，它根据跟踪问题创建新告警，其次，也会对重复出现的问题事件合并到相同告警中（也称为告警压缩）。</p>
</div>
<div class="paragraph">
<p>在 OpenNMS Horizon version 23.0.0 (H23) 版本之前，Alarmd 不需要配置。H23 版本发布后，Drools 现在直接嵌入到 Alarmd 的事件处理功能。
通过有效管理网络中的工作流和问题状态，为用户提供了更稳固的基础设施。
业务规则现在取代了之前 Vacuumd 中的 ''Automations'' 功能。
你可以在 etc/alarmd/drools-rules.d/ 文件夹中找到这些新的业务规则。</p>
</div>
<div class="literalblock">
<div class="title">$OPENNMS_ETC/.drools-rules.d/</div>
<div class="content">
<pre>alarmd.drl</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-alarmd-configuration">7.3. 配置告警</h3>
<div class="paragraph">
<p>因为 Alarmd 实例的告警来自事件，在 <em>OpenNMS Horizon</em> 中定义告警，只需要在事件定义添加额外 XML 元素来标识网络中的问题或处理方式。
这个附加元素是 "alarm-data" 元素。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 logmsg 元素的 "dest" 属性中标记为 "donotpersist" 的任何事件，都不会作为告警处理。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">告警数据模型定义 (XSD)</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-XML" data-lang="XML">&lt;element name="alarm-data"&gt;
  &lt;annotation&gt;
    &lt;documentation&gt;This element is used for converting events into alarms.&lt;/documentation&gt;
  &lt;/annotation&gt;
  &lt;complexType&gt;
    &lt;sequence&gt;
      &lt;element ref="this:update-field" minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/sequence&gt;
    &lt;attribute name="reduction-key" type="string" use="required" /&gt;
    &lt;attribute name="alarm-type" use="required" &gt;
      &lt;simpleType&gt;
        &lt;restriction base="int"&gt;
          &lt;minInclusive value="1"/&gt;
        &lt;/restriction&gt;
      &lt;/simpleType&gt;
    &lt;/attribute&gt;
    &lt;attribute name="clear-key" type="string" use="optional" /&gt;
    &lt;attribute name="auto-clean" type="boolean" use="optional" default="false" /&gt;
    &lt;attribute name="x733-alarm-type" type="this:x733-alarm-type" use="optional" /&gt;
    &lt;attribute name="x733-probable-cause" type="int" use="optional" /&gt;
  &lt;/complexType&gt;
&lt;/element&gt;

&lt;element name="update-field"&gt;
  &lt;complexType&gt;
    &lt;attribute name="field-name" type="string" use="required" /&gt;
    &lt;attribute name="update-on-reduction" type="boolean" use="optional" default="true" /&gt;
    &lt;attribute name="value-expression" type="string" use="optional" default="" /&gt;
  &lt;/complexType&gt;
&lt;/element&gt;

&lt;simpleType name="x733-alarm-type"&gt;
  &lt;restriction base="string" &gt;
    &lt;pattern value="CommunicationsAlarm|ProcessingErrorAlarm|EnvironmentalAlarm|QualityOfServiceAlarm|EquipmentAlarm|IntegrityViolation|SecurityViolation|TimeDomainViolation|OperationalViolation|PhysicalViolation" /&gt;
  &lt;/restriction&gt;
&lt;/simpleType&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE</strong>
参考: <a href="#ga-events-anatomy-of-an-event">事件分析</a></p>
</div>
<div class="paragraph">
<div class="title">reduction-key（还原键）</div>
<p>在定义事件的 alarm-data 的关键属性是 <em>reduction-key</em>。
这个属性可以包含文本字符串和引用事件的属性 (字段和参数)。
reduction-key 是用来唯一标识明确问题，同时，也用来减少 (去重复)事件，以便只实例化一个问题告警。
通常，事件标识符 (UEI) 用作 reduction-key 的左边（最宽泛）部分，接下来是事件的其它属性，从最宽泛到最具体，并且一般使用 ':' 分隔。</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. 具体构成 reduction-key</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-XML" data-lang="XML">&lt;event&gt;
   &lt;uei&gt;uei.opennms.org/nodes/nodeDown&lt;/uei&gt;
...
   &lt;alarm-data reduction-key="%uei%:%dpname%:%nodeid%" alarm-type="1" auto-clean="false"/&gt;
&lt;/event&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. 宽泛构成 reduction-key 属性</div>
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
减少构成 reduction-key 的项目是一种汇聚方式，例如，将所有设备 down 汇聚到一个告警中。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-XML" data-lang="XML">&lt;event&gt;
  &lt;uei&gt;uei.opennms.org/nodes/nodeDown&lt;/uei&gt;
  &lt;alarm-data reduction-key="%uei%" alarm-type="1"/&gt;
&lt;/event&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用此 reduction-key，轮询的所有设备 down，将汇总到一个告警中。
将有一个单独的告警，告警次数将是设备 down 的数量。
然而，当 UEI uei.opennms.org/nodes/nodeUp 作为该告警的清除告警配置项，<strong>不是</strong> 一个很好 ''搭配''，因为只要有一个 ''设备 up'' 时，所有的设备 down 记录都将被清除，在这种配置下。</p>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">属性 alarm-type</div>
<p>第二个重要属性是 alarm-type。
目前有三种类型告警: 问题 problem (1), 恢复 resolution (2), 和 通知 notification (3)。
属性 alarm-type 帮助 Alarmd 关联恢复处理，来匹配恢复事件和问题事件。</p>
</div>
<div class="paragraph">
<div class="title">属性 clear-key</div>
<p>Alarmd 使用该属性进行关联。
当配置恢复告警时，设置此属性与相应的问题告警的 reduction-key 相匹配。</p>
</div>
<div class="paragraph">
<div class="title">属性 auto-clean</div>
<p>此属性指示 Alarmd 只保留相应告警的最新事件。
对于非常频繁的告警，这是一种减少数据库中最近事件的方法。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
不要将此特性用于成对相关性的告警 (匹配问题告警和恢复告警)。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">元素 update-field</div>
<p>使用此元素可以覆盖 Alarmd 的默认行为，在告警压缩期间可以更新某些字段。
当前允许处理的告警字段是：</p>
</div>
<div class="ulist">
<div class="title">项目</div>
<ul>
<li>
<p>distpoller</p>
</li>
<li>
<p>ipaddr</p>
</li>
<li>
<p>mouseover</p>
</li>
<li>
<p>operinstruct</p>
</li>
<li>
<p>severity</p>
</li>
<li>
<p>descr</p>
</li>
<li>
<p>acktime</p>
</li>
<li>
<p>ackuser</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 H23 中使用新的单告警行为，如果告警从 alarm-type 2 转换回 alarm-type 1，则告警级别（Severity）将设置为事件中级别最大的。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">压缩（重复）告警</div>
<p>Alarmd 可以将多次出现的告警压缩为单次告警。</p>
</div>
<div class="paragraph">
<div class="title">关联关系</div>
<p>Alarmd 可以自动匹配现有告警的恢复事件。
问题告警与相匹配的恢复问题告警 (Ups 与相应 Downs)，应该用 alarm-type 属性指示。</p>
</div>
<div class="ulist">
<div class="title">项目</div>
<ul>
<li>
<p>alarm-type="1" (问题告警)</p>
</li>
<li>
<p>alarm-type="2" (恢复告警)</p>
</li>
<li>
<p>alarm-type="3" (通知告警，像 SNMP 身份验证失败这类告警没有恢复告警。)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">为现有已清除告警生成新记录</div>
在新版本 H23 中，可以设置压缩已清除告警的全局属性。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在 $OPENNMS_ETC/opennms.properties.d/ 文件夹中创建一个 alarmd.properties 属性文件，并将以下属性设置为 true：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>###### Alarmd Properties ######
#
# Enable this property to force Alarmd to create new alarms when an problem re-occurs and the
# existing Alarm is in a "Cleared" state.
#
# Default: false
#org.opennms.alarmd.newIfClearedAlarmExists = false
org.opennms.alarmd.newIfClearedAlarmExists = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，使用此属性设置，当发生重复事件并且当前问题告警的状态是 "Cleared" 时，将创建告警的新实例，而不是将当前告警设置回默认严重级别并增加告警次数。
.设备存在清除告警情况下，产生新设备 down 告警
<span class="image"><img src="images/alarms/new_after_clear_3.png" alt="new after clear 3"></span></p>
</div>
<div class="paragraph">
<p>此时，Alarmd 会改变现有告警的压缩关键字 reductionKey。
从而防止它再次用于网络中重新出现的问题 (字符 ":ID:" 和告警 ID 值将附加到 reductionKey)。</p>
</div>
<div class="paragraph">
<div class="title">更改 reductionKey</div>
<p><span class="image"><img src="images/alarms/new_after_clear_4.png" alt="new after clear 4"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">重新启用传统双告警状态</div>
在 H23 版本中，可以设置全局属性来重新启用传统的双告警特性。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在 $OPENNMS_ETC/opennms.properties.d/ 文件夹中创建一个名为 alarmd.properties 的属性文件，并将以下属性设置为 true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>###### Alarmd Properties ######
# Enable this property to have the traditional dual alarm handling of alarms state
# for Alarm pairwise correlation.
# Default: false
#org.opennms.alarmd.legacyAlarmState = false
org.opennms.alarmd.legacyAlarmState = true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
设置 legacyAlarmState 之后，将使 newIfClearedAlarmExists 无效。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-alarm-notes">7.4. 告警注释</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 为网络中的问题创建一个 <em>告警</em> 。
共享当前的 <em>告警</em> 信息，对于团队工作中的人是有帮助的。
<em>告警注释</em> 可以将特定一类 <em>告警</em> 标记一个注释。
下图 <a href="#gu-alarm-notes-ui">告警详细图</a> 显示将 <em>备忘录</em> 信息添加到 <em>告警</em> 中。</p>
</div>
<div id="ga-alarm-notes-ui" class="paragraph">
<div class="title">告警详细图</div>
<p><span class="image"><img src="images/alarms/01_alarm-notes.png" alt="01 alarm notes"></span></p>
</div>
<div class="paragraph">
<p><em>告警注释</em> 允许在现有 <em>告警</em> 或 <em>告警类</em> 中添加两种类型注释:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>关联备忘录</em>: 用户对指定 <em>告警</em> 定义的特定备注。
删除 <em>告警</em> 后关联备忘录也会删除。</p>
</li>
<li>
<p><em>日志备忘录</em>: 用户基于告警恢复关键字对一类告警定义的备注。
-日志备忘录_ 将显示在所有的匹配指定告警恢复关键字的告警上。
删除一条 <em>告警</em> 不会删除 <em>日志备忘录</em>, 可以通过包含 <em>日志备忘录</em> 的 <em>告警</em> 上的"清除"按钮来移除。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果一条 <em>告警</em> 包含 <em>关联/日志备忘录</em> ，将会在"告警概览列表"和"告警详细列表"中由两个图标表示。</p>
</div>
</div>
<div class="sect2">
<h3 id="ga-alarm-sounds">7.5. 告警声音</h3>
<div class="paragraph">
<p>通常用户希望听到声音提示，当告警状态改变的时候。
<em>OpenNMS Horizon</em> 告警列表页面可以选择在产生新告警或每个告警事件数量改变时是否产生声音提示。</p>
</div>
<div class="paragraph">
<p>下图 <a href="#ga-alarm-sounds-ui">告警声音图</a> 显示了启用告警声音的告警列表页面。</p>
</div>
<div id="ga-alarm-sounds-ui" class="paragraph">
<div class="title">告警声音图</div>
<p><span class="image"><img src="images/alarms/01_alarm-sound.png" alt="01 alarm sound"></span></p>
</div>
<div class="paragraph">
<p>默认情况下，告警声音功能被禁用。系统管理员必须声音告警功能，也可以为所有用户设置默认声音。
同时，用户可以使用下拉菜单修改默认声音设置，包括如下选项：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>声音关闭: 页面不产生声音提示。</p>
</li>
<li>
<p>新告警声音: 有新告警时产生声音提示。</p>
</li>
<li>
<p>告警数量声音: 告警页面上告警事件数量每次增加将产生声音提示。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_活动告警闪烁">7.6. 活动告警闪烁</h3>
<div class="paragraph">
<p>默认情况下， <em>OpenNMS Horizon</em> 可以使用单独确认和活动告警选项卡显示告警列表。
在一些环境下，可以在同一个页面上看到闪烁的所有活动告警，表明这些告警还没有被用户注意到。
这样可以使每个人清楚的看到所有告警的实时状态，并且引起注意。</p>
</div>
<div class="paragraph">
<p>下图 <a href="#ga-alarm-sounds-ui">告警声音图</a> 启用了闪烁的活动告警列表页面。
活动告警持续的闪烁。
已确认的告警不会闪烁，并且在选择框旁还有一个勾选框。
所有的告警可以选择升级、清除、确认、和取消确认。</p>
</div>
</div>
<div class="sect2">
<h3 id="_配置告警声音和闪烁">7.7. 配置告警声音和闪烁</h3>
<div class="paragraph">
<p>默认情况下， <em>OpenNMS Horizon</em> 没有启用告警声音或闪烁告警。
默认设置保存在 opennms.properties 配置文件中。
但是，系统管理员不应该编辑 opennms.properties 配置文件，而是通过在 opennms.properties.d 目录下创建一个新配置文件来启用下面的这些功能：</p>
</div>
<div class="paragraph">
<p><code>${OPENNMS_HOME}/etc/opennms.properties.d/alarm.listpage.properties</code></p>
</div>
<div class="listingblock">
<div class="title">与告警声音和闪烁相关的配置属性</div>
<div class="content">
<pre class="prettyprint highlight"><code># ###### Alarm List Page Options ######
# Several options are available to change the default behaviour of the Alarm List Page.
# &lt;opennms url&gt;/opennms/alarm/list.htm
#
# The alarm list page has the ability to generate a sound either on each new alarm
# or (more annoyingly) on each change to an alarm event count on the page.
#
# Turn on the sound feature. Set true and Alarm List Pages can generate sounds in the web browser.
opennms.alarmlist.sound.enable=true
#
# Set the default setting for how the Alarm List Pages generates sounds. The default setting can be
# modified by users for the duration of their logged-in session using a drop down menu .
#    off = no sounds generated by the page.
#    newalarm = sounds generated for every new alarm in the page
#    newalarmcount = sounds generated for every increase in alarm event count for alarms on the page
#
opennms.alarmlist.sound.status=off

# By default the alarm list page displays acknowledged and unacknowledged alarms in separate search tabs
# Some users have asked to be able to see both on the same page. This option allows the alarm list page
# to display acknowledged and unacknowledged alarms on the same list but unacknowledged alarms
# flash until they are acknowledged.
#
opennms.alarmlist.unackflash=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>播放的声音由以下文件的内容决定 <code>${OPENNMS_HOME}/jetty-webapps/opennms/sounds/alert.wav</code></p>
</div>
<div class="paragraph">
<p>如果你想改变声音，使用你的声音命名为 <code>alert.wav</code> ，并且替换到这个目录下。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-notifications">8. 通知</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ga-notifications-introduction">8.1. 介绍</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 系统使用通知功能来让用户知道发生的事件。
常见的通知方法是电子邮件和呼机，也可以使用如下通知机制：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>任意 HTTP GET and POST 操作</p>
</li>
<li>
<p>任意外部命令</p>
</li>
<li>
<p>Asterisk 始发呼叫</p>
</li>
<li>
<p>IRCcat 互联网多线交谈终端</p>
</li>
<li>
<p>SNMP Traps</p>
</li>
<li>
<p>Slack, Mattermost, 和其它 API-兼容的聊天平台</p>
</li>
<li>
<p>Twitter, GNU 社交, 和其它 API-兼容的微博服务</p>
</li>
<li>
<p>任何兼容 JSR-223 语言的用户脚本</p>
</li>
<li>
<p>XMPP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>当在 <em>OpenNMS Horizon</em> 中发生选定的事件时，<em>通知</em> 模块根据配置的规则创建和发送通知。</p>
</div>
</div>
<div class="sect2">
<h3 id="ga-notifications-getting-started">8.2. 入门</h3>
<div class="paragraph">
<p>通知的状态由 Web UI 导航栏右上方的图标指示。
<em>OpenNMS Horizon</em> 安装默认情况下禁用全局通知。</p>
</div>
<div class="sect3">
<h4 id="_启用通知">8.2.1. 启用通知</h4>
<div class="paragraph">
<p>若要启用 <em>OpenNMS Horizon</em> 中的通知, 请使用管理员用户登录到 Web UI。在用户图标上悬停，然后单击 <em>配置 OpenNMS</em> 链接。
全局通知状态的控件是在上层通知菜单中，名为 <em>通知状态</em> 。
单击 <em>启用</em> 按钮然后单击 <em>更新</em> 按钮。
现在，通知功能全局启用了。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
上面的 Web 操作流程相当于编辑 <code>notifd-configuration.xml</code> 文件，然后在 <code>notifd-configuration</code> 元素上 设置 <code>status="on"</code> 是相同的效果。
此配置文件更改不需要重新启动或发送事件，就可以立即生效。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_配置目标路径">8.2.2. 配置目标路径</h4>
<div class="paragraph">
<p>若要在 <em>OpenNMS Horizon</em> 中配置通知的目的路径，请浏览 <em>配置 OpenNMS</em> 然后在 <em>事件管理</em> 部分中选择 <em>配置通知</em> 。
在结果对话框中选择 <em>配置目的路径</em> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
目的路径配置存储在 <code>destinationPaths.xml</code> 文件中。
对该文件更改后是不需要重新启动或发送事件，就可以立即生效。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_配置事件通知">8.2.3. 配置事件通知</h4>
<div class="paragraph">
<p>若要在 <em>OpenNMS Horizon</em> 中配置单个事件的通知，请浏览 <em>配置 OpenNMS</em> 然后在 <em>事件管理</em> 部分中选择 <em>配置通知</em> 。
然后选择 <em>配置事件通知</em> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
事件通知配置存储在 <code>notifications.xml</code> 文件中。
对该文件更改后是不需要重新启动或发送事件，就可以立即生效。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认情况下，OpenNMS 执行与事件的 uei 匹配的所有通知的目的路径。
可以通过编辑 <code>notifd-configuration.xml</code> 文件并在顶层 <code>notifd-configuration</code> 元素设置 <code>match-all="false"</code> 来配置 OpenNMS 只执行第一个匹配通知的目的路径。
不需要重新启动或发送变更事件，就可以动态获取配置文件更改。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-notifications-concepts">8.3. 概念</h3>
<div class="paragraph">
<p><em>通知</em> 是 <em>OpenNMS Horizon</em> 系统报告用户发生在网络中的事件的方式，并且用户无需登录和查看 UI。
理解通知所需的核心概念是:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>事件和 UEIs</p>
</li>
<li>
<p>用户，组和计划角色</p>
</li>
<li>
<p>值班计划</p>
</li>
<li>
<p>目的路径</p>
</li>
<li>
<p>通知命令</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些概念组合在一起形成了一个 <em>事件通知定义</em> 。
与此相关，与通知简单关联的也有 <em>告警</em> 和 <em>确认</em>。</p>
</div>
<div class="sect3">
<h4 id="_事件和_ueis">8.3.1. 事件和 UEIs</h4>
<div class="paragraph">
<p>正如 <a href="#ga-events">事件</a> 一章中所讨论的，事件是 <em>OpenNMS Horizon</em> 系统操作的中心。
在系统中发送的所有事情都是一个或多个事件的结果或原因，每个通知都是由事件触发的。
因此，对事件的良好理解是对通知工作原理所必不可少的。</p>
</div>
<div class="paragraph">
<p>每个事件都有一个 <em>UEI</em> (统一事件标识), 一个唯一标识事件类型的字符串。
UEIs 通常以 URI 格式的样式，只是以字符串 <code>uei.</code> 开头。
大多数通知是由一个精确的 UEI 匹配触发的 (尽管它们也可以使用正则表达式匹配部分 UEI 来触发)。</p>
</div>
</div>
<div class="sect3">
<h4 id="_用户组和计划角色">8.3.2. 用户，组，和计划角色</h4>
<div class="paragraph">
<p><em>用户</em> 在 <em>OpenNMS Horizon</em> 系统中是可以登录的账户。
理论上，每个用户对应一个人。
它们用来控制 web UI 的访问，但也为它们所代表的人携带联系信息 (e-mail 地址，电话号码等) 。
用户可以单独或作为组和计划角色的一部分接收通知。
每个用户都有几个基于特定技术的联络信息字段，如果用户要通过相关方法接收通知，则必须填写这些字段。</p>
</div>
<div class="paragraph">
<p><em>组</em> 是用户列表。
在拥有大量用户的大型系统中，将它们组织成一个 <em>组</em> 是有帮助的。
组可以接收通知，这通常比单个用户操作更方便。
<em>组</em> 允许分配一些用户给计划角色，来构建更复杂的通知工作流。</p>
</div>
<div class="olist arabic">
<div class="title">如何创建或修改 <em>组</em> 中的 <em>用户</em> 成员</div>
<ol class="arabic">
<li>
<p>以管理员权限 <strong>用户</strong> 登录</p>
</li>
<li>
<p>从用户特定的主导航菜单中选择 <strong>配置 OpenNMS</strong> ，在登录用户名相应菜单下面</p>
</li>
<li>
<p>选择 <strong>配置用户，组和计划角色</strong>，然后选择 <strong>配置组</strong></p>
</li>
<li>
<p>创建一个新的 <strong>组</strong> 通过 <strong>添加新的组</strong> 或修改一个存在的 <strong>组</strong> 通过单击 <strong>组</strong> 旁边的 <strong>修改</strong> 图标</p>
</li>
<li>
<p>从 <strong>可用的用户</strong> 中使用 <strong>&gt;&gt;</strong> 将它们添加到 <strong>当前的组</strong> 中，或者从 <strong>当前的用户</strong> 中使用 <strong>&lt;&lt;</strong> 从列表中删除它们。</p>
</li>
<li>
<p>单击 <strong>完成</strong> 来保存并应用更改</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
组中的 <em>用户</em> 是有顺序的，并且用作在 <em>目标路径</em> 中作为 <em>目标</em> 发送 <em>通知</em> 的顺序。
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">如何删除一个 <em>组</em></div>
<ol class="arabic">
<li>
<p>以管理员权限 <strong>用户</strong> 登录</p>
</li>
<li>
<p>从用户特定的主导航菜单中选择 <strong>配置 OpenNMS</strong> ，在登录用户名相应菜单下面</p>
</li>
<li>
<p>选择 <strong>配置用户，组和计划角色</strong>，然后选择 <strong>配置组</strong></p>
</li>
<li>
<p>使用 <em>组</em> 旁边的垃圾桶图标删除</p>
</li>
<li>
<p>用 <strong>OK</strong> 确认删除请求</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>计划角色</em> 的有效顺序是在组之上的，目的是使 <em>OpenNMS Horizon</em> 的通知目标用户遵照日程表配置。
一个常见的用例是让系统工程师在一个给定的时间表上进行轮换。
<em>计划角色</em> 允许将一个预定于的 <em>计划任务</em> 分配给一个现有的 <em>组</em> 里的 <em>用户</em>。
对于每个 <em>计划角色</em> ，要有一个 <em>用户</em> 被指派为 <em>负责人</em> 用来监管这个 <em>计划角色</em> 里的一组人。</p>
</div>
<div class="olist arabic">
<div class="title">如何将 <em>组</em> 分配给 <em>计划角色</em></div>
<ol class="arabic">
<li>
<p>以管理员权限 <strong>用户</strong> 登录</p>
</li>
<li>
<p>从用户特定的主导航菜单中选择 <strong>配置 OpenNMS</strong> ，在登录用户名相应菜单下面</p>
</li>
<li>
<p>选择 <strong>配置用户，组和计划角色</strong>，然后选择 <strong>配置计划角色</strong></p>
</li>
<li>
<p>使用 <strong>添加新计划角色</strong> 并为这个 <em>计划角色</em> 设置一个 <strong>名称</strong> ，分配现有的 <strong>组</strong> 并且给出一个有意义的描述</p>
</li>
<li>
<p>单击 <strong>保存</strong> 来存储</p>
</li>
<li>
<p>通过单击相应时间的 <strong>加号 (+)</strong> 图标。在给定日期的日历中定义一个 <em>值班表</em> ，从相关联的 <em>组</em> 中提供一个特定的 <em>用户</em> 通知时间</p>
</li>
<li>
<p>单击 <strong>保存</strong> 来存储 <em>计划</em></p>
</li>
<li>
<p>单击 <strong>完成</strong> 以应用更改</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_值班计划">8.3.3. 值班计划</h4>
<div class="paragraph">
<p>每个 <em>用户</em> 和 <em>组</em> 都可以有一个 <em>值班计划</em>, 它指定了用户 (或组) 每周接收通知的时间表。
如果通知应该发送给单个用户，但该用户当时不值班，则该通知将不会发送给这个用户。
在通过组的方式针对用户通知的情况下，逻辑略有不同。
如果创建通知消息是该组值班，则将通知值班的所有用户。
如果改组值班，但目前没有成员用户值班，则通知将被排队并发送给下一个值班的用户。
如果该组在创建通知消息时不值班，则通知将不会发送。</p>
</div>
</div>
<div class="sect3">
<h4 id="_目的路径">8.3.4. 目的路径</h4>
<div class="paragraph">
<p><em>目的路径</em> 是一个命名的，可重用的用于发送通知的规则集合。
每个目的路径都有初始步骤和零或更多级上报步骤。</p>
</div>
<div class="paragraph">
<p>目的路径中每个步骤都有一个默认为0秒的延时。初始步骤的延时被称为 <em>初始延时</em> ，而上报步骤的被简单的叫作 <em>延时</em> .</p>
</div>
<div class="paragraph">
<p>每一步都有一个或多个 <em>目标</em> 。
目标可以是用户，组，计划角色，或一个电子邮件地址。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
虽然在任何时候用户使用临时输入的电子邮件地址是方便的，但保留下特殊的电子邮件地址是有帮助的。
例如，如果用户更改了他的电子邮件地址，则需要在其配置的每个目的路径中进行更新。
临时电子邮件地址是指供应商或其他外部人员在短期内协助排除故障的情况。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>当一个步骤以一个或多个组为目标时，也可以为每个组指定延时。
默认为0秒，在这种情况下，所有组成员同时被通知。
如果设置较长的延时，则组成员将以用户名的字母顺序通知。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
避免为组和用户使用相同的名称。
目标路径配置的步骤级别中不区分用户和组，所以如果用户和组都命名为  <code>admin</code>，那么通知操作是不明确的。
正是由于这个原因，默认的管理员组被命名为 <code>Admin</code> (大写字母 <code>A</code>)&#8201;&#8212;&#8201;重要情况。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在一个步骤中，每个目标与一个或多个通知命令相关联。
如果选择多个命令，它们将同时执行。</p>
</div>
<div class="paragraph">
<p>每个步骤也有一个 <em>自动通知</em> 开关，它可以设置为 <code>关闭</code>, <code>开启</code>, 或 <code>自动</code>。
此开关的逻辑决定是否在首次创建通知时将自动确认通知发送到不值班的目标。
如果 <code>关闭</code>, 通知永远不会发送到这样的目标，如果 <code>开启</code>, 它们将被发送；如果 <code>自动</code>, 系统采用启发模式，旨在 "做正确的事"。</p>
</div>
</div>
<div class="sect3">
<h4 id="_通知命令">8.3.5. 通知命令</h4>
<div class="paragraph">
<p>一个 <em>通知命令</em> 是一个名称，一个 Java 类或外部程序命令用来发送通知到目标的可执行文件。
默认配置中包含下面的通知命令：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>callHomePhone</code>, <code>callMobilePhone</code>, 和 <code>callWorkPhone</code></dt>
<dd>
<p>在用户联系信息中配置一个电话号码。
这三个都是使用 Asterisk 进程通知策略实现的，只是在使用联系信息字段时有不同。</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ircCat</code></dt>
<dd>
<p>发送通知给一个 <em>IRCcat</em> 互联网多线交谈终端。
通过 IRCcat 进程通知策略实现。</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>javaEmail</code> 和 <code>javaPagerEmail</code></dt>
<dd>
<p>到目前为止，最常用的命令，这些将发送通知给用户的 <code>email</code> 或 <code>pagerEmail</code> 联系信息字段值。
通过配置用户的 <code>pagerEmail</code> 信息字段值，目标将是电子邮件发送到短信的网关，短信通知很容易配置。
两者都是使用 JavaMail 通知策略。</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>microblogDM</code>, <code>microblogReply</code>, 和 <code>microblogUpdate</code></dt>
<dd>
<p>将通知作为直接消息发送给用户，通过 at-reply 发送给用户, 或通过具有 Twitter v1-兼容 API 的微博服务向每个人发送通知。
每个命令都使用单独的进程通知策略实现。</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>numericPage</code> 和 <code>textPage</code></dt>
<dd>
<p>将通知发送到用户的数字或字母数字寻呼机。
使用 <code>qpage</code> 工具的外部命令实现。</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>xmppGroupMessage</code> 和 <code>xmppMessage</code></dt>
<dd>
<p>向 XMPP 组或用户发送消息。
使用进程 XMPP 通知策略实现。</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>通过编辑 <code>notificationCommands.xml</code> 文件，可以定制和扩展通知命令。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
谨慎使用外部二进制通知命令，避免叉爆你的 <em>OpenNMS Horizon</em> 系统。
最初，所有通知命令都是外部命令。
当前，只有 <code>numericPage</code> 和 <code>textPage</code> 命令使用外部程序来完成它们的工作。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-notifications-bonus-strategies">8.4. 新通知方法</h3>
<div class="paragraph">
<p>在 <em>OpenNMS Horizon</em> 中包括一些新的通知方法，但是当前需要手动来激活。</p>
</div>
<div class="sect3">
<h4 id="ga-notifications-strategy-mattermost">8.4.1. Mattermost</h4>
<div class="paragraph">
<p>如果你对组织使用 Mattermost 作为团队通信平台，你可以配置 <em>OpenNMS Horizon</em> 使用 Mattermost 接入信道发送通知。
你必须在你的 Mattermost 团队配置传入的网络通道，并对你的 <em>OpenNMS Horizon</em> 实例做一点手动配置。</p>
</div>
<div class="paragraph">
<p>首先，将下面的 XML 片段添加到 <code>notificationCommands.xml</code> 配置文件 (不需要定制):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;command binary="false"&gt;
  &lt;name&gt;mattermost&lt;/name&gt;
  &lt;execute&gt;org.opennms.netmgt.notifd.MattermostNotificationStrategy&lt;/execute&gt;
  &lt;comment&gt;class for sending messages to a Mattermost team channel for notifications&lt;/comment&gt;
  &lt;argument streamed="false"&gt;
    &lt;switch&gt;-subject&lt;/switch&gt;
  &lt;/argument&gt;
  &lt;argument streamed="false"&gt;
    &lt;switch&gt;-tm&lt;/switch&gt;
  &lt;/argument&gt;
&lt;/command&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后在 <code>opennms.properties.d</code> 目录中创建一个名为 <code>mattermost.properties</code> 的属性文件，内容如下 (自定义适当的值):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">org.opennms.netmgt.notifd.mattermost.webhookURL=https://mattermost.example.com/hooks/bf980352b5f7232efe721dbf0626bee1</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 OpenNMS ，以便加载 <code>mattermost.properties</code> 文件。新的 <code>mattermost</code> 通知命令就可以在目的路径中使用了。</p>
</div>
<div class="sect4">
<h5 id="_附加选项">附加选项</h5>
<div class="paragraph">
<p>下表列出了可选的属性，你可以在 <code>mattermost.properties</code> 中使用它们来定制你的 Mattermost 通知。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
为了改进布局，它们的属性名称应该使用最终的组件名；当使用它们时，你必须策划为  <code>org.opennms.netmgt.notifd.mattermost.</code> 。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 91. Mattermost 通知策略的附加可用参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必选项</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">例子</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>channel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定一个通道或私有组，而不是针对一个目标网络信道</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Webhook default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NetOps</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通知通讯的用户名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS_Bot</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iconEmoji</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个用于通知栏图标的 emoji 序列</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:metal:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iconURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用作通知通讯的图标的 URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://example.org/assets/icon.png" class="bare">https://example.org/assets/icon.png</a></code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Mattermost 的一些可选配置参数在有些版本不兼容。
           例如，已知 <code>channel</code> 选项在 Mattermost 3.7.0 版本不工作。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>有关 Mattermost 接入的网络通信更多信息，请参考 <a href="https://docs.mattermost.com/developer/webhooks-incoming.html">Mattermost Integration Guide</a> 。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-notifications-strategy-slack">8.4.2. Slack 通知</h4>
<div class="paragraph">
<p>如果你的组织使用 Slack 团队通信平台，则可以配置 <em>OpenNMS Horizon</em> 通过 Slack 接入信道发送通知。
你必须在你的 Slack 团队中配置接入连接，并对你的 <em>OpenNMS Horizon</em> 实例做一点手动配置。</p>
</div>
<div class="paragraph">
<p>首先，将下面的 XML 片段添加到 <code>notificationCommands.xml</code> 配置文件 (不需要定制):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;command binary="false"&gt;
  &lt;name&gt;slack&lt;/name&gt;
  &lt;execute&gt;org.opennms.netmgt.notifd.SlackNotificationStrategy&lt;/execute&gt;
  &lt;comment&gt;class for sending messages to a Slack team channel for notifications&lt;/comment&gt;
  &lt;argument streamed="false"&gt;
    &lt;switch&gt;-subject&lt;/switch&gt;
  &lt;/argument&gt;
  &lt;argument streamed="false"&gt;
    &lt;switch&gt;-tm&lt;/switch&gt;
  &lt;/argument&gt;
&lt;/command&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后在 <code>opennms.properties.d</code> 目录中创建一个名为 <code>slack.properties</code> 的新文件，其内容如下 (适当修改值):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">org.opennms.netmgt.notifd.slack.webhookURL=https://hooks.slack.com/services/AEJ7IIYAI/XOOTH3EOD/c3fc4a662c8e07fe072aeeec</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 OpenNMS ，以便加载 <code>slack.properties</code> 文件。现在你就可以在通知路径中使用新添加的 <code>slack</code> 通知命令了。</p>
</div>
<div class="sect4">
<h5 id="_附加选项_2">附加选项</h5>
<div class="paragraph">
<p>下表列出了可选的属性，你可以在 <code>slack.properties</code> 中使用它们来自定义 Slack 通知。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
为了改进布局，它们的属性名称应该使用最终的组件名；当使用它们时，你必须策划为 <code>org.opennms.netmgt.notifd.slack.</code> 。
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 92. Slack 通知策略的附加参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必选项</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">例子</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>channel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定一个通道或私有组，而不是针对一个目标网络信道</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Webhook default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NetOps</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通知通讯的用户名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS_Bot</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iconEmoji</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个用于通知栏图标的 emoji 序列</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:metal:</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iconURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用作通知通讯的图标的 URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="https://example.org/assets/icon.png" class="bare">https://example.org/assets/icon.png</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>useSystemProxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否应该使用系统范围的代理设置？
                     可以在 <a href="#ga-opennms-system-properties">opennms.conf</a> 中配置。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>有关 Slack 接入的网络通信更多信息，请参考 <a href="https://api.slack.com/incoming-webhooks">Slack API</a> 。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-provisioning">9. Provisioning（探针）</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ga-provisioning-introduction">9.1. 介绍</h3>
<div class="paragraph">
<p>OpenNMS 版本 1.8 引入了企业级、前所未有的服务管理组件，来维护 OpenNMS 的管理实体。
这个新模块 <em>Provisiond</em>, 将所有在1.6版本实体管理机制统一起来 (<em>Capsd</em> 和 <em>Importer</em>), 成为一个新的, 改进的, 基于策略的 provisioning system。
系统集成商应该注意到, <em>Provisiond</em> 带来了一个完整的 <em>RESTFul Web Service API</em> 与外部系统集成，像是 CRM 或其他外部系统通过适配器 API 接口进行连接。</p>
</div>
<div class="paragraph">
<p>OpenNMS 1.0版本开始, 近十年一直使用 Capsd 作为扫描功能模块, 为管理实体提供服务。
1.8.0 版本 <em>Capsd</em> 已过期, provided 提供了一个丰富的自动配置机制，只需要一个IP地址来创建和维护管理实体 (设备, 接口, 和基于IP的服务)。
版本 1.2 添加的 <em>XML-RPC API</em> 作为更受控 (定向) 的策略，主要用于非基于电信的服务提供商 (例如 主机托管公司)。
版本 1.6 加入了另一个机制，叫作 <em>Importer 服务模块</em>。
<em>Importer</em> 提供了大型服务管理功能，能够基于XML的 API 来严格控制 OpenNMS 实体配置，以便完整定义和控制非发现的实体并且也可以进行服务扫描。</p>
</div>
<div class="paragraph">
<p>Importer 模块用于提高 OpenNMS 的可扩展性，来维护管理大数量级的管理实体。
这个功能模块概念非常简单，但很强大、灵活导入设备，并且是 Provisiond 模块的预备方案。
导入服务在服务提供商网络中已经使用3年，在 OpenNMS 的单实例上维护了超过 50,000 个节点数量级的能力。
这是一个固有的导入工具。</p>
</div>
<div class="paragraph">
<p><em>Provisiond</em> 为 OpenNMS 提供了一个管理实体引入的新方式。</p>
</div>
</div>
<div class="sect2">
<h3 id="_概念">9.2. 概念</h3>
<div class="paragraph">
<p><em>Provisioning</em> 是服务提供商 (像 运营商, 或者 电话公司) 和开源软件系统所熟悉的术语，但是非开源软件企业并不是这样。</p>
</div>
<div class="paragraph">
<p>Provisiond 通过两个基本机制接收添加管理实体的 "请求"， <em>OpenNMS Horizon</em> 传统的 "New Suspect" 事件, 通常是通过 <em>Discovery 模块</em> 发出的, 和在系统探针界面导入请求列表 (XML 定义的节点实体) 。
如果你对 OpenNMS 之前发布的版本很熟悉, 你应该知道 <em>Discovery</em> 首先发出 <em>New Suspect 事件</em> 然后 <em>Capsd</em> 组件收到事件后进行设备扫描工作。
你还将认识到 OpenNMS 的 <em>模型导入</em> 组件的导入请求。
现在，<em>Provisiond</em> 将这两个独立的组件统一为一个大规模并行基于高级策略的 provisioning 服务。</p>
</div>
<div class="sect3">
<h4 id="_术语">9.2.1. 术语</h4>
<div class="paragraph">
<p>关于 <em>OpenNMS Horizon</em> provisioning 系统使用的以下术语，对于了解本指南中所提到的概念是必不可少的。</p>
</div>
<div class="sect4">
<h5 id="_实体">实体</h5>
<div class="paragraph">
<p>实体是 <em>OpenNMS Horizon</em> 中的管理对象，例如设备, IP接口, SNMP接口, 和服务。</p>
</div>
</div>
<div class="sect4">
<h5 id="_外部源及外源id">外部源及外源ID</h5>
<div class="paragraph">
<p>1.6 版本的 <em>Importer</em> 服务引入了外部源和外源IDs 的概念。
<em>外部源</em> 唯一地标识了一个提供源，并且是将设备导入 <em>OpenNMS Horizon</em> 的基本属性。
这个概念是提供一种外部 (外来) 系统，其具有唯一标识自身和请求 (通过申请单) 提供任意节点实体给 <em>OpenNMS Horizon</em>。</p>
</div>
<div class="paragraph">
<p><em>外源ID</em> 是在外部系统中维护的唯一节点ID，同时是在 <em>OpenNMS Horizon</em> 系统中用来唯一标识外部系统的。</p>
</div>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 使用外部源和外源ID的组合作为唯一的外键，将来自每个源的节点集合与 <em>OpenNMS Horizon</em> 数据库中的节点进行同步。
这样外部系统不必与第一次创建节点时分配的 <em>OpenNMS Horizon</em> 节点IDs 保持一致。
这样 <em>Provisiond</em> 就可以确定导入申请单中的节点实体，哪些是新添加的，要更新的或要删除的。</p>
</div>
</div>
<div class="sect4">
<h5 id="_外部源定义">外部源定义</h5>
<div class="paragraph">
<p>此外, 外部源已经扩展到包含规范，规定每个外部源的节点如何发现和管理。
外部源的名称在 provisioning 系统中已经变得非常普遍，并且通常会经常见到:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web-UI 中的 provisioning group 的名称</p>
</li>
<li>
<p>存储申请单的文件名 (像是处于就绪状态的申请单)</p>
</li>
<li>
<p>在申请单中的 foreign-source 属性值 (名字很明显, 但是, 必须指出文件名不一定必须等于这个属性值，但是 <em>OpenNMS Horizon</em> 建议最好使用相同值)</p>
</li>
<li>
<p>在申请单中定义节点的 building 属性 (这个值在 Web-UI 中被称为 “site”，并且 Provisiond 会将它分配到节点的资产记录 building 列，同时是站点状态视图特性中使用的默认值)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_导入申请表">导入申请表</h5>
<div class="paragraph">
<p>导入申请表是 <em>OpenNMS Horizon</em> 的概念术语，用来表示由 XML 格式组织的一组节点, 以便从外部源提供给 <em>OpenNMS Horizon</em>。
申请单结构设计 (XSD) 可以在以下位置找到。 <a href="http://xmlns.opennms.org/xsd/config/model-import">http://xmlns.opennms.org/xsd/config/model-import</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_自动发现">自动发现</h5>
<div class="paragraph">
<p>自动发现是 <em>OpenNMS Horizon</em> 中用来描述节点实体自动装配的术语。
目前, <em>OpenNMS Horizon</em> 使用 ICMP ping 来扫描网络上的IP地址。
对于有响应而不在数据库里的IPs，<em>OpenNMS Horizon</em> 将生成一个新可疑设备的事件。
当 Provisiond 接收到这个事件时, 将创建一个设备，并且基于默认外部源定义开始设备扫描。</p>
</div>
</div>
<div class="sect4">
<h5 id="_定向发现">定向发现</h5>
<div class="paragraph">
<p>在 1.6 版本中 Provisiond 接管了 Importer 导入模型，并且第一个并且唯一实现了控制机制，可以从一个或多个数据源直接将管理实体提供给 <em>OpenNMS Horizon</em> 。
这些数据源通常是一个内部开发的资产库或独立的 provisioning 系统 ，甚至是一组元素管理系统。
使用这个机制, <em>OpenNMS Horizon</em> 可以直接添加, 更新, 或删除一个完全由外部源定义的节点实体。
没有发现更多相关接口和服务的过程。</p>
</div>
</div>
<div class="sect4">
<h5 id="_增强的定向发现">增强的定向发现</h5>
<div class="paragraph">
<p>定向发现同时增加了扫描设备的能力，针对设备实体 (接口)。</p>
</div>
</div>
<div class="sect4">
<h5 id="_基于策略的发现">基于策略的发现</h5>
<div class="paragraph">
<p>基于策略的发现 是一个术语，代表了 <em>OpenNMS Horizon</em> provisioning 演进的最新阶段，并且很好描述了新的 provisioning 架构，现在，在 <em>OpenNMS Horizon</em> 中用于维护其管理实体库。
这个术语描述了 <em>OpenNMS Horizon</em> 用户对于 Provisioning 系统的控制，来管理 NMS 对新发现实体的行为。
目前的行为包括存储, 数据采集, 服务监控, 和分类策略。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_地址可伸缩">9.2.2. 地址可伸缩</h4>
<div class="paragraph">
<p>当今部署的 IT 系统呈现爆炸性增长以支持非传统的 IP 服务，这已经前所未有的影响到管理系统，并要求它们具备强大的可扩展性。
管理系统的可扩展性表现在其维护大量管理实体的能力以及管理实体的效率相结合来确定的。</p>
</div>
<div class="paragraph">
<p>现在, <em>OpenNMS Horizon</em> 部署发现由虚拟机 (虚拟主机, 接口, 一级网络) 通过 SNMP 代理上报数以万计物理接口的设备并不少见。
为了应对这些管理环境，NMS 必须尽可能有效利用其计算平台的全部资源 (硬件和 OS)。
当今，通过编写脚本或单线程应用程序已经不能应对这种工作，而是需要利用 NMS 来处理这个领域的工作和系统管理员面临的可伸缩性挑战。</p>
</div>
<div class="sect4">
<h5 id="_并行化和非阻塞_io">并行化和非阻塞 I/O</h5>
<div class="paragraph">
<p>要从一个管理系统的平台 (硬件和 OS) 挤出一点点的功率是需要一个全功能 NMS 全力协调工作才行，例如 <em>OpenNMS Horizon</em>。
庆幸的是, 现代计算平台的硬件和 CPU 架构提供了多核 CPUs ，这样的CPU具有支持原子操作的指令集。
虽然这些强大的资源是由商用系统提供，但是也使得开发应用程序增加了复杂性，并且是复杂性数量级的增加。
然而, 由于我们复杂的 IT 环境, 多线程 NMS 应用程序现在是必不可少的，这也充分暴露了软件开发中复杂的并发问题。</p>
</div>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 使用新的并发策略来应对这一挑战。
该策略基于一种技术，这项技术将并行 (异步) 操作的效率 (传统上完全由单线程完成工作) 与最流行、非阻塞、多线程的效率相结合。
这种新的并发策略的非阻塞组件增加了更大的复杂性，但是 <em>OpenNMS Horizon</em> 增加了数量级的可伸缩性。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java 运行时, 基于 Sun JVM, 提供了基于原子操作实现的 <em>OpenNMS Horizon</em> 非阻塞并发算法。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_provisioning_策略">Provisioning 策略</h5>
<div class="paragraph">
<p>虽然你可以做到，但是不一定应该做。
因为 <em>Provisiond</em> 创建大规模并行操作，所以大量的设备, 接口, 和服务很快被发现和存储，但是并不意味着应该这样做。
为 <em>Provisiond</em> 创建的 <em>策略 API</em> ，允许开发实现应用控制 <em>Provisiond</em> 的行为.
1.8 版本包括一组灵活的 provisioning 策略，这些策略控制实体的存储，并且它们的属性限制监控行为。</p>
</div>
<div class="paragraph">
<p>当设备导入或重新扫描时，可能有零或多个 provisioning 策略被应用。
这些策略是在外部源中定义的。
对于自动发现设备或在没有定义外部源的 provisioning groups 中设备的策略，会使用默认外部源定义的策略。</p>
</div>
</div>
<div class="sect4">
<h5 id="_默认外部源定义">默认外部源定义</h5>
<div class="paragraph">
<p>在 Provisioning 服务的库中包含的是 "模板" 或默认外部源。
存储在库中的模板被直接使用，除非 <em>OpenNMS Horizon</em> 管理员用户在 <em>Provisioning Groups</em> WebUI 界面修改了默认配置。
编辑后, 这个模板被导出到 <em>OpenNMS Horizon</em> <code>etc/</code> 目录，文件名是: <code>default-foreign-source.xml</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;foreign-source date-stamp="2009-10-16T18:04:12.844-05:00"
                name="default"
                xmlns="http://xmlns.opennms.org/[http://xmlns.opennms.org/xsd/config/foreign-source"&gt;
    &lt;scan-interval&gt;1d&lt;/scan-interval&gt;
    &lt;detectors&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.datagram.DnsDetector" name="DNS"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.FtpDetector" name="FTP"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.HttpDetector" name="HTTP"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.HttpsDetector" name="HTTPS"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.icmp.IcmpDetector" name="ICMP"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.ImapDetector" name="IMAP"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.LdapDetector" name="LDAP"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.NrpeDetector" name="NRPE"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.Pop3Detector" name="POP3"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.radius.RadiusAuthDetector" name="Radius"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.simple.SmtpDetector" name="SMTP"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.snmp.SnmpDetector" name="SNMP"/&gt;
      &lt;detector class="org.opennms.netmgt.provision.detector.ssh.SshDetector" name="SSH"/&gt;
  &lt;/detectors&gt;
  &lt;policies/&gt;
&lt;/foreign-source&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_自动重新扫描">自动重新扫描</h5>
<div class="paragraph">
<p>默认外部源定义了 <code>scan-interval</code> 为 <code>1d</code>, 这将使申请单中所有设备每天扫描一次。你可以使用下列标志符组合设置扫描间隔:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>w: 周</p>
</li>
<li>
<p>d: 天</p>
</li>
<li>
<p>h: 小时</p>
</li>
<li>
<p>m: 分钟</p>
</li>
<li>
<p>s: 秒</p>
</li>
<li>
<p>ms: 毫秒</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如, 要在每隔 6 天 53 分重新扫描一次, 你可以将 <code>scan-interval</code> 设置为 <code>7d 53m</code>。</p>
</div>
<div class="paragraph">
<p>不要忘记, 为了使新的扫描间隔生效，你需要重新导入申请单，以便激活外部源。</p>
</div>
</div>
<div class="sect4">
<h5 id="_禁用重新扫描">禁用重新扫描</h5>
<div class="paragraph">
<p>对于大量设备的情况，你可能希望将 <code>scan-interval</code> 设置为 <code>0</code> ，来完全禁用自动重新扫描。 <em>OpenNMS Horizon</em> 将不会试图重新扫描申请单中的设备，除非你通过 web UI 或 Provisioning ReST API 手动 (强制) 触发重新扫描。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_入门">9.3. 入门</h3>
<div class="paragraph">
<p>一个 NMS 要使用起来，要设置监控和添加实体到系统中。
<em>OpenNMS Horizon</em> 安装后有一个基本的配置，这个配置基本满足服务级别监控和性能管理的快速应用和运行。
一旦管理实体被加入，基本配置将自动开始监控和报告。</p>
</div>
<div class="paragraph">
<p>一般说来，在 <em>OpenNMS Horizon</em> 中有两个引入方式: <em>自动发现</em> 和 <em>定向发现</em>。
我们先从 <em>自动发现</em> 讲起, 首先, 我们应该检查 SNMP 配置，以便新发现的设备可以理解对实体进行扫描，并应用报表和门限。</p>
</div>
<div class="sect3">
<h4 id="_提供_snmp_配置">9.3.1. 提供 SNMP 配置</h4>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 需要根据你的网络正确的进行 SNMP 配置，以便正确获取网络和设备拓扑，并自动开启性能数据采集。
设备 (像 设备 或 主机) 添加后网络拓扑被更新。
导航到 <em>管理/通过IP地址配置SNMP团体名</em> 界面，如下所示。</p>
</div>
<div class="paragraph">
<div class="title">配置 SNMP 团体名</div>
<p><span class="image"><img src="images/provisioning/00029.png" alt="00029"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Provisiond 包括一个选项，在 <em>单个设备</em> provisioning 界面添加团体名。
这相当于在系统界面输入单个IP地址，同时设置设备团体名。
有关 <em>快速添加设备</em> 功能的更多信息，请参阅下面信息。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这个界面设置 <em>OpenNMS Horizon</em> 的管理的 SNMP agents 监听 IP地址，从 10.1.1.1 到 10.254.254.254。
这些设置被优化保存到 <code>snmp-configuration.xml</code> 文件。
优化过程可以使配置最小化。
已配置的包含在此范围的 IP 地址将被删除。
下面是生成的配置。</p>
</div>
<div class="listingblock">
<div class="title">例子 snmp-config.xml</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;snmp-config
xmlns="http://xmlns.opennms.org/xsd/config/snmp[http://xmlns.opennms.org/xsd/config/snmp]"
port="161" retry="3" timeout="800" read-community="public"

version="v1" max-vars-per-pdu="10"&gt;

&lt;definition retry="1" timeout="2000"

read-community="public" version="v2c"&gt;

&lt;specific&gt;10.12.23.32&lt;/specific&gt;

&lt;/definition&gt;

&lt;/snmp-config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，如果 IP 地址配置在这个范围内，
该范围将被分成两个独立的范围并且将添加特定的条目。
例如，如果通过相同的 UI 添加配置，
IP: 10.12.23.32 团体名是 <code>public</code>,
然后得到的配置将是:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;snmp-config xmlns="http://xmlns.opennms.org/xsd/config/snmp"
             port="161"
             retry="3"
             timeout="800"
             read-community="public"
             version="v1"
             max-vars-per-pdu="10"&gt;

    &lt;definition retry="1" timeout="2000" read-community="YrusoNoz" version="v2c"&gt;
        &lt;range begin="10.1.1.1" end="10.12.23.31"/&gt;
        &lt;range begin="10.12.23.33" end="10.254.254.254"/&gt;
    &lt;/definition&gt;

    &lt;definition retry="1" timeout="2000" read-community="public" version="v2c"&gt;
        &lt;specific&gt;10.12.23.32&lt;/specific&gt;
    &lt;/definition&gt;
&lt;/snmp-config&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
粗体 IP地址显示了范围被分割的位置，并添加了特定的团体名 "public" 。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>现在，我们为10个网络提供了 SNMP 配置，我们准备开始添加设备。
我们第一个例子是自动发现并添加所有管理实体 (设备, IP接口, SNMP接口, 和基于监控IP的服务)。
然后，我们通过一个例子说明如何通过使用  <em>Provisioning Groups</em> 更加直观和详细地了解你的发现过程。</p>
</div>
<div class="paragraph">
<p>对自动发现的条目进行分析，并将其保存到关系数据库中，然后根据默认 foreign source 中定义的策略进行管理。
这非常类似于以前 (已过时) Capsd 模块的处理过程，但可以更精细地控制。</p>
</div>
</div>
<div class="sect3">
<h4 id="_自动发现_2">9.3.2. 自动发现</h4>
<div class="paragraph">
<p>目前在 <em>OpenNMS Horizon</em> 中, ICMP 用于自动发现设备，并添加到 <em>OpenNMS Horizon</em> 系统中。
自从 OpenNMS 1.0 版本发布以来，一直使用 <em>Capsd</em> 作为扫描模块，直到 1.8 版本, 由 <em>Provisiond</em> 模块代替。</p>
</div>
<div class="sect4">
<h5 id="_功能分离">功能分离</h5>
<div class="paragraph">
<p>版本 1.8 的 <em>Provisiond</em> 分离了之前 <em>Capsd</em> 的3个不同阶段：实体扫描，服务探测和设备合并。
这些阶段现在由 Provisiond模块 分开管理。
紧接着导入设备实体，创建设备扫描任务来发现设备上的接口 (SNMP 和 IP)。
当接口被发现后，存储它们，然后安排任务对每个IP接口进行服务探测。</p>
</div>
<div class="paragraph">
<p>对于自动发现的设备，将计划设备合并阶段；
对于直接提供的设备，将不包括设备合并过程。
只有当2个自动发现的设备看起来是提一个设备时才会发生合并。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
设备合并的用例和重新设计仍然是发布 1.8.0 版本的突出问题
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_增强的定向发现_2">9.3.3. 增强的定向发现</h4>
<div class="paragraph">
<p>这总新的 provisioning 形式首先出现在 OpenNMS 1.8 版本的 Provisiond 模块服务中。
它结合了导入方式的严格控制的定向供应方法 (从 1.6 版本) 到 OpenNMS 的方便灵活的自动发现的优点。
<em>增强的定向发现</em> 开始时使用相同的定向导入请求的增强功能，但在实体和服务扫描阶段完成后，通过策略控制实体的保存。</p>
</div>
<div class="paragraph">
<p>如果你打算使用这种供应的形式，最重要的是了解细节概念， <em>Provisiond</em> 是如何管理定向提供的实体。
这些知识将使管理员和系统集成商更好地规划，实施和解决与此供应策略相关的任何问题。</p>
</div>
<div class="sect4">
<h5 id="_过程说明">过程说明</h5>
<div class="paragraph">
<p>涉及发现实体有3个阶段: 导入, 设备扫描, 和服务扫描。
导入阶段又分成几步: 整理, 审核, 部分 SNMP 扫描, 和复合。</p>
</div>
<div class="sect5">
<h6 id="_整理和审核阶段">整理和审核阶段</h6>
<div class="paragraph">
<p>重要的是要理解，从每个外部源收集的设备作为一个完整的集合来管理。
例如来自外部源 <em>CRM</em> 和 <em>CMDB</em> 定义的设备, 将彼此分开管理，即使它们包含完全相同的设备定义。
对于 <em>OpenNMS Horizon</em> 来说, 它们是单个实体，并且它们作为集合进行管理。</p>
</div>
<div class="paragraph">
<p>Requisitions 是一个引用的 URL。
目前, URL 可以被指定为以下协议: FILE, HTTP, HTTPS, 和 DNS。
每种协议都有一个协议处理单元，用于从 <em>外部源</em> 获取 XML 流, 例如 <a href="http://inv.corp.org/import.cgi?customer=acme" class="bare">http://inv.corp.org/import.cgi?customer=acme</a> 或 <code>file:/opt/opennms/etc/imports/acme.xml</code>。
DNS 协议是一种特殊的处理程序，用于从企业DNS服务器的 <em>外部源</em> 获取设备集合。
有关详细信息，请参阅 DNS协议处理程序。</p>
</div>
<div class="paragraph">
<p>对于导入请求的 (无论是计划还是请求，通过事件传递的) 申请表需要转换为 Java对象进行处理。
在申请表中定义的设备，<em>OpenNMS Horizon</em> 将作为外部源的管理实体集合。
审核阶段将确定在申请表中定义的每个设备 (或未定义) ，在 <em>导入阶段</em> 需要执行 <em>添加</em>, <em>更新</em>, 或 <em>删除</em> 操作。
对申请表中的设备设置 foreign IDs 来区别当前 <em>OpenNMS Horizon</em> 中的管理对象。</p>
</div>
<div class="paragraph">
<p>每个集合里 IDs 交集将执行更新操作，申请表中额外 foreign IDs 将执行添加操作，并来自管理对象额外集合 foreign IDs 将执行删除操作。
这意味着每个来自外部源的 foreign IDs 必须是唯一的。</p>
</div>
<div class="paragraph">
<p>自然地, 第一次从外部源导入请求时，不会在当前管理设备中有关联对象，因此申请表中定义的所有设备将执行添加操作。
如果使用零个 (0) 设备定义的申请表，则所有外部源的当前管理设备将被删除 (所有设备, 接口, 故障, 告警等. 都将从 <em>OpenNMS Horizon</em> 中删除)。</p>
</div>
<div class="paragraph">
<p>当使用 Provisioning Groups 的 Web-UI 界面提供设备时, 申请表保存在本地文件系统并且文件协议处理程序将引用这个申请表。
每个 Provisioning Group 都是一个独立的外部源，并且 Web-UI 生成唯一的 foreign IDs。
MSP 可以使用 Provisioning Groups 根据客户名称来定义管理设备集合，其中每个客户的设备集合被组织为单独的 Provisioning Group。</p>
</div>
</div>
<div class="sect5">
<h6 id="_导入阶段">导入阶段</h6>
<div class="paragraph">
<p>导入阶段开始时，Provisiond 接收到一个从 URL 导入申请表的请求。
在这个阶段，第一步是加载申请表，把所有申请表中定义的设备对象都转换为 Java 对象。</p>
</div>
<div class="paragraph">
<p>如果在申请表中出现任何语法或XML结构问题，则放弃整个导入操作。</p>
</div>
<div class="paragraph">
<p>一旦对申请表完成转换，申请表中的设备就要进行审核存储。
将申请表的设备和数据库中外部源申请表定义的设备进行比较。
审核申请表中的每个设备并生成三类操作: <em>插入</em>, <em>更新</em>, <em>删除</em> ，基于每个申请表设备的 foreign ID。
如果设备在数据库中，而不在申请表中，则执行删除操作；申请表中的设备匹配到了存储的设备，则执行更新操作 (交集), 申请表中剩下的设备执行插入操作 (设备在申请表而不在数据库中)。</p>
</div>
<div class="paragraph">
<p>如果申请表中设备有 Primary SNMP 接口定义, 那么在更新和插入操作期间，将扫描设备，获取小范围 SNMP 属性信息。
此扫描是在配置了设备和 SNMP 接口的情况下进行，如果要对整个设备进行 SNMP 扫描，则在申请表只配置IP接口。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这与 Provisiond 的 SNMP 发现扫描阶段不同: 设备扫描和接口扫描。
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_设备扫描阶段">设备扫描阶段</h6>
<div class="paragraph">
<p>所有操作完成后，定向发现完成，然后增强定向发现开始。
申请表的设备被安排进行设备扫描，对于不是直接提供的设备信息和接口也会被发现。
所有发现的物理 (SNMP) 和逻辑 (IP) 接口，都要根据导入申请表时关联的外部源 <em>Provisioning Policies</em> 定义来进行存储。</p>
</div>
</div>
<div class="sect5">
<h6 id="_服务扫描_探测_阶段">服务扫描 (探测) 阶段</h6>
<div class="paragraph">
<p>此外, 新的 Provisiond 的增强定向发现机制，对每个发现的IP接口都要进行服务探测扫描。
与 OpenNMS 之前版本中 Capsd 模块类似，除了外部源定义的服务会进行探测，在申请表在设备上发现的接口也会扫描。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_导入处理程序">9.4. 导入处理程序</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 中的 Provisioning 服务正在不断的改进和满足新的需要。</p>
</div>
<div class="paragraph">
<p>系统最新的改进之一是建立非常灵活和可扩展的 API 之上的，它通过 URL 引用一个申请单的位置。
最常见的是, 这些 URLs 是文件系统上的文件 (例如 <code>file:/opt/opennms/etc/imports/&lt;my-provisioning-group.xml&gt;</code>) 作为申请单，在 Provisioning Groups UI 界面上创建。
同时, 这些添加，更改和删除设备的请求 (基于原始模型导入) 也可以来自 URLs。
例如，可以使用 HTTP 协议检索: <a href="http://myinventory.server.org/nodes.cgi" class="bare">http://myinventory.server.org/nodes.cgi</a></p>
</div>
<div class="paragraph">
<p>处理 Java 支持的标准协议, 我们提供一系列自定义 URL 处理程序来检索外部源的申请单。</p>
</div>
<div class="sect3">
<h4 id="_通用处理程序">9.4.1. 通用处理程序</h4>
<div class="paragraph">
<p>通用处理程序，可以处理 URLs 形式: requisition://type?param=1;param=2</p>
</div>
<div class="paragraph">
<p>使用这些 URLs ，可以在本地和 <em>Minion</em> 调用各种类型的处理程序处理。</p>
</div>
<div class="paragraph">
<p>除了特定类型参数，还支持以下参数:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 93. 通用参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理程序运行的位置名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">处理程序远程运行最大等待时间，单位毫秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>有关支持类型的详细信息，请参阅相关章节。</p>
</div>
<div class="paragraph">
<p><em>Karaf Shell</em> 的 <code>provision:show-import</code> 命令可以用来显示导入结果 (没有存储或触发导入):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>provision:show-import -l MINION http url=http://127.0.0.1:8000/req.xml</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_文件处理程序">9.4.2. 文件处理程序</h4>
<div class="paragraph">
<p>例子:</p>
</div>
<div class="literalblock">
<div class="title">简例</div>
<div class="content">
<pre>file:///path/to/my/requisition.xml</pre>
</div>
</div>
<div class="literalblock">
<div class="title">使用通用处理程序</div>
<div class="content">
<pre>requisition://file?path=/path/to/my/requisition.xml;location=MINION</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_http_处理程序">9.4.3. HTTP 处理程序</h4>
<div class="paragraph">
<p>实例:</p>
</div>
<div class="literalblock">
<div class="title">简例</div>
<div class="content">
<pre>http://myinventory.server.org/nodes.cgi</pre>
</div>
</div>
<div class="literalblock">
<div class="title">使用通用处理程序</div>
<div class="content">
<pre>requisition://http?url=http%3A%2F%2Fmyinventory.server.org%2Fnodes.cgi</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
当使用通用处理程序时，URL 应该是 "URL 编码"。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dns_处理程序">9.4.4. DNS 处理程序</h4>
<div class="paragraph">
<p>DNS 处理程序从 DNS 服务器请求一个 <em>区域传输 (AXFR) 请求</em> 。
每条记录被记录并建立一个申请表。
对于使用 DNS (可能与IP管理工具一起) 作为网络中节点记录的数据库组织方式，是很方便的。
因此, 比起使用 ping 扫描网络或手动添加设备到 <em>OpenNMS Horizon</em> Provisioning UI, 使用1个或多个 DNS 服务来管理节点是更方便。</p>
</div>
<div class="paragraph">
<p>新协议处理程序的 URL 格式是: dns://&lt;host&gt;[:port]/&lt;zone&gt;[/&lt;foreign-source&gt;/][?expression=&lt;regex&gt;]</p>
</div>
<div class="paragraph">
<p>DNS 导入示例:</p>
</div>
<div class="literalblock">
<div class="title">简例</div>
<div class="content">
<pre>dns://my-dns-server/myzone.com</pre>
</div>
</div>
<div class="paragraph">
<p>这个 URL 将从主机 <code>my-dns-server</code> 端口 53 (默认端口) 的区域 "myzone.com" 导入所有记录，并且由于未指定外部源 (又叫作 provisioning group) ，将使用默认区域。</p>
</div>
<div class="literalblock">
<div class="title">使用正则表达式过滤</div>
<div class="content">
<pre>dns://my-dns-server/myzone.com/portland/?expression=^por-.*</pre>
</div>
</div>
<div class="paragraph">
<p>此 URL 将导入来自相同服务器和区域的设备，但只管理区域中与正则表达式 <code>^port-.*</code> 匹配的设备，并且将为它们分配一个唯一的外部源 (provisioning group) ，用于管理区域中的这些设备。</p>
</div>
<div class="paragraph">
<p>如果你对表达式需要 URL 编码 (例如，你需要在表达式中使用 <code>?</code> ) ，必须正确编码。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dns://my-dns-server/myzone.com/portland/?expression=^por[0-9]%3F</pre>
</div>
</div>
<div class="paragraph">
<div class="title">DNS 设置</div>
<p>当前, DNS 服务器需要被设置，允许 <em>OpenNMS Horizon</em> 服务器进行区域转移。
建议在 <em>OpenNMS Horizon</em> 上运行辅助 DNS 服务器，并且允许 <em>OpenNMS Horizon</em> 服务器请求区域转移。
测试区域转移是否有效的快速方法是:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dig -t AXFR @&lt;dnsServer&gt; &lt;zone&gt;</pre>
</div>
</div>
<div class="paragraph">
<div class="title">配置</div>
<p>Provisoning 系统的配置已经从属性文件 (<code>model-importer.properties</code>) 改为 XML 配置容器。
该配置现在是可扩展的，允许定义0个或多个导入申请单，每个都有自己的 cron 时间计划，用来从各种源自动导入 (旨在与外部 URL，例如 http 和 新 dns 协议处理程序)。</p>
</div>
<div class="paragraph">
<p>在 <em>OpenNMS Horizon</em> <code>etc/</code> 目录中提供了默认配置，名字是: <code>provisiond-configuration.xml</code>。
此默认配置有一个示例，用于从本地运行的 DNS 服务器的区域时间计划导入设备，并且在每天午夜执行导入。
不是很实用，而是一个很好的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;provisiond-configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.opennms.org/xsd/config/provisiond-configuration"
                              foreign-source-dir="/opt/opennms/etc/foreign-sources"
                              requistion-dir="/opt/opennms/etc/imports"
                              importThreads="8"
                              scanThreads="10"
                              rescanThreads="10"
                              writeThreads="8" &gt;

    &lt;!--http://www.quartz-scheduler.org/documentation/quartz-1.x/tutorials/crontrigger
        Field Name Allowed Values Allowed Special Characters
        Seconds 0-59 , - * / Minutes 0-59 , - * / Hours 0-23 , - * /
        Day-of-month1-31, - * ? / L W C Month1-12 or JAN-DEC, - * /
        Day-of-Week1-7 or SUN-SAT, - * ? / L C # Year (Opt)empty, 1970-2099, - * /
    --&gt;

    &lt;requisition-def import-name="localhost"
                     import-url-resource="dns://localhost/localhost"&gt;

        &lt;cron-schedule&gt;0 0 0 * * ? *&lt;/cron-schedule&gt; &lt;!-- daily, at midnight --&gt;
    &lt;/requisition-def&gt;
&lt;/provisiond-configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">配置重新载入</div>
<p>与 1.7 分支中的许多系统模块配置一样，配置可以在不重新启动 <em>OpenNMS Horizon</em> 情况下重新加载, 使用 reloadDaemonConfig uei:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/opt/opennms/bin/send-event.pl
uei.opennms.org/internal/reloadDaemonConfig --parm 'daemonName Provisiond'</pre>
</div>
</div>
<div class="paragraph">
<p>这意味着，每次更新配置时，不必重新启动 <em>OpenNMS Horizon</em> 。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_实例">9.5. Provisioning 实例</h3>
<div class="paragraph">
<p>下面是一些增强型定向发现的实际例子，以帮助您理解这个特性。</p>
</div>
<div class="sect3">
<h4 id="_基本的_provisioning">9.5.1. 基本的 Provisioning</h4>
<div class="paragraph">
<p>该示例添加了三个设备，并且除了要在 <em>OpenNMS Horizon</em> 中提供和管理的设备实体之外，不需要 <em>OpenNMS Horizon</em> 配置。</p>
</div>
<div class="sect4">
<h5 id="_通过_web_ui_定义设备">通过 Web-UI 定义设备</h5>
<div class="paragraph">
<p>使用 Provisioning Groups Web-UI, 创建三个设备通过在给定单个IP地址。
导航到管理菜单，然后从 Admin 选项列表中单击 Provisioning Groups 菜单，并创建分组 <em>Bronze</em>。</p>
</div>
<div class="paragraph">
<div class="title">创建新的 Provisioning Group</div>
<p><span class="image"><img src="images/provisioning/00006.jpeg" alt="00006"></span></p>
</div>
<div class="paragraph">
<p>单击 <em>Add New Group</em> 按钮将创建该组，并将在页面重新显示所有已创建的组列表和这个新组。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/provisioning/00028.jpeg" alt="00028"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在这时候，用于保存新的 provisioning Group (也叫作 一个 import requisition) 的 XML 结构已经被保存到 '$OPENNMS_ETC/imports/pending' 目录中。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>单击 <em>Edit</em> 链接，你就可以开始定义要导入到 <em>OpenNMS Horizon</em> 的设备实体了。
单击添加设备按钮将开始设备实体创建过程，填写设备标签然后单击 <em>Save</em> 按钮。</p>
</div>
<div class="paragraph">
<div class="title">在 Provisioning Group 中创建新的设备</div>
<p><span class="image"><img src="images/provisioning/00026.jpeg" alt="00026"></span></p>
</div>
<div class="paragraph">
<p>此时，provisioning Group 包含设备实体的基本结构，直到接口及接口上的服务定义才完成。
点击 <em>Save</em> 按钮之后，像我们上面介绍的，在 Web-UI 界面， <em>Add Interface</em> 选项, <em>Add Node Category</em> 选项, 和 <em>Add Node Asset</em> 选项。
点击 <em>Add Interface</em> 链接向设备添加接口实体。</p>
</div>
<div class="paragraph">
<div class="title">添加设备接口</div>
<p><span class="image"><img src="images/provisioning/00009.jpeg" alt="00009"></span></p>
</div>
<div class="paragraph">
<p>输入此接口的IP地址，描述信息，然后指定主要属性像 <code>P</code> (Primary), <code>S</code> (Secondary), <code>N</code> (不采集的), 或 <code>C</code> (要采集的) ，最后单击保存按钮。
现在设备有一个接口了，可以在 Web-UI 界面上通过 <em>Add Service</em> 链接定义服务。
通过这个链接添加两个服务 (ICMP, SNMP) 。</p>
</div>
<div class="paragraph">
<div class="title">一个完整的设备定义，已经定义了所有必需元素。</div>
<p><span class="image"><img src="images/provisioning/00007.jpeg" alt="00007"></span></p>
</div>
<div class="paragraph">
<p>现在设备实体定义了所有的 <em>必须</em> 元素，然后将该清单导入 <em>OpenNMS Horizon</em>。
此时，设备应该已经添加了所有接口。
例如，NAT接口应该指定它们提供的服务，因为它们不会再扫描阶段被发现。</p>
</div>
<div class="paragraph">
<p>下面的benefit例子中，将添加另外两个设备定义。</p>
</div>
<div class="paragraph">
<div class="title">示例 Bronze Provisioning Group 的完整清单</div>
<p><span class="image"><img src="images/provisioning/00021.jpeg" alt="00021"></span></p>
</div>
<div class="paragraph">
<p>这是 <em>Bronze</em> provisioning Group 的导入清单的设备集合。
通过 WebUI 编辑这个清单, 修改后被保存在 <em>OpenNMS Horizon</em> 系统的配置目录 '$OPENNMS_etc/imports/' ，并且 XML 文件名为 <code>bronze.xml</code>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
导入清单的 XML 文件名称与 provisioning group 名称相同。
因此命名你的 provisioning group，不要包含空格，否则不利于在文件系统上进行管理。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>单击 <em>Done</em> 按钮返回到 <em>Provisioning Groups</em> 列表界面。
“Bronze” 组表示清单中有3个设备，但是还没有添加到数据库中 (叫作 外部源)。
另外，你可以看到清单的最后修改时间和最后导入时间 (时间戳存储在文件清单中，而不是文件系统时间)。
这些详细信息是数据库中相应信息的完整描述。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/provisioning/00013.jpeg" alt="00013"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这个清单有两点要指出: 1) 定义了3个设备，然而上没有添加到数据库中, 2) 上次导入之后，清单已经修改 (其实 <em>从未</em> 导入)。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_导入设备">导入设备</h5>
<div class="paragraph">
<p>在这个例子中，你可以看到在清单中定义了3个设备，数据库中0个设备。
单击 <em>Import</em> 按钮将提交清单到 provisioning 系统 (实际上是 Web-UI 向 Provisioner 发送一个事件，通知它开始导入这个组)。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在检查这些值的时候，不要刷新此页面。
若要刷新导入的证明信息，请单击 <em>Provisioning Groups</em> 的刷新图标。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>你应该能够立即验证这个 provisioning group 导入处理过程。
Provisiond 有几个准备线程处理这个清单定义的设备。</p>
</div>
<div class="paragraph">
<p>发送和接收一些 SNMP 数据包，来获取清单中定义的设备和接口的 SNMP 详细信息。
在接收到这些数据包 (或不) 后，设备都被插入数据库中。</p>
</div>
<div class="paragraph">
<div class="title">设备现在被添加到 <em>OpenNMS Horizon</em> 并且处于管理之下。</div>
<p><span class="image"><img src="images/provisioning/000014.png" alt="000014"></span></p>
</div>
<div class="paragraph">
<p>随着导入设备的数千个接口，你可以在设备页面刷新接口表，查看后台发现和添加的接口和服务。
这是定向发现组件。</p>
</div>
<div class="paragraph">
<div class="title">添加设备</div>
<p>直接从外部添加另一个设备 (在这个例子中 Bronze Provisioning Group) 来添加一个新设备定义，并重新导入。
请注意所有的设备定义都将被导入，并且如果必要的话，现有的管理设备将被更新。</p>
</div>
</div>
<div class="sect4">
<h5 id="_更改设备">更改设备</h5>
<div class="paragraph">
<p>直接修改现有的设备，只需要添加，修改，删除设备定义的元素或属性，然后重新导入。
这是一个很大的特性，清单中设备的指定元素可以直接修改。
例如，要修改设备的 Primary SNMP 接口的IP地址，就必须修改清单然后重新导入。</p>
</div>
<div class="paragraph">
<p>Web-UI 中的每个元素都有一个关联的编辑图标。
单击该图标更改 barbrady.opennms.org 的IP地址, 点击保存，然后点击完成按钮。</p>
</div>
<div class="paragraph">
<div class="title"><em>barbrady.opennms.org</em> 的IP从 10.1.1.2 改为 192.168.1.1</div>
<p><span class="image"><img src="images/provisioning/00027.jpeg" alt="00027"></span></p>
</div>
<div class="paragraph">
<p>Web-UI 界面将返回到 <em>Provisioning Groups</em> 页面，在这里你可以看到最后一次修改和最后一次导入时间是最近这次。</p>
</div>
<div class="paragraph">
<div class="title">Provisioning Group 必须重新导入</div>
<p><span class="image"><img src="images/provisioning/000012.png" alt="000012"></span></p>
</div>
<div class="paragraph">
<p>这表明清单修改后分组必须重新导入。
只有IP接口被更新，并且所需的所有事件 (消息) 将发送到 <em>OpenNMS Horizon</em>，来应用更改。</p>
</div>
<div class="paragraph">
<div class="title">barbrady.opennms.org 的IP地址将立即更新</div>
<p><span class="image"><img src="images/provisioning/000008.png" alt="000008"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_删除设备">删除设备</h5>
<div class="paragraph">
<p>如果设备 <em>Barbrady</em> 已经不需要了，就可以把它从系统中删除。
编辑 provisioning group, 单击设备 <em>barbrady.opennms.org</em> 旁边的删除按钮，然后单击 <em>Done</em> 按钮。</p>
</div>
<div class="paragraph">
<div class="title">Bronze Provisioning Group 定义表示已经删除一个设备，需要在 <em>OpenNMS Horizon</em> 系统导入来删除设备</div>
<p><span class="image"><img src="images/provisioning/000010.png" alt="000010"></span></p>
</div>
<div class="paragraph">
<p>单击 Bronze 组的导入按钮，然后设备 Barbrady 和它的接口，服务，及其它相关数据将立即从 <em>OpenNMS Horizon</em> 系统删除。
所有必要事件 (消息) 都将发送到 Provisiond ，<em>OpenNMS Horizon</em> 系统将标示删除设备 Barbrady。</p>
</div>
<div class="paragraph">
<div class="title">Barbrady 已经删除</div>
<p><span class="image"><img src="images/provisioning/000011.png" alt="000011"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_删除所有设备">删除所有设备</h5>
<div class="paragraph">
<p>有一种简单的方法删除外部指定的所有设备。
在Web-UI界面的主 <em>Admin/Provisioning Groups</em> ，单击 <em>Delete Nodes</em> 按钮。
这个按钮将删除 Bronze 清单中的所有设备。
需要注意，此操作不能撤销!
在 Web-UI 界面不能撤销操作，如果你在 '$OPENMS_ETC/' 目录备份了副本，才可以撤销。
如果你在重新导入清单时有错误，请将备份的 <code>Bronze.xml</code> 清单还原到 '$OPENNMS_ETC/imports' 目录。</p>
</div>
<div class="paragraph">
<div class="title">Bronze 清单中定义的所有设备都将删除。 Web-UI 显示导入后设备都从 <em>OpenNMS Horizon</em> 删除了。</div>
<p><span class="image"><img src="images/provisioning/000019.png" alt="000019"></span></p>
</div>
<div class="paragraph">
<p>单击 <em>Import</em> 按钮，<em>Provisiond</em> 将开始 <em>审核操作</em> ，<em>Bronze</em> 组 (外部) 里全部设备将从数据库删除。
这时，如果你确定设备已经删除并且你也不需要该组里定义的设备，你可以看到之前的 <em>删除设备</em> 按钮，现在已经变成了 <em>删除组</em> 按钮。
当 <em>OpenNMS Horizon</em> 中已经没有该组 (外部) 的设备实体时，将显示 <em>删除组</em> 按钮。</p>
</div>
<div class="paragraph">
<p>当该组中没有设备实体存在于 <em>OpenNMS Horizon</em> 中时，将显示 <em>删除组</em> 按钮。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_provisioning_高级配置示例">9.5.2. Provisioning 高级配置示例</h4>
<div class="paragraph">
<p>在前一个示例中，我们提供了3个设备来让 <em>Provisiond</em> 导入操作，并且使用默认的 外部源 定义。
每个 Provisioning Group 可以有一个独立的 外部源 定义来控制:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>扫描间隔</p>
</li>
<li>
<p>要探测的服务</p>
</li>
<li>
<p>应用的策略</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>此示例将演示如何在导入一个 <em>Provisioning Group/外部源申请单</em> 时，如何创建 外部源 定义以及如何使用它来控制 Provisiond 的行为。</p>
</div>
<div class="paragraph">
<p>首先，我们只提供设备，应用默认的 外部源 定义。</p>
</div>
<div class="paragraph">
<div class="title">高级 Provisioning 示例的设备定义</div>
<p><span class="image"><img src="images/provisioning/00025.jpeg" alt="00025"></span></p>
</div>
<div class="paragraph">
<p>导入之后，除了 requisition 中指定的接口之外，所有 IP 和 SNMP 接口都已经被发现并添加到设备实体中。
默认的 外部源 定义中没有用于控制被发现的接口是由 <em>OpenNMS Horizon</em> 保存还是管理的策略。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/provisioning/000005.png" alt="000005"></span></p>
</div>
<div class="paragraph">
<div class="title">逻辑和物理接口还有服务实体都是由 Provisiond 探测发现的。</div>
<p><span class="image"><img src="images/provisioning/000002.png" alt="000002"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/provisioning/000018.png" alt="000018"></span></p>
</div>
<div class="sect4">
<h5 id="_服务探测">服务探测</h5>
<div class="paragraph">
<p>当设备扫描过程中发现了IP接口，就会对每个IP接口安排服务探测任务。
在 外部源 中定义的服务探测器可以确定哪些服务以及如何探测 (像是 控制如何探测服务的参数值，端口，超时等。)。</p>
</div>
<div class="sect5">
<h6 id="_应用新_外部源_定义">应用新 外部源 定义</h6>
<div class="paragraph">
<p>此示例的设备使用默认的 外部源 定义。
导航到 <em>OpenNMS Horizon</em> Web-UI 然后单击编辑 外部源 链接，可以创建定义服务探测器和策略的新 外部源 定义。
策略决定发现实体的存储 和/或 设置属性，用来控制 <em>OpenNMS Horizon</em> 的管理行为。</p>
</div>
<div class="paragraph">
<div class="title">在创建新 外部源 定义时, 默认定义使用模板。</div>
<p><span class="image"><img src="images/provisioning/000017.png" alt="000017"></span></p>
</div>
<div class="paragraph">
<p>在这个 UI 界面, 可以添加，修改和删除新探测器。
在这个例子中，我们将删除所有服务探测器，只留 ICMP 和 DNS 服务, 修改 ICMP 探测器的超时, 然后通过 <em>OpenNMS Horizon</em> Web-UI 新建一个服务探测器。</p>
</div>
<div class="paragraph">
<div class="title">NMS Provisioning Group (外部源) 创建自定义 外部源</div>
<p><span class="image"><img src="images/provisioning/00022.jpeg" alt="00022"></span></p>
</div>
<div class="paragraph">
<p>单击完成按钮并重新导入 NMS Provisioning Group。
在此期间和之后重新导入或重新扫描时, <em>OpenNMS Horizon</em> 探测器激活，但是已经删除的探测器将不再探测在 provisioning group (requisition) 中管理的设备接口上的相关服务, 然而，当前发现的服务不会删除。
有两种方法删除之前发现的服务:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>删除 provisioning group 中的设备, 重新导入, 重新定义它, 然后再次重新导入。</p>
</li>
<li>
<p>使用 ReST API 删除不需要的服务。使用此命令迭代从接口上删除每个不需要的服务:</p>
<div class="literalblock">
<div class="content">
<pre>curl -X DELETE -H "Content-Type: application/xml" -u admin:admin http://localhost:8980/opennms/rest/nodes/6/ipinterfaces/172.16.1.1/services/DNS</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
方法 #1 是一种不好的方法。
编辑 provisioning group 然后修改 foreign ID。
这将使得 Provisiond 认为在相同的清单中删除一个设备然后添加一个设备!
谨慎使用此操作，并充分了解删除现有设备的影响。
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_provisioning_策略_2">Provisioning 策略</h6>
<div class="paragraph">
<p>Provisiond 中的策略 API 允许你在扫描阶段控制发现的 IP 和 SNMP 接口实体及设备分类的存储。</p>
</div>
<div class="paragraph">
<div class="title">匹配 IP 接口策略</div>
<p>匹配的 IP 接口策略控制是否要存储发现的接口，并且如果它们被存储，它们是否被强制管理或非管理。</p>
</div>
<div class="paragraph">
<p>继续使用这个 Provisioning Group 示例, 我们将定义一些策略:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>防止发现的10个网络地址被存储</p>
</li>
<li>
<p>强制 192.168 网络地址非管理</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>从 外部源 定义界面, 单击 Add Policy 按钮，然后定义一个新策略，先输入策略名称并选择目前安装的策略下拉列表。
策略名称 <em>no10s</em>, 确保在类列表中指定 <em>匹配 IP 接口策略</em> ，然后单击保存按钮。
此操作将自动添加策略所需的所有参数。</p>
</div>
<div class="paragraph">
<p>此策略所需的两个参数是操作和匹配行为。</p>
</div>
<div class="paragraph">
<div class="title">操作参数可以设置为 <em>DO_NOT_PERSIST</em>, <em>Manage</em>, 或 <em>UnManage</em>。</div>
<p><span class="image"><img src="images/provisioning/00001.jpeg" alt="00001"></span></p>
</div>
<div class="paragraph">
<div class="title">创建防止 10 网络 IP 接口存储的策略。</div>
<p><em>DO_NOT_PERSIST</em> 操作就像它的名字一样，当满足 <em>matchBehavior</em> 条件时，它防止发现的 IP 接口实体添加到 <em>OpenNMS Horizon</em> 。
此操作的 Manage 和 UnManage 值允许 <em>OpenNMS Horizon</em> 通过 IP 接口的存储来控制是否管理这个接口。</p>
</div>
<div class="paragraph">
<p>matchBehavior 是一个布尔型值，用来控制可选参数如何计算。
设置此参数值为 <em>ALL_PARAMETERS</em> ，来让 <em>Provisiond</em> 通过 <em>AND</em> 逻辑 计算每个可选参数，同时 <em>ANY_PARAMETERS</em> 应用 <em>OR</em> 逻辑。</p>
</div>
<div class="paragraph">
<p>现在我们将添加一个可选参数来过滤10个网络地址.
匹配的IP接口策略支持两个附加参数，<em>hostName</em> 和 <em>ipAddress</em>。
单击 <em>Add Parameter</em> 链接然后选择 <em>ipAddress</em> 作为 <em>key</em>。
可选参数中的 <em>值</em> 即可以是精确表达式也可以是正则表达式匹配。
在 <em>OpenNMS Horizon</em> 中的大多数配置中，都可以应用正则表达式匹配，使用 <code>~</code> 字符前缀值。</p>
</div>
<div class="paragraph">
<div class="title">示例不存储10个网络地址的匹配 IP 接口策略</div>
<p><span class="image"><img src="images/provisioning/00023.jpeg" alt="00023"></span></p>
</div>
<div class="paragraph">
<p>随后扫描的设备或重新导入的 NMS provisioning group 的设备都将强制应用该策略。
与此策略匹配的IP接口实体将不会删除。
在 <em>Provisioning Groups</em> 界面配置中创建的现有接口都能删除 (简单方式是修改 foreign ID 然后重新导入该组) 或通过使用 ReST API:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X DELETE -H "Content-Type: application/xml" -u admin:admin http://localhost:8980/opennms/rest/nodes/6/ipinterfaces/10.1.1.1</pre>
</div>
</div>
<div class="paragraph">
<p>本例下一步是定义一个策略，此策略将 <em>OpenNMS Horizon</em> 中发现的 192.168 网络地址设置为 unmanaged (未管理) 。
再次单击 Add Policy 按钮，让我们调整这个策略 <em>noMgt192168s</em>。
选择匹配IP接口策略，这次设置操作为 <em>UNMANAGE</em>。</p>
</div>
<div class="paragraph">
<div class="title">不管理IP接口 192.168 网络的策略</div>
<p><span class="image"><img src="images/provisioning/00015.jpeg" alt="00015"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>UNMANAGE</em> 行为将应用于现有接口。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">匹配 SNMP 接口策略</div>
<p>与匹配 IP 接口策略相似，此策略控制是否要存储发现的 SNMP 接口实体，以及 <em>OpenNMS Horizon</em> 是否要从 SNMP agent 采集性能数据，接口的索引(MIB2 IfIndex)。</p>
</div>
<div class="paragraph">
<p>在这个例子中，我们将创建一个策略，不存储 <em>ATM</em> 或 类型 <em>49</em> (<em>ifType</em>) 上的  <em>AAL5</em> 接口。
遵循与创建IP管理策略相同的步骤，编辑 外部源 定义然后创建新策略。
让我们叫他: <em>noAAL5s</em>。
我们将为每个策略使用匹配 SNMP 接口类，并添加一个参数，key 为 <em>ifType</em> ，value 为 <em>49</em> 。</p>
</div>
<div class="paragraph">
<div class="title">匹配存储和数据采集的 SNMP 接口策略示例</div>
<p><span class="image"><img src="images/provisioning/00003.jpeg" alt="00003"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在扫描阶段期间，Provisiond 将
评估 外部源 定义中的策略并采取适当的操作。
如果在策略评估过程中，
有策略与 “DO_NOT_PERSIST” 操作匹配，
则不会对该特定实体 (IP 接口, SNMP 接口) 进行进一步的策略评估。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">设备分类策略</div>
<p>使用此策略，设备实体将自动被分配分类。
该策略的定义与 IP 和 SNMP 接口策略相同。
点击 Add Policy 按钮，并提供策略名称, <code>cisco</code> 然后选择 <em>Set Node Category</em> 类。
编辑所需的 key 为 <em>category</em> 然后设置 value 为 <code>Cisco</code>。
添加一个策略参数，并选择 key 为 <em>sysObjectId</em> 同时 value 为 <code>~^\.1\.3\.6\.1\.4\.1\.9\..*</code>。</p>
</div>
<div class="paragraph">
<div class="title">示例: 设备分类设置策略</div>
<p><span class="image"><img src="images/provisioning/00020.jpeg" alt="00020"></span></p>
</div>
<div class="paragraph">
<div class="title">脚本策略</div>
<p>此策略允许使用 <em>Groovy</em> 脚本修改 provisioned 设备数据。
这些脚本必须放在 OpenNMS Horizon <code>etc/script-policies</code> 目录中。
例如，设备的主(primary)接口或位置(location)的更改。
将对每个匹配的设备调用脚本。
下面的示例代码用于将 <code>192.168.100.0/24</code> 接口设置为 <code>PRIMARY</code>，而将所有剩余接口设置为 <code>SECONDARY</code>。
此外，设备的位置（location）被设置为 <code>Minneapolis</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">import org.opennms.netmgt.model.OnmsIpInterface;
import org.opennms.netmgt.model.monitoringLocations.OnmsMonitoringLocation;
import org.opennms.netmgt.model.PrimaryType;

for(OnmsIpInterface iface : node.getIpInterfaces()) {
    if (iface.getIpAddressAsString().matches("^192\\.168\\.100\\..*")) {
        LOG.warn(iface.getIpAddressAsString() + " set to PRIMARY")
        iface.setIsSnmpPrimary(PrimaryType.PRIMARY)
    } else {
        LOG.warn(iface.getIpAddressAsString() + " set to SECONDARY")
        iface.setIsSnmpPrimary(PrimaryType.SECONDARY)
    }
}

node.setLocation(new OnmsMonitoringLocation("Minneapolis", ""));

return node;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_新的导入功能">新的导入功能</h5>
<div class="paragraph">
<p>从版本1.6 开始 OpenNMS 加入了导入服务后，一些新的 XML 实体已经添加到导入清单中。
因此, 除了提供基本的设备，接口，服务和设备分类，你现在还可以提供资产数据。</p>
</div>
<div class="sect5">
<h6 id="_provisiond_配置">Provisiond 配置</h6>
<div class="paragraph">
<p>Provisioning 系统的配置已经从属性文件 (<code>model-importer.properties</code>) 改为基于 XML 的配置容器。
该配置现在是可扩展的，允许0或多个导入清单定义，每个都有自己基于 <em>Cron</em> 的时间表，用于从各种源自动导入 (旨在与外部 URL ，像 HTTP 和新 DNS 协议处理程序集成)。</p>
</div>
<div class="paragraph">
<p>provided 的默认配置在 <em>OpenNMS Horizon</em> 的 <code>etc/</code> 目录下，名字是: <code>provisiond-configuration.xml</code>。
此默认配置有一个示例，用于从本地设备上运行的 DNS 服务器，按照时间计划导入，并且是每天午夜时导入一次。虽然不是很实用，但是个很好的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;provisiond-configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://xmlns.opennms.org/xsd/config/provisiond-configuration"
        foreign-source-dir="/opt/opennms/etc/foreign-sources"
        requistion-dir="/opt/opennms/etc/imports"
        importThreads="8"
        scanThreads="10"
        rescanThreads="10"
        writeThreads="8" &gt;
    &lt;!--
        http://www.quartz-scheduler.org/documentation/quartz-1.x/tutorials/crontrigger[http://www.quartz-scheduler.org/documentation/quartz-1.x/tutorials/crontrigger]
        Field Name Allowed Values Allowed Special Characters
        Seconds 0-59 , - * / Minutes 0-59 , - * / Hours 0-23 , - * /
        Day-of-month1-31, - * ? / L W C Month1-12 or JAN-DEC, - * /
        Day-of-Week1-7 or SUN-SAT, - * ? / L C # Year (Opt)empty, 1970-2099, - * /
    --&gt;

    &lt;requisition-def import-name="NMS"
                     import-url-resource="file://opt/opennms/etc/imports/NMS.xml"&gt;
        &lt;cron-schedule&gt;0 0 0 * * ? *&lt;/cron-schedule&gt; &lt;!-- daily, at midnight --&gt;
    &lt;/requisition-def&gt;
&lt;/provisiond-configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">配置重新载入</div>
<p>像 1.7 分支中的许多模块的配置一样，在不必重新启动 OpenNMS 的情况下，就可以重新加载 <em>Provisiond 的</em> 配置。
使用 reloadDaemonConfig uei:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/opt/opennms/bin/send-event.pl uei.opennms.org/internal/reloadDaemonConfig --parm 'daemonName Provisiond'</pre>
</div>
</div>
<div class="paragraph">
<p>这意味着，每次更新配置后，不必重新启动 <em>OpenNMS Horizon</em> !</p>
</div>
</div>
<div class="sect5">
<h6 id="_provisioning_资产数据">Provisioning 资产数据</h6>
<div class="paragraph">
<p>Provisioning Groups 已经更新从 Web-UI 界面，并且在导入清单中也可以添加设备资产数据。
单击 <em>Add Node Asset</em> 链接，然后可以从下拉列表中选择所有可定义的设备资产属性。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/provisioning/00024.jpeg" alt="00024"></span></p>
</div>
<div class="paragraph">
<p>导入之后，你可以导航到 <em>设备页面</em> 然后单击 <em>资产信息</em> 链接就可以看到刚刚在表单中提供的资产数据。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/provisioning/000004.png" alt="000004"></span></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_外部_requisition_源">外部 Requisition 源</h5>
<div class="paragraph">
<p>由于 Provisiond 需要 <em>URL</em> 作为导入表单的位置服务， <em>OpenNMS Horizon</em> 除了支持处理本地 URL ，也可在扩展到 Java 支持的: <em>file://</em>, <em>http://</em>, 和 <em>https://</em> 。
当你配置 <em>Provisiond</em> 的时间计划导入清单时，可以配置一个 <em>URL</em> 资源。
对于 <em>Provisioning Groups</em> WebUI 界面创建的表单, 你可以指定一个文件的 URL。</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
&lt;need further documentation&gt;
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_从_dns_提供设备">从 DNS 提供设备</h6>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 中的 Provisioning 服务正在不断改进并适应新的需求。
对系统的最新改进之一是建立在非常灵活和可扩展的API上，它通过URL引用一个导入请求的位置。
最常见的是，这些 URLs 是文件系统上的文件 (例如 <code>file:/opt/opennms/etc/imports/&lt;my-provisioning-group.xml&gt;</code>) 作为 Provisioning Groups UI 界面上创建的请求表单。但是, 这些添加，更新和删除的请求表单 (基于原始模型导入) 也可以指定 HTTP 协议的 URLs : <a href="http://myinventory.server.org/nodes.cgi" class="bare">http://myinventory.server.org/nodes.cgi</a>)</p>
</div>
<div class="paragraph">
<p>现在, 使用 Java 的扩展协议处理规范，创建一个新的协议处理程序，根据指定的 URL 从 DNS 服务器获取区域转移 (<em>AXFR</em>) 请求。
<em>一条记录</em> 用来构建一个导入请求清单。
对于使用 DNS (可能与 IP 管理工具一起) 作为网络中设备记录的数据仓库，是很方便的。
因此, 比起用 ping 扫描网络或从 <em>OpenNMS Horizon</em> 的 Provisioning UI 界面手动输入设备信息, 通过一个或多个 DNS 服务器来管理设备要方便。
此新协议处理程序的 URL 格式是:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dns://&lt;host&gt;[:port]/&lt;zone&gt;[/&lt;foreign-source&gt;/][?expression=&lt;regex&gt;]</pre>
</div>
</div>
<div class="literalblock">
<div class="title">简单实例</div>
<div class="content">
<pre>dns://my-dns-server/myzone.com</pre>
</div>
</div>
<div class="paragraph">
<p>这将从区域 <em>myzone.com</em> 的主机 <em>my-dns-server</em> 端口 53 (默认端口) 中导入所有的 <em>记录</em>，并且由于没有指定 外部源 (也叫作 provisioning group) ，它将指定为默认区域。</p>
</div>
<div class="paragraph">
<div class="title">使用正则表达式过滤</div>
<p>你也可以使用正则表达式从 zone transfer 过滤 <em>记录</em> :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dns://my-dns-server/myzone.com/portland/?expression=^por-.*</pre>
</div>
</div>
<div class="paragraph">
<p>这将从同一服务器和区域导入所有设备，但只管理区域中与正则表达式 <code>^port-.*</code> 匹配的设备，并且给他们分配一个唯一的 外部源 (provisioning group) ，用于管理这个指定区域内的设备。</p>
</div>
<div class="paragraph">
<div class="title">URL 编码</div>
<p>如果你对表达式需要 URL 编码 (例如，你需要在表达式中使用 <code>?</code>) ，必须正确编码。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dns://my-dns-server/myzone.com/portland/?expression=^por[0-9]%3F</pre>
</div>
</div>
<div class="paragraph">
<div class="title">DNS 设置</div>
<p>目前, DNS 服务器需要进行设置，来允许 <em>OpenNMS Horizon</em> 服务器进行区域转移。
建议在 <em>OpenNMS Horizon</em> 上允许辅助 DNS 服务器，并允许 <em>OpenNMS Horizon</em> 服务器请求区域转移。
一种快速测试区域转移的方法是:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dig -t AXFR @&lt;dn5Server&gt; &lt;zone&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_适配器">9.6. 适配器</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 的 <em>Provisiond API</em> 也支持 <em>探针适配器</em> (插件) 来整合外部系统的引入阶段。
当设备实体的添加，更新，删除，或收到一个配置管理变化的事件， <em>OpenNMS Horizon</em> 将调用集成系统的引入活动适配器。</p>
</div>
<div class="paragraph">
<p>目前, <em>OpenNMS Horizon</em> 支持以下适配器:</p>
</div>
<div class="sect3">
<h4 id="_ddns_适配器">9.6.1. DDNS 适配器</h4>
<div class="paragraph">
<p><em>Provisiond</em> 从 DNS 请求导入集成的另一端是 <em>DDNS 适配器</em>。
该适配器使用 <em>动态DNS协议</em> 来更新 DNS 系统，作为设备引入 <em>OpenNMS Horizon</em>。
要配置这个适配器, 编辑 <code>opennms.properties</code> 文件，然后设置 <code>importer.adapter.dns.server 属性</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>importer.adapter.dns.server=192.168.1.1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rancid_适配器">9.6.2. RANCID 适配器</h4>
<div class="paragraph">
<p>通过新 API 已经集成了 RANCID。</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
&lt;需要更多的文档&gt;
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Maps (即将移至 Mapd) &lt;需要文档&gt;
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
WiMax-Link (即将移至 Linkd) &lt;需要文档&gt;
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_整合_provisiond">9.7. 整合 Provisiond</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 的 ReST API 可以用来与其他 provisioning 系统集成。
ReST API 提供定义外部源和申请单的接口。</p>
</div>
<div class="sect3">
<h4 id="_provisioning_groups_设备">9.7.1. Provisioning Groups 设备</h4>
<div class="paragraph">
<p>正如 WebUI 一样, 可以通过外部系统的 ReST API 管理设备组。
步骤如下:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>为组创建一个外部源 (如果没有，则使用默认)</p>
</li>
<li>
<p>更新组中每个设备的 SNMP 配置</p>
</li>
<li>
<p>创建/更新设备组</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_例子">9.7.2. 例子</h4>
<div class="sect4">
<h5 id="_步骤_1_创建外部源">步骤 1 - 创建外部源</h5>
<div class="paragraph">
<p>要想对该组的设备指定不同于默认策略的设定，则应该为该组创建外部源。
使用 ReST API, 可以提供外部源。
下面是一个例子:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>curl</code> 命令选项 <code>-d</code> 可以指定 XML，或者在文件名前加 <code>@</code> 前缀来引用文件。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>XML 文件: <code>customer-a.foreign-source.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;foreign-source date-stamp="2009-10-12T17:26:11.616-04:00" name="customer-a" xmlns="http://xmlns.opennms.org/xsd/config/foreign-source"&gt;
    &lt;scan-interval&gt;1d&lt;/scan-interval&gt;
    &lt;detectors&gt;
        &lt;detector class="org.opennms.netmgt.provision.detector.icmp.IcmpDetector" name="ICMP"/&gt;
        &lt;detector class="org.opennms.netmgt.provision.detector.snmp.SnmpDetector" name="SNMP"/&gt;
    &lt;/detectors&gt;
    &lt;policies&gt;
        &lt;policy class="org.opennms.netmgt.provision.persist.policies.MatchingIpInterfacePolicy" name="no-192-168"&gt;
            &lt;parameter value="UNMANAGE" key="action"/&gt;
            &lt;parameter value="ALL_PARAMETERS" key="matchBehavior"/&gt;
            &lt;parameter value="~^192\.168\..*" key="ipAddress"/&gt;
        &lt;/policy&gt;
    &lt;/policies&gt;
&lt;/foreign-source&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是一个使用 <code>curl</code> 命令创建外部源的例子，指定上面显示的外部源:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">curl -v -u admin:admin -X POST -H 'Content-type: application/xml' -d '@customer-a.foreign-source.xml' http://localhost:8980/opennms/rest/foreignSources</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，你已经创建了外部源，它需要通过 Provisiond 来部署。
下面是使用 <code>curl</code> 命令部署外部源的示例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">curl -v -u admin:admin http://localhost:8980/opennms/rest/foreignSources/pending/customer-a/deploy -X PUT</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
目前 API 不严格遵循 ReST 设计原则，将在之后的版本中更新。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_步骤_2_更新_snmp_配置">步骤 2 - 更新 SNMP 配置</h5>
<div class="paragraph">
<p>目前只实现了 <em>PUT</em> 请求，因为它是一个代表 "更新" 配置，并且需要一个IP地址或默认配置的全部IP。
此请求被传递到 <em>OpenNMS Horizon</em> 中的 SNMP 配置工厂，并优化配置存储到 <code>snmp-config.xml</code>。
这个例子修改 IP地址 10.1.1.1 的团体名为 <code>yRuSonoZ</code>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
团体名字符串是唯一必须元素
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">curl -v -X PUT -H "Content-Type: application/xml" -H "Accept: application/xml" -d &lt;snmp-info&gt;&lt;community&gt;yRuSonoZ&lt;/community&gt;&lt;port&gt;161&lt;/port&gt;&lt;retries&gt;1&lt;/retries&gt;&lt;timeout&gt;2000&lt;/timeout&gt;&lt;version&gt;v2c&lt;/version&gt;&lt;/snmp-info&gt;" -u admin:admin http://localhost:8980/opennms/rest/snmpConfig/10.1.1.1</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_步骤_3_创建更新_申请单">步骤 3 - 创建/更新 申请单</h5>
<div class="paragraph">
<p>这个实例向 Provisioning Group, <em>customer-a</em> 添加2个设备。
请注意，外部源属性通常与 Provisioning Group 申请单是1对1的关系。
申请表中的外部源与外部源策略之间是直接关联的。
此外, 通常 provisioning group 名称也相同。
在下面的示例中，ReST API 将根据 XML 中指定的外部源属性自动创建 provisioning group 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">curl -X POST -H "Content-Type: application/xml" -d "&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;model-import xmlns="http://xmlns.opennms.org/xsd/config/model-import" date-stamp="2009-03-07T17:56:53.123-05:00" last-import="2009-03-07T17:56:53.117-05:00" foreign-source="customer-a"&gt;&lt;node node-label="p-brane" foreign-id="1" &gt;&lt;interface ip-addr="10.0.1.3" descr="en1" status="1" snmp-primary="P"&gt;&lt;monitored-service service-name="ICMP"/&gt;&lt;monitored-service service-name="SNMP"/&gt;&lt;/interface&gt;&lt;category name="Production"/&gt;&lt;category name="Routers"/&gt;&lt;/node&gt;&lt;node node-label="m-brane" foreign-id="1" &gt;&lt;interface ip-addr="10.0.1.4" descr="en1" status="1" snmp-primary="P"&gt;&lt;monitored-service service-name="ICMP"/&gt;&lt;monitored-service service-name="SNMP"/&gt;&lt;/interface&gt;&lt;category name="Production"/&gt;&lt;category name="Routers"/&gt;&lt;/node&gt;&lt;/model-import&gt;" -u admin:admin http://localhost:8980/opennms/rest/requisitions</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 <code>curl</code> 命令成功执行后，在 <em>OpenNMS Horizon</em> 系统上将生成名为 <code>etc/imports/customer-a.xml</code> 文件，并且通过 WebUI 可以看到。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
通过 ReST API 详细描述的相同方式，来处理 <em>添加</em>, <em>更新</em>, <em>删除</em> 操作。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_单个设备_快速添加设备">9.8. Provisioning 单个设备 (快速添加设备)</h3>
<div class="paragraph">
<div class="title">向申请单添加设备</div>
<p>有时候, 可能需要为已定义完成的 provisioning group 来 添加/更新 一个单独的设备。
在 <em>OpenNMS Horizon</em> Web-UI 中可以找到 <em>添加设备</em> 的 ReST API 实现。
因此, 即使组中没有定义设备，在系统中也必须存在 provisioning group 。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建外部源 (如果需要)</p>
</li>
<li>
<p>指定 SNMP 配置</p>
</li>
<li>
<p>提供具有以下规范的单个设备</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_使用_provision_pl_配置_provisioning">9.9. 使用 <em>provision.pl</em> 配置 Provisioning</h3>
<div class="paragraph">
<p><em>provision.pl</em> 是一个命令行接口，通过 <em>OpenNMS Horizon</em> 的 REST API 方式。</p>
</div>
<div class="paragraph">
<p>该脚本有许多选项，但这里只介绍3个参数:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
你可以使用 <code>--help</code> 来查看所有可用的选项。
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>--username (默认: admin)
--password (默认: admin)
--url (默认: http://localhost:8980/opennms/rest)</pre>
</div>
</div>
<div class="sect3">
<h4 id="_创建一个新_requisition">9.9.1. 创建一个新 requisition</h4>
<div class="paragraph">
<p><em>provision.pl</em> 使用 <em>requisition</em> 选项，可用轻松访问 requisition REST 服务:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl requisition customer1</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个命令将在 <em>OpenNMS Horizon</em> 中创建一个新的，空的 (不包含设备) requisition 。</p>
</div>
<div class="paragraph">
<p>新创建的 requisition 开始阶段处于 <code>pending</code> 状态。
这样你就可以迭代的构建 requisition ，并且稍后可以将 requisition 中的设备导入到 <em>OpenNMS Horizon</em> 中。
一次性处理所有的 添加/更改/删除。
因此, 你可以在白天进行更改，然后在晚上通过 <em>OpenNMS Horizon</em> 的时间计划自动导入组，或者从外部系统通过 REST 服务发送命令，来将准备好的 requisition 导入/重新导入。</p>
</div>
<div class="paragraph">
<p>你可以使用 <code>provision.pl</code> 脚本的 <code>list</code> 选项来获取当前所有的 requisitions :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl list</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_创建新设备">创建新设备</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl node add customer1 1 node-a</code></pre>
</div>
</div>
<div class="paragraph">
<p>此命令使用脚本的 <em>node</em> 选项在 requisition <em>customer1</em> 创建一个叫 <em>node-a</em> 的设备元素。设备的 foreign-ID 是 <em>1</em> ，但它可以是任何字母数字值，只要在 requisition 中是唯一的。
注意，设备还没有接口或服务。</p>
</div>
</div>
<div class="sect4">
<h5 id="_向设备添加接口元素">向设备添加接口元素</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl interface add customer1 1 127.0.0.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>命令 <code>provision.pl</code> 的 <em>interface</em> 选项添加接口元素到设备上，现在可以运行 <code>provision.pl requisition list customer1</code> 命令查看准备好的 requisition。</p>
</div>
</div>
<div class="sect4">
<h5 id="_将两个服务添加到接口">将两个服务添加到接口</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl service add customer1 1 127.0.0.1 ICMP
${OPENNMS_HOME}/bin/provision.pl service add customer1 1 127.0.0.1 SNMP</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将添加2个服务到指定的 127.0.0.1 接口，现在是准备 requisition。</p>
</div>
</div>
<div class="sect4">
<h5 id="_设置_primary_snmp_接口">设置 Primary SNMP 接口</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl interface set customer1 1 127.0.0.1 snmp-primary P</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将设置 127.0.0.1 接口为设备的 Primary SNMP 接口。</p>
</div>
</div>
<div class="sect4">
<h5 id="_添加两个设备分类">添加两个设备分类</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl category add customer1 1 Routers
${OPENNMS_HOME}/bin/provision.pl category add customer1 1 Production</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将添加两个设备分类，现在是准备 requisition。</p>
</div>
<div class="paragraph">
<p>这些分类是区分大小写的，，但不需要先在 <em>OpenNMS Horizon</em> 中定义。
如果它们不存在，它们将在导入时被动态地创建。</p>
</div>
</div>
<div class="sect4">
<h5 id="_设置设备的资产字段">设置设备的资产字段</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl asset add customer1 1 serialnumber 9999</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将添加值为 <code>9999</code> 的资产字段: <em>serialnumber</em>。</p>
</div>
<div class="listingblock">
<div class="title">部署导入 Requisition (创建组)</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl requisition import customer1</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将使 <em>OpenNMS Horizon</em> 的 Provisiond 模块导入准备好的 <code>customer1</code> requisition。
在 <em>OpenNMS Horizon</em> 内之前准备的 requisition 将进入 <code>deployed</code> 状态。</p>
</div>
<div class="paragraph">
<div class="title">从 Requisition 中删除设备</div>
<p>与添加相同，除了要执行删除命令，还需要执行重新导入命令。
由 Provisiond 执行检查，并决定从 requisition 删除设备，然后设备将从数据库删除，同时相关的所有服务也将停止活动。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">${OPENNMS_HOME}/bin/provision.pl node delete customer1 1 node-a
${OPENNMS_HOME}/bin/provision.pl requisition import customer1</code></pre>
</div>
</div>
<div class="paragraph">
<p>这就是管理设备元素的完整生命周期。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_其它_api_示例">9.10. 其它 API 示例</h3>
<div class="paragraph">
<div class="title">列出 Provisioning Group 中的设备</div>
<p>脚本 <code>provision.pl</code> 没有提供这个特性，但是你可以通过 REST API 获得。下面是使用 <code>curl</code> 的示例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-bash" data-lang="bash">#!/bin/bash
REQ=$1
curl -X GET -H "Content-Type: application/xml" -u admin:admin http://localhost:8980/opennms/rest/requisitions/$REQ 2&gt;/dev/null | xmllint --format -</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-provisioning-detectors">9.11. 服务探测器</h3>
<div class="sect3">
<h4 id="_http_探测器">9.11.1. HTTP 探测器</h4>
<div class="paragraph">
<p>该探测器用于发现和指出 <em>HTTP</em> 服务。</p>
</div>
<div class="sect4">
<h5 id="_探测器定义">探测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">实现</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.provision.detector.simple.HttpDetector</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_50">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 94. HTTP 探测器的参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkRetCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果设置为 true，则只有 HTTP 状态代码与 <em>maxRetCode</em> 值相同或更低时，
                   通过</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxRetCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过的最高 HTTP 响应代码。<em>maxRetCode</em> 只有在 checkRetCode 设置
                   为 true 时，才进行检查。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">399</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询端口                          .</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询 Url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待响应的超时，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>请注意:</em> Http 探测器只发出一个 http 请求，不会进行重定向。</p>
</div>
</div>
<div class="sect4">
<h5 id="_示例配置">示例配置</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;foreign-source date-stamp="2010-06-29T13:15:30.494+02:00" name="test" xmlns="http://xmlns.opennms.org/xsd/config/foreign-source"&gt;
  &lt;scan-interval&gt;1d&lt;/scan-interval&gt;
  &lt;detectors&gt;
    &lt;detector class="org.opennms.netmgt.provision.detector.simple.HttpDetector" name="http8080"&gt;
      &lt;parameter key="port" value="8080"/&gt;
      &lt;parameter key="url" value="index2.html" /&gt;
      &lt;parameter key="maxRetCode" value="200"/&gt;
      &lt;parameter key="checkRetCode" value="true"/&gt;
    &lt;/detector&gt;
  &lt;/detectors&gt;
  &lt;policies/&gt;
&lt;/foreign-source&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_https_探测器">9.11.2. HTTPS 探测器</h4>
<div class="paragraph">
<p>该探测器用于发现和指出 <em>HTTPS</em> 服务。</p>
</div>
<div class="sect4">
<h5 id="_探测器定义_2">探测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">实现</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.provision.detector.simple.HttpsDetector</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_51">配置与使用</h5>
<div class="paragraph">
<div class="title">HTTPS 探测器的参数</div>
<p><em>参数与 HTTP 探测器相同</em></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_snmp_探测器">9.11.3. SNMP 探测器</h4>
<div class="paragraph">
<p>该探测器用于发现和指出 <em>SNMP</em> 服务。
当特定 <em>SNMP OID</em> 的值与给定标准匹配时，探测器将服务绑定到 <em>服务名称</em> 。</p>
</div>
<div class="sect4">
<h5 id="_探测器定义_3">探测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">实现</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.provision.detector.snmp.SnmpDetector</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_52">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 95. SNMP 探测器的参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">探测服务的 <em>SNMP OID</em> 或表。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.1.2.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">探测服务的重试次数。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>agent config</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">等待 <em>SNMP</em> 代理的响应时间，单位毫秒。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>agent config</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vbvalue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">探测服务的预期返回值；如果没有指定，则检查 <em>SNMP OID</em> 的值是否存在。
                返回任何有效值。
                关于 <code>vbvalue</code> 有效配置参考
                <a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">Java 正则表达式</a>。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果数据是 <em>十六进制字符串</em>，则设置为 <code>true</code> 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isTable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果探测的是 <em>SNMP 表</em> ，则设置为 <code>true</code> 。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>matchType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">设置匹配类型，以评估SNMP表中的预期值。<br>
                <em>EXIST</em>: 期望值 <code>vbalue</code> 被忽略，如果给定表中存在 <em>OID</em> ，则检测到服务。<br>
                <em>ALL</em>: 表中的所有值必须与预期值 <code>vbalue</code> 匹配，才算检测到服务<br>
                <em>ANY</em>: 表中至少有一个值与预期值 <code>vbalue</code> 匹配，才算检测到服务<br>
                <em>NONE</em>: 没有一个值与预期值匹配，就算检测到服务</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可选</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXIST</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_snmp_标量值示例">SNMP 标量值示例</h5>
<div class="paragraph">
<p>我们有一台 <em>Dell</em> 服务器，并且希望通过 <em>OpenManage Server Administrator</em> 监控全局服务器状态。
全局状态由标量 <em>OID</em> <code>.1.3.6.1.4.1.674.10892.1.200.10.1.2.1</code> 提供。
如果服务器支持这个 <em>OID</em>，服务应该可以自动探测到。</p>
</div>
<div class="paragraph">
<p>对于探针，我们有一个名为 <em>服务器</em> 的检测列表，它包含了我们数据中心的所有服务器。
一个名为 <em>Dell-OMSA-Global-State</em> 的 <em>探测器</em> 要创建如下参数：</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 96. SNMP 探测器的参数</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Dell-OMSA-Global-State</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.674.10892.1.200.10.1.2.1</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当检测 <em>服务器</em> 同步时，如果它们支持给定的 <em>SNMP OID</em>，服务 <em>Dell-OMSA-Global-State</em> 将被探测到。</p>
</div>
</div>
<div class="sect4">
<h5 id="_使用snmp表的示例">使用SNMP表的示例</h5>
<div class="paragraph">
<p>我们有一个 <em>HP</em> 服务器，想通过 <em>SNMP</em> 从 <em>HP Insight Manager</em> 监控逻辑驱动器状况。
逻辑驱动器的状态在表 <code>.1.3.6.1.4.1.232.3.2.3.1.1.4</code> 中提供。
服务将自动分配给所有服务器，提供给 <em>SNMP OID</em>。</p>
</div>
<div class="paragraph">
<p>对于探针，我们有一个名为 <em>服务器</em> 的检测列表，它包含了我们数据中心的所有服务器。
一个名为 <em>HP-Insight-Drive-Logical</em> 的 <em>探测器</em> 要创建如下参数：</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 97. SNMP 探测器的参数</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HP-Insight-Drive-Logical</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.232.3.2.3.1.1.4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isTable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当检测 <em>服务器</em> 同步时，如果它们支持给定的 <em>SNMP OID</em> 表，服务 <em>HP-Insight-Drive-Logical</em> 将被探测到。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ws_man_探测器">9.11.4. WS-Man 探测器</h4>
<div class="paragraph">
<p>WS-Management 探测器尝试连接 <code>wsman-config.xml</code> 中定义的代理，并发出识别命令。
如果识别命令执行成功，则服务标记为检测到，并且选择性地将命令返回的产品详情存储到资产字段中（参见下面的详细信息）。</p>
</div>
<div class="sect4">
<h5 id="_探测器定义_4">探测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">实现</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.provision.detector.wsman.WsManDetector</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_53">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 98. 参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updateAssets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 <code>vendor</code> 和 <code>modelNumber</code> 的资产字段存储产品供应商和产品版本</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_实例_43">实例</h5>
<div class="paragraph">
<p>如果接收到识别命令的有效响应，则产品供应商和产品版本存储在设备关联的资产表 <code>vendor</code> 和 <code>modelNumber</code> 字段中。</p>
</div>
<div class="paragraph">
<p>例如， Windows Server 2008 返回:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Product Vendor</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft Corporation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Product Version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS: 6.1.7601 SP: 1.0 Stack: 2.0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果这些资产字段要用于其它目的，可以通过在外部源的探测器配置中设置 <code>updateAssets</code> 参数为 <code>false</code> ，来禁用此操作。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
某些代理可能响应具有通用身份的标识命令，例如 <code>Openwsman</code> <code>2.0.0</code>。
      通过在 <code>wsman-config.xml</code> 中指定 <code>product-vendor</code> 和 <code>product-version</code> 属性可以覆盖这些值。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>探测器配置实例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;detector name="WS-Man" class="org.opennms.netmgt.provision.detector.wsman.WsManDetector"&gt;
    &lt;parameter key="updateAssets" value="true"/&gt;
&lt;/detector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>调试信息的响应日志在 <code>provisiond.log</code> 中，并且看起来如下所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">ID: 3
Response-Code: 200
309Encoding: UTF-8
Content-Type: application/soap+xml;charset=UTF-8
Headers: {Content-Length=[787], content-type=[application/soap+xml;charset=UTF-8], Date=[Mon, 08 Feb 2016 14:21:20 GMT], Server=[Microsoft-HTTPAPI/2.0]}
Payload:
&lt;s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xml:lang="en-US"&gt;
  &lt;s:Header/&gt;
  &lt;s:Body&gt;
    &lt;wsmid:IdentifyResponse xmlns:wsmid="http://schemas.dmtf.org/wbem/wsman/identity/1/wsmanidentity.xsd"&gt;
    &lt;wsmid:ProtocolVersion&gt;http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd&lt;/wsmid:ProtocolVersion&gt;
    &lt;wsmid:ProductVendor&gt;Microsoft Corporation&lt;/wsmid:ProductVendor&gt;<i class="conum" data-value="1"></i><b>(1)</b>
    &lt;wsmid:ProductVersion&gt;OS: 6.2.9200 SP: 0.0 Stack: 3.0&lt;/wsmid:ProductVersion&gt;<i class="conum" data-value="2"></i><b>(2)</b>
    &lt;wsmid:SecurityProfiles&gt;
      &lt;wsmid:SecurityProfileName&gt;http://schemas.dmtf.org/wbem/wsman/1/wsman/secprofile/http/basic&lt;/wsmid:SecurityProfileName&gt;
      &lt;wsmid:SecurityProfileName&gt;http://schemas.dmtf.org/wbem/wsman/1/wsman/secprofile/http/spnego-kerberos&lt;/wsmid:SecurityProfileName&gt;
    &lt;/wsmid:SecurityProfiles&gt;
    &lt;/wsmid:IdentifyResponse&gt;
  &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>ProductVendor</code>: 存储到资产字段 <code>vendor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ProductVersion</code>: 存储到资产字段 <code>modelNumber</code></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 <em>系统定义规则</em> 中使用资产字段的信息来决定从 <em>Collectd</em> 收集哪些性能指标。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ws_man_wql_探测器">9.11.5. WS-Man WQL 探测器</h4>
<div class="paragraph">
<p>WS-Management WQL 探测器尝试连接到 <code>wsman-config.xml</code> 中定义的代理并发出 WQL 查询。</p>
</div>
<div class="sect4">
<h5 id="_探测器定义_5">探测器定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">实现</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.provision.detector.wsman.WsManWQLDetector</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_配置与使用_54">配置与使用</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 99. WS-Management WQL 探测器的参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resourceUri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceUri 由前缀和资源路径组成。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://schemas.microsoft.com/wbem/wsman/1/wmi/root/cimv2/*" class="bare">http://schemas.microsoft.com/wbem/wsman/1/wmi/root/cimv2/*</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用 WQL 过滤器语言来查询</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serviceName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于标识此服务的自定义服务名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WsManWQLService</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_实例_44">实例</h5>
<div class="paragraph">
<p>探测器配置的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;detector name="WinRM" class="org.opennms.netmgt.provision.detector.wsman.WsManWQLDetector"&gt;
   &lt;parameter key="resourceUri" value="http://schemas.microsoft.com/wbem/wsman/1/wmi/root/cimv2/*"/&gt;
   &lt;parameter key="serviceName" value="WinRM"/&gt;
   &lt;parameter key="wql" value="select Name,Status from Win32_Service where Name = 'WinRM' and StartMode='Auto' and Status = 'OK'"/&gt;
&lt;/detector&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>该响应的 <em>DEBUG</em> 日志记录在 <code>provisiond.log</code>，像如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">ID: 167
Response-Code: 200
Encoding: UTF-8
Content-Type: application/soap+xml;charset=UTF-8
Headers: {Content-Length=[975], content-type=[application/soap+xml;charset=UTF-8], Date=[Thu, 02 Aug 2018 20:34:33 GMT], Server=[Microsoft-HTTPAPI/2.0]
Payload: &lt;s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://schemas.xmlsoap.org/ws/2004/08/addressing" xmlns:n="http://schemas.xmlsoap.org/ws/2004/09/enumeration" xmlns:w="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd" xml:lang="en-US"&gt;
  &lt;s:Header&gt;
    &lt;a:Action&gt;http://schemas.xmlsoap.org/ws/2004/09/enumeration/EnumerateResponse&lt;/a:Action&gt;
    &lt;a:MessageID&gt;uuid:2298892C-575F-4722-82F6-C77F9E8B1A4F&lt;/a:MessageID&gt;
    &lt;a:To&gt;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&lt;/a:To&gt;
    &lt;a:RelatesTo&gt;urn:uuid:3c63e4d5-890c-4706-854b-876bf3b35b99&lt;/a:RelatesTo&gt;
  &lt;/s:Header&gt;
  &lt;s:Body&gt;
    &lt;n:EnumerateResponse&gt;
      &lt;n:EnumerationContext/&gt;
      &lt;w:Items&gt;
        &lt;w:XmlFragment xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:w="http://schemas.dmtf.org/wbem/wsman/1/wsman.xsd" xmlns:m="http://schemas.microsoft.com/wbem/wsman/1/wsman.xsd"&gt;
          &lt;Name&gt;WinRM&lt;/Name&gt;
          &lt;Status&gt;OK&lt;/Status&gt;
        &lt;/w:XmlFragment&gt;
      &lt;/w:Items&gt;
      &lt;w:EndOfSequence/&gt;
    &lt;/n:EnumerateResponse&gt;
  &lt;/s:Body&gt;
&lt;/s:Envelope&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-bsm">10. Business Service Monitoring</h2>
<div class="sectionbody">
<div id="ga-bsm-introduction" class="paragraph">
<p>While <em>OpenNMS Horizon</em> detects issues in your network by device, interface or service, the <em>Business Service Monitoring (BSM)</em> takes it one step further.
The <em>BSM</em> components allows you to monitor and model high level <em>Business Services (BS)</em> and helps quickly identify the most critical problems affecting these.
With the <em>BSM</em> feature it is possible to model a high level <em>BS</em> context around the technical <em>Service Monitors</em> provided in <em>OpenNMS Horizon</em>.
To indicate which <em>BS</em> is effected an <em>Operational Status</em> is calculated.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s assume a company runs an online store.
Customers enter through a login system, select items, place them in the shopping cart and checkout using a payment system.
The whole service is provided by a few web servers and access data from databases.
To monitor the status of the databases, a <em>SQL</em> service monitor on each database server is configured.
For testing the web servers a <em>HTTP</em> service monitor is used for each of them.
Covering the overall functionality a <em>Page Sequence Monitor (PSM)</em> is used to test the login, shop and payment workflow through the provided web portal.
A possible representation of the whole system hierarchy is shown in figure <a href="#ga-bsm-example-web-shop">Example scenario for a web shop</a>.</p>
</div>
<div id="ga-bsm-example-web-shop" class="paragraph">
<div class="title">Example scenario for a web shop</div>
<p><span class="image"><img src="images/bsm/01_bsm-example-scenario.png" alt="01 bsm example scenario"></span></p>
</div>
<div class="paragraph">
<p>To be able to model this scenarios the <em>BSM</em> functions can be used.
The <em>Business Service Monitoring (BSM)</em> feature includes the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Business Service Monitoring Daemon (BSMD)</em>: Maintains and drives the state of all <em>BS</em></p>
</li>
<li>
<p><em>Business Service Editor</em>: Web application which allows you to create, update or delete <em>BS</em></p>
</li>
<li>
<p><em>Topology View for Business Services</em>: Visual representation of the <em>Business Service Hierarchy</em> as a component of the <em>Topology User Interface</em>.</p>
</li>
<li>
<p><em>BSM ReST API</em>: ReST based API to create, read, update or delete <em>BS</em></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_business_service_hierarchy">10.1. Business Service Hierarchy</h3>
<div class="paragraph">
<p><em>BS</em> can depend on each other and build together a <em>Business Service Hierarchy</em>.
It can be visualized using the <em>Topology User Interface</em> with the <em>Business Services View</em>.
The <em>Operational Status</em> of a <em>BS</em> is ultimately calculated from <em>Alarms</em> and their <em>Severity</em>.
To define the class of <em>Alarms</em> a <em>Reduction Key</em> is used and is represented as an <em>Edge</em> of a <em>BS</em>.
Giving more granularity than just <em>Up</em> or <em>Down</em>, the <em>Operational Status</em> uses the <em>Severities</em>, i.e. <em>Normal</em>, <em>Warning</em>, <em>Minor</em>, <em>Major</em>, <em>Critical</em>.</p>
</div>
<div class="paragraph">
<p>Based on the hierarchy, the <em>Operational Status</em> is calculated with <em>Map</em> and <em>Reduce Functions</em>.
A <em>Map Function</em> influences which <em>Severity</em> from the <em>Edge</em> is used as an input to the <em>BS</em>.
A <em>Reduce Function</em> is used to consolidate the <em>Severities</em> from all <em>Edges</em> of a BS and uses them as inputs and reduces them into a single <em>Severity</em>, which is the <em>Operational Status</em>.</p>
</div>
<div class="paragraph">
<p>The <em>Topology User Interface</em> allows users to traverse <em>Business Service Hierarchies</em> using the <em>Semantic Zoom Level (SZL)</em>.
The <em>Semantic Zoom Level</em> (SZL, pronounced as 'sizzle') defines how many <em>Neighbors</em> are shown related to the elements which are in <em>Focus</em>.
The number can be interpreted as how many <em>Hops</em> from the <em>Focus</em> should be shown on the <em>Topology User Interface</em>.</p>
</div>
<div id="gu-bsm-hierarchy-image" class="imageblock">
<div class="content">
<img src="images/bsm/02_bsm-service-hierarchy.png" alt="02 bsm service hierarchy">
</div>
<div class="title">Figure 35. Business Service Hierarchy components</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A top-level <em>Business Service</em> which depends on other <em>Business Services</em>, <em>Monitored Services</em> and <em>Alarms</em> (referenced by <em>Reduction Key</em>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>Business Service</em> as child an the <em>Operational Status</em> is used as input for the top-level <em>Business Service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><em>IP Service</em> <em>Edge</em> used as an input with auto generated <em>Reduction Keys</em> for node down, interface down and node lost service</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><em>Reduction Key</em> <em>Edge</em> used as an input to the top-level <em>BS</em>, which references just a node lost service of a <em>Page Sequence Monitor</em> for the user login</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To add or remove an additional selected <em>BS</em> or <em>Edge</em> to <em>Focus</em> use in the context menu <em>Add To Focus</em> or <em>Remove From Focus.
If you want to have a specific _BS</em> or <em>Edge</em> as a single focus use <em>Set as Focal Point</em>.
The <em>Eye</em> icon highlights all elements in the <em>Topology UI</em> which are set to <em>Focus</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="gu-bsm-op-status">10.2. Operational status</h3>
<div class="paragraph">
<p>Every <em>Business Service</em> maintains an <em>Operational Status</em> that represents the overall status calculated by the <em>Map and Reduce Functions</em> from the <em>Edges</em>.
The <em>Operational Status</em> uses the <em>Severities</em> known from <em>Events</em> and <em>Alarms</em>.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 100. Operational Status representation</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Numerical code</th>
<th class="tableblock halign-left valign-top">Color       / Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Critical</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>7</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purple      / <code>#c00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This event means that a severe service affecting event has occurred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Major</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>6</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red         / <code>#f30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates serious disruption or malfunction of a service or system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Minor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>5</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Orange      / <code>#f90</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for troubles that have not immediate effect on service or system performance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Warning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yellow      / <code>#fc0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An event has occurred that may require action.
                                                            This severity can also be used to indicate a condition that should be noted (logged) but does not require immediate action.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Normal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>3</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dark green  / <code>#360</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informational message. No action required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cleared</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>2</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grey        / <code>#eee</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This severity is reserved for use in alarms to indicate that an alarm describes a self-clearing error condition has been corrected and service is restored.
                                                            This severity should never be used in event definitions.
                                                            Please use "Normal" severity for events that clear an alarm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Indeterminate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Light green / <code>#990</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No Severity could be associated with this event.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a <em>Business Service</em> changes its <em>Operational Status</em> an <em>OpenNMS</em> event of the type <code>uei.opennms.org/bsm/serviceOperationalStatusChanged</code> is generated and sent to the <em>OpenNMS Event Bus</em>.
In case the <em>Operational Status</em> changed from <em>Normal</em> to a higher <em>Severity</em> an <em>Event</em> of the type <code>uei.opennms.org/bsm/serviceProblem</code> is generated and has the <em>Severity</em> of the <em>BS</em>.
When the <em>BS</em> goes back to normal a <em>Event</em> of the type <code>uei.opennms.org/bsm/serviceProblemResolved</code> is generated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>Service Problem</em> and <em>Service Problem Resolved</em> events can be used for notifications or ticketing integration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The log message of the events have the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Business Service Name</em>: <code>businessServiceName</code></p>
</li>
<li>
<p><em>Business Service Identifier</em>: <code>id</code></p>
</li>
<li>
<p><em>Previous Severity Identifier</em>: <code>prevSeverityId</code></p>
</li>
<li>
<p><em>Previous Severity Label</em>: <code>prevSeverityLabel</code></p>
</li>
<li>
<p><em>New Severity Identifier</em>: <code>newSeverityId</code></p>
</li>
<li>
<p><em>New Severity Label</em>: <code>newSeverityLabel</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>BSM</em> events are not associated to a <em>Node</em>, <em>Interface</em> or <em>Service</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="gu-bsm-rc-imp-analysis">10.3. Root Cause and Impact Analysis</h3>
<div class="paragraph">
<p>The <em>Root Cause</em> operation can be used to quickly identify the underlying <em>Reduction Keys</em> as <em>Edges</em> that contribute to the current <em>Operational Status</em> of an element.
The <em>Impact Analysis</em> operation, converse to the <em>Root Cause</em> operation, can be used to identify all of the <em>BS</em> affected by a given element.
Both of these options are available in the context menu of the <em>Topology User Interface</em> when visualizing <em>BS</em>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to identify the <em>Root Cause</em> of the critical status of the <em>Shop</em> service.
Use the <em>Context Menu</em> on the <em>BS</em> to investigate the <em>Root Cause</em> shown in figure <a href="#ug-bsm-example-rca-action">View before performing Root Cause Analysis</a>.</p>
</div>
<div id="ug-bsm-example-rca-action" class="paragraph">
<div class="title">View before performing Root Cause Analysis</div>
<p><span class="image"><img src="images/bsm/03_bsm-rca-action.png" alt="03 bsm rca action"></span></p>
</div>
<div class="paragraph">
<p>The <em>Topology UI</em> sets only elements to <em>Focus</em> which are the reason for the <em>Operational Status</em> of the selected <em>BS</em>.
In figure <a href="#ug-bsm-example-rca-results">View after performing Root Cause Analysis</a> the <em>Page Sequence Monitor</em> which tests the user login is down and has set the <em>BS</em> to a critical status.</p>
</div>
<div id="ug-bsm-example-rca-results" class="paragraph">
<div class="title">View after performing Root Cause Analysis</div>
<p><span class="image"><img src="images/bsm/04_bsm-rca-results.png" alt="04 bsm rca results"></span></p>
</div>
<div class="paragraph">
<p>Similar to identifying a root cause for a <em>BS</em> it is also possible to identfy which <em>Business Services</em> from a specific <em>Edge</em> are affected.
Use the <em>Context Menu</em> on a specific <em>Edge</em> element and select <em>Impact Analysis</em> shown in figure <a href="#ug-bsm-example-ia-action">View before performing Impact Analysis</a>.</p>
</div>
<div id="ug-bsm-example-ia-action" class="paragraph">
<div class="title">View before performing Impact Analysis</div>
<p><span class="image"><img src="images/bsm/05_bsm-ia-action.png" alt="05 bsm ia action"></span></p>
</div>
<div class="paragraph">
<p>In figure <a href="#ug-bsm-example-ia-results">View after performing Impact Analysis</a> the <em>Business Services</em> for <em>Login</em>, <em>Shop</em> and <em>Payment</em> are affected if this <em>HTTP</em> service is unavailable.</p>
</div>
<div id="ug-bsm-example-ia-results" class="paragraph">
<div class="title">View after performing Impact Analysis</div>
<p><span class="image"><img src="images/bsm/06_bsm-ia-results.png" alt="06 bsm ia results"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the reason the service <em>PSM Shop</em> is introducing the critical status for the <em>Business Service</em> <em>Shop</em>, the <em>HTTP</em> service has no impact on the <em>Operational Status</em> of the <em>PSM Shop</em> and is not shown.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="gu-bsm-sim-mode">10.4. Simulation Mode</h3>
<div class="paragraph">
<p>To visualize if the configured behavior works as expected, the <em>Simulation Mode</em> can be used to manually set an <em>Alarm</em> status of an <em>Edge</em> element.
The <em>Operational Status</em> is calculated with the given <em>Map and Reduce Functions</em>.
This allows users to validate and tune their <em>Business Service Hierarchies</em> until the desired status propagation is achieved.</p>
</div>
<div class="paragraph">
<p>In order to enter <em>Simulation Mode</em>, open the <em>Business Service View</em> in the <em>Topology User Interface</em> and toggle the <em>Simulation Mode</em> option in the <em>Simulate</em> menu at the top of the screen.
The <em>Info Panel</em> on the left hand side allows to set the <em>Severity</em> of the selected <em>Edge</em> element.
In figure <a href="#gu-bsm-simulate">BSM Simulation Mode</a> the <em>Menu</em> and <em>Severity</em> setting is shown.</p>
</div>
<div id="gu-bsm-simulate" class="paragraph">
<div class="title">BSM Simulation Mode</div>
<p><span class="image"><img src="images/bsm/07_bsm-simulation.png" alt="Simulation Mode" width="400" height="293"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>Info Panel</em> can be hidden with the <em>Arrow</em> button in the top left corner.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the <em>Simulate</em> menu there are <em>Inherite State</em> and <em>Reset State</em> as options available.
With <em>Inherite State</em> the current <em>Severities</em> and <em>Operational Status</em> from monitoring is used for the <em>Simulation Mode</em>.
By selecting <em>Reset State</em> all states will be set to <em>Normal</em> for simulation.</p>
</div>
</div>
<div class="sect2">
<h3 id="gu-bsm-share-view">10.5. Share View</h3>
<div class="paragraph">
<p>In some cases it is useful to share a specific view on a <em>Business Service Hierarchy</em>.
For this reason the menu function <em>Share</em> can be used and generates a link for the current view and can be copied and sent to another user.
In figure <a href="#gu-bsm-share-view-image">Share Business Service View</a> the <em>Share</em> menu item was used and a link is generated.
The link can be used with <em>Copy &amp; Paste</em> and sent to another user to have access to exactly the same configured _Business Service View.</p>
</div>
<div id="gu-bsm-share-view-image" class="paragraph">
<div class="title">Share Business Service View</div>
<p><span class="image"><img src="images/bsm/08_bsm-share-view.png" alt="08 bsm share view"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The user receiving the link needs an account in OpenNMS to be able to see the <em>Business Service View</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="gu-bsm-change-iconset">10.6. Change Icons</h3>
<div class="paragraph">
<p>Each element in the <em>Business Service View</em> has an icon which is assigned to a <em>BS</em> or an <em>Edge</em>.
To be able to customize the <em>Business Service View</em> the icons for each element can be changed.
Select the element in the <em>Business Service View</em> and choose <em>Change Icon</em> from the <em>Context Menu</em>.
As shown in figure <a href="#gu-bsm-change-icon">Change Icon for Business Service or Edges</a> select the the new icon for the selected element and click <em>Ok</em> to permanently assign the new icon to the element.</p>
</div>
<div id="gu-bsm-change-icon" class="paragraph">
<div class="title">Change Icon for Business Service or Edges</div>
<p><span class="image"><img src="images/bsm/09_bsm-change-icon.png" alt="09 bsm change icon"></span></p>
</div>
<div class="paragraph">
<p>It is also possible create custom <em>Icon Sets</em> which is described in the <em>Business Service Monitoring</em> section of the <em>Developer Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_business_service_definition">10.7. Business Service Definition</h3>
<div class="paragraph">
<p>The status of <em>Service Monitors</em> and any kind of <em>Alarm</em> can be used to drive the <em>Operational Status</em> of a <em>BS</em>.
A <em>BS</em> is defined with the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Business Service Name</em>: A unique name used to identify the <em>BS</em></p>
</li>
<li>
<p><em>Edges</em>: A set of elements on which this <em>BS</em> relies which can include other <em>BS</em>, or <em>Reduction Keys</em>.</p>
</li>
<li>
<p><em>Reduce Function</em>: Function used to aggregate the <em>Operational Status</em> from all the <em>Edges</em>.
Specific functions may take additional parameters.</p>
</li>
<li>
<p><em>Attributes</em>: Optional key/value pairs that can be used to tag or enrich the <em>Busines Service</em> with additional information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each <em>Business Service</em> can contain a list of optional key/value attributes.
These can be used to identify or tag the <em>BS</em>, and may be reference in other workflows.
These attributes do not affect the dependencies or the status calculation of the <em>BS</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Attributes can be used to filter <em>BS</em> in <em>Ops Board</em> dashlets.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>Business Service Editor</em> is used to manage and model the <em>Business Services</em> and their hierarchy.
It is required to have administrative permissions and is available in <em>"Login Name &#8594; Configure OpenNMS &#8594; Manage Business Services"</em> in the <em>Service Monitoring</em> section.</p>
</div>
<div id="ga-bsm-editor" class="paragraph">
<div class="title">Managing Business Services with the Business Service Editor</div>
<p><span class="image"><img src="images/bsm/01_bsm-editor.png" alt="01 bsm editor"></span></p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a new <em>Business Service</em> definition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Collapse tree view for all <em>Business Services</em> in the view</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Expand tree view for all <em>Business Services</em> in the view</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Reload all <em>Business Services</em> in the view with current <em>Business Services</em> from the system</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Reload the <em>Business Service Monitoring Daemon</em> to use the <em>Business Service</em> definition as configured</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><em>Business Service</em> dependency hierarchy as tree view</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Show the current <em>Business Service</em> with dependencies in the <em>Topology UI</em></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Edit and delete existing <em>Business Service</em> defintions</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As shown in figure <a href="#ga-bsm-editor">Managing Business Services with the Business Service Editor</a> the <em>Business Services</em> can be created or changed.
The hierarchy is created by assigning an existing <em>Business Service</em> as <em>Child Service</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_edges">10.8. Edges</h3>
<div class="paragraph">
<p><em>Edges</em> map the <em>Alarm</em> status monitoring with <em>OpenNMS</em></p>
</div>
<div class="paragraph">
<p>The following types can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Child Service</em>: A reference to an existing <em>Business Service</em> on which to depend</p>
</li>
<li>
<p><em>IP Service</em>: A convenient way to refer to the alarms that can be generated by a monitored <em>IP Service</em>. This will automatically provided edges for the <em>nodeLostService</em>, <em>interfaceDown</em> and <em>nodeDown</em> reductions keys of the specified service.</p>
</li>
<li>
<p><em>Reduction Key</em>: A resolved <em>Reduction Key</em> used to refer to a specific <em>Alarm</em>, e.g. generated by a <em>SNMP Trap</em> or <em>Threshold</em> violation</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need help determining the reduction key used by alarm, trigger the alarm in question and pull the reduction key from the <em>Alarm</em> details page.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All edge types have the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Map Function</em>: The associated <em>Map Function</em> for this <em>Edge</em></p>
</li>
<li>
<p><em>Weight</em>: The relative <em>Weight</em> of this edge. Used by certain <em>Reduce Functions</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <em>IP Service</em> and <em>Reduction Key</em> type edges also support a <em>Friendly Name</em> parameter which gives the user control on how the edge is labeled in the <em>Topology User Interface</em>.
The editor changing the <em>Edge</em> attributes is shown in figure <a href="#ga-bsm-edge-edit">Editor to add Business Service Edges</a>.</p>
</div>
<div id="ga-bsm-edge-edit" class="paragraph">
<div class="title">Editor to add Business Service Edges</div>
<p><span class="image"><img src="images/bsm/02_bsm-edge-edit.png" alt="Business Service Edge edit" width="400" height="199"></span></p>
</div>
<div class="sect3">
<h4 id="_child_services">10.8.1. Child Services</h4>
<div class="paragraph">
<p>To create a hierarchy of <em>Business Services</em> they need to be created first.
The hierarchy is build by selecting the <em>Business Service</em> as_Child Service_ as dependency.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ip_services">10.8.2. IP Services</h4>
<div class="paragraph">
<p>The <em>IP Service</em> is a predefined set of <em>Reduction Keys</em> which allows easily to assign a specific <em>Monitored Service</em> to the given <em>BS</em>.
As an example you have multiple Servers with a <em>Monitored Service</em> <em>SMTP</em> and you want to model a <em>BS</em> named <em>Mail Communication</em>.
If just the <em>Reduction Key</em> for a <em>nodeLostService</em> is assgined, the <em>BS</em> would not be affected in case the <em>IP Interface</em> or the whole <em>Node</em> goes down.
<em>OpenNMS</em> generates <em>Alarms</em> with different <em>UEI</em> which needs to be assigned to the <em>BS</em> as well.
To make it easier to model this use case the <em>IP Service</em> generates the following <em>Reduction Keys</em> automatically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>uei.opennms.org/nodes/nodeLostService:%nodeId%:%ipAddress%:%serviceName%</code>: Matches <em>Alarms</em> when the given <em>Monitored Service</em> goes down</p>
</li>
<li>
<p><code>uei.opennms.org/nodes/interfaceDown:%nodeId%:%ipAddress%</code>: Matches <em>Alarms</em> when the given <em>IP Interface</em> of the <em>Monitored Service</em> goes down</p>
</li>
<li>
<p><code>uei.opennms.org/nodes/nodeDown:%nodeId%</code>: Matches <em>Alarms</em> when the given <em>Node</em> of the <em>Monitored Service</em> goes down</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_custom_reduction_key">10.8.3. Custom Reduction Key</h4>
<div class="paragraph">
<p>The <em>Reduction Key</em> edge is used to refer to specific instance of alarms.
When an alarm with the given <em>Reduction Key</em> is present, the alarms' severity will be used to calculate the <em>Operational Status</em> of the <em>BS</em>.
To give a better explanation a <em>Friendly Name</em> can be set and is used in the <em>Business Service View</em>.
The format of the <em>Reduction Key</em> is build by a set of attributes as a key separated by <code>:</code> and enclosed in <code>%</code>, i.e (<code>%attribute%:%attribute%</code>).</p>
</div>
<div class="listingblock">
<div class="title">Example of a Reduction Key for a specific nodeLostService</div>
<div class="content">
<pre class="prettyprint highlight"><code>%uei.opennms.org/nodes/nodeLostService%:%nodeId%:%ipAddress%:%serviceName%</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_map_functions">10.9. Map Functions</h3>
<div class="paragraph">
<p>The <em>Map Functions</em> define how the <em>Severity</em> of the edge will be used in the <em>Reduce Function</em> of the parent when calculating the <em>Operational Status</em>.</p>
</div>
<div class="paragraph">
<p>The available <em>Map Functions</em> are:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 101. Calculation of the <em>Operational Status</em> with <em>Map Functions</em></caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Identity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the same <em>Severity</em> as <em>Operational Status</em> of the <em>BS</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Increase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increase the <em>Severity</em> by one level and use it as <em>Operational Status</em> of the <em>BS</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Decrease</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decrease the <em>Severity</em> by one level and use it as <em>Operational Status</em> of the <em>BS</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SetTo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the <em>Operational Status</em> to a constant <em>Severity</em> value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Ignore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input of the <em>Edge</em> is ignored for <em>Operational Status</em> calculation</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_reduce_functions">10.10. Reduce Functions</h3>
<div class="paragraph">
<p>A <em>Reduce Function</em> is used to aggregate the <em>Operational Status</em> for the <em>BS</em>.
The <em>Alarm Severity</em> from the <em>Edges</em> are used as input for the <em>Reduce Function</em>.
For this operation the following <em>Reduce Functions</em> are available:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 102. Status calculation <em>Reduce Functions</em></caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Highest Severity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses the value of the highest severity, <em>Weight</em> is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses the highest severity found more often than the given threshold, e.g. 0.26 can also be seen as 26%, which means at least 2 of 4 <em>Alarms</em> need to be raised to change the <em>BS</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Highest Severity Above</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses the highest severity greater than the given threshold severity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exponential Propagation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This reduce function computes the sum of the given child severities based on a base number. For this computation the severities are mapped to
                              numbers:</p>
<p class="tableblock">                              \$WARNING=0, MINOR=1, MAJOR=2, CRITICAL=3\$</p>
<p class="tableblock">                              All other severities are ignored.</p>
<p class="tableblock">                              For the aggregation the following formula will be used to compute the resulting Business Service severity from its <em>n</em> child entities based on the base number <em>b</em>:</p>
<p class="tableblock">                              \$severity = |__log_{b}( sum_(i=1)^n b^(ch\ildSeverity_{i}) )__|\$</p>
<p class="tableblock">                              In summary the base value defines how many items of a severity <em>x</em> will result in a severity <em>x+1</em>.
                              Results lower as <em>0</em> are treated as <em>NORMAL</em> and results higher than <em>3</em> are treated as <em>CRITICAL</em>.
                              If all input values are of severity <em>INDETERMINATE</em>, the result is <em>INDETERMINATE</em>.</p>
<p class="tableblock">                              For example if the Business Service depends on four child entities with the severities <em>WARNING</em>, <em>WARNING</em>, <em>NORMAL</em> and <em>NORMAL</em> and the base defined by the number 2 the following computation will be made:</p>
<p class="tableblock">                              \$severity = |__log_{2}( 2^{0} + 2^{0} + 0 + 0 )__| = |__log_{2}( 1 + 1 + 0 + 0)__| = |__log_{2}( 2 )__| = |__1__| = 1\$</p>
<p class="tableblock">                              which corresponds to the severity <em>MINOR</em>. The same computation with the base value of 3 results in:</p>
<p class="tableblock">                              \$severity = |__log_{3}( 3^{0} + 3^{0} + 0 + 0 )__| = |__log_{3}( 1 + 1 + 0 + 0)__| = |__log_{3}( 2 )__| = |__0.63__| = 0\$</p>
<p class="tableblock">                              which means <em>WARNING</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table shows the status calculation with <em>Edges</em> assigned to an <em>IP Service</em>.
The <em>IP-Service</em> is driven by the monitoring of the <em>ICMP</em> service for three Web Server.
In the table below you find a configuration where <em>Web Server 3</em> is weighted 3 times higher than the other and a threshold of 0.33 (33%) is configured.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 103. Example for status calculation using the Threshold function</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Weight</th>
<th class="tableblock halign-left valign-top">Weight Factor</th>
<th class="tableblock halign-left valign-top">Input Severity</th>
<th class="tableblock halign-left valign-top">Operational Status</th>
<th class="tableblock halign-left valign-top">Critical</th>
<th class="tableblock halign-left valign-top">Major</th>
<th class="tableblock halign-left valign-top">Minor</th>
<th class="tableblock halign-left valign-top">Warning</th>
<th class="tableblock halign-left valign-top">Normal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web-ICMP-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Critical</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Critical</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web-ICMP-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web-ICMP-3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Warning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Warning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Percentage</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100%</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <em>Operational Status Severity</em> is evaluated from left to right, the first value higher then the configured <em>Threshold</em> is used.
In this case the <em>Operational Status</em> is set to <em>Warning</em> because the first threshold which exceeds <em>33%</em> is <em>Warning</em> with <em>80%</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_business_service_daemon">10.11. Business Service Daemon</h3>
<div class="paragraph">
<p>The calculation of the <em>Operational Status</em> of the <em>BS</em> is driven by the <em>Business Service Monitoring Daemon</em> (bsmd).
The daemon is responsible for tracking the operational status of all <em>BS</em> and for sending events in case of operational status changes.</p>
</div>
<div class="paragraph">
<p>In order to calculate the <em>Operational Status</em> the <em>reduction key</em> associated with a <em>Business Service</em> is used.
The <em>reduction key</em> is obtained from an alarm generated by <em>OpenNMS Horizon</em>.
This means that the alarm&#8217;s <em>reduction key</em> of a defined <em>Business Service</em> must not change afterwards.
Otherwise <em>bsmd</em> is not able to calculate the <em>Operational Status</em> correctly.
This also applies for removing the <em>alarm data</em> from events associated to <em>Business Services</em>
In addition the child type "IP Service" from the <em>Business Service Configuration Page</em> requires the following events with the default reduction keys being defined:
 * uei.opennms.org/nodes/nodeLostService
 * uei.opennms.org/nodes/nodeDown
 * uei.opennms.org/nodes/interfaceDown</p>
</div>
<div class="paragraph">
<p>Every time the configuration of a <em>Business Service</em> is changed a reload of the daemon&#8217;s configuration is required.
This includes changes like the name of the <em>Business Service</em> or its attributes as well as changes regarding the <em>Reduction Keys</em>, contained <em>Business Services</em> or <em>IP Services</em>.
The <em>bsmd</em> configuration can be reloaded with the following mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <em>Reload Daemon</em> button in the <em>Business Service Editor</em></p>
</li>
<li>
<p>Send the <em>reloadDaemonConfig</em> event using <code>send-event.pl</code> or use the WebUI in <em>Manually Send an Event</em> with parameter <code>daemonName bsmd</code></p>
</li>
<li>
<p>Use the ReST API to perform a <code>POST</code> request to <code>/opennms/api/v2/business-services/daemon/reload</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the reload of the configuration is done an event of type <code>uei.opennms.org/internal/reloadDaemonConfigSuccessful</code> is fired.</p>
</div>
<div class="listingblock">
<div class="title">Example reloading bsmd configuration from CLI</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$OPENNMS_HOME/bin/send-event.pl -p 'daemonName bsmd' uei.opennms.org/internal/reloadDaemonConfig</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example reloading bsmd configuration through ReST POST</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">curl -X POST -u admin:admin -v http://localhost:8980/opennms/api/v2/business-services/daemon/reload</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-topology">11. Topology Map</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to configure the <em>Topology Map</em>.</p>
</div>
<div class="sect2">
<h3 id="_properties">11.1. Properties</h3>
<div class="paragraph">
<p>The <em>Topology Map</em> supports the following properties, which can be influenced by changing the file <code>etc/org.opennms.features.topology.app.cfg</code>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>showHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if the <em>OpenNMS Horizon</em> header is shown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>autoRefresh.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled, auto refresh is enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>autoRefresh.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the auto refresh interval in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hiddenCategoryPrefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>empty String</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A String which allows hiding categories. For example a value of <code>server</code> will hide all categories starting with <code>server</code>.
                                                                                   Be aware, that this setting is case-sensistive, so <code>Servers</code> will be shown.
                                                                                   The resolution is only enabled if no longitude/latitude information is available.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_icons">11.2. Icons</h3>
<div class="paragraph">
<p>Each Vertex on the <em>Topology Map</em> is represented by an icon.
The default icon is configured in the icon mapping file: <code>${OPENNMS_HOME}/etc/org.opennms.features.topology.app.icons.&lt;topology-namespace&gt;.cfg</code>.
If an icon mapping file does not exist for a <em>Topology Provider</em>, the provider does not support customization.</p>
</div>
<div class="listingblock">
<div class="title">List of available icon mapping files (may not be complete)</div>
<div class="content">
<pre class="prettyprint highlight"><code>org.opennms.features.topology.app.icons.default.cfg <i class="conum" data-value="1"></i><b>(1)</b>
org.opennms.features.topology.app.icons.application.cfg <i class="conum" data-value="2"></i><b>(2)</b>
org.opennms.features.topology.app.icons.bsm.cfg <i class="conum" data-value="3"></i><b>(3)</b>
org.opennms.features.topology.app.icons.linkd.cfg <i class="conum" data-value="4"></i><b>(4)</b>
org.opennms.features.topology.app.icons.vmware.cfg <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Default icon mapping</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Icon mapping for the Application Topology Provider</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Icon mapping for the Business Services Topology Provider</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Icon mapping for the Linkd Topology Provider</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Icon mapping for the Vmware Topology Provider</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each File contains a mapping in form of <code>&lt;icon key&gt; = &lt;icon id&gt;</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Icon key</dt>
<dd>
<p>A <em>Topology Provider</em> dependent string which maps to an <code>icon id</code>.
An <code>icon key</code> consists of one to multiple <code>segments</code>.
Each segment must contain only numbers or characters.
If multiple <code>segments</code> exist they must be separated by <code>.</code>, e.g. <code>my.custom.key</code>.
Any existing default <code>icon keys</code> are not configurable and should not be changed.</p>
</dd>
<dt class="hdlist1">Icon id</dt>
<dd>
<p>The <code>icon id</code> is a unique icon identifier to reference an icon within one of the available SVG icons located in <code>${OPENNMS_HOME}/jetty-webapps/opennms/svg</code>.
For more details see <a href="#ga-topology-add-icons">Add new icons</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Icon key and icon id specification using BNF</div>
<div class="content">
<pre class="prettyprint highlight"><code>icon key ::= segment["."segment]*
segment ::= text+ [( "-" | "_" | ":" ) text]*
text ::== (char | number)+
char ::== A | B | ... | Z | a | b | ... | z
number ::= 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
icon id ::= segment</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example icon mapping file</div>
<div class="content">
<pre class="prettyprint highlight"><code># Business Service Topology
bsm.business-service = business_service <i class="conum" data-value="1"></i><b>(1)</b>
bsm.ip-service = IP_service <i class="conum" data-value="2"></i><b>(2)</b>
bsm.reduction-key = reduction_key <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Icon definition for Business Services</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Icon definition for IP Services</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Icon definition for Reduction Keys</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_icon_resolution">11.2.1. Icon resolution</h4>
<div class="paragraph">
<p>The icon of a vertex is resolved as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a <code>vertex id</code> to <code>icon id</code> mapping is defined, the icon referenced by the <code>icon id</code> is used</p>
</li>
<li>
<p>If a mapping for the <code>icon key</code> determined by the <em>Topology Provider</em> for the vertex is defined, the icon referenced by the <code>icon id</code> is used</p>
<div class="ulist">
<ul>
<li>
<p>If no mapping exists and the <code>icon key</code> has more than one <code>segments</code>, reduce the <code>icon key</code> by the last <code>segment</code> and try resolving that <code>icon key</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If no mapping is defined, the fallback <code>icon key</code> <code>default</code> is used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example icon mapping is defined for the <em>Linkd Topology Provider</em> to illustrate this behaviour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>linkd.system.snmp.1.3.6.1.4.1.9.1.485 = server1
linkd.system.snmp.1.3.6 = server2</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the Enterprise OID of a node is <code>1.3.6.1.4.1.9.1.485</code> the icon with id <code>server1</code> is used.
If the Enterprise OID of a node is <code>1.3.6</code> the icon with id <code>server2</code> is used.
However, if the Enterprise OID of a node is <code>1.3.6.1.4.1.9.1.13</code> the icon with id <code>server2</code> is used.</p>
</div>
<div class="sect4">
<h5 id="_linkd_topology_provider">Linkd Topology Provider</h5>
<div class="paragraph">
<p>The <em>Linkd Topology Provider</em> uses the <code>Enterprise OID</code> from each node to determine the icon of a vertex.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_change_existing_icon_mappings">11.2.2. Change existing icon mappings</h4>
<div class="paragraph">
<p>The easiest way to change an icon representation of an existing Vertex is to use the <em>Icon Selection Dialog</em> from the Vertex' context menu in the <em>Topology Map</em>.
This will create a custom <code>icon key</code> to <code>icon id</code> mapping in the <em>Topology Provider</em> specific icon mapping file.
As <code>icon key</code> the Vertex id is used.
This allows each Vertex to have it&#8217;s own icon.</p>
</div>
<div class="paragraph">
<p>If a more generic approach is preferred the icon mapping file can be modified manually.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do NOT remove the default mappings and do NOT change the icon keys in the default mappings.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ga-topology-add-icons">11.2.3. Add new icons</h4>
<div class="paragraph">
<p>All available icons are stored in SVG files located in <code>${OPENNMS_HOME}/jetty-webapps/opennms/svg</code>.
To add new icons, either add definitions to an existing SVG file or create a new SVG file in that directory.</p>
</div>
<div class="paragraph">
<p>Whatever way new icons are added to <em>OpenNMS</em> it is important that each new <code>icon id</code> describes a set of icons, rather than a single icon.
The following example illustrates this.</p>
</div>
<div class="listingblock">
<div class="title">Example SVG file with a custom icon with id <code>my-custom</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;
&lt;svg id="icons" xmlns="http://www.w3.org/2000/svg"&gt;
  &lt;g id="my-custom_icon"&gt; <i class="conum" data-value="1"></i><b>(1)</b>
      &lt;g id="my-custom_active"&gt; <i class="conum" data-value="2"></i><b>(2)</b>
          &lt;!-- rect, path, circle, etc elements, supported by SVG --&gt;
      &lt;/g&gt;
      &lt;g id="my-custom_rollover"&gt; <i class="conum" data-value="3"></i><b>(3)</b>
          &lt;!-- rect, path, circle, etc elements, supported by SVG --&gt;
      &lt;/g&gt;
      &lt;g id="my-custom"&gt; <i class="conum" data-value="4"></i><b>(4)</b>
          &lt;!-- rect, path, circle, etc elements, supported by SVG --&gt;
      &lt;/g&gt;
  &lt;/g&gt;
  &lt;!-- Additional groups ... --&gt;
&lt;/svg&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each icon must be in a SVG group with the id <code>&lt;icon id&gt;_icon</code>.
Each SVG <code>&lt;icon id&gt;_icon</code> group must contain three sub groups with the ids: <code>&lt;icon id&gt;_active</code>, <code>&lt;icon id&gt;_rollover</code> and <code>&lt;icon id&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The icon to use when the Vertex is selected.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The icon to use when the Vertex is moused over.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The icon to use when the Vertex is not selected or not moused over (just visible).</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important that each <code>icon id</code> is unique overall SVG files. This means there cannot be another <code>my-custom</code> icon id in any other SVG file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the new icons should be selectable from the <em>Topology Map&#8217;s Icon Selection Dialog</em> an entry with the new <code>icon id</code> must be added to the file <code>${OPENNMS_HOME}/etc/org.opennms.features.topology.app.icons.properties</code>.</p>
</div>
<div class="listingblock">
<div class="title">Snippet of <code>org.opennms.features.topology.app.icons.list</code></div>
<div class="content">
<pre class="prettyprint highlight"><code>access_gateway <i class="conum" data-value="1"></i><b>(1)</b>
accesspoint
cloud
fileserver
linux_file_server
opennms_server
printer
router
workgroup_switch
my-custom <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Already existing icon ids</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>New icon id</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order of the entries in <code>org.opennms.features.topology.app.icons.list</code> determine the order in the <em>Icon Selection Dialog</em> in the <em>Topology Map</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_asset_topology_provider">12. Asset Topology Provider</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">12.1. Overview</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> has introduced the ability for users to define arbitrarily complex
 layered topologies using GraphML (see <a href="http://graphml.graphdrawing.org/" class="bare">http://graphml.graphdrawing.org/</a>).
 The details of how <em>OpenNMS Horizon</em> interprets GraphML are given in the
 GraphML section of the <em>OpenNMS Horizon</em> developers guide. The ability to display
 complex layered topologies is a great feature but creating a usable GraphML topology for a
 large network can be a complex task for a user.</p>
</div>
<div class="paragraph">
<p>The <em>Asset Topology Provider</em> avoids the need for users to work directly with GraphML
by directly generating a layered GraphML topology based upon node parameters and the contents of the Node Asset table.
 The <em>Asset Topology Provider</em> greatly simplifies the task for many use cases by allowing users
 to define fields in the Node Asset table which will enable nodes to be positioned correctly
  in a complex topology. This allows a physical and logical ordering of nodes which makes
  it easier for users to represent and navigate their infrastructure.</p>
</div>
<div class="paragraph">
<p>The structure of the generated topology is determined by the <code>assetLayers</code> configuration
constant which can be set by a user. To illustrate how this works, we will consider the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>assetLayers=asset-region,asset-building</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>OpenNMS Horizon</em> Asset table is parsed to generate nested layers in
the order of the comma separated keys in the assetLayers property.
Each layer is a graph which is named after the key. Graph nodes in each layer reference
related Graph nodes in the underlying layer. The lowest layer contains Graph nodes which
are directly linked to monitored <em>OpenNMS Horizon</em> nodes which have entries in the Asset table.</p>
</div>
<div class="paragraph">
<p>The following diagram shows the structure of a topology generated by the above <code>assetLayers</code> property</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/asset-topology/graphMLtopologyLayers.jpg" alt="Illustrating how node asset entries are interpreted as layers"></span></p>
</div>
<div class="paragraph">
<p>In this example the <code>region</code> asset fields for node 1,2,3,4 are set to north.
All of these nodes are in the same north region. The <code>building</code> asset fields
for Node 1 and Node 2 are set to 21 (both nodes are in building 21) while the
<code>building</code> asset fields for Node 3 and Node 4 are set to 22 (both nodes are in building 22).</p>
</div>
<div class="paragraph">
<p>The <em>Asset Topology Provider</em> generates four linked graphs for this configuration.
The layer 0 graph is called <code>asset-region</code>, the layer 1 graph is called <code>asset-building</code>
and the layer 2 graph is called <code>nodes</code>.</p>
</div>
<div class="paragraph">
<p>Conceptually we can see that the topology is rendered as concentric sets.
The <em>Asset Topology Provider</em> first searches all of the nodes with regions
defined and creates a new level 0 graph node representing each region found.
The <em>Asset Topology Provider</em> then searches within each region to find the building entries and
creates a corresponding level 1 graph node for each building name found. Finally the <em>Asset Topology Provider</em>
creates layer 2 nodes corresponding to each <em>OpenNMS Horizon</em> monitored node and places each in the correct building.</p>
</div>
<div class="paragraph">
<p>If however <em>OpenNMS Horizon</em> monitored nodes are found which have either the region
or building asset fields empty they cannot be placed correctly in this topology.
These nodes as shown in the diagram as <code>unallocated nodes</code>.
Finally, only building and region nodes are generated which can be linked to <em>OpenNMS Horizon</em> nodes in the topology.
The <em>Asset Topology Provider</em> does not generate spurious graph nodes in upper
layers which are not directly and completely referenced by <em>OpenNMS Horizon</em> nodes in the lowest layer.</p>
</div>
<div class="paragraph">
<p>Example screenshots of a topology containing regions, buildings, racks and nodes are shown below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/asset-topology/AssetScreen1.png" alt="Screenshot of Regions Layer" width="400" height="600">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/asset-topology/AssetScreen2.png" alt="Screenshot of Buildings Layer" width="400" height="600">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/asset-topology/AssetScreen3.png" alt="Screenshot of Nodes Layer" width="400" height="600">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asset_layers">12.2. Asset layers</h3>
<div class="paragraph">
<p>The entries for <code>assetLayers</code> can be any node or asset entry from the following list (defined in class NodeParamLabels).
Keys beginning with <code>node-</code> come from the node table.
Keys beginning with <code>parent-</code> come from the node table entry of the designated parent node (If defined).
Keys beginning with <code>asset-</code>  come from the corresponding asset table entry for the given node (If defined).</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-nodelabel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-nodeid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-foreignsource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-foreignid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-nodesysname</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-nodesyslocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-operatingsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-categories</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent-nodelabel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent-nodeid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent-foreignsource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent-foreignid</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-address1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-address2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-city</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-zip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-latitude</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-longitude</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-department</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-building</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-floor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-room</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-rack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-slot</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-circuitid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-category</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-displaycategory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-notifycategory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-pollercategory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-thresholdcategory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-managedobjecttype</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-managedobjectinstance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-manufacturer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-vendor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-modelnumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-operatingsystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-country</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This allows arbitrary topologies to be generated including physical fields (room, rack etc.) and
logical fields such as asset node categories. Please note you should not put any spaces in the comma separated <code>assetLayers</code> list.
If the <code>assetLayers</code> property is defined as empty then a single graph layer will be generated containing all opennms nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_node_filtering">12.3. Node filtering</h3>
<div class="paragraph">
<p>In many cases it is desirable to control which nodes are included or excluded from a topology. For instance it is
useful to be able to generate customised topologies for specific customers which include only regions/buildings etc
relevant to their filtered node set. To this end it is possible to define a node filter
which chooses which nodes are included in a generated topology.</p>
</div>
<div class="paragraph">
<p>Filters are defined using the same asset table keys which are available for the <code>assetLayers</code> field.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-left valign-top">Definition</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">key1=value1,value2 alternatively key1=value1;key1=value2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-region=north,south</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">key1=val1;key2=val2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-region=north;asset-building=23</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">key1=!val1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-building=!23</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Thus the following configuration means include only nodes with region <code>north</code> or <code>south</code> but exclude all nodes with building <code>23</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter=asset-region=north,south;asset-building=!23</pre>
</div>
</div>
<div class="paragraph">
<p>The filters are designed to treat all selected text key entries as comma separated values (csv). This allows OpenNMS node-categories which are
many to many entries to be dealt with as a comma separated list of values; routers,servers,web etc.
Thus we can select based on multiple separate node categories. The following configuration means show routers and servers on all buildings except building 23.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter=node-categories=routers,servers;asset-building=!23</pre>
</div>
</div>
<div class="paragraph">
<p>The filters treat all asset table entries as comma separated variables (csv). This also means that,
for instance asset-displaycategory could also contain several values separated by commas. e.g. customer1,customer2,customer3 etc.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should make sure asset addresses and other free format asset text fields do not contain commas if you want an exact match on the whole field
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regular expressions are also allowed. Regular expressions start with the ~ character.
You can also negate a regular expression by preceding it with !~.</p>
</div>
<div class="paragraph">
<p>The following example will match against regions 'Stuttgart' and 'Isengard' and any building name which ends in 4</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter=asset-region=~.*gar(t|d);asset-building=~.*4</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">12.4. Configuration</h3>
<div class="paragraph">
<p>The <em>Asset Topology Provider</em> persists both the asset topology graph definitions and the generated GraphML graphs.
The persisted definitions mean that is is possible to regenerate graphs if the asset table is changed without reentering the configuration.</p>
</div>
<div class="paragraph">
<p>The <em>Asset Topology Provider</em> persists GraphML graphs along side any other GraphML graphs in the directory;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;opennms home&gt;/etc/graphml</pre>
</div>
</div>
<div class="paragraph">
<p>Please note that if you are using ReST or any other means to generate other GraphML graphs, you should ensure that
the providerIds and labels are distinct from those used by the <em>Asset Topology Provider</em></p>
</div>
<div class="paragraph">
<p>The asset graph definitions for the Asset Topology Provider are persisted to the following xml configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;opennms home&gt;/etc/org.opennms.features.topology.plugins.topo.asset.xml</pre>
</div>
</div>
<div class="paragraph">
<p>Normally you should not edit this file directly but use the karaf consol or events to define new graphs.</p>
</div>
<div class="paragraph">
<p>The config file will contain each of the graph definitions as properties in the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;configs&gt;
    &lt;config&gt;
        &lt;label&gt;Asset Topology Provider&lt;/label&gt;
        &lt;breadcrumb-strategy&gt;SHORTEST_PATH_TO_ROOT&lt;/breadcrumb-strategy&gt;
        &lt;provider-id&gt;asset&lt;/provider-id&gt;
        &lt;preferred-layout&gt;Grid Layout&lt;/preferred-layout&gt;
        &lt;filters&gt;
            &lt;filter&gt;asset-region=South&lt;/filter&gt;
        &lt;/filters&gt;
        &lt;layers&gt;
            &lt;layer&gt;asset-region&lt;/layer&gt;
            &lt;layer&gt;asset-building&lt;/layer&gt;
            &lt;layer&gt;asset-rack&lt;/layer&gt;
        &lt;/layers&gt;
    &lt;/config&gt;
&lt;/configs&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The individual definition parameters are described in the following table</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providerId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique name of the provider - used as handle to install and remove the topology</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name which shows up on the topology menu (must be unique)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assetLayers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of asset layers (in order). See separate description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>filters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of filters to be applied. Filters determine which nodes are included in graph.  See separate description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>preferredLayout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferred layout of the nodes in generated graphs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>breadcrumbStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Breadcrumb strategy used to display breadcrumbs above each graph</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_creating_asset_based_topologies_from_karaf_consol">12.5. Creating Asset Based Topologies From Karaf Consol</h3>
<div class="paragraph">
<p>The <em>OpenNMS Horizon</em> Karaf Consol can be used to control topology generation. To login use admin password.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh admin@localhost -p 8101</pre>
</div>
</div>
<div class="paragraph">
<p>The following commands are available</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Options</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-topology:create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates Asset Topology.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(The default settings are used if a particular setting is not included in the command)</p>
<p class="tableblock">-l, --label : Asset Topology label (shows in topology menu) (Default: asset)</p>
<p class="tableblock">-i, --providerId : Unique providerId of asset topology (Default: 'Asset Topology Provider')</p>
<p class="tableblock">-f, --filter : Optional node filter (Default: empty filter i.e. allow all nodes)</p>
<p class="tableblock">-a, --assetLayers : Comma separated list of asset layers (Default: asset-region,asset-building,asset-rack)</p>
<p class="tableblock">-p, --preferredLayout : Preferred Layout (Default: 'Grid Layout')</p>
<p class="tableblock">-b, --breadcrumbStrategy : Bread Crumb Strategy (Default: SHORTEST_PATH_TO_ROOT)</p>
<p class="tableblock">If you simply type asset-topology:create a default topology with providerId asset will be created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-topology:remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes Asset Topology.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-i, --providerId : Unique providerId of asset topology (Default: asset)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-topology:list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists all Asset Topologies installed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all : display detailed view including --uriParams string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-topology:regenerate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regenerates the graphs for the given Asset Topology definition.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-i, --providerId : Unique providerId of asset topology to regenerate (Default: asset)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">asset-topology:regenerateall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Best Effort regeneration of all asset topologies.
(If one graph fails, the command will try to complete the rest of the definitions definition)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_creating_asset_based_topologies_using_opennms_horizon_events">12.6. Creating Asset Based Topologies Using <em>OpenNMS Horizon</em> events</h3>
<div class="paragraph">
<p>The <em>Asset Topology Provider</em> listens for events which trigger the generation and installation or removal of topologies.
The <em>Asset Topology Provider</em> events are defined in the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;opennms home&gt;/etc/events/GraphMLAssetPluginEvents.xml</pre>
</div>
</div>
<div class="paragraph">
<p>These events will use the default parameters if parameters are not supplied</p>
</div>
<div class="paragraph">
<p>To create a new topology from the current OpenNMS inventory use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(for default topology)
sudo ./send-event.pl  uei.opennms.plugins/assettopology/create localhost

(or with parameters)
sudo ./send-event.pl  uei.opennms.plugins/assettopology/create localhost  -p 'providerId test' -p 'label test' -p 'assetLayers asset-country,asset-city,asset-building'--&gt;

other example possible parameters are
-p 'filters asset-displaycategory=!testDisplayCategory'
-p 'preferredLayout Grid Layout'
-p 'breadcrumbStrategy SHORTEST_PATH_TO_ROOT'</pre>
</div>
</div>
<div class="paragraph">
<p>To uninstall an asset topology use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(for default topology providerId)
sudo ./send-event.pl  uei.opennms.plugins/assettopology/remove localhost

(or with specific providerId)
sudo ./send-event.pl  uei.opennms.plugins/assettopology/remove localhost -p 'providerId test'</pre>
</div>
</div>
<div class="paragraph">
<p>To regenerate an existing asset topology use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(for default topology providerId)
sudo ./send-event.pl  uei.opennms.plugins/assettopology/regenerate localhost

(or with specific providerId)
sudo ./send-event.pl  uei.opennms.plugins/assettopology/regenerate localhost-p 'providerId test'</pre>
</div>
</div>
<div class="paragraph">
<p>To regenerate all existing asset topologies use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo ./send-event.pl  uei.opennms.plugins/assettopology/regenerateall localhost</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_the_topology">12.7. Viewing the topology</h3>
<div class="paragraph">
<p>If all goes well, having installed the topology, upon refreshing your screen,
you should see a new topology display option in the <em>OpenNMS Horizon</em>  topology page.
The displayed name of this topology is given by the label field</p>
</div>
<div class="paragraph">
<p>The label field need not be the same as the providerId which is used by the ReST api for the installation
or removal of a topology. However the label field must be unique across all installed topologies.</p>
</div>
<div class="paragraph">
<p>It is possible to have several topologies installed which have been generated using different configurations.
You simply need to ensure that the providerId and label field used for each installation command is different.</p>
</div>
</div>
<div class="sect2">
<h3 id="_additional_notes">12.8. Additional notes</h3>
<div class="paragraph">
<p>Please note you MUST first uninstall an <em>OpenNMS Horizon</em> graphml topology before installing a new one.
You will also have to log out and log back into the UI in order to see the new topology file.
If you uninstall a topology while viewing it, the UI will throw an error and
you will also have to log out and back in to see the remaining topologies.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-database-reports">13. Database Reports</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reporting on information from the <em>OpenNMS Horizon</em> monitoring system is important for strategical or operational decisions.
<em>Database Reports</em> give access to the embedded <em>JasperReports</em> engine and allows to create and customize report templates.
These reports can be executed on demand or on a pre-defined schedule within <em>OpenNMS Horizon</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Originally <em>Database Reports</em> were introduced to create reports working on data stored in the <em>OpenNMS Horizon</em> database only.
      This is no longer mandatory, also performance data can be used.
      Theoretically the reports do not necessarily need to be <em>OpenNMS Horizon</em> related.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <em>OpenNMS Horizon Report Engine</em> allows the creation of various kinds of reports and also supports distributed report repositories.
         At the moment these features are not covered by this documentation.
         Only reports using <em>JasperReports</em> are described here.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="ga-database-reports-overview">13.1. Overview</h3>
<div class="paragraph">
<p>The <em>OpenNMS Horizon Report Engine</em> uses the <em>JasperReport</em> library to create reports in various output formats.
Each report template must be a <code>*.jrxml</code> file.
The <em>OpenNMS Horizon Report Engine</em> passes a <em>JDBC</em> Connection to the <em>OpenNMS Horizon Database</em> to each report on execution.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 104. feature overview</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported Output Formats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PDF</code>, <code>CSV</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JasperReport</code> Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.3.0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more details on how <em>JasperReports</em> works, please have a look at the <a href="http://community.jaspersoft.com/documentation/tibco-jaspersoft-studio-user-guide/v610/getting-started-jaspersoft-studio">official documentation</a> of <em>Jaspersoft Studio</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ga-database-report-add-custom-report">13.2. Modify existing reports</h3>
<div class="paragraph">
<p>All default reports of <em>OpenNMS Horizon</em> are located in <code>$OPENNMS_HOME/etc/report-templates</code>.
Each <code>.jrxml</code> file located there can be modified and the changes are applied the next time a report is created by <em>OpenNMS Horizon</em>.</p>
</div>
<div class="paragraph">
<p>When a subreport has been modified <em>OpenNMS Horizon</em> will detect a change based on the report&#8217;s <code>lastModified</code> time and will recompile the report.
A compiled version of the report is represented by a <code>.jasper</code> file with the same name as the <code>.jrxml</code> file.
Subreports are located in <code>$OPENNMS_HOME/etc/report-templates/subreports</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If unsure, simply delete all <code>.jasper</code> files and <em>OpenNMS Horizon</em> will automatically compile the subreports if needed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_add_a_custom_report">13.3. Add a custom report</h3>
<div class="paragraph">
<p>To add a new <em>JasperReport</em> report to the <em>Local OpenNMS Horizon Report Repository</em>, the following steps are required.</p>
</div>
<div class="paragraph">
<p>At first a new entry in the file <code>$OPENNMS_HOME/etc/database-reports.xml</code> must be created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;report
  id="MyReport" <i class="conum" data-value="1"></i><b>(1)</b>
  display-name="My Report" <i class="conum" data-value="2"></i><b>(2)</b>
  online="true" <i class="conum" data-value="3"></i><b>(3)</b>
  report-service="jasperReportService" <i class="conum" data-value="4"></i><b>(4)</b>
  description="This is an example description. It shows up in the web ui when creating an online report"  <i class="conum" data-value="5"></i><b>(5)</b>
/&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A unique identifier.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the report. Is shown when using the web ui.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines if this report can be executed on demand, otherwise only scheduling is possible.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The report service implementation to use. In most cases this is <code>jasperReportService</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A description of the report. Is shown when using the web ui.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition a new entry in the file <code>$OPENNMS_HOME/etc/jasper-reports.xml</code> must be created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;report
  id="MyReport" <i class="conum" data-value="1"></i><b>(1)</b>
  template="My-Report.jrxml" <i class="conum" data-value="2"></i><b>(2)</b>
  engine="jdbc" <i class="conum" data-value="3"></i><b>(3)</b>
/&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The identifier defined in the previous step. This identifier must exist in <code>$OPENNMS_HOME/etc/database-reports.xml</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the template. The template must be located in <code>$OPENNMS_HOME/etc/report-templates</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The engine to use. It is either <code>jdbc</code> or <code>null</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-database-reports-usage-jaspersoft-studio">13.4. Usage of Jaspersoft Studio</h3>
<div class="paragraph">
<p>When developing new reports it is recommended to use the <em>Jaspersoft Studio</em> application.
It can be downloaded <a href="http://community.jaspersoft.com/project/jaspersoft-studio">here</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We recommend always to use the same <em>Jaspersoft Studio</em> version as the <em>JasperReport</em> library OpenNMS Horizon uses.
     Currently OpenNMS Horizon uses version 6.3.0.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ga-database-reports-connect-database">13.4.1. Connect to the OpenNMS Horizon Database</h4>
<div class="paragraph">
<p>In order to actually create SQL statements against the <em>OpenNMS Horizon database</em> a <code>database Data Adapter</code> must be created.
The official <em>Jaspersoft Studio</em> documentation and wiki covers this aspect.</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-database-reports-measurement-ds-helpers">13.4.2. Use Measurements Datasource and Helpers</h4>
<div class="paragraph">
<p>To use the <em>Measurements API</em> it is required to add the <em>Measurements Datasource</em> library to the build path of <em>JasperStudio</em>.
This is achieved with right click in the <code>Project Explorer</code> and select <code>Configure Buildpath</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/database-reports/1_configure-build-path-1.png" alt="1 configure build path 1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Switch to the <code>Libraries</code> tab.</p>
</li>
<li>
<p>Click <code>Add External JARs</code> and select the <code>opennms-jasperstudio-extension-23.0.1-jar-with-dependencies.jar</code> file located in <code>$OPENNMS_HOME/contrib/jasperstudio-extension</code>.</p>
</li>
<li>
<p>Close the file selection dialog.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/database-reports/2_configure-build-path-2.png" alt="2 configure build path 2">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Close the dialog.</p>
</li>
<li>
<p>The <em>Measurements Datasource and Helpers</em> should now be available.</p>
</li>
<li>
<p>Go to the <code>Dataset and Query Dialog</code> in <em>Jaspersoft Studio</em> and select a language called <code>measurement</code>.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/database-reports/3_dataset-query-dialog.png" alt="3 dataset query dialog">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even if there is no <code>Read Fields</code> functionality available, the <code>Data preview</code> can be used.
      It is required the the access to the <em>Measurements API</em> is possible using the connection parameters <code>MEASUREMENT_URL</code>, <code>MEASUREMENT_USERNAME</code> and <code>MEASUREMENT_PASSWORD</code>.
      The <a href="#ga-database-reports-fields">Supported Fields</a> section gives more details. In addition you have
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-database-reports-access-performance-data">13.5. Accessing Performance Data</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Before <em>OpenNMS Horizon 17</em> and <em>OpenNMS Meridian 2016</em> it was possible to access the performance data stored in <code>.rrd</code> or <code>.jrobin</code> files directly by using the <code>jrobin</code> language extension provided by the <code>RrdDataSource</code>.
         This is no longer possible and the <em>Measurements Datasource</em> has to be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To access performance data within reports we created a custom <em>Measurement Datasource</em> which allows to query the <em>Measurements API</em> and process the returned data in your reports.
Please refer to the <a href="http://docs.opennms.org/opennms/releases/23.0.1/guide-development/guide-development.html#_measurements_api">official Measurements API documentation</a> on how to use the _Measurements API_.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using the <em>Measurements Datasource</em> within a report a <code>HTTP</code> connection to the <em>Measurements API</em> is only established if the report is NOT running within OpenNMS Horizon, e.g. when used with <em>Jaspersoft Studio</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To receive data from the <em>Measurements API</em> simply create a query as follows:</p>
</div>
<div class="listingblock">
<div class="title">Sample queryString to receive data from the <code>Measurements API</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;query-request step="300000" start="$P{startDateTime}" end="$P{endDateTime}" maxrows="2000"&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  &lt;source aggregation="AVERAGE" label="IfInOctets" attribute="ifHCInOctets" transient="false" resourceId="node[$P{nodeId}].interfaceSnmp[$P{interface}]"/&gt;
  &lt;source aggregation="AVERAGE" label="IfOutOctets" attribute="ifHCOutOctets" transient="false" resourceId="node[$P{nodeid}].interfaceSnmp[$P{interface}]"/&gt;
&lt;/query-request&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The query language. In our case <code>measurement</code>, but <code>JasperReports</code> supports a lot out of the box, such as <code>sql</code>, <code>xpath</code>, etc.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ga-database-reports-fields">13.5.1. Fields</h4>
<div class="paragraph">
<p>Each datasource should return a number of fields, which then can be used in the report.
The <em>Measurement Datasource</em> supports the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field name</th>
<th class="tableblock halign-left valign-top">Field type</th>
<th class="tableblock halign-left valign-top">Field description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;label&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each <code>Source</code> defined as <code>transient=false</code> can be used as a field.
                                                        The name of the field is the <code>label</code>, e.g. <code>IfInOctets</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The timestamp of the sample.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>step</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>Step</code> size of the <code>Response</code>. Returns the same value for all rows.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>Start</code> timestamp in milliseconds of the <code>Resopnse</code>. Returns the same value for all rows.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>end</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>End</code> timestamp in milliseconds of the <code>Response</code>. Returns the same value for all rows.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more details about the <code>Response</code>, please refer to the <a href="http://docs.opennms.org/opennms/releases/23.0.1/guide-development/guide-development.html#_measurements\_api">official Measurement API documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-database-reports-parameters">13.5.2. Parameters</h4>
<div class="paragraph">
<p>In addition to the <code>queryString</code> the following <em>JasperReports</em> parameters are supported.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEASUREMENT_URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of the <em>Measurements API</em>, e.g. <code><a href="http://localhost:8980/opennms/rest/measurements" class="bare">http://localhost:8980/opennms/rest/measurements</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEASUREMENT_USERNAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If authentication is required, specify the username, e.g. <code>admin</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MEASUREMENT_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If authentication is required, specify the password, e.g. <code>admin</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-database-reports-helper-methods">13.6. Helper methods</h3>
<div class="paragraph">
<p>There are a couple of helper methods to help creating reports in <em>OpenNMS Horizon</em>.</p>
</div>
<div class="paragraph">
<p>These helpers come along with the <em>Measurement Datasource</em>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 105. supported helper methods</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Helper class</th>
<th class="tableblock halign-left valign-top">Helper Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.jasper.helper.MeasurementsHelper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getNodeOrNodeSourceDescriptor(nodeId, foreignSource, foreignId)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a <code>node source descriptor</code> according to the input paramters. Either <code>node[nodeId]</code> or <code>nodeSource[foreignSource:foreignId]</code> is returned.
                                                                                                                              <code>nodeSource[foreignSource:foreignId]</code> is only returned if <code>foreignSource</code> and <code>foreignId</code> is not empty and not null.
                                                                                                                              Otherwise always <code>node[nodeId]</code> is returned.<br>
                                                                                                                             <br>
                                                                                                                              <code>nodeId</code> : String, the id of the node<br>
                                                                                                                              <code>foreignSource</code>: String, the foreign source of the node, may be null<br>
                                                                                                                              <code>foreignId</code>: String, the foreign id of the node, may be null.<br>
                                                                                                                             <br>
                                                                                                                              For more details checkout <a href="#ga-database-reports-node-source-descriptor">Usage of the node source descriptor</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.jasper.helper.MeasurementsHelper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getInterfaceDescriptor(snmpifname, snmpifdescr, snmphysaddr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <code>interface descriptor</code> of a given interface, e.g. <code>en0-005e607e9e00</code>.
                                                                                                                              The input paramaters are prioritized. If a <code>snmpifdescr</code> is specified, it is used instead of the <code>snmpifname</code>.
                                                                                                                              It a <code>snmpifdescr</code> is defined, it will be appended to <code>snmpifname</code>/<code>snmpifdescr</code>.<br>
                                                                                                                             <br>
                                                                                                                              <code>snmpifname</code>: String, the interface name of the interface, e.g. <code>en0</code>. May be null.<br>
                                                                                                                              <code>snmpifdescr</code>: String, the description of the interface, e.g. <code>en0</code>. May be null.<br>
                                                                                                                              <code>snmphyaddr</code>: String, the mac address of the interface, e.g. <code>005e607e9e00</code>. May be null.<br>
                                                                                                                              As each input parameter may be null, not all of them can be null at the same time. At least one input parameter has to be defined.<br>
                                                                                                                             <br>
                                                                                                                              For more details checkout <a href="#ga-database-reports-interface-descriptor">Usage of the interface descriptor</a>.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="ga-database-reports-node-source-descriptor">13.6.1. Usage of the node source descriptor</h4>
<div class="paragraph">
<p>A node is addressed by a <code>node source descriptor</code>.
The <code>node source descriptor</code> references the node either via the <code>foreign source</code> and <code>foreign id</code> or by the <code>node id</code>.</p>
</div>
<div class="paragraph">
<p>If <code>store by foreign source</code> is enabled only addressing the node via <code>foreign source</code> and <code>foreign id</code> is possible.</p>
</div>
<div class="paragraph">
<p>In order to make report creation easier, there is a helper method to create the <code>node source descriptor</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about <code>store by foreign source</code>, please have a look at <a href="http://www.opennms.org/wiki/ForeignSource/foreignId_Data_Storage_How-To">our Wiki</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows the usage of that helper.</p>
</div>
<div class="listingblock">
<div class="title">jrxml report snippet to visualize the use of the <code>node source descriptor</code>.</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parameter name="nodeResourceDescriptor" class="java.lang.String" isForPrompting="false"&gt;
  &lt;defaultValueExpression&gt;&lt;![CDATA[org.opennms.netmgt.jasper.helper.MeasurementsHelper.getNodeOrNodeSourceDescriptor(String.valueOf($P{nodeid}), $P{foreignsource}, $P{foreignid})]]&gt;&lt;/defaultValueExpression&gt;
&lt;/parameter&gt;
&lt;queryString language="Measurement"&gt;
  &lt;![CDATA[&lt;query-request step="300000" start="$P{startDateTime}" end="$P{endDateTime}" maxrows="2000"&gt;
&lt;source aggregation="AVERAGE" label="IfInOctets" attribute="ifHCInOctets" transient="false" resourceId="$P{nodeResourceDescriptor}.interfaceSnmp[en0-005e607e9e00]"/&gt;
&lt;source aggregation="AVERAGE" label="IfOutOctets" attribute="ifHCOutOctets" transient="false" resourceId="$P{nodeResourceDescriptor}.interfaceSnmp[en0-005e607e9e00]"/&gt;
&lt;/query-request&gt;]]&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the input parameters you either get a <code>node resource descriptor</code> or a <code>foreign source/foreign id resource descriptor</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-database-reports-interface-descriptor">13.6.2. Usage of the interface descriptor</h4>
<div class="paragraph">
<p>An <code>interfaceSnmp</code> is addressed with the exact <code>interface descriptor</code>.
To allow easy access to the <code>interface descriptor</code> a helper tool is provided.
The following example shows the usage of that helper.</p>
</div>
<div class="listingblock">
<div class="title">jrxml report snippet to visualize the use of the <code>interface descriptor</code></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;parameter name="interface" class="java.lang.String" isForPrompting="false"&gt;
  &lt;parameterDescription&gt;&lt;![CDATA[]]&gt;&lt;/parameterDescription&gt;
  &lt;defaultValueExpression&gt;&lt;![CDATA[org.opennms.netmgt.jasper.helper.MeasurementsHelper.getInterfaceDescriptor($P{snmpifname}, $P{snmpifdescr}, $P{snmpphysaddr})]]&gt;&lt;/defaultValueExpression&gt;
&lt;/parameter&gt;
&lt;queryString language="Measurement"&gt;
  &lt;![CDATA[&lt;query-request step="300000" start="$P{startDateTime}" end="$P{endDateTime}" maxrows="2000"&gt;
&lt;source aggregation="AVERAGE" label="IfInOctets" attribute="ifHCInOctets" transient="false" resourceId="node[$P{nodeId}].interfaceSnmp[$P{interface}]"/&gt;
&lt;source aggregation="AVERAGE" label="IfOutOctets" attribute="ifHCOutOctets" transient="false" resourceId="node[$P{nodeId}].interfaceSnmp[$P{interface}]"/&gt;
&lt;/query-request&gt;]]&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the appropriate <code>interface descriptor</code> depends on the input parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-database-reports-https">13.6.3. Use HTTPS</h4>
<div class="paragraph">
<p>To establish a secure connection to the <em>Measurements API</em> the public certificate of the running <em>OpenNMS Horizon</em> must be imported to the <em>Java Trust Store</em>.
In Addition <em>OpenNMS Horizon</em> must be configured to use that <em>Java Trust Store</em>.
Please follow the instructions in this <a href="#ga-operation-ssl-opennms-trust-store">chapter</a> to setup the <em>Java Trust Store</em> correctly.</p>
</div>
<div class="paragraph">
<p>In addition please also set the property <code>org.opennms.netmgt.jasper.measurement.ssl.enable</code> in <code>$OPENNMS_HOME\etc\opennms.properties</code> to <code>true</code> to ensure that only secure connections are established.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If <code>org.opennms.netmgt.jasper.measurement.ssl.enable</code> is set to <code>false</code> an accidentally insecure connection can be established to the <em>Measurements API</em> location.
         A SSL secured connection can be established even if <code>org.opennms.netmgt.jasper.measurement.ssl.enable</code> is set to <code>false</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-database-reports-limitations">13.7. Limitations</h3>
<div class="ulist">
<ul>
<li>
<p>Only a <em>JDBC Datasource</em> to the <em>OpenNMS Horizon Database connection</em> can be passed to a report, or no datasource at all.
One does not have to use the datasource, though.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-enlinkd">14. 增强的链路发现 (Enlinkd)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>增强的链路发现 (Enlinkd)</em> 已经被设计成通过SNMP使用各种链路发现协议的数据发现设备间的连接。
<em>Enlinkd</em> 会每隔一段时间收集这些数据，并计算出设备间连接关系的快照。
被 <em>Enlinkd</em> 发现的连接称为 <em>链路</em>。
在 <em>Enlinkd</em> 的上下文中，术语 <em>Link</em> 与网络OSI域中的2层的"link"是不同的，这里的链路仅指示2层连接。
<em>Enlinkd</em> 中的一个 <em>链路</em> 是一个更抽象的概念，用来描述 <em>OpenNMS Horizon</em> 中两个设备间的连接关系。
这些链路是基于代理在 OSI 的 <em>2层</em>, <em>3层</em>, 或 其他 OSI层提供的信息而发现的。</p>
</div>
<div class="paragraph">
<p>下面的部分描述了 <em>Enlinkd</em> 程序模块及其配置。
另外，将描述要实现 <em>链路发现</em> SNMP agents需要支持的 SNMP MIBs 列表，以便 <em>EnLinkd</em> 收集 <em>设备</em> 间的 <em>链路</em> 。
FYI: 关于设备连接详细详细 (发现的 <em>链路</em>) 和支持的链接数据可以在 <em>OpenNMS Horizon</em> Web-UI 的 <em>设备信息页面</em> 看到。</p>
</div>
<div class="sect2">
<h3 id="ga-enlinkd-daemon">14.1. Enlinkd 模块</h3>
<div class="paragraph">
<p>本质上， <em>Enlinkd</em> 向每个设备要求以下问题："从你的观点来看，网络拓扑是什么"。
从这个角度来看，这只会提供本地拓扑发现特性。
它不试图发现全局拓扑，或者与其他设备的数据进行关联。</p>
</div>
<div class="paragraph">
<p>对于大型环境，可以配置 <em>Enlinkd</em> 的行为。
在 <em>链路</em> 发现的过程中，日志和错误信息会输出记录到全局日志文件中。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 106. <em>Enlinkd</em> 的全局日志和配置文件</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">位置</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enlinkd-configuration.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">功能模块的全局配置</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enlinkd.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/logs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Enlinkd</em> 的全局日志文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log4j2.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$OPENNMS_HOME/etc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置 <em>Enlinkd</em> 的日志级别</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title"><em>Enlinkd</em> 的配置文件</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;enlinkd-configuration threads="5"
                     initial_sleep_time="60000"
                     rescan_interval="86400000"
                     use-cdp-discovery="true"
                     use-bridge-discovery="true"
                     use-lldp-discovery="true"
                     use-ospf-discovery="true"
                     use-isis-discovery="true"
                     /&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 107. 全局配置参数描述</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于发现拓扑的并行线程数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial_sleep_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenNMS Horizon 系统启动后，开始发现拓扑结构的等待时间，单位为毫秒。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rescan_interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Integer</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>86400000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">重新发现和更新拓扑的间隔，单位是毫秒。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-cdp-discovery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用基于 <em>CDP</em> 信息拓扑发现。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-bridge-discovery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用基于 <em>Bridge MIB</em> 信息算法发现拓扑结构。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-lldp-discovery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用基于 <em>LLDP</em> 信息拓扑发现。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-ospf-discovery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用基于 <em>OSPF</em> 信息拓扑发现。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>use-isis-discovery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否启用基于 <em>IS-IS</em> 信息拓扑发现。</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果启用多个协议，那么每个启用的发现协议都将发现链路。
      拓扑 WebUI 将展示每个发现协议计算的 <em>链路</em>。
      例如，如果你启用了 <em>CDP</em> 和 <em>LLDP</em> 发现方式，WebUI 将展示 <em>CDP 链路</em> 和 <em>LLDP 链路</em>。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-enlinkd-layer-2-link-discovery">14.2. 2层链路发现</h3>
<div class="paragraph">
<p><em>Enlinkd</em> 能够发现 <em>2层</em> 网络链路，其基于以下协议：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Link_Layer_Discovery_Protocol">链路层发现协议</a> (LLDP)</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Cisco_Discovery_Protocol">思科发现协议</a> (CDP)</p>
</li>
<li>
<p>透明网桥发现</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些信息需要由 <em>SNMP Agents</em> 提供 <em>MIB 支持</em>。
因此，首先需要一些 <em>SNMP</em> 配置工作。
下面的部分描述为了 <em>链路发现</em>，需要 <em>SNMP agent</em> 提供的 <em>SNMP MIB</em> 信息。</p>
</div>
<div class="sect3">
<h4 id="_lldp_发现">14.2.1. LLDP 发现</h4>
<div class="paragraph">
<p><em>链路层发现协议 (LLDP)</em> 是一个开放的链路层协议。
它被网络设备用来标识他们身份、能力和邻居。
<em>LLDP</em> 执行类似于多个专有协议的功能，像 <em>思科发现协议 (CDP)</em>, <em>极进发现协议 (Extreme Discovery Protocol)</em>, <em>Foundry 发现协议 (FDP)</em>, <em>Nortel 发现协议 (也称为 SONMP)</em>, 和 <em>微软的链路层拓扑发现 (LLTD)<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
发现链路只是设备上运行 <em>LLDP</em> 进程功能的一部分。
      这些数据类似于在 IOS CLI 上执行 <code>show lldp neighbor</code> 命令的结果。
      Linux 和 Windows 服务器默认情况下没有运行 <em>LLDP</em> 进程，因此不能支持发现链路。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>下面的 OIDs 用来支持发现和构建 <em>LLDP</em> 网络拓扑。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 108. LLDP-MIB 支持的 OIDs</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">OID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpLocChassisIdSubtype</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.3.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of encoding used to identify the chassis associated with the local system. Possible values can be:<br>
                                                            <em>chassisComponent(1)</em><br>
                                                            <em>interfaceAlias(2)</em><br>
                                                            <em>portComponent(3)</em><br>
                                                            <em>macAddress(4)</em><br>
                                                            <em>networkAddress(5)</em><br>
                                                            <em>interfaceName(6)</em><br>
                                                            <em>local(7)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpLocChassisId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.3.2.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the chassis component associated with the local system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpLocSysName</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.3.3.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the system name of the local system.
                                                            If the local agent supports <a href="http://tools.ietf.org/html/rfc3418">IETF RFC 3418</a>, <em>lldpLocSysName</em> object should have the same value of <em>sysName</em> object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpLocPortIdSubtype</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.3.7.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of port identifier encoding used in the associated <em>lldpLocPortId</em> object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpLocPortId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.3.7.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the port component associated with a given port in the local system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpLocPortDesc</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.3.7.1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the <em>802 LAN station&#8217;s</em> port description associated with the local system.
                                                            If the local agent supports <em>IETF RFC 2863</em>, <em>lldpLocPortDesc</em> object should have the same value of <em>ifDescr</em> object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpRemChassisIdSubtype</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.4.1.1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of encoding used to identify the chassis associated with the local system. Possible values can be:<br>
                                                            <em>chassisComponent(1)</em><br>
                                                            <em>interfaceAlias(2)</em><br>
                                                            <em>portComponent(3)</em><br>
                                                            <em>macAddress(4)</em><br>
                                                            <em>networkAddress(5)</em><br>
                                                            <em>interfaceName(6)</em><br>
                                                            <em>local(7)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpRemChassisId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.4.1.1.5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the chassis component associated with the remote system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpRemPortIdSubtype</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.4.1.1.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of port identifier encoding used in the associated <em>lldpRemPortId</em> object.<br>
                                                           <br>
                                                            <em>interfaceAlias(1)</em><br>
                                                            the octet string identifies a particular instance of the <em>ifAlias</em> object (defined in IETF RFC 2863). If the particular <em>ifAlias</em> object does not contain any values, another port identifier type should be used.<br>
                                                           <br>
                                                            <em>portComponent(2)</em><br>
                                                            the octet string identifies a particular instance of the <em>entPhysicalAlias</em> object (defined in IETF RFC 2737) for a port or backplane component.<br>
                                                           <br>
                                                            <em>macAddress(3)</em><br>
                                                            this string identifies a particular unicast source address (encoded in network byte order and IEEE 802.3 canonical bit order) associated with the port (IEEE Std 802-2001).<br>
                                                           <br>
                                                            <em>networkAddress(4)</em><br>
                                                            this string identifies a network address associated with the port.
                                                            The first octet contains the <em>IANA AddressFamilyNumbers</em> enumeration value for the specific address type, and octets 2 through N contain the <em>networkAddress</em> address value in network byte order.<br>
                                                           <br>
                                                            <em>interfaceName(5)</em><br>
                                                            the octet string identifies a particular instance of the <em>ifName</em> object (defined in IETF RFC 2863).
                                                            If the particular <em>ifName</em> object does not contain any values, another port identifier type should be used.<br>
                                                           <br>
                                                            <em>agentCircuitId(6)</em><br>
                                                            this string identifies a agent-local identifier of the circuit (defined in RFC 3046)<br>
                                                           <br>
                                                            <em>local(7)</em><br>
                                                            this string identifies a locally assigned port ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpRemPortId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.4.1.1.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the port component associated with the remote system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpRemPortDesc</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.4.1.1.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the description of the given port associated with the remote system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>lldpRemSysName</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.0.8802.1.1.2.1.4.1.1.9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string value used to identify the system name of the remote system.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>关于 <em>LLDP</em> 处理的基本信息可以在 <em>设备信息页面</em> 里 <em>LLDP 信息</em> 信息框看到。
从这些 <em>OID</em> 收集的信息将存储在以下数据库表中：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/enlinkd/lldp-database.png" alt="lldp database">
</div>
<div class="title">Figure 36. LLDP 发现相关数据库表</div>
</div>
</div>
<div class="sect3">
<h4 id="_cdp_发现">14.2.2. CDP 发现</h4>
<div class="paragraph">
<p><em>思科发现协议 (CDP)</em> 是 <em>思科</em> 的私有链路层协议。
它被网络设备用来标识身份、能力和邻居。
<em>CDP</em> 执行类似于多个专有协议的功能，如 <em>链路层发现协议 (LLDP)</em>, <em>极进发现协议 (Extreme Discovery Protocol)</em>, <em>Foundry 发现协议 (FDP)</em>, <em>Nortel 发现协议 (也称为 SONMP)</em>, 和 <em>微软的链路层拓扑发现 (LLTD)</em>。
<em>CDP</em> 发现使用的信息由 <a href="http://tools.cisco.com/Support/SNMP/do/BrowseMIB.do?local=en&amp;step=2&amp;mibName=CISCO-CDP-MIB">CISCO-CDP-MIB</a> 和 <a href="http://tools.cisco.com/Support/SNMP/do/BrowseMIB.do?local=en&amp;step=2&amp;mibName=CISCO-VTP-MIB">CISCO-VTP-MIB</a> 提供的。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
发现链路只是设备上运行 <em>CDP</em> 进程功能的一部分。
      这些数据类似于在 IOS CLI 上执行 <code>show cdp neighbor</code> 命令的结果。
      Linux 和 Windows 服务器默认情况下没有运行 <em>CDP</em> 进程，因此不能支持发现链路。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>下面的 OIDs 用来支持发现和构建 <em>CDP</em> 网络拓扑。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 109. IF-MIB 支持的 OIDS</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">OID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ifDescr</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.2.2.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A textual string containing information about the interface.
                                                                This string should include the name of the manufacturer, the product name and the version of the interface hardware/software.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 110. CISCO-CDP-MIB 支持发现链路的 OIDS</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">OID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpInterfaceName</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.1.1.1.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the local interface as advertised by <em>CDP</em> in the <em>Port-ID TLV</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpCacheEntry</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.2.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An entry (conceptual row) in the <em>cdpCacheTable</em>, containing the information received via <em>CDP</em> on one interface from one device.
                                                                Entries appear when a <em>CDP</em> advertisement is received from a neighbor device.
                                                                Entries disappear when <em>CDP</em> is disabled on the interface, or globally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpCacheAddressType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.2.1.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication of the type of address contained in the corresponding instance of <em>cdpCacheAddress</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpCacheAddress</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.2.1.1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The (first) network-layer address of the device&#8217;s SNMP-agent as reported in the Address <em>TLV</em> of the most recently received <em>CDP</em> message.
                                                                For example, if the corresponding instance of <em>cacheAddressType</em> had the value <code>ip(1)</code>, then this object would be an IP-address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpCacheVersion</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.2.1.1.5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Version string as reported in the most recent <em>CDP</em> message.
                                                                The zero-length string indicates no Version field <em>(TLV)</em> was reported in the most recent <em>CDP</em> message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpCacheDeviceId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.2.1.1.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>Device-ID</em> string as reported in the most recent <em>CDP</em> message.
                                                                The zero-length string indicates no <em>Device-ID</em> field <em>(TLV)</em> was reported in the most recent <em>CDP</em> message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpCacheDevicePort</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.2.1.1.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>Port-ID</em> string as reported in the most recent <em>CDP</em> message.
                                                                This will typically be the value of the <em>ifName</em> object (e.g., <code>Ethernet0</code>).
                                                                The zero-length string indicates no <em>Port-ID</em> field <em>(TLV)</em> was reported in the most recent <em>CDP</em> message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpCachePlatform</em>        </p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.2.1.1.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Device&#8217;s Hardware Platform as reported in the most recent <em>CDP</em> message.
                                                                The zero-length string indicates that no Platform field <em>(TLV)</em> was reported in the most recent <em>CDP</em> message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpGlobalRun</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.3.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication of whether the Cisco Discovery Protocol is currently running.
                                                                Entries in <em>cdpCacheTable</em> are deleted when CDP is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpGlobalDeviceId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.3.4.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The device ID advertised by this device.
                                                                The format of this device id is characterized by the value of <em>cdpGlobalDeviceIdFormat</em> object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>cdpGlobalDeviceIdFormat</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.23.1.3.7.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication of the format of Device-Id contained in the corresponding instance of <em>cdpGlobalDeviceId</em>.
                                                                User can only specify the formats that the device is capable of as denoted in <em>cdpGlobalDeviceIdFormatCpb</em> object.<br>
                                                                <strong><em>serialNumber(1):</em></strong> indicates that the value of <em>cdpGlobalDeviceId</em> object is in the form of an <em>ASCII</em> string contain the device serial number.<br>
                                                                <strong><em>macAddress(2):</em></strong> indicates that the value of <em>cdpGlobalDeviceId</em> object is in the form of Layer 2 MAC address.<br>
                                                                <strong><em>other(3):</em></strong> indicates that the value of <em>cdpGlobalDeviceId</em> object is in the form of a platform specific <em>ASCII</em> string contain info that identifies the device.
                                                                For example: <em>ASCII string</em> contains <em>serialNumber</em> appended/prepened with system name.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 111. CISCO-VTP-MIB 支持的 OIDS</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>vtpVersion</em></th>
<th class="tableblock halign-left valign-top"><code>.1.3.6.1.4.1.9.9.46.1.1.1.0</code></th>
<th class="tableblock halign-left valign-top">The version of VTP in use on the local system.
                                                                A device will report its version capability and not any particular version in use on the device.
                                                                If the device does not support <em>VTP</em>, the version is <em>none(3)</em>.</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ciscoVtpVlanState</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.46.1.3.1.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The state of this <em>VLAN</em>.
                                                                The state <em>mtuTooBigForDevice</em> indicates that this device cannot participate in this <em>VLAN</em> because the <em>VLAN&#8217;s MTU</em> is larger than the device can support.<br>
                                                                The state <em>mtuTooBigForTrunk</em> indicates that while this <em>VLAN&#8217;s MTU</em> is supported by this device, it is too large for one or more of the device&#8217;s trunk ports.<br>
                                                                <em>operational(1)</em>, <em>suspended(2)</em>, <em>mtuTooBigForDevice(3)</em>, <em>mtuTooBigForTrunk(4)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ciscoVtpVlanType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.46.1.3.1.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of this <em>VLAN</em>.<br>
                                                                <em>ethernet(1)</em>, <em>fddi(2)</em>, <em>tokenRing(3)</em>, <em>fddiNet(4)</em>, <em>trNet(5)</em>, <em>deprecated(6)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ciscoVtpVlanName</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.46.1.3.1.1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of this <em>VLAN</em>.
                                                                This name is used as the <em>ELAN-name</em> for an <em>ATM LAN-Emulation</em> segment of this <em>VLAN</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>关于 <em>CDP</em> 处理的基本信息可以在 <em>设备信息页面</em> 里 <em>CDP 信息</em> 信息框看到。
从这些 <em>OID</em> 收集的信息将存储在以下数据库表中：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/enlinkd/cdp-database.png" alt="cdp database">
</div>
<div class="title">Figure 37. CDP 发现相关数据库表</div>
</div>
</div>
<div class="sect3">
<h4 id="_透明网桥发现">14.2.3. 透明网桥发现</h4>
<div class="paragraph">
<p>使用 <em>桥接转发</em> 表发现 <em>2层</em> 网络链路需要一个特殊的算法。
基于一个标题为 <a href="http://cs-pub.bu.edu/groups/nrg/readinglist/lowekamp-sigcomm01.pdf">用于大型以太网的拓扑发现</a> 论文发现 <em>链路</em> 算法实现。
收集的信息用于发现 <em>mac链路</em> 和 <em>网桥链路</em> 两种 <em>链路</em> 。
一个 <em>mac链路</em> 是由 mac地址标识的工作站和服务器之间的 <em>链路</em>。
一个 <em>网桥链路</em> 是干线端口间的一个连接。</p>
</div>
<div class="paragraph">
<p>透明网桥不能是回环的，所有如果有回环，则必须启用生成树协议侦测回环，然后重新将一些端口放置在一个 <em>阻塞</em> 的状态来避免回环。
要得到链路必须执行一些计算，来让我们定义 <em>链路</em>。
要通过 <em>透明网桥发现</em> 链路，<em>SNMP agent</em> 必须支持下面的 <em>MIBS</em> 。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 112. Cisco-VTP 支持的 MIB</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">描述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>vtpVersion</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.4.1.9.9.46.1.1.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在本地系统中使用的 VTP 版本。
                                                                    设备需要能够报告它的版本，而不能是设备上使用的任何特殊版本。
                                                                    如果设备不支持 <em>VTP</em>, 版本会是 <em>none(3)</em>。</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 113. IP-MIB 支持的 OIDs</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ipNetToMediaIfIndex</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.4.22.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interface on which this entry&#8217;s equivalence is effective.
                                                                    The layer-2 interface identified by a particular value of this index is the same interface as identified by the same value of <em>ifIndex</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ipNetToMediaPhysAddress</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.4.22.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The media-dependent <em>physical</em> address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ipNetToMediaNetAddress</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.4.22.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>IpAddress</em> corresponding to the media-dependent <em>physical</em> address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ipNetToMediaType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.4.22.1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of mapping. Setting this object to the value <em>invalid(2)</em> has the effect of invalidating the corresponding entry in the <em>ipNetToMediaTable</em>.
                                                                    That is, it effectively dissasociates the interface identified with said entry from the mapping identified with said entry.
                                                                    It is an implementation-specific matter as to whether the agent removes an invalidated entry from the table.
                                                                    Accordingly, management stations must be prepared to receive tabular information from agents that corresponds to entries not currently in use.
                                                                    Proper interpretation of such entries requires examination of the relevant <em>ipNetToMediaType</em> object.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 114. BRIDGE-MIB 支持的 OIDS</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dBaseBridgeAddress</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.1.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The MAC address used by this bridge when it must be referred to in a unique fashion.
                                                                    It is recommended that this be the numerically smallest MAC address of all ports that belong to this bridge.
                                                                    However it is only required to be unique.
                                                                    When concatenated with <em>dot1dStpPriority</em> a unique <em>BridgeIdentifier</em> is formed which is used in the <em>Spanning Tree Protocol</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dBaseNumPorts</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.1.2.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of ports controlled by this bridging entity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dBaseType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.1.3.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates what type of bridging this bridge can perform.
                                                                    If a bridge is actually performing a certain type of bridging this will be indicated by entries in the port table for the given type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dBasePort</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.1.4.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port number of the port for which this entry contains bridge management information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dPortIfIndex</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.1.4.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the instance of the <em>ifIndex</em> object, defined in <em>MIB-II</em>, for the interface corresponding to this port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpProtocolSpecification</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An indication of what version of the Spanning Tree Protocol is being run.
                                                                    The value <em>decLb100(2)</em> indicates the <em>DEC LANbridge 100 Spanning Tree protocol</em>.
                                                                    <em>IEEE 802.1d</em> implementations will return <em>ieee8021d(3)</em>.
                                                                    If future versions of the <em>IEEE Spanning Tree Protocol</em> are released that are incompatible with the current version a new value will be defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPriority</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the writeable portion of the <em>Bridge ID</em>, i.e., the first two octets of the (8 octet long) <em>Bridge ID</em>.
                                                                    The other (last) 6 octets of the <em>Bridge ID</em> are given by the value of <em>dot1dBaseBridgeAddress</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpDesignatedRoot</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bridge identifier of the root of the spanning tree as determined by the <em>Spanning Tree Protocol</em> as executed by this node.
                                                                    This value is used as the <em>Root Identifier</em> parameter in all configuration <em>Bridge PDUs</em> originated by this node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpRootCost</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cost of the path to the root as seen from this bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpRootPort</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port number of the port which offers the lowest cost path from this bridge to the root bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPort</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port number of the port for which this entry contains Spanning Tree Protocol management information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortPriority</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the priority field which is contained in the first (in network byte order) octet of the (2 octet long) Port ID.
                                                                    The other octet of the Port ID is given by the value of <em>dot1dStpPort</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortState</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port&#8217;s current state as defined by application of the <em>Spanning Tree Protocol</em>.
                                                                    This state controls what action a port takes on reception of a frame.
                                                                    If the bridge has detected a port that is malfunctioning it will place that port into the <em>broken(6)</em> state.
                                                                    For ports which are disabled (see <em>dot1dStpPortEnable</em>), this object will have a value of <em>disabled(1)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortEnable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The enabled/disabled status of the port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortPathCost</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The contribution of this port to the path cost of paths towards the spanning tree root which include this port.
                                                                    802.1D-1990 recommends that the default value of this parameter be in inverse proportion to the speed of the attached LAN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortDesignatedRoot</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique <em>Bridge Identifier</em> of the <em>Bridge</em> recorded as the <em>Root</em> in the <em>Configuration BPDUs</em> transmitted by the <em>Designated Bridge</em> for the segment to which the port is attached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortDesignatedCost</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path cost of the <em>Designated Port</em> of the segment connected to this port.
                                                                    This value is compared to the <em>Root Path Cost</em> field in received bridge <em>PDUs</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortDesignatedBridge</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>Bridge Identifier</em> of the bridge which this port considers to be the <em>Designated Bridge</em> for this port&#8217;s segment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dStpPortDesignatedPort</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.2.15.1.9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>Port Identifier</em> of the port on the <em>Designated Bridge</em> for this port&#8217;s segment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dTpFdbAddress</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.4.3.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A unicast <em>MAC address</em> for which the bridge has forwarding and/or filtering information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dTpFdbPort</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.4.3.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the value '0', or the port number of the port on which a frame having a source address equal to the value of the corresponding instance of <em>dot1dTpFdbAddress</em> has been seen.
                                                                    A value of '0' indicates that the port number has not been learned but that the bridge does have some forwarding/filtering information about this address (e.g. in the <em>dot1dStaticTable</em>).
                                                                    Implementors are encouraged to assign the port value to this object whenever it is learned even for addresses for which the corresponding value of <em>dot1dTpFdbStatus</em> is not <em>learned(3)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1dTpFdbStatus</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.4.3.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of this entry.
                                                                    The meanings of the values are:<br>
                                                                    <strong><em>other(1)</em></strong>: none of the following.
                                                                    This would include the case where some other <em>MIB</em> object (not the corresponding instance of <em>dot1dTpFdbPort</em>, nor an entry in the <em>dot1dStaticTable</em>) is being used to determine if and how frames addressed to the value of the corresponding instance of <em>dot1dTpFdbAddress</em> are being forwarded.<br>
                                                                    <strong><em>invalid(2)</em></strong>: this entry is not longer valid (e.g., it was learned but has since aged-out), but has not yet been flushed from the table.<br>
                                                                    <strong><em>learned(3)</em></strong>: the value of the corresponding instance of <em>dot1dTpFdbPort</em> was learned, and is being used.<br>
                                                                    <strong><em>self(4)</em></strong>: the value of the corresponding instance of <em>dot1dTpFdbAddress</em> represents one of the bridge&#8217;s addresses.
                                                                    The corresponding instance of <em>dot1dTpFdbPort</em> indicates which of the bridge&#8217;s ports has this address.<br>
                                                                    <strong><em>mgmt(5)</em></strong>: the value of the corresponding instance of dot1dTpFdbAddress is also the value of an existing instance of dot1dStaticAddress.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 115. Q-BRIDGE-MIB 支持的 OIDS</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1qTpFdbPort</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.7.1.2.2.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the value <em>0</em>, or the port number of the port on which a frame having a source address equal to the value of the corresponding instance of <em>dot1qTpFdbAddress</em> has been seen.
                                                                    A value of <em>0</em> indicates that the port number has not been learned but that the device does have some forwarding/filtering information about this address (e.g., in the <em>dot1qStaticUnicastTable</em>).
                                                                    Implementors are encouraged to assign the port value to this object whenever it is learned, even for addresses for which the corresponding value of <em>dot1qTpFdbStatus</em> is not <em>learned(3)</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>dot1qTpFdbStatus</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.17.7.1.2.2.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of this entry.
                                                                    The meanings of the values are:<br>
                                                                    <strong><em>other(1)</em></strong>: none of the following.
                                                                    This may include the case where some other MIB object (not the corresponding instance of <em>dot1qTpFdbPort</em>, nor an entry in the <em>dot1qStaticUnicastTable</em>) is being used to determine if and how frames addressed to the value of the corresponding instance of <em>dot1qTpFdbAddress</em> are being forwarded.<br>
                                                                    <strong><em>invalid(2)</em></strong>: this entry is no longer valid (e.g., it was learned but has since aged out), but has not yet been flushed from the table.<br>
                                                                    <strong><em>learned(3)</em></strong>: the value of the corresponding instance of <em>dot1qTpFdbPort</em> was learned and is being used.<br>
                                                                    <strong><em>self(4)</em></strong>: the value of the corresponding instance of <em>dot1qTpFdbAddress</em> represents one of the device&#8217;s addresses.
                                                                    The corresponding instance of <em>dot1qTpFdbPort</em> indicates which of the device&#8217;s ports has this address.<br>
                                                                    <strong><em>mgmt(5)</em></strong>: the value of the corresponding instance of <em>dot1qTpFdbAddress</em> is also the value of an existing instance of <em>dot1qStaticAddress</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>关于 <em>网桥</em> 链路发现过程中的基本信息，可以在 <em>设备信息页面</em> 里  <em>网桥信息</em> 信息框看到。
从这些 <em>OID</em> 收集的信息将存储在以下数据库表中：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/enlinkd/bridge-database.png" alt="bridge database">
</div>
<div class="title">Figure 38. 透明网桥发现相关数据库表</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-enlinkd-layer-3-link-discovery">14.3. 3层链路发现</h3>
<div class="paragraph">
<p>使用 <em>Enlinkd</em> ，可以获得基于网络路由应用的 <em>链路</em> 。
下面的路由协议用来提供发现 <em>3层</em> 链路的所需信息：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Open_Shortest_Path_First">开放最短路径优先</a> (OSPF)</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/IS-IS">中间系统到中间系统</a> (IS-IS)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些信息需要由 <em>SNMP Agents</em> 提供 <em>MIB 支持</em>。
因此，首先需要一些 <em>SNMP</em> 配置工作。
由 <em>Enlinkd</em> 发现的链路数据可以在相关设备信息页面的 <em>拓扑用户界面</em> 看到。</p>
</div>
<div class="sect3">
<h4 id="_ospf_发现">14.3.1. OSPF 发现</h4>
<div class="paragraph">
<p>有关 OSPF 拓扑的MIBs是 <em>OSPF-MIB</em> 和 <em>OSPF-TRAP-MIB</em>。
在这些MIBs中定义了用于查找OSPF链路的相关对象，具体如下：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在OSPF中的 <em>Router ID</em> 有相同格式的IP地址</p>
</li>
<li>
<p>但是识别路由器不依赖于它的IP地址。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>另外所有的接口都是通过IP地址来识别的。
OSPF 链路是定义在 OSPF-MIB 文件中的 SNMP <em>ospfNbrTable</em> 表，但是实际中是存储在 <em>ospfLink</em> 表里:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 116. OSPF-MIB 支持的 OIDs</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">OID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfRouterId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.1.1.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A 32-bit integer uniquely identifying the router in the Autonomous System.
                                                         By convention, to ensure uniqueness, this should default to the value of one of the router&#8217;s IP interface addresses.
                                                         This object is persistent and when written the entity <strong>should</strong> save the change to non-volatile storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfAdminStat</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.1.2.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The administrative status of <em>OSPF</em> in the router.
                                                         The value <em>enabled</em> denotes that the <em>OSPF Process</em> is active on at least one interface; <em>disabled</em> disables it on all interfaces.
                                                         This object is persistent and when written the entity <strong>should</strong> save the change to non-volatile storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfVersionNumber</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.1.3.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current version number of the <em>OSPF protocol</em> is <em>2</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfAreaBdrRtrStatus</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.1.4.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A flag to note whether this router is an <em>Area Border Router</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfAreaASBdrRtrStatus</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.1.5.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A flag to note whether this router is configured as an <em>Autonomous System Border Router</em>.
                                                         This object is persistent and when written the entity <strong>should</strong> save the change to non-volatile storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfIfIpAddress</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.7.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IP address of this <em>OSPF</em> interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfAddressLessIf</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.7.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the purpose of easing the instancing of addressed and addressless interfaces; this variable takes the value <em>0</em> on interfaces with IP addresses and the corresponding value of <em>ifIndex</em> for interfaces having no <em>IP address</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfNbrIpAddr</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.10.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IP address this neighbor is using in its IP source address.
                                                         Note that, on addressless links, this will not be 0.0.0.0 but the address of another of the neighbor&#8217;s interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfNbrAddressLessIndex</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.10.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On an interface having an <em>IP address</em>, zero.
                                                         On addressless interfaces, the corresponding value of <em>ifIndex</em> in the <em>Internet Standard MIB</em>.
                                                         On row creation, this can be derived from the instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ospfNbrRtrId</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.14.10.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A 32-bit integer (represented as a type <em>IpAddress</em>) uniquely identifying the neighboring router in the <em>Autonomous System</em>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 117. IP-MIB 支持的 OIDs</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">OID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ipAdEntIfIndex</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.4.20.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The index value which uniquely identifies the interface to which this entry is applicable.
                                                       The interface identified by a particular value of this index is the same interface as identified by the same value of the <em>IF-MIB&#8217;s ifIndex</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ipAdEntNetMask</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.4.20.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The subnet mask associated with the <em>IPv4</em> address of this entry.
                                                       The value of the mask is an <em>IPv4</em> address with all the network bits set to <em>1</em> and all the hosts bits set to <em>0</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>关于 <em>OSPF</em> 处理的基本信息可以在 <em>设备信息页面</em> 里 <em>OSPF 信息</em> 信息框看到。
从这些 <em>OID</em> 收集的信息将存储在以下数据库表中：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/enlinkd/ospf-database.png" alt="ospf database">
</div>
<div class="title">Figure 39. OSPF 发现相关数据库表</div>
</div>
</div>
<div class="sect3">
<h4 id="_is_is_发现">14.3.2. IS-IS 发现</h4>
<div class="paragraph">
<p><em>IS-IS 链路</em> 发现是基于 <em>isisISAdjTable</em> ，这是在 <em>ISIS-MIB</em> (mib-rfc4444.txt) 中定义的。
在这个表中可以找到寻找邻接中间系统所需的信息。
有关 IS-IS 的信息存储在两个表中： <em>isisElement</em> 和 <em>isisLink</em>。
<em>isisElement</em> 包含 <em>ISISSysID</em>, 这是一个 "中间系统"的唯一标识 (ISO协议中的路由器名称)。
该 SNMP MIB 表里的每条记录表示运行 IS-IS 和 "peering" 的源路由单向连接，从被询问的 <em>中间系统</em> 到 <em>相邻的中间系统</em> 。
如果两个路由器 <em>IS-A</em> 和 <em>IS-B</em> 都支持 <em>ISIS-MIB</em>, 那么 <em>EnLinkd</em> 将创建两条链路记录在 OpenNMS Horizon 系统中: 一条是从 <em>IS-A</em> 到 <em>IS-B</em> (从 <em>IS-A</em> 开始) ，另一条互补的链接反向是从 <em>IS-B</em> 到 <em>IS-A</em> (从 <em>IS-B</em> 开始)。
下面是用来支持 IS-IS 链路发现的 <em>ISIS-MIB</em> :</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 118. ISIS-MIB 支持的 OIDs</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">OID</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisSysID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.1.1.3.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID for this Intermediate System.
                                                                This value is appended to each of the area addresses to form the Network Entity Titles.
                                                                The derivation of a value for this object is implementation specific.
                                                                Some implementations may automatically assign values and not permit an SNMP write, while others may require the value to be set manually.
                                                                Configured values <strong>must</strong> survive an agent reboot.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisSysAdminState</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.1.1.8.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The administrative state of this Intermediate System.
                                                                Setting this object to the value <code>on</code> when its current value is <code>off</code> enables the Intermediate System.
                                                                Configured values <strong>must</strong> survive an agent reboot.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisSysObject</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">isisSysObject</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisCircIfIndex</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.3.2.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of ifIndex for the interface to which this circuit corresponds.
                                                                This object cannot be modified after creation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisCircAdminState</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.3.2.1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The administrative state of the circuit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisISAdjState</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.6.1.1.2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The state of the adjacency.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisISAdjNeighSNPAAddress</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.6.1.1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>SNPA address</em> of the neighboring system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisISAdjNeighSysType</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.6.1.1.5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the neighboring system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisISAdjNeighSysID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.6.1.1.6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The system ID of the neighboring Intermediate System.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>isisISAdjNbrExtendedCircID</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.1.3.6.1.2.1.138.1.6.1.1.7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The 4-byte <em>Extended Circuit ID</em> learned from the Neighbor during 3-way handshake, or <em>0</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>关于 <em>IS-IS</em> 处理的基本信息可以在 <em>设备信息页面</em> 里 <em>IS-IS 信息</em> 信息框看到。
从这些 <em>OID</em> 收集的信息将存储在以下数据库表中：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/enlinkd/is-is-database.png" alt="is is database">
</div>
<div class="title">Figure 40. IS-IS 发现相关数据库表</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-opennms-operation">15. 操作</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ga-operation-https-ssl">15.1. HTTPS / SSL</h3>
<div class="paragraph">
<p>This chapter covers the possibilities to configure <em>OpenNMS Horizon</em> to protect web sessions with HTTPS and also explains how to configure <em>OpenNMS Horizon</em> to establish secure connections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to use HTTPS the Java command line tool <code>keytool</code> is used.
      It is automatically shipped with each JRE installation.
      More details about the <code>keytool</code> can be found at the <a href="https://docs.oracle.com/javase/6/docs/technotes/tools/windows/keytool.html">official documentation</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ga-operation-standalone-https-jetty">15.1.1. Standalone HTTPS with Jetty</h4>
<div class="paragraph">
<p>To configure <em>OpenNMS Horizon</em> to protect web sessions with HTTPS please refer to the official <em>OpenNMS Horizon</em> Wiki article <a href="http://www.opennms.org/wiki/Standalone_HTTPS_with_Jetty">Standalone HTTPS with Jetty</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-operation-https-client">15.1.2. OpenNMS Horizon as HTTPS client</h4>
<div class="paragraph">
<p>To establish secure HTTPS connections within Java one has to setup a so called <em>Java Trust Store</em>.</p>
</div>
<div class="paragraph">
<p>The <em>Java Trust Store</em> contains all certificates a Java application should trust when making connections as a client to a server.</p>
</div>
<div class="sect4">
<h5 id="ga-operation-setup-java-truststore">Setup <em>Java Trust Store</em></h5>
<div class="paragraph">
<p>To setup the <em>Java Trust Store</em> the following command can be issued.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not have a <em>Java Trust Store</em> setup yet, it is created automatically.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Import a certificate to the <em>Java Trust Store</em></div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">keytool \
  -import \ <i class="conum" data-value="1"></i><b>(1)</b>
  -v \ <i class="conum" data-value="2"></i><b>(2)</b>
  -trustcacerts \ <i class="conum" data-value="3"></i><b>(3)</b>
  -alias localhost \ <i class="conum" data-value="4"></i><b>(4)</b>
  -file localhost.cert \ <i class="conum" data-value="5"></i><b>(5)</b>
  -keystore /$OPENNMS_HOME/etc/trust-store.jks  <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define to import a certificate or a certificate chain</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use verbose output</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define to trust certificates from cacerts</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The alias for the certificate to import, e.g. the common name</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The certificate to import</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The location of the <em>Java Trust Store</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you create a new <em>Java Trust Store</em> you are asked for a password to protect the <em>Java Trust Store</em>.
If you update an already existing <em>Java Trust Store</em> please enter the password you chose when creating the <em>Java Trust Store</em> initially.</p>
</div>
</div>
<div class="sect4">
<h5 id="ga-operation-download-certificate">Download existing public certificate</h5>
<div class="paragraph">
<p>To Download an existing public certificate the following command can be issued.</p>
</div>
<div class="listingblock">
<div class="title">Download an existing public certificate</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">openssl \
  s_client \ <i class="conum" data-value="1"></i><b>(1)</b>
  -showcerts \ <i class="conum" data-value="2"></i><b>(2)</b>
  -connect localhost:443 \ <i class="conum" data-value="3"></i><b>(3)</b>
  -servername localhost \ <i class="conum" data-value="4"></i><b>(4)</b>
  &lt; /dev/null \ <i class="conum" data-value="5"></i><b>(5)</b>
  &gt; localhost.cert <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use SSL/TLS client functionality of <code>openssl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Show all certificates in the chain</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>PORT:HOST to connect to, e.g. localhost:443</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This is optional, but if you are serving multiple certificates under one single ip address you may define a server name, otherwise the <code>ip of localhost</code>:PORT certificate is returned which may not match the requested server name (<code>mail.domain.com</code>, <code>opennms.domain.com</code>, <code>dns.domain.com</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>No input</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Where to store the certificate.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="ga-operation-ssl-opennms-trust-store">Configure OpenNMS Horizon to use the defined <em>Java Trust Store</em></h5>
<div class="paragraph">
<p>To setup <em>OpenNMS Horizon</em> to use the defined <em>Java Trust Store</em> the according <code>javax.net.ssl.trustStore*</code> properties have to be set.
Open <code>$OPENNMS_HOME/etc/opennms.properties</code> and add the properties <code>javax.net.ssl.trustStore</code> and <code>javax.net.ssl.trustStorePassword</code> as shown below.</p>
</div>
<div class="listingblock">
<div class="title">$OPENNMS_HOME/etc/opennms.properties snippet to define a <em>Java Trust Store</em></div>
<div class="content">
<pre class="prettyprint highlight"><code>javax.net.ssl.trustStore=/$OPENNMS_HOME/etc/trust-store.jks <i class="conum" data-value="1"></i><b>(1)</b>
javax.net.ssl.trustStorePassword=change-me <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The location of the <em>Java Trust Store</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The password of the <em>Java Trust Store</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more details on the Java build-in SSL System properties have a look at chapter <a href="#ga-operation-ssl-properties">Debugging / Properties</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Each time you modify the <em>Java Trust Store</em> you have to restart <em>OpenNMS Horizon</em> to have the changes take effect.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-operation-trust-store-key-store">15.1.3. Differences between <em>Java Trust Store</em> and <em>Java Key Store</em></h4>
<div class="paragraph">
<p>The <em>Java Trust Store</em> is used to determine whether a remote connection should be trusted or not, e.g. whether a remote party is who it claims to be (client use case).</p>
</div>
<div class="paragraph">
<p>The <em>Java Key Store</em> is used to decide which authentication credentials should be sent to the remote host for authentication during SSL handshake (server use case).</p>
</div>
<div class="paragraph">
<p>For more details, please check the <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html#Stores">JSSE Reference Guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-operation-ssl-properties">15.1.4. Debugging / Properties</h4>
<div class="paragraph">
<p>If you encounter issues while using HTTPS it might be useful to enable debugging or use one of the build-in Java System Properties to configure the proper use of SSL.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 119. Java build-in System Properties (<a href="https://access.redhat.com/documentation/en-US/Fuse_MQ_Enterprise/7.1/html/Security_Guide/files/SSL-SysProps.html">Source</a>)</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.net.ssl.keyStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the Java keystore file containing an application process&#8217;s own certificate and private key.
                                       On Windows, the specified pathname must use forward slashes, <code>/</code>, in place of backslashes, <code>\</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.net.ssl.keyStorePassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to access the private key from the keystore file specified by <code>javax.net.ssl.keyStore</code>.
                                       This password is used twice: to unlock the keystore file (store password) and to decrypt the private key stored in the keystore (key password).
                                       In other words, the JSSE framework requires these passwords to be identical.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.net.ssl.keyStoreType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) For Java keystore file format, this property has the value <code>jks</code> (or <code>JKS</code>). You do not normally specify this property, because its default value is already <code>jks</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.net.ssl.trustStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the Java keystore file containing the collection of CA certificates trusted by this application process (trust store). On Windows, the specified pathname must use forward slashes, <code>/</code>, in place of backslashes, <code>\</code>.
                                       If a trust store location is not specified using this property, the Sun JSSE implementation searches for and uses a keystore file in the following locations (in order):
                                       <code>$JAVA_HOME/lib/security/jssecacerts</code> and <code>$JAVA_HOME/lib/security/cacerts</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.net.ssl.trustStorePassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to unlock the keystore file (store password) specified by <code>javax.net.ssl.trustStore</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.net.ssl.trustStoreType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) For Java keystore file format, this property has the value <code>jks</code> (or <code>JKS</code>). You do not normally specify this property, because its default value is already <code>jks</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.net.debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To switch on logging for the SSL/TLS layer, set this property to ssl. More details about possible values can be found <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#Debug">here</a>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-operation-request-logging">15.2. Request Logging</h3>
<div class="paragraph">
<p>HTTP requests logs for <em>Jetty</em> can be enabled by uncommenting the following snippet in <code>etc/jetty.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- NCSA Request Logging
 &lt;Item&gt;
     &lt;New id="RequestLog" class="org.eclipse.jetty.server.handler.RequestLogHandler"&gt;
       &lt;Set name="requestLog"&gt;
         &lt;New id="RequestLogImpl" class="org.eclipse.jetty.server.NCSARequestLog"&gt;
           &lt;Arg&gt;logs/jetty-requests-yyyy_mm_dd.log&lt;/Arg&gt;
           &lt;Set name="retainDays"&gt;90&lt;/Set&gt;
           &lt;Set name="append"&gt;true&lt;/Set&gt;
           &lt;Set name="extended"&gt;true&lt;/Set&gt;
           &lt;Set name="logTimeZone"&gt;US/Central&lt;/Set&gt;
         &lt;/New&gt;
       &lt;/Set&gt;
     &lt;/New&gt;
 &lt;/Item&gt;
--&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not have a <code>jetty.xml</code> in the <code>etc</code> directory, you can start by copying the example from <code>etc/examples/jetty.xml</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you would like the include the usernames associated with the requests in the log file,  you must also uncomment the following snippet in <code>jetty-webapps/opennms/WEB-INF/web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;!-- Enable this filter mapping when using NCSA request logging
&lt;filter-mapping&gt;
  &lt;filter-name&gt;jettyUserIdentityFilter&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
--&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After restarting <em>OpenNMS Horizon</em>, requests logs of the following form should be available in <code>logs/jetty-requests-*.log</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>127.0.0.1 - - [02/Jun/2017:09:16:38 -0500] "GET / HTTP/1.1" 302 0 "-" "Mozilla/5.0 (X11; Fedora; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/5
8.0.3029.110 Safari/537.36"
127.0.0.1 - anonymousUser [02/Jun/2017:09:16:39 -0500] "GET /opennms/ HTTP/1.1" 302 0 "-" "Mozilla/5.0 (X11; Fedora; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"
127.0.0.1 - admin [02/Jun/2017:09:16:46 -0500] "POST /opennms/rest/datachoices?action=enable HTTP/1.1" 200 0 "http://127.0.0.1:8980/opennms/index.jsp" "Mozilla/5.0 (X11; Fedora; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"
127.0.0.1 - rtc [02/Jun/2017:09:16:45 -0500] "POST /opennms/rtc/post/DNS+and+DHCP+Servers HTTP/1.1" 200 35 "-" "Java/1.8.0_121"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_geocoder_service">15.3. Geocoder Service</h3>
<div class="paragraph">
<p>The <em>Geocoder Service</em> is used to resolve geolocation information within <em>OpenNMS Horizon</em>.
By default The Google Map API is used to resolve the geolocation information, if available.
In order to configure the Google Map API the following properties in <code>etc/org.opennms.features.geocoder.google.cfg</code> are supported:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>empty string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Google Map API <code>Client ID</code>.
                                                        This is required if you exceed the free Google Map API usage.
                                                        Please refer to the <a href="https://developers.google.com/maps/documentation/javascript/get-api-key">official documentation</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientKey</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>empty string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Google Map API <code>API Key</code>.
                                                        This is required if you exceed the free Google Map API usage.
                                                        Please refer to the <a href="https://developers.google.com/maps/documentation/javascript/get-api-key">official documentation</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The connection timeout in milliseconds the Geocoder tries to resolve a single geolocation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>An alternative is to use the NominatimGeocoderService (<a href="https://developer.mapquest.com/documentation/open/nominatim-search/" class="bare">https://developer.mapquest.com/documentation/open/nominatim-search/</a>).</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>emailAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>empty string</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>referer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>empty string</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>useSystemProxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the system wide proxy settings be used? The system proxy settings can
                                                           be configured in <a href="#ga-opennms-system-properties">opennms.conf</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_resourcecli_simple_resource_management_tool">15.4. resourcecli: simple resource management tool</h3>
<div class="paragraph">
<p>Sometimes a user want to list or manually delete collected data (resources) of an <em>OpenNMS Horizon</em> instance.
When using <em>RRDTool-</em> or <em>JRobin</em>-based storage this can easily be achieved by traversing the <code>share/rrd</code> directory and its subdirectories.
The several <code>.rrd</code> or <code>.jrb</code> files can be listed or deleted for individual nodes.
When <em>Newts</em>-based storage is used the data is stored and indexed remotely on a <em>Cassandra</em> cluster.
In this case the cluster must be queried for available resources.
For the deletion of resources the data and all generated indexes must be gathered and removed.
The <em>resourcecli</em> tool simplifies this process and works with <em>Newts</em>-based storage as well as with <em>RRDTool</em> and <em>JRobin</em> files.</p>
</div>
<div class="sect3">
<h4 id="_usage_2">15.4.1. Usage</h4>
<div class="paragraph">
<p>The utility is installed by default and its wrapper script is located in the <code>${OPENNMS_HOME}/bin</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ cd /path/to/opennms/bin
$ ./resourcecli</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When invoked without parameters the usage and help information is printed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>resourcecli</em> tool uses sub-commands for the different tasks.
Each of these sub-commands provide different options and parameters.
The command line tool accepts the following sub-commands.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sub-command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queries an <em>OpenNMS Horizon</em> server for available resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>show</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays details for a given resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes a given resource and all of its child resources.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following global options are available in each of the sub-commands of the tool:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option/Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help and exit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--username VALUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for connecting to <em>OpenNMS Horizon</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password VALUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for connecting to <em>OpenNMS Horizon</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--url VALUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the <em>OpenNMS Horizon</em> instance to connect to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8980/opennms" class="bare">http://localhost:8980/opennms</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_sub_command_list">15.4.2. Sub-command: list</h4>
<div class="paragraph">
<p>This sub-command is used to query an <em>OpenNMS Horizon</em> instance for its available resources.
The following example queries the local <em>OpenNMS Horizon</em> instance with the credentials <code>admin/secret</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ ./resourcecli --username admin --password secret list
node[72]
  node[72].nodeSnmp[]
  node[72].responseTime[192.168.0.2]
node[70]
  node[70].nodeSnmp[]
  node[70].interfaceSnmp[bridge0]
  node[70].interfaceSnmp[bridge1]
  node[70].interfaceSnmp[vlan0-002500fe1bf3]
	node[70].responseTime[50.16.15.18]
  node[70].responseTime[192.168.0.1]

&lt;output omitted&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sub_command_show">15.4.3. Sub-command: show</h4>
<div class="paragraph">
<p>This sub-command can be used to show details for a given resource.
The following example display details for the resource identified by resourceId <code>node[70]</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ ./resourcecli --username admin --password secret show node\[70\]
ID:         node[70]
Name:       70
Label:      MyRouter
Type:       Node
Link:       element/node.jsp?node=70
Parent ID:  null
Children:
  node[70].nodeSnmp[]
  node[70].interfaceSnmp[bridge0]
  node[70].interfaceSnmp[bridge1]
  node[70].interfaceSnmp[vlan0-002500fe1bf3]
	node[70].responseTime[50.16.15.18]
  node[70].responseTime[192.168.0.1]
Attributes:
  External:
  Graphs:
  Strings:</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following options are available for the <em>show</em> sub-command.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option/Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;resource&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resourceId of the resource to display.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_sub_command_delete">15.4.4. Sub-command: delete</h4>
<div class="paragraph">
<p>This sub-command can be used to delete a given resource and its child resources.
The following example deletes the resource identified by resourceId <code>node[70]</code>.
When successful, this command does not generate any output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ ./resourcecli --username admin --password secret delete node\[70\]
$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following options are available for the <em>delete</em> sub-command.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option/Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;resource&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The resourceId of the resource to be deleted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> -</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_newts_repository_converter_rrdjrb_to_newts_migration_utility">15.5. newts-repository-converter: Rrd/Jrb to Newts migration utility</h3>
<div class="paragraph">
<p>This utility can be used to migrate existing <em>RRDTool-</em> or <em>JRobin</em>-based data to a <em>Newts</em> cluster.
This will be achieved by traversing the <code>share/rrd</code> directory and its subdirectories, reading the data and properties files and persisting this data to <em>Newts</em>.</p>
</div>
<div class="sect3">
<h4 id="_migration">15.5.1. Migration</h4>
<div class="paragraph">
<p>The following suggestions try to minimize the data collection gap that occur when reconfiguring <em>OpenNMS Horizon</em> for a different storage strategy.
First, we determine the parameters needed for migration of the existing data.
After that, we reconfigure <em>OpenNMS Horizon</em> to persists all new collected data to <em>Newts</em> storage.
Finally, the <em>Rrd</em>- or <em>JRobin</em>-based data will be converted and persisted to <em>Newts</em> using the <em>newts-repository-converter</em> utility.</p>
</div>
<div class="sect4">
<h5 id="_prerequisites">Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>Working OpenNMS Horizon installation with <em>RRDTool</em>- or <em>JRobin</em>-based storage strategy configured.</p>
</li>
<li>
<p>Installed and working <em>Newts</em> cluster reachable by the <em>OpenNMS Horizon</em> instance.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_migration_plan">Migration plan</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check and write down the values for the following options in your <code>opennms.properties</code> file.
You will need these information later to invoke the <em>newts-repository-converter</em> utility.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>File <code>etc/opennms.properties</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Check for the entry <code>org.opennms.rrd.storeByGroup</code> whether <code>storeByGroup</code> is enabled.</p>
</li>
<li>
<p>Check for the entry <code>rrd.base.dir</code> for the location where <em>Rrd</em> or <em>Jrb</em> files are stored.</p>
</li>
<li>
<p>Check for the entry <code>rrd.binary</code> for the location of the <em>RRDTool</em> binary.</p>
</li>
</ul>
</div>
</li>
<li>
<p>File <code>etc/rrd-configuration.properties</code>:</p>
<div class="ulist">
<ul>
<li>
<p>Check for the entry <code>org.opennms.rrd.strategyClass</code> whether <code>JRobinRrdStrategy</code> (<em>JRobin</em>) or <code>JniRrdStrategy</code> / <code>MultithreadedJniRrdStrategy</code> (<em>RRDTool</em>) is used.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Stop your <em>OpenNMS Horizon</em> instance.</p>
</li>
<li>
<p>Reconfigure <em>OpenNMS Horizon</em> to persist data to <em>Newts</em> - so, when correctly configured all new samples will be persisted into <em>Newts</em> after <em>OpenNMS Horizon</em> is started.
Note, that the converter assumes storeByForeignSource to be enabled.</p>
</li>
<li>
<p>Start your <em>OpenNMS Horizon</em> instance.</p>
</li>
<li>
<p>Use the <em>newts-repository-converter</em> utility to convert the existing data to <em>Newts</em> by specifying the options that correspond to the information gathered during step #1.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure will minimize the data collection gap to the time needed to reconfigure <em>OpenNMS Horizon</em> for <em>Newts</em> storage.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <em>newts_converter</em> utility needs the path to the base directory of your <em>OpenNMS Horizon</em> instance for reading the configuration files.
For instance the utility needs the datasource configuration during the migration process to query the database to lookup node data.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage_3">15.5.2. Usage</h4>
<div class="paragraph">
<p>The utility is installed by default and its wrapper script is located in the <code>${OPENNMS_HOME}/bin</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ cd /path/to/opennms/bin
$ ./newts-repository-converter</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When invoked without parameters the usage and help information is printed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>newts-repository-converter</em> tool provide the following options and parameters:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short-option</th>
<th class="tableblock halign-left valign-top">Long-option</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints help and usage information</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onms-home</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>OpenNMS Horizon</em> Home Directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/opennms</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the RRD data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ONMS-HOME/share/rrd</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-tool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use rrdtool or JRobin</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rrd-binary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The binary path to the rrdtool command (only used if rrd-tool is set)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/bin/rrdtool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>store-by-group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether store by group was enabled or not</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of conversion threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaults to number of CPUs</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_example_1_convert_rrd_based_data_with_storebygroup_enabled">15.5.3. Example 1: convert Rrd-based data with storeByGroup enabled</h4>
<div class="paragraph">
<p>The following example shows how to convert <em>RRDTool</em>-based data that was stored with <code>storeByGroup</code> enabled.
The OpenNMS Horizon home is <code>/opt/opennms</code>, the data directory is <code>/opt/opennms/share/rrd</code> and the <em>RRDTool</em> binary located at <code>/usr/local/bin/rrdtool</code>.
This program call will use 16 concurrent threads to convert the <em>Rrd</em> files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ ./newts-repository-converter -t true -s true -T /usr/local/bin/rrdtool -n 16
&lt;output omitted&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_2_convert_jrobin_based_data_with_storebygroup_disabled">15.5.4. Example 2: convert JRobin-based data with storeByGroup disabled</h4>
<div class="paragraph">
<p>The following example shows how to convert <em>JRobin</em>-based data located in the directory <code>/mnt/opennms/rrd</code> that was collected with <code>storeByGroup</code> disabled.
This program call will use 8 concurrent threads to convert the <em>Jrb</em> files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">$ ./newts-repository-converter -t false -s false -r /mnt/opennms/rrd -n 8
&lt;output omitted&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-opennms-operation-newts">15.6. Newts (新时间序列)</h3>
<div class="paragraph">
<p>本节介绍如何配置 <em>OpenNMS Horizon</em> 来使用 <em>Newts</em>，并且如何使用 <em>OpenNMS Horizon</em> 来监控你的 Cassandra 集群。</p>
</div>
<div class="sect3">
<h4 id="_配置_2">15.6.1. 配置</h4>
<div class="sect4">
<h5 id="_启用_newts">启用 Newts</h5>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 配置使用 Newts，在 <code>${OPENNMS_HOME}/etc/opennms.properties</code> 中需要设置以下属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>org.opennms.timeseries.strategy=newts</code></pre>
</div>
</div>
<div class="paragraph">
<p>强烈建议存储在 <em>Newts</em> 中的资源，由其外部源(foreign source)和外部ID(foreign ID)引用，而不使用它们的数据库ID。
为此，还应在同一文件中设置以下属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>org.opennms.rrd.storeByForeignSource=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置完成后，需要重新启动 <em>OpenNMS Horizon</em>，然后将使用 <em>Newts</em> 引擎存储指标数据。</p>
</div>
<div class="paragraph">
<p>其它配置选项将在下一节介绍。</p>
</div>
</div>
<div class="sect4">
<h5 id="_配置参考">配置参考</h5>
<div class="paragraph">
<p>在 <code>${OPENNMS_HOME}/etc/opennms.properties</code> 中可以使用以下属性来配置和调整 <em>Newts</em>。</p>
</div>
<div class="sect5">
<h6 id="ga-opennms-operation-newts-properties-general">概览</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.keyspace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>newts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要使用的 keyspace 的名称。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.hostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cassandra 节点的IP地址或主机名。可以用逗号分隔多个主机。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9042</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于连接 Cassandra 节点的 CQL 端口。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cassandra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过 CQL 连接到 Cassandra 时，使用的用户名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cassandra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通过 CQL 连接到 Cassandra 时，使用的密码。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.ssl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">连接到 Cassandra 时，启用/禁用 SSL。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.read_consistency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于 <em>读取</em> 操作的一致性级别。
                                                                           有关可用选项列表，请参阅 <a href="http://docs.datastax.com/en/cassandra/2.1/cassandra/dml/dml_config_consistency_c.html">配置数据一致性</a>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.write_consistency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ANY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于 <em>写入</em> 操作的一致性级别。
                                                                           有关可用选项列表，请参阅 <a href="http://docs.datastax.com/en/cassandra/2.1/cassandra/dml/dml_config_consistency_c.html">配置数据一致性</a>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.max_batch_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在单个事务中插入的最大记录数。受 Cassandra 集群的 batch_size_fail_threshold_in_kb 属性的限制。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.ring_buffer_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8192</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">环形缓冲区中可以保存的最大记录数。必须是两倍大小。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.writer_threads</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于从环形缓冲区中提取样本并将其插入 Newts 的线程数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31540000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">自动删除样本的秒数，默认为一年。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.resource_shard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>604800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">样本存储在同一个密钥(key)的持续时间，以秒为单位。默认为7天。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.query.minimum_step</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最小步长，以毫秒为单位。用于防止大型查询。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.query.interval_divider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果在查询中未指定间隔，则在聚合值时，该步骤将被划分为多个间隔。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.query.heartbeat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>450000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">持续时间，以毫秒为单位，在未指定心跳时使用。通常应该是你最大采集间隔的1.5倍。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.query.parallelism</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可用于计算聚合的最大线程数。默认为可用核心(cores)数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.cache.strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See bellow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于资源级别缓存的类的规范名称。有关所有可用选项，请参阅下表。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.cache.max_entries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8192</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用内存缓存策略时，要保留在缓存中的最大记录数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.nan_on_counter_wrap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁用 counter wraps，而是用 NaNs 代替。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.cache.priming.disable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">禁用缓存引导，它在启动时抢先使用索引资源加载缓存。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.cache.priming.block_ms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>120000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在等待缓存准备期间，阻止启动的时间，单位毫秒。
                                                                           将此值设置为 <code>-1</code>，以禁用阻止。
                                                                           将此值设置为 <code>0</code>，以无限期地阻止等待读取所有记录。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>可用的缓存策略包括:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">内存缓存</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.newts.support.GuavaSearchableResourceMetadataCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于 Redis 缓存</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.newts.support.RedisResourceMetadataCache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect5">
<h6 id="ga-opennms-operation-newts-properties-redis-cache">Redis 缓存</h6>
<div class="paragraph">
<p>启用后，可以使用以下选项配置基于 Redis 的缓存。</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.cache.redis_hostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Redis</em> 服务器主机名的IP地址。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.newts.config.cache.redis_port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6379</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于连接 <em>Redis</em> 服务器的 TCP 端口。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_建议">建议</h5>
<div class="paragraph">
<p>你可能需要更改 <code>cache.max_entries</code> 和 <code>ring_buffer_size</code> 的值，以适应安装环境。</p>
</div>
<div class="paragraph">
<p>缓存与资源相关的元数据(Meta-data)，以避免 <em>Cassandra</em> 中写入冗余记录。
如果要从大量资源中收集数据，则应增加合适的缓冲区 <code>cache.max_entries</code>，以适应要收集的资源数。</p>
</div>
<div class="paragraph">
<p>收集器收集的样本在使用 <em>Newts</em> 保存到 <em>Cassandra</em> 之前，暂时存储在环形缓冲区中。
如果你希望收集器的大峰值立即回落或延迟存储到 <em>Cassandra</em>，则应增加 <code>ring_buffer_size</code> 的值。
但请注意，环形缓冲区使用的内存是保守的，较大的值可能需要增加堆(heap)大小。</p>
</div>
<div class="paragraph">
<p>启用缓存用于帮助减少重新启动 <em>OpenNMS Horizon</em> 后需要编制索引的记录数。
这可以通过使用在 Cassandra 中存储的索引数据来实现重建缓存。
如果在重新启动后仍然看到相关索引插入的大量峰值，则可能需要考虑增加启动缓存的时间。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cassandra_monitoring">15.6.2. Cassandra Monitoring</h4>
<div class="paragraph">
<p>This section describes some of the metrics <em>OpenNMS Horizon</em> collects from a <em>Cassandra</em> cluster.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
JMX must be enabled on the <em>Cassandra</em> nodes and made accessible from <em>_OpenNMS Horizon</em> in order to collect these metrics.
     See <a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/configuration/secureJmxAuthentication.html">Enabling JMX authentication</a> for details.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The data collection is bound to the agent IP interface with the service name <em>JMX-Cassandra</em>.
     The <em>JMXCollector</em> is used to retrieve the <em>MBean</em> entities from the <em>Cassandra</em> node.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_client_connections">Client Connections</h5>
<div class="paragraph">
<p>The number of active client connections from <code>org.apache.cassandra.metrics.Client</code> are collected:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connectedNativeClients</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metrics for connected native clients</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connectedThriftClients</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metrics for connected thrift clients</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_compaction_bytes">Compaction Bytes</h5>
<div class="paragraph">
<p>The following compaction manager metrics from <code>org.apache.cassandra.metrics.Compaction</code> are collected:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BytesCompacted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of bytes compacted since node started</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_compaction_tasks">Compaction Tasks</h5>
<div class="paragraph">
<p>The following compaction manager metrics from <code>org.apache.cassandra.metrics.Compaction</code> are collected:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletedTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estimated number of completed compaction tasks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PendingTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estimated number of pending compaction tasks</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_storage_load">Storage Load</h5>
<div class="paragraph">
<p>The following storage load metrics from <code>org.apache.cassandra.metrics.Storage</code> are collected:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Load</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total disk space (in bytes) used by this node</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_storage_exceptions">Storage Exceptions</h5>
<div class="paragraph">
<p>The following storage exception metrics from <code>org.apache.cassandra.metrics.Storage</code> are collected:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exceptions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of unhandled exceptions since start of this <em>Cassandra</em> instance</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dropped_messages">Dropped Messages</h5>
<div class="paragraph">
<p>Measurement of messages that were <em>DROPPABLE</em>.
These ran after a given timeout set per message type so was thrown away.
In <em>JMX</em> these are accessible via <code>org.apache.cassandra.metrics.DroppedMessage</code>.
The number of dropped messages in the different message queues are good indicators whether a cluster can handle its load.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Stage</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mutation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MutationStage</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a write message is processed after its timeout (write_request_timeout_in_ms) it either sent a failure to the client or it met its requested consistency level and will relay on hinted handoff and read repairs to do the mutation if it succeeded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Counter_Mutation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MutationStage</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a write message is processed after its timeout (write_request_timeout_in_ms) it either sent a failure to the client or it met its requested consistency level and will relay on hinted handoff and read repairs to do the mutation if it succeeded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Read_Repair</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MutationStage</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Times out after write_request_timeout_in_ms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ReadStage</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Times out after read_request_timeout_in_ms.
                                                No point in servicing reads after that point since it would of returned error to client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Range_Slice</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ReadStage</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Times out after range_request_timeout_in_ms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Request_Response</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RequestResponseStage</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Times out after request_timeout_in_ms.
                                                Response was completed and sent back but not before the timeout</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_thread_pools">Thread pools</h5>
<div class="paragraph">
<p><em>Apache Cassandra</em> is based on a so called <em>Staged Event Driven Architecture</em> (SEDA).
This seperates different operations in stages and these stages are loosely coupled using a messaging service.
Each of these components use queues and thread pools to group and execute their tasks.
The documentation for <em>Cassandra</em> Thread pool monitoring is originated from <a href="http://www.pythian.com/blog/guide-to-cassandra-thread-pools">Pythian Guide to Cassandra Thread Pools</a>.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 120. Collected metrics for Thread Pools</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ActiveTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks that are currently running</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompletedTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks that have been completed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CurrentlyBlockedTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks that have been blocked due to a full queue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PendingTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks queued for execution</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_memtable_flushwriter">Memtable FlushWriter</h6>
<div class="paragraph">
<p>Sort and write <em>memtables</em> to disk from <code>org.apache.cassandra.metrics.ThreadPools</code>.
A vast majority of time this backing up is from over running disk capability.
The sorting can cause issues as well however.
In the case of sorting being a problem, it is usually accompanied with high load but a small amount of actual flushes (seen in cfstats).
Can be from huge rows with large column names, i.e. something inserting many large values into a <em>CQL</em> collection.
If overrunning disk capabilities, it is recommended to add nodes or tune the configuration.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_memtable_post_flusher">Memtable Post Flusher</h6>
<div class="paragraph">
<p>Operations after flushing the <em>memtable</em>.
Discard commit log files that have had all data in them in <em>sstables</em>.
Flushing non-cf backed secondary indexes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_anti_entropy_stage">Anti Entropy Stage</h6>
<div class="paragraph">
<p>Repairing consistency.
Handle repair messages like merkle tree transfer (from Validation compaction) and streaming.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_gossip_stage">Gossip Stage</h6>
<div class="paragraph">
<p>Post 2.0.3 there should no longer be issue with pending tasks.
Instead monitor logs for a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Gossip stage has {} pending tasks; skipping status check ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before that change, in particular older versions of 1.2, with a lot of nodes (100+) while using vnodes can cause a lot of CPU intensive work that caused the stage to get behind.
Been known to of been caused with out of sync schemas.
Check <em>NTP</em> working correctly and attempt <code>nodetool resetlocalschema</code> or the more drastic deleting of system column family folder.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_migration_stage">Migration Stage</h6>
<div class="paragraph">
<p>Making schema changes</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_miscstage">MiscStage</h6>
<div class="paragraph">
<p>Snapshotting, replicating data after node remove completed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_mutation_stage">Mutation Stage</h6>
<div class="paragraph">
<p>Performing a local including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>insert/updates</p>
</li>
<li>
<p>Schema merges</p>
</li>
<li>
<p>commit log replays</p>
</li>
<li>
<p>hints in progress</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to ReadStage, an increase in pending tasks here can be caused by disk issues, over loading a system, or poor tuning. If messages are backed up in this stage, you can add nodes, tune hardware and configuration, or update the data model and use case.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_read_stage">Read Stage</h6>
<div class="paragraph">
<p>Performing a local read.
Also includes deserializing data from row cache.
If there are pending values this can cause increased read latency.
This can spike due to disk problems, poor tuning, or over loading your cluster.
In many cases (not disk failure) this is resolved by adding nodes or tuning the system.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_request_response_stage">Request Response Stage</h6>
<div class="paragraph">
<p>When a response to a request is received this is the stage used to execute any callbacks that were created with the original request.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_read_repair_stage">Read Repair Stage</h6>
<div class="paragraph">
<p>Performing read repairs.
Chance of them occurring is configurable per column family with <code>read_repair_chance</code>.
More likely to back up if using <code>CL.ONE</code> (and to lesser possibly other <code>non-CL.ALL</code> queries) for reads and using multiple data centers.
It will then be kicked off asynchronously outside of the queries feedback loop.
Note that this is not very likely to be a problem since does not happen on all queries and is fast providing good connectivity between replicas.
The repair being droppable also means that after <code>write_request_timeout_in_ms</code> it will be thrown away which further mitigates this.
If pending grows attempt to lower the rate for high read <code>CFs</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Alerts: pending &gt; 15 || blocked &gt; 0
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jvm_metrics">JVM Metrics</h5>
<div class="paragraph">
<p>Some key metrics from the running Java virtual machine are also collected:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">java.lang:type=Memory</dt>
<dd>
<p>The memory system of the Java virtual machine. This includes heap and non-heap memory</p>
</dd>
<dt class="hdlist1">java.lang:type=GarbageCollector,name=ConcurrentMarkSweep</dt>
<dd>
<p>Metrics for the garbage collection process of the Java virtual machine</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you use <em>Apache Cassandra</em> for running <em>Newts</em> you can also enable additional metrics for the <em>Newts</em> keyspace.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_newts_monitoring">15.6.3. Newts Monitoring</h4>
<div class="paragraph">
<p>This section describes the metrics <em>OpenNMS Horizon</em> collects for monitoring the <em>Newts</em> keyspace from <code>org.apache.cassandra.metrics.Keyspace</code> on an <em>Cassandra</em> node.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
JMX must be enabled on the <em>Cassandra</em> nodes and made accessible from <em>_OpenNMS Horizon</em> in order to collect these metrics.
     See <a href="https://docs.datastax.com/en/cassandra/3.0/cassandra/configuration/secureJmxAuthentication.html">Enabling JMX authentication</a> for details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The data collection is bound to the agent IP interface with the service name <em>JMX-Cassandra-Newts</em>.
The <em>JMXCollector</em> is used to retrieve the <em>MBean</em> entities from the <em>Cassandra</em> node.</p>
</div>
<div class="sect4">
<h5 id="_all_memory_table_data_size">All Memory Table Data Size</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AllMemtablesLiveDataSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of live data stored in the memtables (2i and pending flush memtables included) that resides off-heap, excluding any data structure overhead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AllMemtablesOffHeapDataSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of data stored in the memtables (2i and pending flush memtables included) that resides off-heap.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AllMemtablesOnHeapDataSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of data stored in the memtables (2i and pending flush memtables included) that resides on-heap.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_memtable_switch_count">Memtable Switch Count</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MemtableSwitchCount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times flush has resulted in the memtable being switched out.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_memtable_columns_count">Memtable Columns Count</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MemtableColumnsCount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total number of columns present in the memtable.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_memory_table_data_size">Memory Table Data Size</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MemtableLiveDataSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of live data stored in the memtable, excluding any data structure overhead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MemtableOffHeapDataSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of data stored in the memtable that resides off-heap, including column related overhead and partitions overwritten.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MemtableOnHeapDataSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of data stored in the memtable that resides on-heap, including column related overhead and partitions overwritten.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_read_and_write_latency">Read and Write Latency</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReadTotalLatency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local read metrics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WriteTotalLatency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local write metrics.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_range_latency">Range Latency</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RangeLatency 99th Percentile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local range slice metrics 99th percentile.</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_latency">Latency</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CasCommitTotalLatency</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CasPrepareTotalLatency</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CasProposeTotalLatency</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_bloom_filter_disk_space">Bloom Filter Disk Space</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BloomFilterDiskSpaceUsed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk space used by bloom filter</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_bloom_filter_off_heap_memory">Bloom Filter Off Heap Memory</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BloomFilterOffHeapMemoryUsed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off heap memory used by bloom filter</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_newts_memory_used">Newts Memory Used</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>CompressionMetadataOffHeapMemoryUsed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off heap memory used by compression meta data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IndexSummaryOffHeapMemoryUsed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off heap memory used by index summary</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_pending">Pending</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PendingCompactions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estimate of number of pending compactions for this column family</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PendingFlushes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Estimated number of tasks pending for this column family</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_disk_space">Disk Space</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TotalDiskSpaceUsed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total disk space used by <em>SSTables</em> belonging to this column family including obsolete ones waiting to be garbage collected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LiveDiskSpaceUsed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk space used by <em>SSTables</em> belonging to this column family</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-opennms-operation-daemon-config-files">15.7. 模块（Daemon）配置文件</h3>
<div class="paragraph">
<p>配置更改需要重新启动 OpenNMS，并且某些模块（Daemon）可以通过模块重新加载事件触发配置更改。
本节概述了所有模块（Daemon）和相关配置文件，无需重新启动 OpenNMS，即可重新加载。</p>
</div>
<div class="sect3">
<h4 id="ga-opennms-operation-daemon-config-files-eventd">15.7.1. Eventd（事件模块）</h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">内部模块名称</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Eventd</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/internal/reloadDaemonConfig -p 'daemonName Eventd'</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 121. Eventd（事件模块）配置文件概述</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">需要重启</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eventd-configuration.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置 <em>Eventd</em> 的通用行为，例如，侦听 <em>事件</em> 的 <em>IP 地址</em> 和相应 <em>TCP</em> 和 <em>UDP</em> 端口，以及 socket 超时。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eventconf.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Eventd</em> 的主要配置文件。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>events/*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此文件夹中的所有文件在 <code>eventconf.xml</code> 中，通过 <code>include</code> 指令引入。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ga-opennms-operation-daemon-config-files-notifd">15.7.2. Notifd（通知模块）</h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">内部模块名称</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Notifd</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/internal/reloadDaemonConfig -p 'daemonName Notifd'</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 122. Notifd（通知模块）配置文件概述</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">需要重启</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notifd-configuration.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">描述 auto-acknowledge(自动确认) 前缀，例如 nodeUp/nodeDown事件的前缀 "RESOLVED: "。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notificationCommands.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">通知媒体的配置，例如，脚本，XMPP 或 HTTP Post，立即应用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notifications.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">事件通知定义和更改，立即应用。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destinationPaths.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含通知目标的路径，例如，JavaMail, XMPP 或外部脚本。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>users.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含通知目标路径的通讯地址信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groups.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">组可用作通知的目标。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javamail-configuration.properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置通过指定邮件服务器发送通知邮件。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ga-opennms-operation-daemon-config-files-pollerd">15.7.3. Pollerd（轮询模块）</h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">内部模块名称</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Pollerd</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/internal/reloadDaemonConfig -p 'daemonName Pollerd'</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 123. Pollerd（轮询模块）配置文件概述</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">文件</th>
<th class="tableblock halign-left valign-top">需要重启</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>poller-configuration.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果创建或删除新监测器，则需要重新启动。
                                                                  重新加载事件可以加载已更改的现有监测器的配置参数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>response-graph.properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">来自监测器的响应时间图的图形定义。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>poll-outages.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">可以使用 <code>uei.opennms.org/internal/schedOutagesChanged</code> 重新加载。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ga-opennms-operation-daemon-config-files-syslogd">15.7.4. Syslogd</h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">内部模块名称</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Syslogd</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/internal/reloadDaemonConfig -p 'daemonName Syslogd'</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Syslogd 的重新加载事件，重新启动模块并加载 syslogd 所有配置更改。</p>
</div>
<div class="paragraph">
<p>可以使用 karaf 上的以下 shell 命令重新加载 Syslog 模块。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms&gt; reload:daemon syslogd</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-opennms-operation-daemon-config-files-trapd">15.7.5. Trapd</h4>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">内部模块名称</th>
<th class="tableblock halign-left valign-top">重新加载事件</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Trapd</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uei.opennms.org/internal/reloadDaemonConfig -p 'daemonName Trapd'</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Trapd 的重新加载事件，重新启动模块并加载 trapd 所有配置更改。</p>
</div>
<div class="paragraph">
<p>可以使用 karaf 上的以下 shell 命令重新加载 Trapd 模块。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms&gt; reload:daemon trapd</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-opennms-system-properties">16. 系统属性</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>OpenNMS</em> 的全局行为是使用属性文件配置的。
配置也可以对 <em>OpenNMS</em> 下面的 <em>Java 虚拟机</em> 产生影响。
这些属性文件的更改需要重新启动 <em>OpenNMS</em>。
配置文件可以在 <code>${OPENNMS_HOME}/etc</code> 中找到。</p>
</div>
<div class="paragraph">
<p><em>Java 系统属性</em> 优先级如下:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>那些通过 <em>Java</em> 命令行设置的，例如 通过 <code>ADDITIONAL_MANAGER_OPTIONS</code> 在 <code>opennms.conf</code> 中设置</p>
</li>
<li>
<p><code>opennms.properties.d/*.properties</code></p>
</li>
<li>
<p><code>opennms.properties</code></p>
</li>
<li>
<p><code>libraries.properties</code></p>
</li>
<li>
<p><code>rrd-configuration.properties</code></p>
</li>
<li>
<p><code>bootstrap.properties</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>opennms.properties.d/</code> 中的属性文件按字母顺序排序。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
为避免与自定义配置冲突，可以将所有自定义属性添加到 <code>${OPENNMS_HOME}/etc/opennms.properties.d/</code> 中的一个或多个文件中。
     建议避免从默认安装中修改 OpenNMS 属性。
     在 <code>opennms.properties.d/</code> 中创建专用文件来自定义属性。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-ticketing">17. Ticketing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ticketing integration allows <em>OpenNMS Horizon</em> to create trouble tickets in external systems.
Tickets can be created and updated in response to new and/or resolved alarms.</p>
</div>
<div class="paragraph">
<p>To activate the ticketing integration, the following properties in <code>${OPENNMS_HOME}/etc/opennms.properties</code> must be set accordingly:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opennms.ticketer.plugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NullTicketerPlugin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The plugin implementation to use.
                                                                       Each ticketer integration should define which value to set.
                                                                       The <code>NullTicketerPlugin</code> does nothing when attempting to create/update/delete tickets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opennms.alarmTroubleTicketEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if the integration is enabled.
                                                                       If enabled various links to control the issue state is shown on the alarm details page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opennms.alarmTroubleTicketLinkTemplate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A template to generate a link to the issue, e.g. <code><a href="http://issues.opennms.org/browse/${id}" class="bare">http://issues.opennms.org/browse/${id}</a></code></p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="ga-ticketing-jira">17.1. JIRA Ticketing Plugin</h3>
<div class="paragraph">
<p>The <em>JIRA Ticketing Plugin</em> is used to create JIRA Issues in response to <em>OpenNMS Horizon</em> alarms.</p>
</div>
<div class="sect3">
<h4 id="ga-ticketing-jira-setup">17.1.1. Setup</h4>
<div class="paragraph">
<p>First, you&#8217;ll need to install the <code>opennms-plugin-ticketer-jira</code> package for your system.
The JIRA ticketing plugin and it&#8217;s dependencies are not part of the core packages.</p>
</div>
<div class="paragraph">
<p>Now, in order to enable the plugin start by setting following property in <code>${OPENNMS_HOME}/etc/opennms.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>opennms.ticketer.plugin=org.opennms.netmgt.ticketd.OSGiBasedTicketerPlugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure the plugin options by setting the following properties in <code>${OPENNMS_HOME}/etc/jira.properties</code>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JIRA Server Url</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.project</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the project to use. Use <code>jira:list-projects</code> command to determine the project key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Issue Type Id to use when opening new issues. Use <code>jira:list-issue-types</code> command to determine the issue type id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.resolve</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the transition to use when resolving issues</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.reopen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the transition to use when re-opening issues</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.status.open</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of JIRA status names for which the ticket should be considered 'Open'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.status.closed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of JIRA status names for which the ticket should be considered 'Closed'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.status.cancelled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of JIRA status names for which the ticket should be considered 'Cancelled'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jira.cache.reloadTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time in milliseconds it takes to reload the <em>fields cache</em>.
                            This is required to prevent the plugin to read the issue type&#8217;s meta data every time an issue is created.
                            A value of 0 disables the cache.
                            Default value is <code>300000</code> (5 minutes).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The transition names for <code>resolve</code> and <code>reopen</code> are typically found on buttons when looking at the ticket in JIRA
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Either use <code>jira:list-issue-types</code> <em>OSGI Command</em> or <a href="https://confluence.atlassian.com/display/JIRA050/Finding+the+Id+for+Issue+Types" class="bare">https://confluence.atlassian.com/display/JIRA050/Finding+the+Id+for+Issue+Types</a> for determining the appropriate issue type id.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, add <code>jira-troubleticketer</code> to the <code>featuresBoot</code> property in the <code>${OPENNMS_HOME}/etc/org.apache.karaf.features.cfg</code></p>
</div>
<div class="paragraph">
<p>Restart <em>OpenNMS Horizon</em>.</p>
</div>
<div class="paragraph">
<p>When <em>OpenNMS Horizon</em> has started again, login to the <em>Karaf Shell</em> and install the feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>feature:install jira-troubleticketer</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin should be ready to use.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jira_commands">17.1.2. Jira Commands</h4>
<div class="paragraph">
<p>The <em>JIRA Ticketing Plugin</em> provides various <em>OSGI Commands</em> which can be used on the <em>Karaf Shell</em> to help set up the plugin.</p>
</div>
<div class="paragraph">
<p>There are OSGI Commands to list all available projects, versions, components, groups, issue types and even more.</p>
</div>
<div class="paragraph">
<p>To list all available commands simply type <code>help | grep jira</code> in the <em>Karaf Shell</em>.</p>
</div>
<div class="paragraph">
<p>Afterwards you can type for example <code>jira:list-projects --help</code> to determine the usage of a command.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_fields">17.1.3. Custom fields</h4>
<div class="paragraph">
<p>The <em>OpenNMS Horizon</em> Ticketer model is limited to the most common fields provided by all ticketing systems.</p>
</div>
<div class="paragraph">
<p>Besides the common fields creator, create date, description or subject, ticket system proprietary fields usually need to be set.</p>
</div>
<div class="paragraph">
<p>In some cases, even additional - so called - custom fields are defined.</p>
</div>
<div class="paragraph">
<p>In order to set these fields, the <em>JIRA Ticketing Plugin</em> provides the possibility to define those in the OpenNMS Ticket attributes which can be overwritten with the Usage of Drools.</p>
</div>
<div class="paragraph">
<p>To enable the Drools Ticketing integration, the following property in <code>${OPENNMS_HOME}/etc/opennms.properties</code> must be set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>opennms.ticketer.servicelayer=org.opennms.netmgt.ticketd.DroolsTicketerServiceLayer</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition the property in <code>${OPENNMS_HOME/etc/drools-ticketer.properties</code> must point to a <code>drools-ticketer-rules.drl</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>drools-ticketer.rules-file=${OPENNMS_HOME/etc/drools-ticketer-rules.drl</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally a Drools Rule file named <code>drools-ticketer-rules.drl</code> must be placed in <code>${OPENNMS_HOME}/etc</code>.</p>
</div>
<div class="paragraph">
<p>The following drools example snippet defines attributes to set custom fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-drools" data-lang="drools">// Set ticket defaults
rule "TicketDefaults"
salience 100
 when
  $alarm : OnmsAlarm()
 then
  ticket.setSummary($alarm.logMsg);
  ticket.setDetails($alarm.description);
  ticket.addAttribute("customfield_10111", "custom-value");
  ticket.addAttribute("customfield_10112", "my-location");
  ticket.addAttribute("customfield_10113", "some classification");
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fields must be referenced by their <code>id</code>.
To identify the <code>id</code> of a field, the <code>jira:list-fields</code> command can be used.
By default only custom fields are shown.
The <code>-s</code> options allows to show all fields.
This may be necessary if JIRA default values need to be set as well, e.g. the Component, the Reporter, the Asignee, etc.
Even the project key or issue type can be defined differently than originally in the <code>jira.properties</code>.</p>
</div>
<div class="paragraph">
<p>The <em>OpenNMS Ticketer Attribute</em> model only allows to set a String value.
However the JIRA model is slightly different.
Therefore each String value must be converted to a JIRA field type.
The following table describes valid values for an OpenNMS attribute.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any date in the format of <code>YYYY-MM-DD</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datetime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any datetime in ISO 8601 format: <code>YYYY-MM-DDThh:mm:ss.sTZD</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>project</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key of the project (e.g. <code>NMS</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the version. To list all available versions, use <code>jira:list-versions</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>option</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>issuetype</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the issuetpye, e.g. <code>Bug</code>. To list all issue types, use <code>jira:list-issue-types</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the priority, e.g. <code>Major</code>. To list all priorites, use <code>jira:list-priorities</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>option-with-child</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either the name of the option, or a comma separated list (e.g. <code>parent,child</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any valid number (e.g. <code>1000</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the type is <code>array</code> the value must be of the containing type.
                            E.g. to set a custom field which defines multiple groups, the value <code>jira-users,jira-administrators</code> is mapped properly.
                            The same is valid for versions: <code>18.0.3,19.0.0</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As described above the values are usually identified by their name instead of their id (projects are identified by their key).
This is easier to read, but may break the mapping code, if for example the name of a component changes in the future.
To change the mapping from <code>name</code> (or <code>key</code>) to <code>id</code> an entry in <code>jira.properties</code> must be made:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>jira.attributes.customfield_10113.resolution=id</pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about the Jira REST API please consult the following pages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.atlassian.com/jiradev/jira-apis/jira-rest-apis/jira-rest-api-tutorials/jira-rest-api-example-create-issue#JIRARESTAPIExample-CreateIssue-MultiSelect" class="bare">https://developer.atlassian.com/jiradev/jira-apis/jira-rest-apis/jira-rest-api-tutorials/jira-rest-api-example-create-issue#JIRARESTAPIExample-CreateIssue-MultiSelect</a></p>
</li>
<li>
<p><a href="https://docs.atlassian.com/jira/REST/cloud/" class="bare">https://docs.atlassian.com/jira/REST/cloud/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following jira (custom) fields have been tested with jira version <code>6.3.15</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checkboxes</p>
</li>
<li>
<p>Date Picker</p>
</li>
<li>
<p>Date Time Picker</p>
</li>
<li>
<p>Group Picker (multiple groups)</p>
</li>
<li>
<p>Group Picker (single group)</p>
</li>
<li>
<p>Labels</p>
</li>
<li>
<p>Number Field</p>
</li>
<li>
<p>Project Picker (single project)</p>
</li>
<li>
<p>Radio Buttons</p>
</li>
<li>
<p>Select List (cascading)</p>
</li>
<li>
<p>Select List (multiple choices)</p>
</li>
<li>
<p>Select List (single choice)</p>
</li>
<li>
<p>Text Field (multi-line)</p>
</li>
<li>
<p>Text Field (read only)</p>
</li>
<li>
<p>Text Field (single line)</p>
</li>
<li>
<p>URL Field</p>
</li>
<li>
<p>User Picker (multiple user)</p>
</li>
<li>
<p>User Picker (single user)</p>
</li>
<li>
<p>Version Picker (multiple versions)</p>
</li>
<li>
<p>Version Picker (single version)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All other field types are mapped as is and therefore may not work.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_examples">Examples</h5>
<div class="paragraph">
<p>The following output is the result of the command <code>jira:list-fields -h <a href="http://localhost:8080" class="bare">http://localhost:8080</a> -u admin -p testtest -k DUM -i Bug -s</code> and lists all available fields for project with key <code>DUM</code> and issue type <code>Bug</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>Name                           Id                   Custom     Type
Affects Version/s              versions             false      array
Assignee                       assignee             false      user
Attachment                     attachment           false      array
Component/s                    components           false      array  <i class="conum" data-value="1"></i><b>(1)</b>
Description                    description          false      string
Environment                    environment          false      string
Epic Link                      customfield_10002    true       any
Fix Version/s                  fixVersions          false      array <i class="conum" data-value="2"></i><b>(2)</b>
Issue Type                     issuetype            false      issuetype <i class="conum" data-value="3"></i><b>(3)</b>
Labels                         labels               false      array
Linked Issues                  issuelinks           false      array
Priority                       priority             false      priority <i class="conum" data-value="4"></i><b>(4)</b>
Project                        project              false      project <i class="conum" data-value="5"></i><b>(5)</b>
Reporter                       reporter             false      user
Sprint                         customfield_10001    true       array
Summary                        summary              false      string
custom checkbox                customfield_10100    true       array <i class="conum" data-value="6"></i><b>(6)</b>
custom datepicker              customfield_10101    true       date</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defined Components are <code>core</code>, <code>service</code>, <code>web</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defined versions are <code>1.0.0</code> and <code>1.0.1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defined issue types are <code>Bug</code> and <code>Task</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Defined priorities are <code>Major</code> and <code>Minor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Defined projects are <code>NMS</code> and <code>HZN</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Defined options are <code>yes</code>, <code>no</code> and <code>sometimes</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following snipped shows how to set the various custom fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>ticket.addAttribute("components", "core,web"); <i class="conum" data-value="1"></i><b>(1)</b>
ticket.addAttribute("assignee", "ulf"); <i class="conum" data-value="2"></i><b>(2)</b>
ticket.addAttribute("fixVersions", "1.0.1"); <i class="conum" data-value="3"></i><b>(3)</b>
ticket.addAttribte("issueType", "Task"); <i class="conum" data-value="4"></i><b>(4)</b>
ticket.addAttribute("priority", "Minor"); <i class="conum" data-value="5"></i><b>(5)</b>
ticket.addAttribute("project", "HZN"); <i class="conum" data-value="6"></i><b>(6)</b>
ticket.addAttribute("summary", "Custom Summary"); <i class="conum" data-value="7"></i><b>(7)</b>
ticket.addAttribute("customfield_10100", "yes,no"); <i class="conum" data-value="8"></i><b>(8)</b>
ticket.addAttribute("customfield_10101", "2016-12-06"); <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the components of the created issue to <code>core</code> and <code>web</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the Asignee of the issue to the user with login <code>ulf</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sets the fix version of the issue to <code>1.0.1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sets the issue type to <code>Task</code>, overwriting the value of <code>jira.type</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Sets the priority of the created issue to <code>Minor</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Sets the project to <code>HZN</code>, overwriting the value of <code>jira.project</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Sets the summary to <code>Custom Summary</code>, overwriting any previous summary.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Checks the checkboxes <code>yes</code> and <code>no</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Sets the value to <code>2016-12-06</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-ticketing-jira-troubleshooting">17.1.4. Troubleshooting</h4>
<div class="paragraph">
<p>When troubleshooting, consult the following log files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>${OPENNMS_HOME}/data/log/karaf.log</p>
</li>
<li>
<p>${OPENNMS_HOME}/logs/trouble-ticketer.log</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also try the <code>jira:verify</code> <em>OSGI Command</em> to help identifying problems in your configuration.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-ticketing-remedy">17.2. Remedy Ticketing Plugin</h3>
<div class="paragraph">
<p>The <em>Remedy Ticketing Plugin</em> is used to create requests in the BMC Remedy ARS Help Desk Module in response to <em>OpenNMS Horizon</em> alarms.</p>
</div>
<div class="sect3">
<h4 id="_remedy_product_overview">17.2.1. Remedy Product Overview</h4>
<div class="paragraph">
<p>It&#8217;s important to be specific when discussing Remedy, because BMC Remedy is a suite of products.
The <em>OpenNMS Horizon</em> Remedy Ticketing Plugin requires the core Remedy ARS and the Help Desk Module.
The Help Desk Module contains a Help Desk Interface Web Service, which serves as the endpoint for creating, updating, and fetching tickets.</p>
</div>
<div class="paragraph">
<p>The Help Desk Interface (HDI) Web Service requires extensive configuration for its basic operation, and may need additional customization to interoperate with the <em>OpenNMS Horizon</em> Remedy Ticketing Plugin.
Contact your Remedy administrator for help with required configuration tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="_supported_remedy_product_versions">17.2.2. Supported Remedy Product Versions</h4>
<div class="paragraph">
<p>Currently supported Remedy product versions are listed below:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Product</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remedy ARS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.6.04 Service Pack 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help Desk Module</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.6.04 Service Pack 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDI Web Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as Help Desk Module</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ga-ticketing-remedy-setup">17.2.3. Setup</h4>
<div class="paragraph">
<p>The Remedy Ticketing Plugin and its dependencies are part of the <em>OpenNMS Horizon</em> core packages.</p>
</div>
<div class="paragraph">
<p>Start by enabling the plugin and the ticket controls in the <em>OpenNMS Horizon</em> web interface, by setting the following properties in <code>${OPENNMS_HOME}/etc/opennms.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>opennms.ticketer.plugin=org.opennms.netmgt.ticketer.remedy.RemedyTicketerPlugin
opennms.alarmTroubleTicketEnabled = true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the same file, set the property <code>opennms.alarmTroubleTicketLinkTemplate</code> to a value appropriate for constructing a link to tickets in the Remedy web interface.
A sample value is provided but must be customized for your site; the token <code>${id}</code> will be replaced with the Remedy ticket ID when the link is rendered.</p>
</div>
<div class="paragraph">
<p>Now configure the plugin itself by setting the following properties in <code>${OPENNMS_HOME}/etc/remedy.properties</code>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.username</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for authenticating to Remedy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for authenticating to Remedy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.authentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication style to use</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.locale</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Locale for text when creating and updating tickets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.timezone</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timezone for interaction with Remedy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.endpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL of the HPD web service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.portname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Port name of the HPD web service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.createendpoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint location of the Create-HPD web service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.createportname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Port name of the Create-HPD web service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.targetgroups</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Colon-separated list of Remedy groups to which created tickets may be assigned (<code>{group}</code> below refers to values from this list)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.assignedgroup.{group}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned group for the target group <code>{group}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.assignedsupportcompany.{group}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned support company for the target group <code>{group}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.assignedsupportorganization.{group}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned support organization for the target group <code>{group}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.assignedgroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default group to assign the ticket in case the ticket itself lacks information about a target assigned group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.firstname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First name for ticket creation and updating. Must exist in Remedy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.lastname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last name for ticket creation and updating. Must exist in Remedy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.serviceCI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid Remedy Service CI for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.serviceCIReconID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid Remedy Service CI Reconciliation ID for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.assignedsupportcompany</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid default assigned support company for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.assignedsupportorganization</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid default assigned support organization for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.categorizationtier1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid categorization tier (primary) for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.categorizationtier2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid categorization tier (secondary) for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.categorizationtier3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid categorization tier (tertiary) for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.serviceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid service type for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.reportedSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid Reported Source for ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.impact</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid value for Impact, used in ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.urgency</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid value for Urgency, used in ticket creation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.reason.reopen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reason code set in Remedy when the ticket is reopened in <em>OpenNMS Horizon</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.resolution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reason code set in Remedy when the ticket is closed in <em>OpenNMS Horizon</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>remedy.reason.cancelled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reason code set in Remedy when the ticket is cancelled in <em>OpenNMS Horizon</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The values for many of the required properties are site-specific; contact your Remedy administrator for assistance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Restart <em>OpenNMS Horizon</em>.</p>
</div>
<div class="paragraph">
<p>The plugin should be ready to use. When troubleshooting, consult the following log files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>${OPENNMS_HOME}/logs/trouble-ticketer.log</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-ticketing-tsrm">17.3. TSRM Ticketing Plugin</h3>
<div class="paragraph">
<p>The <em>TSRM Ticketing Plugin</em> is used to create TSRM incidents in response to <em>OpenNMS Horizon</em> alarms.</p>
</div>
<div class="sect3">
<h4 id="ga-ticketing-tsrm-setup">17.3.1. Setup</h4>
<div class="paragraph">
<p>In order to enable the plugin start by setting following property in <code>${OPENNMS_HOME}/etc/opennms.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>opennms.ticketer.plugin=org.opennms.netmgt.ticketd.OSGiBasedTicketerPlugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure the plugin options by setting the following properties in <code>${OPENNMS_HOME}/etc/tsrm.properties</code>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tsrm.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSRM Endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tsrm.ssl.strict</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strict SSL Check (true/false)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tsrm.status.open</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSRM status for open ticket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tsrm.status.close</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSRM status for close ticket</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Next, add <code>tsrm-troubleticketer</code> to the <code>featuresBoot</code> property in the <code>${OPENNMS_HOME}/etc/org.apache.karaf.features.cfg</code></p>
</div>
<div class="paragraph">
<p>Restart <em>OpenNMS</em>.</p>
</div>
<div class="paragraph">
<p>When <em>OpenNMS</em> has started again, login to the <em>Karaf Shell</em> and install the feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>feature:install tsrm-troubleticketer</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin should be ready to use. When troubleshooting, consult the following log files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>${OPENNMS_HOME}/data/log/karaf.log</p>
</li>
<li>
<p>${OPENNMS_HOME}/logs/trouble-ticketer.log</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mapping_opennms_ticket_with_tsrm_incident">17.3.2. Mapping OpenNMS Ticket with TSRM Incident</h4>
<div class="paragraph">
<p>Following tables shows mapping between OpenNMS ticket and TSRM Incident</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Ticket Field</th>
<th class="tableblock halign-left valign-top">TSRM Incident Field</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TICKETID</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STATUS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>summary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DESCRIPTION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>details</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DESCRIPTIONLONGDESCRIPTION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REPORTEDBY</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below fields are not part of Ticket, they have to be added as attributes.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Ticket Field</th>
<th class="tableblock halign-left valign-top">TSRM Incident Field</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>affectedPerson</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AFFECTEDPERSON</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assetNum</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ASSETNUM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLASS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classStructureId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLASSSTRUCTUREID</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>commodity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMMODITY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOCATION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ownerGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OWNERGROUP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shsCallerType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SHSCALLERTYPE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shsReasonForOutage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SHSREASONFOROUTAGE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shsResolution</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SHSRESOLUTION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shsRoomNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SHSROOMNUMBER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>siteId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SITEID</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statusIface</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STATUSIFACE</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-rmi">18. Enabling RMI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the RMI port in the OpenNMS Horizon server is disabled, for security reasons.  If you wish to enable it so you can access OpenNMS Horizon through jconsole, remote-manage OpenNMS Horizon, or use the remote poller over RMI, you will have to add some settings to the default OpenNMS Horizon install.</p>
</div>
<div class="sect2">
<h3 id="_enabling_rmi">18.1. Enabling RMI</h3>
<div class="paragraph">
<p>To enable the RMI port in OpenNMS Horizon, you will have to add the following to the <code>${OPENNMS_HOME}/etc/opennms.conf</code> file.  If you do not have an <code>opennms.conf</code> file, you can create it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-bash" data-lang="bash"># Configure remote JMX
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.port=18980"
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.local.only=false"
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.authenticate=true"
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.ssl=false"

# Listen on all interfaces
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dopennms.poller.server.serverHost=0.0.0.0"
# Accept remote RMI connections on this interface
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Djava.rmi.server.hostname=&lt;your-server-ip-address&gt;"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells OpenNMS Horizon to listen for RMI on port <code>18980</code>, and to listen on all interfaces.  (Originally, RMI was only used for the Remote Poller, so despite the porperty name mentioning the "opennms poller server" it applies to RMI as a whole.)  Note that you <em>must</em> include the <code>-Djava.rmi.server.hostname=</code> option or OpenNMS Horizon will accept connections on the RMI port, but not be able to complete a valid connection.</p>
</div>
<div class="paragraph">
<p>Authentication will only be allowed for users that are in the <code>admin</code> role (i.e. <code>ROLE_ADMIN</code>), or the <code>jmx</code> role (i.e. <code>ROLE_JMX</code>).
To make a user an admin, be sure to add only the <code>ROLE_ADMIN</code> role to the user in <code>users.xml</code>.
To add the <code>jmx</code> role to the user, add the <code>ROLE_JMX</code> role to the user in <code>users.xml</code>, and also the <code>ROLE_USER</code> role if is required to provide access to the WebUI.</p>
</div>
<div class="paragraph">
<p>Make sure <code>$OPENNMS_HOME/etc/jmxremote.access</code> has the appropriate settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">admin   readwrite
jmx     readonly</pre>
</div>
</div>
<div class="paragraph">
<p>The possible types of access are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">readwrite</dt>
<dd>
<p>Allows retrieving JMX metrics as well as executing MBeans.</p>
</dd>
<dt class="hdlist1">readonly</dt>
<dd>
<p>Allows retrieving JMX metrics but does <strong>not</strong> allow executing MBeans, even if they just return simple values.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_ssl">18.2. Enabling SSL</h3>
<div class="paragraph">
<p>To enable SSL on the RMI port, you will need to have an existing keystore for the OpenNMS Horizon server.  For information on configuring a keystore, please refer to the official <em>OpenNMS Horizon</em> Wiki article <a href="http://wiki.opennms.org/wiki/Standalone_HTTPS_with_Jetty">Standalone HTTPS with Jetty</a>.</p>
</div>
<div class="paragraph">
<p>You will need to change the <code>com.sun.management.jmxremote.ssl</code> option to <code>true</code>, and tell OpenNMS Horizon where your keystore is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight nowrap"><code class="language-bash" data-lang="bash"># Configure remote JMX
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.port=18980"
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.local.only=false"
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.authenticate=true"
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dcom.sun.management.jmxremote.ssl=true"

# Configure SSL Keystore
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Djavax.net.ssl.keyStore=/opt/opennms/etc/opennms.keystore"
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Djavax.net.ssl.keyStorePassword=changeit"

# Listen on all interfaces
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Dopennms.poller.server.serverHost=0.0.0.0"
# Accept remote RMI connections on this interface
ADDITIONAL_MANAGER_OPTIONS="$ADDITIONAL_MANAGER_OPTIONS -Djava.rmi.server.hostname=&lt;your-server-ip-address&gt;"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_to_rmi_over_ssl">18.3. Connecting to RMI over SSL</h3>
<div class="paragraph">
<p>Note that if you are using a self-signed or otherwise untrusted certificate, you will need to configure a <em>truststore</em> on the client side when you attempt to connect over SSL-enabled RMI.  To create a truststore, follow the example in <a href="#ga-operation-https-client">the HTTPS client instructions</a> in the operator section of the manual.  You may then use the truststore to connect to your OpenNMS Horizon RMI server.</p>
</div>
<div class="paragraph">
<p>For example, when using <code>jconsole</code> to connect to the OpenNMS Horizon RMI interface to get JVM statistics, you would run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">jconsole -J-Djavax.net.ssl.trustStore=/path/to/opennms.truststore -J-Djavax.net.ssl.trustStorePassword=changeit</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-minion">19. Minion</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ga-minion-kafka">19.1. 使用 Kafka 接收 ( Traps 和 Syslog)</h3>
<div class="paragraph">
<p>默认情况下，<em>OpenNMS Horizon</em> 使用内置的 <em>ActiveMQ</em> 代理与 <em>Minions</em> 进行通信。
此代理用于发出远程过程调用 (RPCs，例如，ping 此主机)，以及传输非请求的消息，像 SNMP traps 和 syslog 消息。</p>
</div>
<div class="paragraph">
<p><em>Apache Kafka</em> 可以用作 <em>ActiveMQ</em> 的替代方法来传输非请求的消息。</p>
</div>
<div class="paragraph">
<p>必须在 <em>OpenNMS Horizon</em> 和 <em>Minion</em> 上启用 <em>Kafka</em> 才能工作。</p>
</div>
<div class="paragraph">
<p><em>Kafka</em> 服务器必须与 <em>Kafka</em> 客户端版本 <code>1.0.1</code> 兼容。</p>
</div>
<div class="sect3">
<h4 id="_消费者配置">19.1.1. 消费者配置</h4>
<div class="paragraph">
<p>使用以下命令在 <em>OpenNMS Horizon</em> 上启用和配置 <em>Kafka</em> 消费模式。属性 <code>initialSleepTime</code> 将确保在 <em>OpenNMS Horizon</em> 系统完全初始化之前，<em>Kafka</em> 不会处理消息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'org.opennms.core.ipc.sink.initialSleepTime=60000' &gt; "$OPENNMS_HOME/etc/opennms.properties.d/sink-initial-sleep-time.properties"
echo 'org.opennms.core.ipc.sink.strategy=kafka
org.opennms.core.ipc.sink.kafka.bootstrap.servers=127.0.0.1:9092' &gt;&gt; "$OPENNMS_HOME/etc/opennms.properties.d/kafka.properties"</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 <em>OpenNMS Horizon</em> 以应用更改。</p>
</div>
<div class="paragraph">
<p>可以通过定义前缀为 <code>org.opennms.core.ipc.sink.kafka</code> 的其它系统属性来设置 <em>Kafka</em> 的消费者选项。
例如，你可以使用 <code>org.opennms.core.ipc.sink.kafka.group.id=MyOpenNMS</code> 自定义组 ID。</p>
</div>
<div class="paragraph">
<p>可以在 <a href="https://kafka.apache.org/10/documentation.html#newconsumerconfigs">New Consumer Configs</a> 中找到所有可用选项。</p>
</div>
</div>
<div class="sect3">
<h4 id="ga-minion-kafka-producer-configuration">19.1.2. 生产者配置</h4>
<div class="paragraph">
<p>使用以下命令在 <em>Minion</em> 上启用 <em>Kafka</em> 生产者:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo '!opennms-core-ipc-sink-camel
opennms-core-ipc-sink-kafka' &gt;&gt; "$MINION_HOME/etc/featuresBoot.d/kafka.boot"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
上面的代码阻止 <code>opennms-core-ipc-sink-camel</code> 功能在 <em>Minion</em> 启动时启动，并加载了 <code>opennms-core-ipc-sink-kafka</code> 功能代替。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>接下来，使用以下命令在 <em>Minion</em> 上配置 <em>Kafka</em> 生产者:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'bootstrap.servers=127.0.0.1:9092
acks=1' &gt; "$MINION_HOME/etc/org.opennms.core.ipc.sink.kafka.cfg"</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 <em>Minion</em> 以应用更改。</p>
</div>
<div class="paragraph">
<p>其它 <em>Kafka</em> 生产者选项可以直接在上面的 <code>org.opennms.core.ipc.sink.kafka.cfg</code> 中设置。
可以在 <a href="https://kafka.apache.org/10/documentation.html#producerconfigs">Producer Configs</a> 中找到所有可用选项。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_使用_kafka_进行_rpc">19.2. 使用 Kafka 进行 RPC</h3>
<div class="paragraph">
<p>默认情况下，<em>OpenNMS Horizon</em> 使用内置的 <em>ActiveMQ</em> 代理与 <em>Minions</em> 进行通信。</p>
</div>
<div class="paragraph">
<p>必须在 <em>OpenNMS Horizon</em> 和 <em>Minion</em> 上启用 <em>Kafka</em> 才能工作。</p>
</div>
<div class="paragraph">
<p><em>Kafka</em> 服务器必须与 <em>Kafka</em> 客户端版本 <code>1.0.1</code> 兼容。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
对于 Kafka RPC，分区数应始终大于某个 location（站点）的 minion 数。当有多个 locations（站点）时，partitions（分区） &gt;= max (某个站点的 minions 数)。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_客户端opennms_配置">19.2.1. 客户端(OpenNMS) 配置</h4>
<div class="paragraph">
<p>使用以下命令在 <em>OpenNMS Horizon</em> 上启用和配置 <em>Kafka</em>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'org.opennms.core.ipc.rpc.strategy=kafka
org.opennms.core.ipc.rpc.kafka.bootstrap.servers=127.0.0.1:9092' &gt;&gt; "$OPENNMS_HOME/etc/opennms.properties.d/kafka.properties"</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 <em>OpenNMS Horizon</em> 以应用更改。
可以通过定义前缀为 <code>org.opennms.core.ipc.rpc.kafka</code> 的其它系统属性来设置 <em>Kafka</em> producer/consumer（生产者/消费者）选项。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认生存时间 (请求到期的时间) 为30秒。可以通过配置系统属性 <code>org.opennms.core.ipc.rpc.kafka.ttl</code> 来更改。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_服务器_minion_配置">19.2.2. 服务器 (Minion) 配置</h4>
<div class="paragraph">
<p>使用以下命令在 <em>Minion</em> 上启用 <em>Kafka</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo '!opennms-core-ipc-rpc-jms
opennms-core-ipc-rpc-kafka' &gt;&gt; "$MINION_HOME/etc/featuresBoot.d/kafka.boot"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
上面的代码段阻止 <code>opennms-core-ipc-rpc-jms</code> 功能，在 <em>Minion</em> 启动时一起启动，并使用 <code>opennms-core-ipc-rpc-kafka</code> 功能代替。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>接下来，使用以下命令在 <em>Minion</em> 上配置 <em>Kafka</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'bootstrap.servers=127.0.0.1:9092
acks=1' &gt; "$MINION_HOME/etc/org.opennms.core.ipc.rpc.kafka.cfg"</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在此处找到 kafka producer/consumer（生产者/消费者）配置的所有可用选项。
<a href="https://kafka.apache.org/10/documentation.html#producerconfigs">Producer Configs</a>.
<a href="https://kafka.apache.org/10/documentation.html#newconsumerconfigs">New Consumer Configs</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_使用_aws_sqs">19.3. 使用 AWS SQS</h3>
<div class="paragraph">
<p>默认情况下， <em>{product-title}</em> 和 <em>Minions</em> 之间使用 <em>ActiveMQ</em> 进行通信。
该代理用于发出远程过程调用 (RPCs, 即 ping 该主机) ，以及传输像 SNMP traps 和 syslog 消息等主动型消息。</p>
</div>
<div class="paragraph">
<p><em>AWS 简单队列服务 (SQS)</em> 可以用来替代 <em>ActiveMQ</em> 传输请求消息。</p>
</div>
<div class="paragraph">
<p><em>AWS SQS</em> 必须在 <em>{product-title}</em> 和 <em>Minion</em> 上同时启用。</p>
</div>
<div class="sect3">
<h4 id="_opennms_horizon_配置">19.3.1. <em>OpenNMS Horizon</em> 配置</h4>
<div class="paragraph">
<p>使用以下命令启用和配置 <em>OpenNMS Horizon</em> 上的 <em>AWS SQS</em> 。
属性 <code>initialSleepTime</code> 将确保在 <em>OpenNMS Horizon</em> 系统完全初始化之前，<em>AWS SQS</em> 不会处理消息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'org.opennms.core.ipc.rpc.strategy=sqs
org.opennms.core.ipc.sink.strategy=sqs
org.opennms.core.ipc.sink.initialSleepTime=60000
org.opennms.core.ipc.aws.sqs.aws_region=us-east-1' &gt; "$OPENNMS_HOME/etc/opennms.properties.d/aws-sqs.properties"</code></pre>
</div>
</div>
<div class="paragraph">
<p>要访问 SQS，必须需要AWS 证书.
默认提供凭证的程序，按照下面的顺序查找凭证：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>环境变量 (例如 <code>AWS_ACCESS_KEY_ID</code> 和 <code>AWS_SECRET_ACCESS_KEY</code>)</p>
</li>
<li>
<p>Java 系统属性 (例如 <code>aws.accessKeyId</code> 和 <code>aws.secretKey</code>。这些 keys 可以添加到 <code>$OPENNMS_HOME/etc/opennms.conf</code>)</p>
</li>
<li>
<p>默认凭证配置文件 (例如 <code>~/.aws/credentials</code>)</p>
</li>
<li>
<p>Amazon ECS 容器凭据 (例如 <code>AWS_CONTAINER_CREDENTIALS_RELATIVE_URI</code>)</p>
</li>
<li>
<p>实例配置文件凭据 (例如 在 EC2 上运行时通过 metadata 服务)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>也可以在 <code>aws-sqs.properties</code> 文件中指定凭证：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'org.opennms.core.ipc.aws.sqs.aws_access_key_id=XXXXXXXXXXX
org.opennms.core.ipc.aws.sqs.aws_secret_access_key=XXXXXXXXXXX' &gt;&gt; "$OPENNMS_HOME/etc/opennms.properties.d/aws-sqs.properties"</code></pre>
</div>
</div>
<div class="paragraph">
<p>当 AWS 在 OpenNMS 里运行时，可以使用 IAM 角色的默认提供程序来避免对 AWS 凭证配置文件硬编码。
下面显示了一个与 OpenNMS 运行的 EC2 实例关联角色的例子：</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/minion/aws-iam-role.png" alt="aws iam role"></span></p>
</div>
<div class="paragraph">
<p>如果需要对消息进行一致的排序，则应该使用 FIFO 队列而不是标准队列。
你可以将以下参数添加到 <code>aws-sqs.properties</code> 文件，来启用 FIFO 队列：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">org.opennms.core.ipc.aws.sqs.sink.FifoQueue=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 <em>OpenNMS Horizon</em> 以应用更改。</p>
</div>
</div>
<div class="sect3">
<h4 id="_minion_配置">19.3.2. Minion 配置</h4>
<div class="paragraph">
<p>使用以下命令在 <em>Minion</em> 上启用 <em>AWS SQS</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo '!minion-jms
!opennms-core-ipc-rpc-jms
!opennms-core-ipc-sink-camel
opennms-core-ipc-rpc-aws-sqs
opennms-core-ipc-sink-aws-sqs' &gt; "$MINION_HOME/etc/featuresBoot.d/aws-sqs.boot"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
上面的代码可以禁止默认的 JMS 相关的功能启动，而加载 SQS 相关功能代替。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>接下来，使用以下命令在 <em>Minion</em> 上配置 <em>AWS SQS</em>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'aws_region=us-east-1
aws_access_key_id=XXXXXXXXXXX
aws_secret_access_key=XXXXXXXXXXX' &gt; "$MINION_HOME/etc/org.opennms.core.ipc.aws.sqs.cfg"</code></pre>
</div>
</div>
<div class="paragraph">
<p>AWS 证书是必需的。
如果没有在配置文件上指定，则将使用默认凭证提供程序 (上文解释) 。</p>
</div>
<div class="paragraph">
<p>如果需要对消息进行一致的排序，则应该使用 FIFO 队列而不是标准队列。
你可以通过将以下参数添加到 <code>org.opennms.core.ipc.aws.sqs.cfg</code> 文件来启用 FIFO 队列：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">sink.FifoQueue=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新启动 <em>Minion</em> 以应用更改。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
当 Minion 内部没有运行 VPC 时，AWS 需要证书。
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Minion SQS 设置必须与 OpenNMS 当前的设置相匹配。
           这对于 <em>FifoQueue</em> 设置尤其重要。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sqs_配置">19.3.3. SQS 配置</h4>
<div class="paragraph">
<p>从 <a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_SetQueueAttributes.html">Amazon SQS 文档</a> 中，下表列出了可添加到 Minion 的参数 (通过 <code>MINION_HOME/etc/org.opennms.core.ipc.aws.sqs.cfg</code>) 或 <em>OpenNMS Horizon</em> (通过 <code>OPENNMS_HOME/etc/opennms.properties.d/aws-sqs.properties</code>)，以及每个环境的正确语法。</p>
</div>
<div class="sect4">
<h5 id="_接收设置">接收设置</h5>
<div class="paragraph">
<p>用于接收非请求的消息的队列 (例如 SNMP traps, syslog 消息) 通过在 SQS 参数名称前添加 <code>sink</code> 属性来配置:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">注释</th>
<th class="tableblock halign-left valign-top"><em>OpenNMS Horizon</em></th>
<th class="tableblock halign-left valign-top">Minion</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DelaySeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 0 秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.DelaySeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.DelaySeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MaximumMessageSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 262144 字节</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.MaximumMessageSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.MaximumMessageSize</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MessageRetentionPeriod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 1209600 秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.MessageRetentionPeriod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.MessageRetentionPeriod</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReceiveMessageWaitTimeSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 10 秒 (OpenNMS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.ReceiveMessageWaitTimeSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.ReceiveMessageWaitTimeSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VisibilityTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 30 秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.VisibilityTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.VisibilityTimeout</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.Policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.Policy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RedrivePolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.RedrivePolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.RedrivePolicy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KmsMasterKeyId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.KmsMasterKeyId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.KmsMasterKeyId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KmsDataKeyReusePeriodSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.KmsDataKeyReusePeriodSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.KmsDataKeyReusePeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FifoQueue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.FifoQueue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.FifoQueue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContentBasedDeduplication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅在 <code>sink.FifoQueue</code> 为 <code>true</code> 时有效</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.sink.ContentBasedDeduplication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sink.ContentBasedDeduplication</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_rpc_设置">RPC 设置</h5>
<div class="paragraph">
<p>除了接收非请求的消息之外，用于 provisioning, 服务轮询, 数据采集, 和其它功能的队列是通过在 SQS 参数名前面添加 <code>rpc</code> 属性来配置:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">注释</th>
<th class="tableblock halign-left valign-top"><em>OpenNMS Horizon</em></th>
<th class="tableblock halign-left valign-top">Minion</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DelaySeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 0 秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.DelaySeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.DelaySeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MaximumMessageSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 262144 字节</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.MaximumMessageSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.MaximumMessageSize</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MessageRetentionPeriod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 1209600 秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.MessageRetentionPeriod</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.MessageRetentionPeriod</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReceiveMessageWaitTimeSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 10 秒 (OpenNMS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.ReceiveMessageWaitTimeSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.ReceiveMessageWaitTimeSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VisibilityTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: 30 秒</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.VisibilityTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.VisibilityTimeout</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.Policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.Policy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RedrivePolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.RedrivePolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.RedrivePolicy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KmsMasterKeyId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.KmsMasterKeyId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.KmsMasterKeyId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KmsDataKeyReusePeriodSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.KmsDataKeyReusePeriodSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.KmsDataKeyReusePeriodSeconds</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FifoQueue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">默认: false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.FifoQueue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.FifoQueue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContentBasedDeduplication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅当 <code>rpc.FifoQueue</code> 为 <code>true</code> 时有效</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.core.ipc.aws.sqs.rpc.ContentBasedDeduplication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rpc.ContentBasedDeduplication</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
当不需要 FIFO 队列时，不需要将 <code>FifoQueue=false</code> 添加到配置文件中，因为这是默认行为。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_管理多个环境">19.3.4. 管理多个环境</h4>
<div class="paragraph">
<p>为了在单个 AWS 区域中支持多个 <em>OpenNMS Horizon</em> 环境，可以使用 <code>aws_queue_name_prefix</code> 属性为队列名称添加前缀。</p>
</div>
<div class="paragraph">
<p>例如，如果我们将此属性设置为 "PROD"，则队列名称将类似于 <code>PROD-OpenNMS-Sink-Heartbeat</code>，而不是 <code>OpenNMS-Sink-Heartbeat</code>。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
必须在 <em>OpenNMS Horizon</em>  和 Minion 两端正确配置此属性。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_aws_证书">19.3.5. AWS 证书</h4>
<div class="paragraph">
<p>OpenNMS 和 Minion 双方都需要凭证 (也叫作公钥和秘钥) 。</p>
</div>
<div class="paragraph">
<p>为了创建访问 SQS 资源的凭证，请遵循以下步骤：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>从 AWS 控制台中，选择适当的区域。</p>
</li>
<li>
<p>打开 IAM Dashboard ，然后单击 "Add user"。</p>
</li>
<li>
<p>选择一个用户名，例如 <code>opennms-minion</code>。</p>
</li>
<li>
<p>只选择 <code>Programmatic access</code> 的访问类型。</p>
</li>
<li>
<p>在权限上，单击 <code>Attach existing policies directly</code>。</p>
</li>
<li>
<p>在搜索栏上，输入 SQS，然后选择 <code>AmazonSQSFullAccess</code>。</p>
</li>
<li>
<p>单击创建用户</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/minion/aws-minion-user.png" alt="aws minion user"></span></p>
</div>
<div class="paragraph">
<p>最后，单击下载 .csv 或单击 "显示" 以获取访问公钥和秘钥的副本。</p>
</div>
</div>
<div class="sect3">
<h4 id="_限制">19.3.6. 限制</h4>
<div class="paragraph">
<p>当使用 <em>AWS SQS</em> 时，有许多限制，特别是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>消息只能包括 XML, JSON, 和无格式文本。下面的 Unicode 字符是允许的: <code>#x9</code> | <code>#xA</code> | <code>#xD</code> | <code>#x20</code> to <code>#xD7FF</code> | <code>#xE000</code> to <code>#xFFFD</code> | <code>#x10000</code> to <code>#x10FFFF</code>。除此之外的任何字符都是禁止的。</p>
</li>
<li>
<p>最小消息大小是一个字节 (1个字符)。最大值是 262,144 字节 (256 KB)。</p>
</li>
<li>
<p>没有批处理，FIFO 队列可以支持最多每秒300条消息 (300 发送, 接收, 或删除操作每秒)。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>详情请参考 <a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-limits.html">Amazon SQS Limits</a>。</p>
</div>
<div class="sect4">
<h5 id="_站点名称">站点名称</h5>
<div class="paragraph">
<p>在 <em>AWS SQS</em> 中队列名称限制为80个字符。
当发出远程过程调用时，目标位置被用作队列名称的一部分。
因此，重要的是:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>位置名称和队列名称前缀 (如果使用) 的长度合计不得超过32个字符。</p>
</li>
<li>
<p>位置名称和队列名称前缀 (如果使用) 只能包含字母与数字, 连字符 (-), 和下划线 (_)。
:imagesdir: ../../images</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_使用_off_heap离线堆存储接收消息">19.4. 使用 Off-heap（离线堆）存储接收消息</h3>
<div class="paragraph">
<p>如果 <em>Minion</em> 失去与代理的连接 (即 <em>Kafka</em> 或 <em>ActiveMQ</em>)，则任何收到的消息 (例如 syslog, flows, SNMP traps) 都会在 JVM 堆中排队，直到恢复连接。
此队列受固定（可配置）数量的消息限制。
队列填满后，将删除其它消息。</p>
</div>
<div class="paragraph">
<p>离线堆（off-heap）存储功能允许我们通过在 JVM 堆外部排队消息来扩展存储容量。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
离线堆（off-heap）存储，当前实现支持将消息存储在堆外部的系统内存中。
      目前不支持基于文件系统的存储。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_配置_off_heap离线堆存储">19.4.1. 配置 Off-heap（离线堆）存储</h4>
<div class="paragraph">
<p>在 <em>Minion</em> 上安装 off-heap（离线堆）功能:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'opennms-core-ipc-sink-offheap' &gt;&gt; "$MINION_HOME/etc/featuresBoot.d/features.boot"</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置存储限制并启用该功能:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'offHeapSize=1.2GB
enableOffHeap=true' &gt; "$MINION_HOME/etc/org.opennms.core.ipc.sink.offheap.cfg"</code></pre>
</div>
</div>
<div class="paragraph">
<p>以 KB, MB 或 GB 为单位指定 offHeapSize。例如: 1.2GB, 2.5MB, 845KB。
它将被转换为字节。
在上面的示例中，offHeapSize 配置为 1.2GB。
那是 1288490188 字节。
例如: 1.2MB 有效。
1gb 无效。</p>
</div>
<div class="paragraph">
<p>当使用 <em>Kafka</em> 作为接收策略时，默认情况下每个接收消息将在30秒后过期，请参阅: <a href="https://issues.opennms.org/browse/NMS-10395">NMS-10395</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-sentinel">20. Sentinel</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Sentinel</em> 的目标是从 <em>OpenNMS Horizon</em> 扩展和分发单个组件。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
sentinel 功能仍处于开发阶段，这只是一个非常粗略的文档，并未涵盖所有方面。
            有关更多详细信息，请参阅 Limitations（限制）部分
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_限制_2">20.1. 限制</h3>
<div class="paragraph">
<p>目前 <em>Sentinel</em> 处于非常早期的开发状态，因此使用受到限制:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>仅允许分发 <em>Telemetryd</em> 功能 (例如，处理 flows，或使用现有的 telemetry 适配器将度量数据存储到 <em>Newts</em>)</p>
</li>
<li>
<p>需要 <em>Minion</em> 作为 (消息) 生产者</p>
</li>
<li>
<p>在大多数情况下，如果它们也由 <em>Sentinel</em> 实例运行，建议在 <em>OpenNMS Horizon</em> 中禁用这些适配器和侦听器。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_安装">20.2. 安装</h3>
<div class="paragraph">
<p>如果 <em>Minion</em> 已经工作，那么 <em>Sentinel</em> 的基础已经具备。
有关如何安装 <em>Sentinel</em> 的更多详细信息，请参阅安装指南。</p>
</div>
</div>
<div class="sect2">
<h3 id="_启动清空">20.3. 启动清空</h3>
<div class="paragraph">
<p>在每次启动时，<em>Sentinel</em> 的缓存将被清除，这意味着容器将返回原始状态。
要禁用此功能，请在 <code>${SENTINEL_HOME}/etc/system.properties</code> 中设置 <code>karaf.clean.cache = false</code>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_配置_3">20.4. 配置</h3>
<div class="paragraph">
<p>假设 <em>Sentinel</em> 容器运行在与 <em>OpenNMS Horizon</em> 和 <em>Minion</em> 不同的系统上。
那么，至少需要以下配置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>配置数据源以连接到 Postgres 数据库</p>
</li>
<li>
<p>配置控制器 (与 OpenNMS 通信的标识和连接 - 与 <em>Minion</em> 相同)</p>
</li>
<li>
<p>配置通信层 (现在是 JMS 或 Kafka)</p>
</li>
<li>
<p>安装功能</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_配置数据源">20.4.1. 配置数据源</h4>
<div class="paragraph">
<p>为了让 <em>Sentinel</em> 连接到 <em>OpenNMS Horizon</em> 的 PostgreSQL 数据库，必须执行以下操作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>config:edit org.opennms.netmgt.distributed.datasource
config:property-set datasource.url jdbc:postgresql://&lt;db-host&gt;:&lt;db-port&gt;/&lt;db-name&gt;
config:property-set datasource.username &lt;db-user&gt;
config:property-set datasource.password &lt;db-password&gt;
config:property-set datasource.databaseName &lt;db-name&gt;
config:update</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置控制器">20.4.2. 配置控制器</h4>
<div class="listingblock">
<div class="content">
<pre>config:edit org.opennms.sentinel.controller
config:property-set location SENTINEL <i class="conum" data-value="1"></i><b>(1)</b>
config:property-set id 00000000-0000-0000-0000-000000ddba11 <i class="conum" data-value="2"></i><b>(2)</b>
config:property-set http-url http://127.0.0.1:8980/opennms <i class="conum" data-value="3"></i><b>(3)</b>
config:property-set broker-url failover:tcp://127.0.0.1:61616 <i class="conum" data-value="4"></i><b>(4)</b>
config:update</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>目前尚未使用，但必须提供</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>目前未使用，可省略</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>url 指向 OpenNMS Horizon (必填)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>url 指向 OpenNMS Horizon 的 Active MQ Broker (仅在使用 <code>sentinel-jms</code> 功能时才需要，否则可以省略)</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
基本上支持与 <em>Minion Controller</em> 相同的属性，但必须将其放在配置文件
        <code>org.opennms.sentinel.controller.cfg</code> 中，而不是 <code>org.opennms.minion.controller.cfg</code>。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_配置连接">20.4.3. 配置连接</h4>
<div class="paragraph">
<p>默认情况下，<em>Sentinel</em> 使用来自 <em>OpenNMS Horizon ActiveMQ Broker</em> 的消息。
有关详细信息，请参阅 <code>配置控制器</code>。</p>
</div>
<div class="paragraph">
<p>与 <em>Minion</em> 一样，<em>Sentinel</em> 也可以配置为使用来自 <em>Kafka</em> 的消息</p>
</div>
<div class="sect4">
<h5 id="_使用_kafka">使用 Kafka</h5>
<div class="paragraph">
<p>当 <em>Sentinel</em> 使用 <em>Kafka</em> 时，适用于 <em>Minions 使用 Kafka</em> 时的相同规则。</p>
</div>
<div class="sect5">
<h6 id="_kafka_配置">Kafka 配置</h6>
<div class="paragraph">
<p>每个 <em>Minion</em> 都作为生产者工作，必须先配置。
有关如何将 <em>Minion</em> 配置为 <em>Kafka Producer</em> ，请参阅 <a href="#ga-minion-kafka-producer-configuration">Minion Kafka 生产者配置</a> 一节。</p>
</div>
<div class="paragraph">
<p>每个 <em>Sentinel</em> 都作为消费者使用，可以在文件 <code>${SENTINEL_HOME}/etc/org.opennms.core.ipc.sink.kafka.consumer.cfg</code> 中配置。
手动或通过 <code>config:edit org.opennms.core.ipc.sink.kafka.consumer</code> 语句。
有关支持的属性，请参阅 <a href="https://kafka.apache.org/10/documentation.html#newconsumerconfigs">here</a></p>
</div>
<div class="paragraph">
<p>默认情况下，每个 <em>Kafka Consumer（消费者）</em> 在功能启动后，立即开始处理消息。
可以设置属性 <code>org.opennms.core.ipc.sink.initialSleepTime</code> 来定义初始休眠时间，以延迟处理消息。
要设置，请在文件 <code>${SENTINEL_HOME}/etc/system.properties</code> 的末尾添加一个条目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code># Initial delay of 5 seconds before consuming of messages is started in milliseconds
org.opennms.core.ipc.sink.initialSleepTime=5000</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_可用功能">20.4.4. 可用功能</h4>
<div class="paragraph">
<p>以下列表包含可手动安装的一些功能：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">功能</th>
<th class="tableblock halign-left valign-top">需要</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentinel-core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基本功能，安装所有必须的 bundles，例如 <code>health:check</code> 和其它 bundles 的服务要求，例如 <code>sentinel-persistence</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentinel-jms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供与 OpenNMS Horizon <em>ActiveMQ</em> Broker 的连接。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentinel-kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供与 <em>Kafka</em> 的连接。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentinel-flows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启动所有依赖项，以启动处理 flows 的功能。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentinel-newts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提供将度量数据保存到 <em>Newts</em> 的功能。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentinel-telemetry-nxos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许使用 <code>NxosGpbAdapter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentinel-telemetry-jti</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">允许使用 <code>JtiGpbAdapter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_自动安装">20.4.5. 自动安装</h4>
<div class="paragraph">
<p>在某些情况下，需要自动配置 <em>Sentinel</em> 实例并启动所需的 features/bundles。
由于 <em>Sentinel</em> 基于 <em>Apache Karaf</em> ，它通过将任何类型的数据复制到
<code>deploy</code> 文件夹，来支持自动部署，因此，<em>Sentinel</em> 可以利用该机制来启用自动或热部署。</p>
</div>
<div class="paragraph">
<p>因此，在大多数情况下，将 <code>features.xml</code> 文件复制到 <code>${SENTINEL_HOME}/deploy</code> 就足够了。
即使容器正在运行，也可以这样做。</p>
</div>
<div class="paragraph">
<p>在 <em>配置 Flow 处理</em> 章节包含有关如何使用 <em>Sentinel</em> 自动启动的示例。</p>
</div>
</div>
<div class="sect3">
<h4 id="_自动启动">20.4.6. 自动启动</h4>
<div class="paragraph">
<p>在某些情况下，使用 <code>features.xml</code> 文件自动部署/配置容器可能是不够的。
如果需要更大的灵活性，建议将 <code><strong>.cfg</code> 和 <code></strong>.properties</code> 文件直接修改/复制到 <code>${SENTINEL_HOME}/etc</code> 目录。
要自动启动容器的功能，必须更新文件 <code>${SENTINEL_HOME}/etc/org.apache.karaf.features.cfg</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code># ...
featuresBoot = \
      (aries-blueprint, \
      deployer), \
      instance/4.1.5, \
      package/4.1.5, \
      log/4.1.5, \
      scv/23.0.1, \
      ssh/4.1.5, \
      framework/4.1.5, \
      system/4.1.5, \
      eventadmin/4.1.5, \
      feature/4.1.5, \
      shell/4.1.5, \
      management/4.1.5, \
      service/4.1.5, \
      system/4.1.5, \
      eventadmin/4.1.5, \
      feature/4.1.5, \
      shell/4.1.5, \
      management/4.1.5, \
      service/4.1.5, \
      jaas/4.1.5, \
      shell-compat/4.1.5, \
      diagnostic/4.1.5, \
      wrap, \
      bundle/4.1.5, \
      config/4.1.5, \
      kar/4.1.5, \
      sentinel-jms, \ <i class="conum" data-value="1"></i><b>(1)</b>
      sentinel-flows <i class="conum" data-value="2"></i><b>(2)</b>

# ....</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>安装并启动 JMS 通信功能</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>安装并启动 Sentinel Flows 功能</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_健康检查_故障排除">20.4.7. 健康检查 / 故障排除</h4>
<div class="paragraph">
<p>命令 <code>health:check</code> 允许验证 <em>Sentinel</em> 容器的运行状况。
它根据安装的功能执行各种运行状况检查，以计算容器整体运行状况。
有关更多信息，请使用 <code>health:check --help</code>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
为了运行 <code>health:check</code> 命令，必须安装 <code>sentinel-core</code> 功能。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这在 <em>Minion</em> 容器中也可用，并将替换现在已经弃用的 <code>minion:ping</code> 命令。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_flow_处理">20.5. Flow 处理</h3>
<div class="paragraph">
<p>为了由 <em>Sentinel</em> 处理 flows，请确保根据官方安装指南安装 <em>OpenNMS Horizon</em>, <em>Minion</em> 和 <em>Sentinel</em>。</p>
</div>
<div class="paragraph">
<p>然后，以下配置示例有助于设置所有内容。</p>
</div>
<div class="sect3">
<h4 id="_配置_sentinel">20.5.1. 配置 Sentinel</h4>
<div class="paragraph">
<p>为了处理 flows，<em>Sentinel</em> 必须启动适当的 flow 适配器。
在 <em>Sentinel</em> 中，flow 适配器可以通过将 <code>.cfg</code> 文件放在 in <code>${SENTINEL_HOME}/etc</code> 中或通过 <code>config:edit</code> 语句来配置。</p>
</div>
<div class="paragraph">
<p>以下示例将配置 <code>Netflow5</code> flows 的处理，并将配置保存在
<code>${SENTINEL_HOME/etc/org.oennms.features.telemetry.adaters-netflow5.cfg</code> 中。</p>
</div>
<div class="paragraph">
<p>首先登录 <em>Karaf Shell</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ssh -p 8301 admin@localhost</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@sentinel&gt; config:edit org.opennms.features.telemetry.adapters-netflow5
admin@sentinel&gt; config:property-set name Netflow-5
admin@sentinel&gt; config:property-set class-name org.opennms.netmgt.telemetry.adapters.netflow.v5.Netflow5Adapter
admin@sentinel&gt; config:update</pre>
</div>
</div>
<div class="paragraph">
<p>然后可以安装 <code>sentinel-flows</code> 功能：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@sentinel&gt; feature:install sentinel-jms <i class="conum" data-value="1"></i><b>(1)</b>
admin@sentinel&gt; feature:install sentinel-flows</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>或 <code>sentinel-kafka</code></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
只是测试 <code>Netflow5</code> flows 的处理。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要检查一切是否按预期工作，请执行 <code>health:check</code> 命令，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@sentinel&gt; health:check
Verifying the health of the container

Verifying installed bundles                    [ Success  ]
Connecting to JMS Broker                       [ Success  ]
Connecting to OpenNMS ReST API                 [ Success  ]
Retrieving NodeDao                             [ Success  ]
Connecting to ElasticSearch ReST API (Flows)   [ Success  ]

=&gt; Everything is awesome</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置_minion">20.5.2. 配置 Minion</h4>
<div class="paragraph">
<p><em>Minion</em> 必须配置为侦听传入的 flow packages（包），例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ssh -p 8201 admin@localhost</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@minion()&gt; config:edit org.opennms.features.telemetry.listeners-udp-8877
admin@minion()&gt; config:property-set name Netflow-5
admin@minion()&gt; config:property-set class-name org.opennms.netmgt.telemetry.listeners.udp.UdpListener
admin@minion()&gt; config:property-set listener.port 8877
admin@minion()&gt; config:update</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
侦听器的名称，在本例中为 <code>Netflow-5</code>，必须与
        <em>Sentinel</em> 容器中适配器配置的名称匹配。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_配置_opennms">20.5.3. 配置 OpenNMS</h4>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 必须公开其 <em>ActiveMQ Broker</em> ，以使 <em>Minion</em> 和 <em>Sentinel</em> 连接到它。
这可以在 <code>$OPENNMS_HOME/etc/opennms-activemq.xml</code> 中完成。
有关详细信息，请参阅 Minion 安装指南。</p>
</div>
</div>
<div class="sect3">
<h4 id="_自动配置_sentinel_的_flow_处理">20.5.4. 自动配置 Sentinel 的 flow 处理</h4>
<div class="paragraph">
<p>以下示例演示了 <code>features.xml</code>，它配置 <em>Sentinel</em> 实例并自动启动所有必需的功能，
以通过 JMS (<em>ActiveMQ</em>) 或 <em>Kafka</em> 处理消息。</p>
</div>
<div class="paragraph">
<p>只需将其复制到 <code>${SENTINEL_HOME}/deploy/</code>。</p>
</div>
<div class="listingblock">
<div class="title">JMS</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;features
        name="opennms-${project.version}"
        xmlns="http://karaf.apache.org/xmlns/features/v1.4.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://karaf.apache.org/xmlns/features/v1.4.0 http://karaf.apache.org/xmlns/features/v1.4.0"
&gt;
    &lt;!-- Bootstrap feature to start all flow related features automatically --&gt;
    &lt;feature name="autostart-sentinel-flows" version="${project.version}" start-level="100" install="auto"&gt;
        &lt;!-- Configure the controller itself --&gt;
        &lt;config name="org.opennms.sentinel.controller"&gt;
            location = SENTINEL
            id = 00000000-0000-0000-0000-000000ddba11
            http-url = http://127.0.0.1:8980/opennms
            broker-url = failover:tcp://127.0.0.1:61616
        &lt;/config&gt;

        &lt;!-- Configure datasource connection --&gt;
        &lt;config name="org.opennms.netmgt.distributed.datasource"&gt;
            datasource.url = jdbc:postgresql://localhost:5432/opennms
            datasource.username = postgres
            datasource.password = postgres
            datasource.databaseName = opennms
        &lt;/config&gt;
        &lt;!--
            Starts the Netflow5Adapter to process Netflow5 Messages.
            Be aware, that this requires a Listener with name "Netflow-5" on the Minion-side to have messages
            processed properly.
        --&gt;
        &lt;config name="org.opennms.features.telemetry.adapters-netflow5"&gt;
            name = Netflow-5
            class-name = org.opennms.netmgt.telemetry.adapters.netflow.v5.Netflow5Adapter
        &lt;/config&gt;
        &lt;!-- Point sentinel to the correct elastic endpoint --&gt;
        &lt;config name="org.opennms.features.flows.persistence.elastic"&gt;
            elasticUrl = http://elasticsearch:9200
        &lt;/config&gt;
        &lt;!-- Install JMS related features --&gt;
        &lt;feature&gt;sentinel-jms&lt;/feature&gt;
        &lt;!-- Install Flow related features --&gt;
        &lt;feature&gt;sentinel-flows&lt;/feature&gt;
    &lt;/feature&gt;
&lt;/features&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Kafka</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;features
        name="opennms-${project.version}"
        xmlns="http://karaf.apache.org/xmlns/features/v1.4.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://karaf.apache.org/xmlns/features/v1.4.0 http://karaf.apache.org/xmlns/features/v1.4.0"
&gt;
    &lt;!-- Bootstrap bootstrap feature to start all flow related features automatically --&gt;
    &lt;feature name="autostart-sentinel-telemetry-flows" version="${project.version}" start-level="200" install="auto"&gt;
        &lt;!-- Configure the controller itself --&gt;
        &lt;config name="org.opennms.sentinel.controller"&gt;
            location = SENTINEL
            id = 00000000-0000-0000-0000-000000ddba11
            http-url = http://127.0.0.1:8980/opennms
            broker-url = failover:tcp://127.0.0.1:61616
        &lt;/config&gt;

        &lt;!-- Configure datasource connection --&gt;
        &lt;config name="org.opennms.netmgt.distributed.datasource"&gt;
            datasource.url = jdbc:postgresql://localhost:5432/opennms
            datasource.username = postgres
            datasource.password = postgres
            datasource.databaseName = opennms
        &lt;/config&gt;
        &lt;!--
            Starts the Netflow5Adapter to process Netflow5 Messages.
            Be aware, that this requires a Listener with name "Netflow-5" on the Minion-side to have messages
            processed properly.
        --&gt;
        &lt;config name="org.opennms.features.telemetry.adapters-netflow5"&gt;
            name = Netflow-5
            class-name = org.opennms.netmgt.telemetry.adapters.netflow.v5.Netflow5Adapter
        &lt;/config&gt;
        &lt;!-- Point sentinel to the correct elastic endpoint --&gt;
        &lt;config name="org.opennms.features.flows.persistence.elastic"&gt;
            elasticUrl = http://elasticsearch:9200
        &lt;/config&gt;
        &lt;!--
            Configure as Kafka Consumer.
            All properties desribed at https://kafka.apache.org/0100/documentation.html#newconsumerconfigs are supported.
        --&gt;
        &lt;config name="org.opennms.core.ipc.sink.kafka.consumer"&gt;
            group.id = OpenNMS
            bootstrap.servers = localhost:9092
        &lt;/config&gt;
        &lt;!-- Install Kafka related features --&gt;
        &lt;feature&gt;sentinel-kafka&lt;/feature&gt;
        &lt;!-- Install flow related features --&gt;
        &lt;feature&gt;sentinel-flows&lt;/feature&gt;
    &lt;/feature&gt;
&lt;/features&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_将采集集合保存到_newts">20.6. 将采集集合保存到 Newts</h3>
<div class="paragraph">
<p>在前一章中，描述了如何配置 <em>OpenNMS Horizon</em>, <em>Minion</em> 和 <em>Sentinel</em> 来分发 flows 的处理。
但是，它仅涵盖 flow 处理适配器，但还有更多，例如 <code>NxosGpbAdapter</code>，也可以在 <em>Sentinel</em> 上运行。</p>
</div>
<div class="sect3">
<h4 id="_适配器_2">20.6.1. 适配器</h4>
<div class="paragraph">
<p>本章介绍了可能包含样本数据的各种适配器，这些样本数据可以存储到持久性存储中，也可以在 <em>Sentinel</em> 上运行。
目前只支持 <em>Newts</em> 作为持久存储。
有关如何配置 <em>Newts</em>，请参阅 <a href="#ga-sentinel-configure-newts">配置 Newts</a> 一章。</p>
</div>
<div class="paragraph">
<p>为了使其正常工作，请注意，还必须配置 <em>Minion</em> 上的相应监听器。
监听器的名称应与 <em>Sentinel</em> 上共享的名称相同。</p>
</div>
<div class="sect4">
<h5 id="_sflowtelemetryadapter">SFlowTelemetryAdapter</h5>
<div class="paragraph">
<p>要使用此适配器，必须安装 <code>sentinel-flows</code> 和 <code>sentinel-newts</code> 功能。
另外，应该正确安装和配置 <code>sentinel-jms</code> 或 <code>sentinel-kafka</code>。
有关更多详细信息，请参见上一章节 <em>Flow 处理</em>。</p>
</div>
<div class="paragraph">
<p>如果只保留样本数据，则可以在 <em>Sentinel</em> 的 Karaf Shell 上执行以下命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ssh -p 8301 admin@localhost</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@sentinel&gt; config:edit org.opennms.features.telemetry.adapters-sflow
admin@sentinel&gt; config:property-set name SFlow-Telemetry
admin@sentinel&gt; config:property-set class-name org.opennms.netmgt.telemetry.adapters.netflow.sflow.SFlowTelemetryAdapter
admin@sentinel&gt; config:property-set parameters.script  /opt/sentinel/etc/sflow-host.groovy
admin@sentinel&gt; config:update</pre>
</div>
</div>
<div class="paragraph">
<p>如果是 SFlow flows 并且应该处理样本数据，则可以配置多个适配器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>config:edit org.opennms.features.telemetry.adapters-sflow-telemetry
config:property-set name SFlow
config:property-set adapters.1.name SFlow-Adapter
config:property-set adapters.1.class-name org.opennms.netmgt.telemetry.adapters.netflow.sflow.SFlowAdapter
config:property-set adapters.2.name SFlow-Telemetry
config:property-set adapters.2.class-name org.opennms.netmgt.telemetry.adapters.netflow.sflow.SFlowTelemetryAdapter
config:property-set adapters.2.parameters.script /opt/sentinel/etc/sflow-host.groovy
config:update</pre>
</div>
</div>
<div class="paragraph">
<p>请注意，在两种情况下，必须手动提供文件 <code>/opt/sentinel/etc/sflow-host.groofy</code>，例如，通过从 <em>OpenNMS Horizon</em> 手动复制它。</p>
</div>
</div>
<div class="sect4">
<h5 id="_nxosgpbadapter">NxosGpbAdapter</h5>
<div class="paragraph">
<p>要使用此适配器，必须安装 <code>sentinel-telemetry-nxos</code> 和 <code>sentinel-newts</code> 功能。
另外，应该正确安装和配置 <code>sentinel-jms</code> 或 <code>sentinel-kafka</code>。
有关更多详细信息，请参见上一章节 <em>Flow 处理</em>。</p>
</div>
<div class="paragraph">
<p>除此之外，<em>OpenNMS Horizon</em> 中的配置文件必须复制到 <em>Sentinel</em> 的 <code>/opt/sentinel/etc</code>。
需要以下文件和目录：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${OPENNMS_HOME}/etc/datacollection</code></p>
</li>
<li>
<p><code>${OPENNMS_HOME}/etc/datacollection-config.xml</code></p>
</li>
<li>
<p><code>${OPENNMS_HOME}/etc/resource-types.d</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>然后可以设置适配器:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ssh -p 8301 admin@localhost</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@sentinel&gt; config:edit org.opennms.features.telemetry.adapters-nxos
admin@sentinel&gt; config:property-set name NXOS
admin@sentinel&gt; config:property-set class-name org.opennms.netmgt.telemetry.adapters.nxos.NxosGpbAdapter
admin@sentinel&gt; config:property-set parameters.script  /opt/sentinel/etc/cisco-nxos-telemetry-interface.groovy
admin@sentinel&gt; config:update</pre>
</div>
</div>
<div class="paragraph">
<p>请注意，文件 <code>/opt/sentinel/etc/cisco-nxos-telemetry-interface.groovy</code> 也必须手动提供，
例如，通过从 <em>OpenNMS Horizon</em> 手动复制它。</p>
</div>
</div>
<div class="sect4">
<h5 id="_jtigpbadapter">JtiGpbAdapter</h5>
<div class="paragraph">
<p>要使用此适配器，必须安装 <code>sentinel-telemetry-jti</code> 和 <code>sentinel-newts</code> 功能。
另外，应该安装 <code>sentinel-jms</code> 或 <code>sentinel-kafka</code>，并进行正确配置。
有关更多详细信息，请参见上一章节 <em>Flow 处理</em>。</p>
</div>
<div class="paragraph">
<p>除此之外，<em>OpenNMS Horizon</em> 中的配置文件必须复制到 <em>Sentinel</em> 的 <code>/opt/sentinel/etc</code>。
需要以下文件和目录：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${OPENNMS_HOME}/etc/datacollection</code></p>
</li>
<li>
<p><code>${OPENNMS_HOME}/etc/datacollection-config.xml</code></p>
</li>
<li>
<p><code>${OPENNMS_HOME}/etc/resource-types.d</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>然后可以设置适配器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ssh -p 8301 admin@localhost</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@sentinel&gt; config:edit org.opennms.features.telemetry.adapters-jti
admin@sentinel&gt; config:property-set name JTI
admin@sentinel&gt; config:property-set class-name org.opennms.netmgt.telemetry.adapters.jti.JtiGpbAdapter
admin@sentinel&gt; config:property-set parameters.script  /opt/sentinel/etc/junos-telemetry-interface.groovy
admin@sentinel&gt; config:update</pre>
</div>
</div>
<div class="paragraph">
<p>请注意，文件 <code>/opt/sentinel/etc/junos-telemetry-interface.groovy</code> 也必须手动提供，
例如，通过从 <em>OpenNMS Horizon</em> 手动复制它。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-sentinel-configure-newts">20.6.2. 配置 Newts</h4>
<div class="paragraph">
<p><em>Sentinel</em> 的 <em>Newts</em> 配置使用与 <em>OpenNMS Horizon</em> 是相同的属性。
唯一的区别是，<em>Sentinel</em> 的属性存储在 <code>/opt/sentinel/etc/org.opennms.newts.config.cfg</code>，而不是 <code>*.properties</code> 文件中。
每个属性的名称与 <em>OpenNMS Horizon</em> 的相同，除了前缀 <code>org.opennms.newts.config</code>。
以下示例使用 <em>Sentinel</em> 的 <em>Karaf Shell</em> 显示自定义的 <em>Newts</em> 配置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ssh -p 8301 admin@localhost</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>admin@sentinel&gt; config:edit org.opennms.newts.config
admin@sentinel&gt; config:property-set hostname localhost
admin@sentinel&gt; config:property-set port 9042
admin@sentinel&gt; config:property-set cache.strategy org.opennms.netmgt.newts.support.GuavaSearchableResourceMetadataCache
admin@sentinel&gt; config:update</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-opennms-plugin-manager">21. Plugin Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the introduction of <em>Karaf</em> as an <em>OSGi</em> application container, <em>OpenNMS Horizon</em> now has the ability to install or upgrade features on top of a running instance of <em>OpenNMS Horizon</em>.
In addition, the new distributed <em>OSGi</em> architecture allows an <em>OpenNMS Horizon</em> system to be deployed as multiple software modules each running in their own <em>Karaf</em> instance.</p>
</div>
<div class="paragraph">
<p>The <em>OpenNMS Horizon</em> Plugin Manager_ provides a unified interface for managing the lifecycle of optional <em>OSGi</em> plugins installed in <em>OpenNMS Horizon</em> or in any <em>Karaf</em> instances which it manages.
This need not be limited to <em>Karaf</em> instances running <em>OpenNMS Horizon</em> but can also be used to deploy modules to <em>Karaf</em> instances running user applications.</p>
</div>
<div class="paragraph">
<p>In addition to managing the installation of <em>OSGi</em> features, the <em>Plugin Manager</em> also allows the installation of licence keys which can be used to enable features for a particular instance of <em>OpenNMS Horizon</em>.
Although the <em>OpenNMS Horizon</em> platform remains open source, this provides a mechanism for third parties developing features on top of the <em>OpenNMS Horizon</em> platform to manage access to their software.</p>
</div>
<div class="paragraph">
<p>The <em>Plugin Manager</em> also provides a mechanism for a separate 'app-store' or Available Plugins Server to be used to deliver these new features and / or licences into a particular <em>OpenNMS Horizon</em> instance.
It is also possible to deliver software without access to the internet using the traditional <em>Karaf</em> Kar/RPM deployment model.
(Kar files are a form of zip file containing bundles and features definitions which can be deployed in the <em>Karaf</em> /deploy directory).
These can be placed in the /deploy directory directly or installed there using an RPM).
In this case a number of features can be delivered together in a single software package but each only enabled at run time using the Plugin Manager.</p>
</div>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> plugins are standard <em>Karaf</em> features with additional metadata which describes the feature and the licence (if any) required.
A plugin requiring a licence will not start if a valid licence string is not also installed.</p>
</div>
<div class="paragraph">
<p>In addition to options described in the licence metadata which is publicly accessible, licences can also contain encrypted secret properties which can only be decrypted when the licence in authenticated.
After licence authentication, these properties are then available to a plugin as properties of it&#8217;s licenceAuthenticator object.</p>
</div>
<div class="paragraph">
<p>Note that <em>Karaf</em>'s features mechanism has not been modified in any way.
The Plugin Manager simply provides a user front end and additional metadata for features.
Plugin features can be installed from the internal features repository, remote maven repositories or from <em>Kar</em> files placed in the deploy directory depending on how the <em>Karaf</em> configuration is set up.
The standard <em>OpenNMS Horizon</em> configuration has no remote maven access enabled for <em>Karaf</em> and external features must be locally provisioned as a <em>Kar</em> or an <em>RPM</em> before being enabled with the <em>Plugin Manager</em>.</p>
</div>
<div class="paragraph">
<p>This guide describes how to deploy and manage plugins using the <em>Plugin Manager</em>.
A separate plugin developer&#8217;s guide is provided for those wishing to write their own plugins or generate licences.</p>
</div>
<div class="sect2">
<h3 id="_plugin_manager_ui">21.1. Plugin Manager UI</h3>
<div class="paragraph">
<p>The Plugin Manager page is split into four quadrants.</p>
</div>
<div class="paragraph">
<p>The top left quadrant is a panel for setting access properties for each of the managed karaf instances including the local <em>OpenNMS Horizon</em> instance.
In order to access any information through the Plugin Manager, users must enter the url, admin or ReST username and password of the remote karaf being managed by editing its entry in the karaf instance list.
This is done by selecting the required karaf entry and selecting edit karaf instance button.
The local  <em>OpenNMS Horizon</em> system is designated by the localhost entry which cannot be removed.
<em>NOTE</em> that the localhost entry in the karaf instance list also needs to have an entry matching the admin or ReST users of the localhost system for anything to work.</p>
</div>
<div class="paragraph">
<p>The top right quadrant is a panel for displaying response messages to any action performed.
When any operation is performed in the plugin manager, the result is displayed.
The full error message associated with any failures can also be viewed.</p>
</div>
<div class="paragraph">
<p>The bottom right quadrant allows a remote plugin repository and shopping cart to be set up.</p>
</div>
<div class="paragraph">
<p>The bottom left quadrant contains panels for showing the installed plugins, for setting up a plugin manifest, selecting locally or remotely hosted plugins to be installed and for controlling the installed licences.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_manager_ui_panel">21.2. Plugin Manager UI panel</h3>
<div class="paragraph">
<p>The <em>Plugin Manager</em> is accessed as an entry in the <em>Additional Tools</em> panel of the <em>OpenNMS Horizon Admin Gui</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/01_adminPageEntry.png" alt="01 adminPageEntry">
</div>
</div>
<div class="paragraph">
<p>The <em>Plugin Manager</em> administration page is split into six main areas as illustrated below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Top Left is the <em>Karaf</em> Instance data panel which lists the <em>Karaf</em> instances known to the <em>Plugin Manager</em>.
When a <em>Karaf</em> instance is selected, the data on the rest of the page refers to the selected instance.</p>
</li>
<li>
<p>Bottom Left is the <em>Available Plugins Server Panel</em> which is used to set the address and passwords to access the <em>Available Plugins Server</em> and / or the list of locally available plugins provided by a <em>Kar</em> or <em>RPM</em>.</p>
</li>
<li>
<p>Top Right, just below the main <em>OpenNMS Horizon</em> menu bar are links to three diagnostic pages which can help test the <em>ReST</em> interface to remote <em>Karaf</em> Instances.</p>
</li>
<li>
<p>Middle Right is a messages panel which reports the status of any operations.
If an operation fails, the full error message can be viewed by pressing the error message button.</p>
</li>
<li>
<p>Bottom Right is a tabbed panel which reflects the status of the plugins and licences installed in the <em>Karaf</em> instance selected by the <em>Karaf</em> Instance data panel.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/02_pluginmgrFullPage.png" alt="02 pluginmgrFullPage">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_karaf_instance_data">21.3. Setting Karaf Instance Data</h3>
<div class="paragraph">
<p>The <em>Karaf</em> instances known to the <em>Plugin Manager</em> are listed in the <em>Karaf</em> Instance data panel.
<code>Localhost</code> refers to the local <em>OpenNMS Horizon</em> server and is always an option in the panel.
The <em>Karaf</em> instance data is persisted locally and should be refreshed from remote sources using the reload <em>Karaf</em> instance data button before changes are made.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that the <code>Localhost</code> configuration in the <em>Plugin Manager</em>  by default uses <code>admin</code> for both the username and the password. This will not work in a production OpenNMS where you have changed the admin user password. You should edit the <code>Localhost</code> configuration using the <code>edit instance list</code> button to match your local configuration)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each <em>Karaf</em> instance must have a unique system id which is used to update its configuration and also to validate its licences.
The system id  it must be unique and included a checksum. A new random system id can be generated for a <em>Karaf</em> instance using a button on the panel.</p>
</div>
<div class="paragraph">
<p>In most situations the remote <em>Karaf</em> instance can be accessed from the <em>OpenNMS Horizon</em> <em>Plugin Manager</em>.
However in many cases, the remote <em>Karaf</em> will be behind a firewall in which case it must initiate the communications to request its configuration and supply an update on its status.</p>
</div>
<div class="paragraph">
<p>The <code>Remote is Accessible</code> field tells the <em>Plugin Manager</em> which mode of operation is in use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remote request of configuration is not yet fully implemented and will be completed in a future release.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 124. <em>Karaf</em> Instance Fields</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instance Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">host Name of the <em>Karaf</em> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Karaf URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL used to access the <em>Karaf</em> <em>Plugin Manager</em> ReST API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current Instance System ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The system ID currently installed in the <em>Karaf</em> system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manifest System ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The system ID to be provisioned in the <em>Karaf</em> system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote is Accessible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If ticked 'true', the <em>Plugin Manager</em> will try and contact the remote <em>Karaf</em> instance using the URL.
                                    If not ticked (i.e. false), the remote <em>Karaf</em> instance must request its configuration.</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow Status Update from Remote</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow the remote <em>Karaf</em> instance to request an update to its remote configuration from the locally held manifest and at the same time to update its status.</p></td>
</tr>
</tfoot>
</table>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/03_karafInstanceData.png" alt="03 karafInstanceData">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manually_adding_a_managed_karaf_instance">21.4. Manually adding a managed <em>Karaf</em> instance</h3>
<div class="paragraph">
<p>The list of <em>Karaf</em> instances can be modified using the <em>Karaf</em> instance editor illustrated below.
The same fields apply as above.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/04_karafinstanceeditor.png" alt="04 karafinstanceeditor">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installed_plugins">21.5. Installed Plugins</h3>
<div class="paragraph">
<p>Under plugin settings, the Installed Plugins tab lists which plugins are currently installed in the <em>Karaf</em> instance selected in the <em>Karaf</em> instance data panel.
Installed plugins can be uninstalled by selecting the plugin on the list and selecting 'uninstall' or reinstalled by selecting the reinstall button.
However Plugins designated as System Plugins (i.e. the System Plugin checkbox is ticked and grayed out) cannot be uninstalled through the UI.
(The <em>Plugin Manager</em> is itself a system plugin).</p>
</div>
<div class="paragraph">
<p>Each plugin has metadata associated with it which is used to identify and describe the plugin.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 125. Plugin Metadata Fields</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Plugin Metadata</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique key used to identify the name and version of the feature.
                             (Same as <em>Karaf</em> Feature Name/Version)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Licence Key Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true (ticked), this plugin needs a licence key to start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Licence Validated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a licence key is required, a green text label will indicate if the licence has been installed and validated. Otherwise a red text label will indicate an invalid licence</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true (ticked) this is a system plugin and cannot be removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packaging Descriptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This describes the packaging mechanism by which the feature was delivered. This will refer to a Kar if the feature was manually installed as a Kar/RPM on the host server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feature Repository URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL identifying the feature repository (Same as <em>Karaf</em> Feature Repository URL)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A textual description of the functionality provided by the plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A URL to point to the plugin&#8217;s documentation / web site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Licence Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description of the licence applied to the plugin (May be GPL if the plugin is not subject to an EULA)</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organisation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The organisation issuing the plugin and/or licence.</p></td>
</tr>
</tfoot>
</table>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/05_installedPlugins.png" alt="05 installedPlugins">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The installed plugins tab shows the data retrieved the last time the <code>Reload Karaf Instance</code> data button was pressed.
(This allow us to maintain a record of offline <em>Karaf</em> instances).
However it also means that the localhost data may not be up to date with the local <em>Karaf</em> instance.
You should always reload to get the accurate picture of what is currently installed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_available_plugins_server">21.6. Available Plugins Server</h3>
<div class="paragraph">
<p>Plugins which are available to be installed in <em>OpenNMS Horizon</em> are either listed in the Local Available Plugins tab or the Remote Available Plugins tab.
Local Available Plugins are plugins which are available as standard packaged with the <em>OpenNMS Horizon</em> build.</p>
</div>
<div class="paragraph">
<p>The Plugin Manager gets this list from the local system using the rest interface with the admin user and password.</p>
</div>
<div class="paragraph">
<p>The <em>Plugin Manager</em> obtains a list of available plugins from the <em>Available Plugin&#8217;s server</em>.</p>
</div>
<div class="paragraph">
<p><em>Available Plugin&#8217;s server</em> can be part of an externally hosted plugin shopping cart or it can simply be a url serving the
internal list of available plugins as described in the section on Internal Plugins.</p>
</div>
<div class="paragraph">
<p>In order for externally downloaded plugins to be installed, the <em>Available Plugin&#8217;s server</em> must have a related maven repository from which
<em>Karaf</em> can download the feature.
By default feature download is not enabled in <em>OpenNMS Horizon</em>.
To enable <em>Karaf</em> external feature download, the address of the maven repository should be entered in the org.ops4j.pax.url.mvn.cfg file in the
<em>OpenNMS Horizon</em> /etc directory.</p>
</div>
<div class="paragraph">
<p>Alternatively the <em>Plugin Manager</em> can list the available plugins which have been installed on the local machine as bundled Plugin Kar&#8217;s
(using the <em>Karaf</em> Kar deploy mechanism) along with any internal plugins bundled with <em>OpenNMS Horizon</em>.
In this case, the <em>Plugin Server URL</em> should be pointed at http:\\localhost:8980\opennms.</p>
</div>
<div class="paragraph">
<p>The admin username and passwords are used to access the <em>Available Plugins Server</em>.
If a shopping cart is provided for obtaining licences, the URL of the shopping cart should be filled in.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/06_availablePluginsServer.png" alt="06 availablePluginsServer">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_available_plugins">21.7. Installing Available Plugins</h3>
<div class="paragraph">
<p>The Available Plugins panel list the plugins which are available and listed by the Available Plugins server.
These can be directly installed into the selected <em>Karaf</em> instance or can be posted to a manifest for later installation.
If a plugin is installed, the system will try and start it.
However if a corresponding licence is required and not installed, the features will be loaded but not started.
You must restart the feature if you later install a licence key.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/07_availablePlugins.png" alt="07 availablePlugins">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_plugins_manifest">21.8. Plugins Manifest</h3>
<div class="paragraph">
<p>The Plugins Manifest for a given <em>Karaf</em> instance lists the target plugins which the <em>Karaf</em> instance should install when it next contacts the licence manager.
If the <em>Plugin Manager</em> can communicate with the remote server, then a manifest can be selected for immediate installation.
A manual manifest entry can also be created for a feature.
This can be used to install features which are not listed in the Available Features list.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/08_pluginManifest.png" alt="08 pluginManifest">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_internal_plugins">21.9. Installing Internal Plugins</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> is packaged with an internal repository of plugins which are shipped with the <em>OpenNMS Horizon</em> distribution.
These plugins can be installed in the local <em>OpenNMS Horizon</em>  <em>Karaf</em> instance and activated by a user using the <em>Plugin Manager</em>
in the same way it could be used to download and install external plugins.</p>
</div>
<div class="paragraph">
<p>The <em>internal-plugin-descriptor</em> feature maintains a list of internal plugins which are packaged with <em>OpenNMS Horizon</em>.
This list of internal plugins can be accessed by the <em>Plugin Manager</em> through the Local Available Plugins Panel.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>The same list can also be accessed through the remote plugins panel if the Available Plugins Server entry is set to point to the local _{opennms-product-name}_ instance.
To do this set Plugin Server URL to the address of the local _{opennms-product-name}_ (i.e. http:\\localhost:8980\opennms) and set the Plugin Server Username and Plugin Server Password to match the _{opennms-product-name}_ ReST or admin username and password.</pre>
</div>
</div>
<div class="paragraph">
<p>Clicking Reload available plugins will then add the list of available internal plugins to the Available Plugins Tab where they
can be installed and started by the user as described previously.</p>
</div>
<div class="paragraph">
<p>The internal plugins included with this <em>OpenNMS Horizon</em> release are documented in a later section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installed_licences_panel">21.10. Installed Licences Panel</h3>
<div class="paragraph">
<p>Each licence has a licence ID which is the <em>Karaf</em> feature ID of the feature to which the licence refers.
Many licences can be installed on a system but only one licence string is allowed per feature ID.</p>
</div>
<div class="paragraph">
<p>Licence Strings are used to validate that a particular feature can be run on a given <em>Karaf</em> instance.
The <em>Plugin Manager</em> will not allow a feature to run if it&#8217;s licence cannot be validated using a private key encoded in the feature bundle.</p>
</div>
<div class="paragraph">
<p>Licences are associated with specific Product ID&#8217;s and specific <em>Karaf</em> instances.
Several <em>Karaf</em> instances can be listed in a licence allowing a feature to run on more than one system using the same licence.
When a licence is installed, the licence metadata is decoded and displayed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A licence may be installed before or after its associated feature is installed.
If a licence is installed after the feature the feature must be restarted before the licence will be read.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/09_installedLicences.png" alt="09 installedLicences">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_new_licence">21.11. Adding a New Licence</h3>
<div class="paragraph">
<p>New licences are added using the add licence panel.
Licences are obtained from the <em>App Store</em> where they can be generated by a user for a given set of system id&#8217;s.</p>
</div>
<div class="paragraph">
<p>A licence must be copied (cut and paste) from the app store into the add licence panel.
The <code>Validate licence</code> button should be used to check the licence has been installed correctly.
Please note that this just checks the integrity of the licence string.
A licence is only authenticated once it is installed and the corresponding feature bundle checks it on start-up.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/plugin-manager/10_addLicence.png" alt="10 addLicence">
</div>
</div>
<div class="paragraph">
<p>The system provides a robust licencing mechanism which would be difficult to spoof and is considered sufficient for most applications.
However it should not be considered cryptographic secure to the extent that a determined hacker could not break the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_licence_structure">21.12. Licence Structure</h3>
<div class="paragraph">
<p>The following note describes how licence keys are structured.</p>
</div>
<div class="paragraph">
<p>Licence keys contain machine readable metadata which can be accessed without decryption.
The metadata is digitally signed with an encrypted hash which must be decrypted in order to verify the licence data.</p>
</div>
<div class="paragraph">
<p>Licence keys may also contain additional encrypted secret properties.
The secret properties are intended to securely convey application specific secrets such as passwords or keys needed to access remote services.</p>
</div>
<div class="paragraph">
<p>The entire licence has a Crc32 Checksum appended to ensure it is conveyed intact when it is installed.</p>
</div>
<div class="paragraph">
<p>The licence keys consist of Hexadecimal strings as ascii printable characters in three (or four) sections separated by the ':' character as follows;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>With secret properties:
&lt;licenceMetadataHexStr&gt;:&lt;encryptedHashStr&gt;":"&lt;aesSecretKeyStr&gt;:&lt;encryptedSecretPropertiesStr&gt;-&lt;Crc32Checksum&gt;

Without secret properties:
&lt;licenceMetadataHexStr&gt;:&lt;encryptedHashStr&gt;":"&lt;aesSecretKeyStr&gt;-&lt;Crc32Checksum&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The licenceMetadataHexStr is a Hexadecimal encoded version of the XML licence metadata.
This section is not encrypted and may be read without decoding so that the key features of the licence may be displayed without access to the licence keys.</p>
</div>
<div class="paragraph">
<p>The encryptedHashStr is a Hexadecimal version of the encrypted hash of the licenceMetadataHexStr.
If the hash can be decrypted and the resulting hash matches a hash of the licenceMetadataHexStr, then the licence is deemed to be validated.
Note that the start time and duration of the licence and the unique system id in the licence must match the local context for the licence to be fully activated.</p>
</div>
<div class="paragraph">
<p>If the encryptedSecretPropertiesStr is present it contains an encrypted version of the secret properties (as name value pairs) supplied with the licence. (Note that the size of the original properties are limited to 245 bytes by the encrypting algorithm).</p>
</div>
<div class="paragraph">
<p>Private key encryption is used to encrypt the metadata hash and the secret properties.
The AesSymetricKeyCipher has a length of 124 bits which is the longest length key allowed without Government Export authorised without cryptographic extensions</p>
</div>
<div class="paragraph">
<p>The encryption key is held in the licence creation server as part of the licence specification.
The decryption key is held in the remote licence authenticator where the licence is verified.</p>
</div>
<div class="paragraph">
<p>However the key held in the licence authenticator is itself encrypted and must first also be decrypted using the aesSecretKeyStr supplied with the licence.
This means that a licence can only be validated and the secret properties decrypted if the remote licence authenticator is itself unlocked by the licence.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internal_plugins">22. Internal Plugins</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_internal_plugins_supplied_with_opennms_horizon">22.1. Internal Plugins supplied with <em>OpenNMS Horizon</em></h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> includes a number of plugins which can be installed by the Plugin Manager
UI or directly from the <em>Karaf</em> consol. Plugins are simply <em>Karaf</em> features which have additional
metadata describing the Plugin and possibly defining that the Plugin also needs a licence installed to run.</p>
</div>
<div class="paragraph">
<p>Once installed, the plugins will always start when OpenNMS is restarted. If the plugins appear not to be working properly, you should check the /data/log/karaf.log file for problems.</p>
</div>
<div class="paragraph">
<p>Each internal plugin supplied with <em>OpenNMS Horizon</em> is described in its own section below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_plugins_with_the_karaf_consol">22.2. Installing Plugins with the Karaf Consol</h3>
<div class="paragraph">
<p>The easiest way to install a plugin is to use the Plugin Manager UI described in the Plugin Manager section. However plugins can also be installed using the <em>Karaf</em> consol. To use the <em>Karaf</em> consol, you need to open the karaf command prompt using</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh -p 8101 admin@localhost
(or ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no if no host checking is wanted)</pre>
</div>
</div>
<div class="paragraph">
<p>To install or remove a feature in <em>Karaf</em> use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>karaf@root&gt; feature:install &lt;feature name&gt;
karaf@root&gt; feature:uninstall &lt;feature name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can see which plugins are installed using</p>
</div>
<div class="listingblock">
<div class="content">
<pre>karaf@root&gt; product-reg:list</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-internal-plugins-alarm-change-notifier">22.3. Alarm Change Notifier Plugin</h3>
<div class="paragraph">
<p>The <em>Alarm Change Notifier Plugin</em> generates new OpenNMS events corresponding to changes in alarms
The new events are defined in the &lt;opennms home&gt;/etc/events/AlarmChangeNotifierEvents.xml file</p>
</div>
<div class="paragraph">
<p>These events contain a json copy of the database table before changes in %parm[oldalarmvalues]%
and after changes in %parm[newalarmvalues]%. (New Alarm events do not contain %parm[oldalarmvalues] and Alarm Deleted
events do not contain %parm[newalarmvalues]%)</p>
</div>
<div class="paragraph">
<p>%parm[alarmid]% contains the alarmid of the alarm which has changed</p>
</div>
<div class="paragraph">
<p>The generated event itself references copies of the nodeid, interface and service contained in the original alarm.
This way the alarm change events are associated with the original source of the alarm.</p>
</div>
<div class="paragraph">
<p>Alarm change events have a severity of normal since they only reflect changes to the alarm.</p>
</div>
<div class="paragraph">
<p>Events from the alarm-change-notifier are also used by the opennms-es-rest plugin to send alarm history to Elasticsearch</p>
</div>
<div class="paragraph">
<p>The table below lists the parameters included with each type of Alarm Change Event. Parameters are listed in the %parm[xxx]% format which is used to reference them in AlarmChangeNotifierEvents.xml</p>
</div>
<div class="paragraph">
<p>To simplify searching and visualisation, specific parameter values are also added for each alarm
change event type. These additional values are described in the table below.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Alarm Change Event Type</th>
<th class="tableblock halign-left valign-top">UEI</th>
<th class="tableblock halign-left valign-top">Additional Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">New Alarm Created</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/NewAlarmCreated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[newalarmvalues]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm Severity Changed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmSeverityChanged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]% %parm[severity]% %parm[oldseverity]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm Cleared</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmCleared</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm Deleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmDeleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm Changed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmChanged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm Acknowledged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmAcknowledged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]% %parm[alarmid]%  %parm[alarmacktime]% %parm[alarmackuser]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm UnAcknowledged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmUnAcknowledged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm Suppressed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmSuppressed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]%  %parm[suppressedtime]% %parm[suppresseduntil]% %parm[suppresseduser]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm UnSuppressed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmUnSuppressed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TroubleTicketStateChange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/TroubleTicketStateChange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]%  %parm[tticketid]% %parm[tticketstate]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sticky Memo Added</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/StickyMemoAdded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]%  %parm[stickymemo]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sticky Memo Update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/StickyMemoUpdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[oldalarmvalues]% %parm[newalarmvalues]% %parm[oldalarmvalues]% %parm[stickymemo]% %parm[author]% %parm[body]% %parm[memovalues]%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Journal Memo Update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uei.opennms.org/plugin/AlarmChangeNotificationEvent/JournalMemoUpdate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%parm[alarmid]% %parm[newalarmvalues]% %parm[oldalarmvalues]%  %parm[author]% %parm[body]% %parm[reductionkey]%  %parm[memovalues]%</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_elasticsearch_rest_plugin">22.4. Elasticsearch ReST plugin</h3>
<div class="paragraph">
<p>The <em>Elasticsearch ReST plugin</em> has been renamed to <em>Event &amp; Alarm Forwarder</em> and since the release of version 22.0.0 is no longer a plugin.
Refer to <a href="#ga-flow-support">Flow 支持</a> for the documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-special-cases-and-workarounds">23. Special Cases and Workarounds</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overriding_snmp_client_behavior">23.1. Overriding SNMP Client Behavior</h3>
<div class="paragraph">
<p>By default, the SNMP subsystem in OpenNMS Horizon does not treat <em>any</em> <a href="https://tools.ietf.org/html/rfc3416">RFC 3416</a> <code>error-status</code> as fatal.  Instead, it will attempt to continue the request, if possible.  However, only a subset of errors will cause OpenNMS Horizon&#8217;s SNMP client to attempt retries.  The default SNMP <code>error-status</code> handling behavior is as follows:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 126. Default SNMP Error Status Behavior</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>error-status</code></th>
<th class="tableblock halign-left valign-top">Fatal?</th>
<th class="tableblock halign-left valign-top">Retry?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noError(0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tooBig(1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noSuchName(2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">badValue(3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readOnly(4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genErr(5)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noAccess(6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wrongType(7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wrongLength(8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wrongEncoding(9)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wrongValue(10)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noCreation(11)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inconsistentValue(12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceUnavailable(13)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commitFailed(14)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">undoFailed(15)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorizationError(16)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notWritable(17)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inconsistentName(18)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can override this behavior by setting a property inside <code>${OPENNMS_HOME}/etc/opennms.properties</code> in the form:</p>
</div>
<div class="paragraph">
<p><code>org.opennms.netmgt.snmp.errorStatus.<em>[statusCode]</em>.<em>[type]</em></code></p>
</div>
<div class="paragraph">
<p>For example, to make <code>authorizationError(16)</code> abort and not retry, you would set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">org.opennms.netmgt.snmp.errorStatus.16.fatal=true
org.opennms.netmgt.snmp.errorStatus.16.retry=false</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-ifttt">24. IFTTT Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The free web-based service <em>IFTTT</em> allows to combine web applications using simple conditional instructions.
Each supported service has several triggers that can be used to trigger actions of other services.
This allows for example to change brightness and color of a smart bulb, send messages or date to IoT devices.</p>
</div>
<div class="paragraph">
<p>The <em>OpenNMS Horizon</em> integration makes uses of the so-called "Webhooks" service, that allows to trigger actions when a specific web-request was received.
The basic operation is as follows: <em>OpenNMS Horizon</em> polls for alarms with associated nodes and matches a given category filter.
For the resulting alarm set the maximum severity and total count is computed.
If one of these values changed compared to the last poll one or more events specified for the computed maximum severity will be sent to <em>IFTTT</em>.</p>
</div>
<div class="sect2">
<h3 id="_ifttt_configuration">24.1. IFTTT Configuration</h3>
<div class="paragraph">
<p>In order to use the <em>IFTTT</em> integration in <em>OpenNMS Horizon</em> you need an <em>IFTTT</em> account.
With this account you are able to create so-called applets that combine a trigger with an action.
In our case we use the "Webhooks" service as the trigger and define the event name <code>OpenNMS</code>.
After this step you can combine this trigger with any of the possible supported services and their actions.</p>
</div>
<div id="gu-ifttt-trigger-definition" class="paragraph">
<div class="title">Webhooks service trigger definition</div>
<p><span class="image"><img src="images/ifttt/trigger-definition-small.png" alt="trigger definition small"></span></p>
</div>
<div class="paragraph">
<p>In your account service settings for the "Webhooks" service you find your key in the given service URL.
In the following example this key is <code>X71dfUZsH4Wkl6cjsLjdV</code>.</p>
</div>
<div id="gu-ifttt-webhooks-settings" class="paragraph">
<div class="title">Webhooks service settings</div>
<p><span class="image"><img src="images/ifttt/webhooks-settings-small.png" alt="webhooks settings small"></span></p>
</div>
<div class="paragraph">
<p>On the side of <em>OpenNMS Horizon</em> you need a configuration that defines which event names to send on an alarm count or severity change.
The configuration file <code>ifttt-config.xml</code> contains so called trigger packages.</p>
</div>
<div class="paragraph">
<p>The operation is as follows:
<em>OpenNMS Horizon</em> retrieves all alarms that have a node associated.
Each trigger package defines whether only acknowledged alarms should be taken into account.
It then computes the maximum severity and alarm count for each trigger package&#8217;s category filter.
After that it triggers all events defined in the corresponding trigger sets for the computed maximum severity.
The category filter accepts Java regular expressions.
Using an empty category filter will use all unacknowledged alarms with an associated node.</p>
</div>
<div class="paragraph">
<p>Each trigger inside a trigger set defines the event name to be triggered and three additional values.
These values can be used to set additional attributes for the corresponding <em>IFTTT</em> applet action.
The following trigger sets can be defined:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Execution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">on start of the <em>IFTTT</em> alarm polling daemon to switch on a device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">on stop of the <em>IFTTT</em> alarm polling daemon to switch off a device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NORMAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if severity is NORMAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if severity is WARNING</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MINOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if severity is MINOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAJOR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if severity is MAJOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRITICAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if severity is CRITICAL</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are also <code>ON</code> and <code>OFF</code> available for the trigger set definition.
The <code>ON</code> event will be sent when the polling daemon is started and the <code>OFF</code> when it is stopped.
These events can be used to powering up/down and initializing devices.</p>
</div>
</div>
<div class="sect2">
<h3 id="_opennms_configuration">24.2. OpenNMS Configuration</h3>
<div class="paragraph">
<p><em>IFTTT</em> alarm polling will be enabled by setting the attribute <code>enabled</code> to <code>true</code> in the <code>ifttt-config.xml</code> file.
It is also possible to configure the polling interval.
The following trigger package defined the trigger sets which itself define a sequence of events to be triggered at <em>IFTTT</em>.
Each trigger defines the <code>eventName</code> and an additional delay.
This allows to defer the execution of the next trigger in a trigger set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_example">24.3. Example</h3>
<div class="paragraph">
<p>The following example shows the configuration file for a WiFi light bulb controlled via <em>IFTTT</em>.
The defined applets use <code>value1</code> for setting the color and <code>value2</code> for setting the brightness.
The third value demonstrate the use of placeholders.
For the severity-based trigger sets the following placeholders can be used in the three value fields:
<code>%os%</code>/<code>%oldSeverity</code> for old severity, <code>%ns%</code>/<code>%newSeverity%</code> for new severity, <code>%oc%</code>/<code>%oldCount</code> for old alarm count and <code>%nc%</code>/``%newCount% for new alarm count.
This is useful for sending messages or operating LED displays via <em>IFTTT</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;ifttt-config enabled="true" key="X71dfUZsH4Wkl6cjsLjdV" pollInterval="30"&gt;
    &lt;trigger-package categoryFilter="Routers|Switches" onlyUnacknowledged="true"&gt;
        &lt;trigger-set name="ON"&gt;
            &lt;trigger eventName="on" delay="0"&gt;
                &lt;value1&gt;&lt;/value1&gt;
                &lt;value2&gt;&lt;/value2&gt;
                &lt;value3&gt;&lt;/value3&gt;
            &lt;/trigger&gt;
        &lt;/trigger-set&gt;

        &lt;trigger-set name="OFF"&gt;
            &lt;trigger eventName="off" delay="0"&gt;
                &lt;value1&gt;&lt;/value1&gt;
                &lt;value2&gt;&lt;/value2&gt;
                &lt;value3&gt;&lt;/value3&gt;
            &lt;/trigger&gt;
        &lt;/trigger-set&gt;

        &lt;trigger-set name="NORMAL"&gt;
            &lt;trigger eventName="OpenNMS" delay="0"&gt;
                &lt;value1&gt;#336600&lt;/value1&gt;
                &lt;value2&gt;0.40&lt;/value2&gt;
                &lt;value3&gt;%os%,%ns%,%oc%,%nc%&lt;/value3&gt;
            &lt;/trigger&gt;
        &lt;/trigger-set&gt;

        &lt;trigger-set name="WARNING"&gt;
            &lt;trigger eventName="OpenNMS" delay="0"&gt;
                &lt;value1&gt;#FFCC00&lt;/value1&gt;
                &lt;value2&gt;0.50&lt;/value2&gt;
                &lt;value3&gt;%os%,%ns%,%oc%,%nc%&lt;/value3&gt;
            &lt;/trigger&gt;
        &lt;/trigger-set&gt;

        &lt;trigger-set name="MINOR"&gt;
            &lt;trigger eventName="OpenNMS" delay="0"&gt;
                &lt;value1&gt;#FF9900&lt;/value1&gt;
                &lt;value2&gt;0.60&lt;/value2&gt;
                &lt;value3&gt;%os%,%ns%,%oc%,%nc%&lt;/value3&gt;
            &lt;/trigger&gt;
        &lt;/trigger-set&gt;

        &lt;trigger-set name="MAJOR"&gt;
            &lt;trigger eventName="OpenNMS" delay="0"&gt;
                &lt;value1&gt;#CC3300&lt;/value1&gt;
                &lt;value2&gt;0.70&lt;/value2&gt;
                &lt;value3&gt;%os%,%ns%,%oc%,%nc%&lt;/value3&gt;
            &lt;/trigger&gt;
        &lt;/trigger-set&gt;

        &lt;trigger-set name="CRITICAL"&gt;
            &lt;trigger eventName="OpenNMS" delay="0"&gt;
                &lt;value1&gt;#FF0000&lt;/value1&gt;
                &lt;value2&gt;0.80&lt;/value2&gt;
                &lt;value3&gt;%os%,%ns%,%oc%,%nc%&lt;/value3&gt;
            &lt;/trigger&gt;
        &lt;/trigger-set&gt;
    &lt;trigger-package&gt;
&lt;/ifttt-config&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-telemetryd">25. Telemetry 模块(Daemon)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>模块 telemetry (telemetryd) 提供可扩展的框架，可用于处理推送到 <em>OpenNMS Horizon</em> 的传感器数据。
可扩展框架用于实现对使用不同协议传输指标度量的各种应用程序的支持。
在 <em>telemetryd</em> 中，操作器(operator)可以定义一系列协议，每个协议至少有一个 <em>侦听器(Listener)</em> 或一个 <em>适配器(Adapter)</em>。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/telemetryd/telemetryd-overview.png" alt="telemetryd overview">
</div>
<div class="title">Figure 41. Telemetryd 中协议实现的通用组件概述</div>
</div>
<div class="paragraph">
<p><em>侦听器(Listener)</em> 和 <em>适配器(Adapter)</em> 以及它的配置为应用程序构建协议。</p>
</div>
<div class="sect2">
<h3 id="_什么是侦听器listener">25.1. 什么是侦听器(Listener)</h3>
<div class="paragraph">
<p><em>侦听器(Listener)</em> 负责从某些外部源接收传感器数据。
例如，包括侦听来自 UDP socket 的数据包，从 <em>MQTT</em> 主题中检索消息等等。
可以配置多个 <em>侦听器(Listeners)</em>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_什么是适配器adapter">25.2. 什么是适配器(Adapter)</h3>
<div class="paragraph">
<p><em>适配器(Adapter)</em> 负责处理 <em>侦听器(Listeners)</em> 转发的字节流。
例如，包括解码特定的 <em>JSON</em> 格式，存储指标度量 和/或 生成事件。</p>
</div>
<div class="paragraph">
<p>该框架不会对有关被接收或处理的数据做任何预处理，而是将其留给 <em>侦听器(Listener)</em> 和 <em>适配器(Adapter)</em> 实现。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
如果你有多个 <em>适配器(Adapters)</em>，则执行顺序与 <code>telemetryd-configuration.xml</code> 中定义的相同。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_什么是协议">25.3. 什么是协议</h3>
<div class="paragraph">
<p>一个 <em>协议(Protocol)</em> 至少由一个 <em>侦听器(Listener)</em> 和至少一个 <em>适配器(Adapter)</em> 以及它的配置组成。
使用 <em>协议(Protocol)</em> 可以处理来自 <em>Juniper Telemetry Interface (JTI)</em> 或 <em>Netflow v5</em> 的传感器数据。</p>
</div>
</div>
<div class="sect2">
<h3 id="_通过_minion_推送传感器数据">25.4. 通过 Minion 推送传感器数据</h3>
<div class="paragraph">
<p><em>侦听器(Listeners)</em> 可以在 <em>OpenNMS Horizon</em> 或 <em>Minion</em> 上运行，而适配器(adapters)只在 <em>OpenNMS Horizon</em> 上运行。
如果侦听器(listener)在 <em>Minion</em> 上运行，则收到的消息将自动转发到 <em>OpenNMS Horizon</em> 中运行的相关适配器(adapter)。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/telemetryd/telemetryd-minion.png" alt="telemetryd minion">
</div>
<div class="title">Figure 42. 使用消息传递系统在 Minion 上运行侦听器(Listener)转发数据包</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-telemetryd-protocols">25.5. 协议参考</h3>
<div class="sect3">
<h4 id="_ipfix_接口">25.5.1. IPFIX 接口</h4>
<div class="paragraph">
<p><em>IP 流量信息导出 (IPFIX)</em> 协议是用于传输流量信息的供应商中立标准。
有关 <em>OpenNMS Horizon</em> 中流支持的详细信息，请参阅 <a href="#ga-flow-support">流量支持</a>。</p>
</div>
<div class="sect4">
<h5 id="telemetryd-ipfix-adapter">IPFIX 适配器(Adapter)</h5>
<div class="paragraph">
<p>IPFIX 适配器(adapter)用于处理由基于 UDP 或 TCP 的 IPFIX 侦听器(adapter)生成的 <em>IPFIX</em> 有效负载。
流量(Flows)从消息解码为规范流格式并发布到 <em>流存储库(flow repository)</em>。</p>
</div>
<div class="sect5">
<h6 id="_定义">定义</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.netflow.ipfix.IpfixAdapter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_参数">参数</h6>
<div class="paragraph">
<p>此适配器当前没有任何配置参数。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_junos_telemetry_接口">25.5.2. Junos Telemetry 接口</h4>
<div class="paragraph">
<p><em>Junos Telemetry 接口 (JTI)</em> 允许将操作统计信息异步推送到 <em>OpenNMS Horizon</em>。
<em>OpenNMS Horizon</em> 发送一次请求，设备的流将定期更新一次。
数据通过 <em>UDP</em> 生成 Google protocol buffers (gpb) 的结构化消息。
有关 <em>JTI</em> 的详细信息，请参阅 <a href="https://www.juniper.net/documentation/en_US/junos/topics/concept/junos-telemetry-interface-oveview.html">Juniper 文档</a>。</p>
</div>
<div class="paragraph">
<p>要启用对 Junos Telemetry 接口 (JTI) 的支持，请编辑 <code>${OPENNMS_HOME}/etc/telemetryd-configuration.xml</code> 文件，并将 <code>JTI</code> 相应协议设置为 <code>enabled=true</code>。</p>
</div>
<div class="listingblock">
<div class="title">在 telemetryd-configuration.xml 中启用 JTI 协议</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;protocol name="JTI" description="Junos Telemetry Interface (JTI)" enabled="true"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过在 CLI 或 WebUI 中发送 <code>reloadDaemonConfig</code> 事件来应用更改，不用重新启动:</p>
</div>
<div class="listingblock">
<div class="title">通过 CLI 发送 reloadDaemonConfig 事件</div>
<div class="content">
<pre class="prettyprint highlight"><code>${OPENNMS_HOME}bin/send-event.pl -p 'daemonName Telemetryd' uei.opennms.org/internal/reloadDaemonConfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，这将打开一个绑定到 <code>0.0.0.0:50000</code> 的 UDP socket，可以转发 <em>JTI</em> 消息。</p>
</div>
<div class="sect4">
<h5 id="_在_minion_上配置_jti_侦听器listener">在 Minion 上配置 JTI 侦听器(Listener)</h5>
<div class="paragraph">
<p>要在 Minion 上为 JTI 启用并配置一个 <em>UDP 侦听器(Listener)</em>，请连接到 <em>Karaf Console</em> 并设置以下属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8201 admin@localhost
...
admin@minion()&gt; config:edit org.opennms.features.telemetry.listeners-udp-50000
admin@minion()&gt; config:property-set name JTI
admin@minion()&gt; config:property-set class-name org.opennms.netmgt.telemetry.listeners.udp.UdpListener
admin@minion()&gt; config:property-set listener.port 50000
admin@minion()&gt; config:update</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
还必须在 <em>OpenNMS Horizon</em> 上启用该协议，来处理消息。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_jti_适配器adapter">JTI 适配器(Adapter)</h5>
<div class="paragraph">
<p>JTI 适配器用于处理 <em>Junos Telemetry 接口</em> 有效负载。
使用已发布的 protobuf 规范对消息进行解码，并将其转发到 JSR-223 兼容脚本(例如 Beanshell 或 Groovy)，以进行进一步处理。
使用脚本扩展，你可以从 JTI 消息中提取所需的指标度量，并将结果保存为时间序列数据。</p>
</div>
<div class="sect5">
<h6 id="_定义_2">定义</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.jti.JtiGpbAdapter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_参数_2">参数</h6>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 127. 适配器 JtiGpbAdapter 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需要</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于处理 JTI 消息的脚本的完整路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_脚本">脚本</h6>
<div class="paragraph">
<p>将为每个接收并成功解码的 JTI 消息调用改脚本。</p>
</div>
<div class="paragraph">
<p>以下全局变量将传递给脚本:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 128. 传递给脚本的全局变量</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与指标度量关联的代理 (node)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collection.api.CollectionAgent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>builder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应在其中添加资源和指标的构建器</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collection.support.builder.CollectionSetBuilder</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解码 JTI 消息，并从中提取指标度量</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.jti.proto.TelemetryTop</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_v5_接口">25.5.3. NetFlow v5 接口</h4>
<div class="paragraph">
<p>有关 <em>OpenNMS Horizon</em> 中流支持的详细信息，请参阅 <a href="#ga-flow-support">流量支持</a>。</p>
</div>
<div class="sect4">
<h5 id="telemetryd-netflow5-adapter">NetFlow v5 适配器(Adapter)</h5>
<div class="paragraph">
<p>NetFlow v5 适配器用于处理 <em>NetFlow v5</em> 有效负载。</p>
</div>
<div class="sect5">
<h6 id="_定义_3">定义</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.netflow.Netflow5Adapter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_参数_3">参数</h6>
<div class="paragraph">
<p>此适配器当前没有任何配置参数。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_v9_接口">25.5.4. NetFlow v9 接口</h4>
<div class="paragraph">
<p>有关 <em>OpenNMS Horizon</em> 中流支持的详细信息，请参阅 <a href="#ga-flow-support">流量支持</a>。</p>
</div>
<div class="sect4">
<h5 id="telemetryd-netflow9-adapter">Netflow v9 适配器(Adapter)</h5>
<div class="paragraph">
<p>Netflow v9 适配器用于处理 Netflov9 UDP 侦听器生成的 <em>Netflow v9</em> 有效负载。
流量(Flows)从消息解码为规范流格式并发布到 <em>流存储库(flow repository)</em>。</p>
</div>
<div class="sect5">
<h6 id="_定义_4">定义</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.netflow.v9.Netflow9Adapter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_参数_4">参数</h6>
<div class="paragraph">
<p>此适配器当前没有任何配置参数。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cisco_nx_os_telemetry">25.5.5. Cisco NX-OS Telemetry</h4>
<div class="paragraph">
<p><em>Cisco NX-OS Telemetry</em> 允许将操作统计信息异步推送到 <em>OpenNMS Horizon</em>。
<em>OpenNMS Horizon</em> 发送一次请求，设备的流将定期更新一次。
数据通过 <em>UDP</em> 生成 Google protocol buffers (gpb) 的结构化消息。
有关 <em>NX-OS</em> 的详细信息，请参阅 <a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus9000/sw/7-x/programmability/guide/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Guide_7x/b_Cisco_Nexus_9000_Series_NX-OS_Programmability_Guide_7x_chapter_011000.html">NXOS 文档</a>。</p>
</div>
<div class="paragraph">
<p>要启用对 NX-OS Telemetry 的支持，请编辑 <code>${OPENNMS_HOME}/etc/telemetryd-configuration.xml</code> 文件，并将 <code>NXOS</code> 的相应协议设置为 <code>enabled=true</code>。</p>
</div>
<div class="listingblock">
<div class="title">在 telemetryd-configuration.xml 中启用 NX-OS 协议</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;protocol name="NXOS" description="Cisco NX-OS Telemetry" enabled="true"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过在 CLI 或 WebUI 中发送 <code>reloadDaemonConfig</code> 事件来应用更改，不用重新启动:</p>
</div>
<div class="listingblock">
<div class="title">通过 CLI 发送 reloadDaemonConfig 事件</div>
<div class="content">
<pre class="prettyprint highlight"><code>${OPENNMS_HOME}bin/send-event.pl -p 'daemonName Telemetryd' uei.opennms.org/internal/reloadDaemonConfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，这将打开一个绑定到 <code>0.0.0.0:50001</code> 的 UDP socket，可以转发 <em>NXOS</em> 消息。</p>
</div>
<div class="sect4">
<h5 id="_在_minion_上配置_nx_os_侦听器listener">在 Minion 上配置 NX-OS 侦听器(Listener)</h5>
<div class="paragraph">
<p>要在 Minion 上为 NX-OS 启用并配置一个 <em>UDP 侦听器(Listener)</em>，请连接到 <em>Karaf Console</em> 并设置以下属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8201 admin@localhost
...
admin@minion()&gt; config:edit org.opennms.features.telemetry.listeners-udp-50000
admin@minion()&gt; config:property-set name NXOS
admin@minion()&gt; config:property-set class-name org.opennms.netmgt.telemetry.listeners.udp.UdpListener
admin@minion()&gt; config:property-set listener.port 50001
admin@minion()&gt; config:update</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
还必须在 <em>OpenNMS Horizon</em> 上启用该协议，来处理消息。
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_cisco_nx_os_适配器adapter">Cisco NX-OS 适配器(Adapter)</h5>
<div class="paragraph">
<p>JTI 适配器用于处理 <em>Cisco NX-OS Telemetry</em> 有效负载。
使用已发布的 protobuf 规范对消息进行解码，并将其转发到 JSR-223 兼容脚本(例如 Beanshell 或 Groovy)，以进行进一步处理。
使用脚本扩展，你可以从 NX-OS 消息中提取所需的指标度量，并将结果保存为时间序列数据。</p>
</div>
<div class="sect5">
<h6 id="_定义_5">定义</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.nxos.NxosGpbAdapter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_参数_5">参数</h6>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 129. 适配器 NxosGpbAdapter 的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需要</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于处理 NXOS 消息的脚本的完整路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_脚本_2">脚本</h6>
<div class="paragraph">
<p>将为每个接收并成功解码的 NX-OS 消息调用改脚本。</p>
</div>
<div class="paragraph">
<p>以下全局变量将传递给脚本:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 130. 传递给脚本的全局变量</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">与指标度量关联的代理 (node)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collection.api.CollectionAgent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>builder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">应在其中添加资源和指标的构建器</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.collection.support.builder.CollectionSetBuilder</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">解码 NX-OS 消息，并从中提取指标度量</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.nxos.proto.TelemetryBis</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sflow_接口">25.5.6. sFlow 接口</h4>
<div class="paragraph">
<p>有关 <em>OpenNMS Horizon</em> 中流支持的详细信息，请参阅 <a href="#ga-flow-support">流量支持</a>。</p>
</div>
<div class="sect4">
<h5 id="telemetryd-sflow-adapter">sFlow 适配器(Adapter)</h5>
<div class="paragraph">
<p>IPFIX 适配器(adapter)用于处理 sFlow 侦听器(adapter)生成的 <em>sFlow</em> 有效负载。
流量(Flows)从消息解码为规范流格式并发布到 <em>流存储库(flow repository)</em>。</p>
</div>
<div class="sect5">
<h6 id="_定义_6">定义</h6>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.adapters.netflow.sflow.SFlowAdapter</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_参数_6">参数</h6>
<div class="paragraph">
<p>此适配器当前没有任何配置参数。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-telemetryd-listener">25.6. 侦听器(Listener)参考</h3>
<div class="sect3">
<h4 id="_udp_侦听器listener">25.6.1. UDP 侦听器(Listener)</h4>
<div class="paragraph">
<p>UDP 侦听器用于打开普通的 UDP socket，并从接收的数据包构建消息。</p>
</div>
<div class="sect4">
<h5 id="_定义_7">定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.listeners.udp.UdpListener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_参数_7">参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 131. UdpListener 的侦听器特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">绑定 UDP 端口的 IP 地址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0.0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要侦听的 UDP 端口号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>50000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxPacketSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最大数据包大小，单位字节 (更大的数据将被截断)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8096</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_netflow_v9_udp_侦听器listener">25.6.2. Netflow v9 UDP 侦听器(Listener)</h4>
<div class="paragraph">
<p>此基于 UDP 侦听器用来打开 UDP socket，以处理传入的 Netflow v9 数据包。</p>
</div>
<div class="sect4">
<h5 id="_定义_8">定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.listeners.flow.netflow9.UdpListener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_参数_8">参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 132. Netflow v9 UDP 侦听器的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">绑定 UDP socket 的 IP 地址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0.0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要侦听的 UDP 端口号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4738</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxPacketSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最大数据包大小，单位字节 (更大的数据将被截断)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8096</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>templateTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模板超时后的毫秒数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1800000</code> (30 minutes)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ipfix_udp_侦听器listener">25.6.3. IPFIX UDP 侦听器(Listener)</h4>
<div class="paragraph">
<p>此基于 UDP 侦听器用来打开 UDP socket，以处理传入的 IPFIX 数据包。</p>
</div>
<div class="sect4">
<h5 id="_定义_9">定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.listeners.flow.ipfix.UdpListener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_参数_9">参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 133. IPFIX UDP 侦听器的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">绑定 UDP socket 的 IP 地址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0.0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要侦听的 UDP 端口号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4738</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxPacketSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最大数据包大小，单位字节 (更大的数据将被截断)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8096</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>templateTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">模板超时后的毫秒数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1800000</code> (30 minutes)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ipfix_tcp_侦听器listener">25.6.4. IPFIX TCP 侦听器(Listener)</h4>
<div class="paragraph">
<p>此基于 TCP 侦听器用来打开 TCP socket，以处理传入的 IPFIX 会话(sessions)。</p>
</div>
<div class="sect4">
<h5 id="_定义_10">定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.listeners.flow.ipfix.TcpListener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_参数_10">参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 134. IPFIX TCP 侦听器的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">绑定 TCP socket 的 IP 地址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0.0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要侦听的 TCP 端口号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4739</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sflow_udp_侦听器listener">25.6.5. sFlow UDP 侦听器(Listener)</h4>
<div class="paragraph">
<p>此基于 UDP 侦听器用来打开 UDP socket，以处理传入的 sFlow 数据包。</p>
</div>
<div class="sect4">
<h5 id="_定义_11">定义</h5>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">类名</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.opennms.netmgt.telemetry.listeners.sflow.Listener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minion 支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Yes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_参数_11">参数</h5>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 135. sFlow UDP 侦听器的特定参数</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">绑定 UDP socket 的 IP 地址</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.0.0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要侦听的 UDP 端口号</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6343</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxPacketSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">最大数据包大小，单位字节 (更大的数据将被截断)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8096</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-elasticsearch-integration">26. Elasticsearch Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>OpenNMS Horizon</em> persists/forwards certain data to <em>Elasticsearch</em>.</p>
</div>
<div class="paragraph">
<p>The following chapters describe the configuration possibilities as well as the available features.</p>
</div>
<div class="paragraph">
<p>Internally all <em>Elasticsearch</em> integrations use the <a href="https://github.com/searchbox-io/Jest">Jest library</a> to access the <em>Elasticsearch</em> ReST interface.</p>
</div>
<div class="sect2">
<h3 id="ga-elasticsearch-integration-configuration">26.1. Configuration</h3>
<div class="paragraph">
<p>The configuration is feature dependant and therefore must take place in the feature configuration file in <code>${OPENNMS_HOME}/etc/org.opennms.features.flows.persistence.elastic.cfg</code>.</p>
</div>
<div class="paragraph">
<p>The following properties can be set:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>elasticUrl</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL(s) to Elasticsearch nodes. Can either point directly to ReST API or seed nodes. The format is: <code>&lt;host&gt;:&lt;port&gt;</code>. Comma separate multiple values.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="http://localhost:9200" class="bare">http://localhost:9200</a></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>elasticIndexStrategy</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index strategy for data, allowed values <em>yearly</em>, <em>monthly</em>, <em>daily</em>, <em>hourly</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>daily</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>globalElasticUser</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username to use for all nodes, when <a href="https://www.elastic.co/guide/en/x-pack/current/setting-up-authentication.html">X-Pack Security</a> is configured.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>globalElasticPassword</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password to use for all nodes, when <em>X-Pack Security</em> is configured.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>defaultMaxTotalConnectionPerRoute</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the default max connections per route. If a negative value is given, the value is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;available processors&gt; * 2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>maxTotalConnection</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the default max total connections. If a negative value is given, the value is ignored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;max connections per route&gt; * 3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>nodeDiscovery</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable/Disable node discovery. Valid values are <code>true|false</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>nodeDiscoveryFrequency</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the frequency in seconds in which the nodes are re-discovered. Must be set, if <code>discovery=true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>proxy</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows defining a HTTP proxy. Only accepts valid URLs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>retries</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines how many times an operation is retried before considered failed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>retryCooldown</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the cooldown in ms to wait before retrying. Value of <code>0</code> means no cooldown. Value must be &gt;= <code>0</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>connTimeout</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the connection timeout in ms.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>readTimeout</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the read timeout in ms.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>bulkRetryCount</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the number of retries performed before a bulk operation is considered as failed.
When bulk operations fail, only the failed items are retried.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>settings.index.number_of_shards</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of primary shards that an index should have. Refer to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-modules-setting">Elasticsearch Reference &#8594; Index Modules</a> for more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>settings.index.number_of_replicas</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of replicas each primary shard has. Refer to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-modules-setting">Elasticsearch Reference &#8594; Index Modules</a> for more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>settings.index.refresh_interval</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How often to perform a refresh operation, which makes recent changes to the index visible to search. Refer to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-modules-setting">Elasticsearch Reference &#8594; Index Modules</a> for more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>settings.index.routing_partition_size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of shards a custom routing valuce can go to. Refer to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html#index-modules-setting">Elasticsearch Reference &#8594; Index Modules</a> for more details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If a configuration management tool is used, the properties file can be created and is used as startup configuration
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If credentials are provided preemptive auth is used for all defined Elasticsearch nodes.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Configuration Example to access Elasticsearch</div>
<div class="content">
<pre class="prettyprint highlight"><code>elasticUrl=http://elastic:9200
elasticIndexStrategy=daily
globalElasticUser=elastic
globalElasticPassword=changeme</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_credentials">26.2. Credentials</h3>
<div class="paragraph">
<p>It is possible to define credentials for each Elasticsearch node individually.
Credentials for each node must be stored in <code>${OPENNMS_HOME}/etc/elastic-credentials.xml</code>.</p>
</div>
<div class="listingblock">
<div class="title">Custom credentials</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;elastic-credentials&gt;
    &lt;credentials url="http://localhost:9200" username="ulf" password="ulf" /&gt;
    &lt;credentials url="https://10.10.0.1:9333" username="ulf" password="flu" /&gt;
&lt;/elastic-credentials&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Credentials are globally defined and will be used by each feature.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-elasticsearch-integration-features">26.3. Features</h3>
<div class="sect3">
<h4 id="_version_matrix">26.3.1. Version Matrix</h4>
<div class="paragraph">
<p>Not all features are enabled by default and may require a certain version of <em>Elasticsearch</em>.
Therefore the following table provides a version overview.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Supported Elastic Version</th>
<th class="tableblock halign-left valign-top">Enabled by default</th>
<th class="tableblock halign-left valign-top">Feature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event and Alarm Forwarder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 5.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opennms-es-rest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flow Support</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 6.2.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opennms-flows</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Correlation Situation Feedback</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;= 6.2.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opennms-situation-feedback</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_alarm_and_event_forwarder">26.3.2. Alarm and Event Forwarder</h4>
<div class="paragraph">
<p>The <em>Alarm and Event Forwarder</em> (formerly known as the <em>Elasticsearch ReST plugin</em>) forwards events and alarms to <a href="https://github.com/elastic/elasticsearch">Elasticsearch</a>.
In combination with the alarm <em><a href="#ga-internal-plugins-alarm-change-notifier">Alarm Change Notifier Plugin</a></em> it also forwards alarm change events.</p>
</div>
<div class="paragraph">
<p>The events and alarms in <em>Elasticsearch</em> can then be used for indexing, long time archival, plotting with <em>Grafana</em> and browsing with <em>Kibana</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature uses the <em>Elasticsearch</em> ReST interface and can interact with cloud-hosted <em>Elasticsearch</em> instances.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use <em>Kibana</em>, make sure you are using the version that is compatible with your version of <em>Elasticsearch</em>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_configuration_2">Configuration</h5>
<div class="paragraph">
<p>The configuration is held in <code>${OPENNMS_HOME}/etc/org.opennms.plugin.elasticsearch.rest.forwarder.cfg</code>.
Please refer to section <a href="#ga-elasticsearch-integration-configuration">Configuring Elasticsearch</a> in order to configure <em>Elasticsearch</em> connection settings.</p>
</div>
<div class="paragraph">
<p>Besides the general <em>Elasticsearch</em> connection settings, the following properties are supported to configure the <em>Alarm and Event Forwarder</em>:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logEventDescription</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to forward the event description field to <em>Elasticsearch</em>. It can be disabled because it contains a long text field that can be redundant with the rest of the metadata included in the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archiveRawEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archive events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archiveAlarms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archive alarms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archiveAlarmChangeEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archive alarm change events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archiveOldAlarmValues</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For alarm change events, we can choose to archive the detailed alarm values but this is expensive. Set false in production.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archiveNewAlarmValues</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archiveAssetData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true The following attributes representing useful node asset fields from the node asset table are included in archived events and alarms. These are included only where the values are not null or empty strings in the table.</p>
<p class="tableblock">(asset-latitude,asset-longitude,asset-region,asset-building,asset-floor,asset-room,asset-rack,asset-slot,asset-port,asset-category,asset-displaycategory,asset-notifycategory,asset-pollercategory,asset-thresholdcategory,asset-managedobjecttype,asset-managedobjectinstance,asset-manufacturer,asset-vendor,asset-modelnumber,parent-nodelabel,parent-nodeid,parent-foreignsource,parent-foreignid)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groupOidParameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code> all oid from the event parameters are stored in a single array <code>p_oids</code> instead of a flattened structue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logAllEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If changed to true, then archive all events even if they have not been persisted in the <em>OpenNMS Horizon</em> database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>batchSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increase this value to enable batch inserts into <em>Elasticsearch</em>. This is the maximum size of a batch of events that is sent to <em>Elasticsearch</em> in a single connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>batchInterval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">optional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum time interval in milliseconds between batch events (recommended: 500ms) when a <code>batchSize</code> value greater than 1 is being used.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once you are sure everything is correctly configured, you can activate the <em>Event &amp; Alarm Forwarder</em> by logging into the <em>OSGi</em> console and installing the feature: <code>opennms-es-rest</code>.</p>
</div>
<div class="listingblock">
<div class="title"><em>OSGi</em> login and installation of the <em>Elasticsearch</em> forwarder</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-shell" data-lang="shell">ssh admin@localhost -p 8101
feature:install opennms-es-rest</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_loading_historical_events">Loading Historical Events</h5>
<div class="paragraph">
<p>It is possible to load historical <em>OpenNMS Horizon</em> events into <em>Elasticsearch</em> from the <em>OpenNMS Horizon</em> database using a <em>karaf</em> console command.
The command uses the <em>OpenNMS Horizon</em> Events ReST interface to retrieve a set number of historical events and forward them to <em>Elasticsearch</em>.
Because we are using the ReST interface it is also possible to contact a remote <em>OpenNMS Horizon</em> and download its events into <em>Elasticsearch</em> by using the correct remote URL and credentials.</p>
</div>
<div class="paragraph">
<p>The following example sends historic events to <em>Elasticsearch</em> using the <em>karaf</em> console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># open karaf command prompt using
# ssh -p 8101 admin@localhost
karaf&gt; elasticsearch:send-historic-events --username admin --password admin --url http://localhost:8980 --limit 10 --offset 0</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details, consolidate the <code>--help</code> option of the command.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_index_definitions">Index Definitions</h5>
<div class="paragraph">
<p>Three indices are created; one for alarms, one for alarm change events and one for raw events.
Alarms and alarm change events are only saved if the <a href="#ga-internal-plugins-alarm-change-notifier">Alarm Change Notifier Plugin</a> plugin is also
installed to generate alarm change events from the <em>OpenNMS Horizon</em> alarms table.
The index names are of the form (assuming an index strategy of monthly): <code>opennms-&lt;name&gt;-&lt;index-strategy&gt;/type/id</code></p>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="paragraph">
<p>a) Alarms</p>
</div>
<div class="listingblock">
<div class="content">
<pre>opennms-alarms-2017-01/alarmdata/1823</pre>
</div>
</div>
<div class="paragraph">
<p>b) Alarm Change Events</p>
</div>
<div class="listingblock">
<div class="content">
<pre>opennms-events-alarmchange-2017-01/eventdata/11549</pre>
</div>
</div>
<div class="paragraph">
<p>c) Raw <em>OpenNMS Horizon</em> events (not including alarm change events)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>opennms-events-raw-2017-01/eventdata/11549</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_viewing_events_using_kibana_sense">Viewing events using Kibana Sense</h5>
<div class="paragraph">
<p><em>Kibana Sense</em> is a <em>Kibana</em> app which allows you to run queries directly against <em>Elasticsearch</em>.
(<a href="https://www.elastic.co/guide/en/sense/current/installing.html" class="bare">https://www.elastic.co/guide/en/sense/current/installing.html</a>)</p>
</div>
<div class="paragraph">
<p>If you install <em>Kibana Sense</em> you can use the following commands to view the alarms and events sent to <em>Elasticsearch</em>
You should review the <em>Elasticsearch</em> ReST API documentation to understand how searches are specified.
(See <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search.html" class="bare">https://www.elastic.co/guide/en/elasticsearch/reference/current/search.html</a>)</p>
</div>
<div class="paragraph">
<p>Example searches to use in <em>Kibana Sense</em> (you can copy the whole contents of this panel into <em>Kibana Sense</em> as a set of examples)</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Search all the alarms indexes

GET /opennms-alarms-*/_search

# Get all of the alarms indexes

GET /opennms-alarms-*/

# Get a specific alarm id from the 2017.01 index

GET opennms-alarms-2017-01/alarmdata/1823

# Delete all alarm indexes

DELETE /opennms-alarms-*/

# Search all the events indexes

GET /opennms-events-*/_search

# Search all the raw events indexes

GET /opennms-events-raw*/_search

# Delete all the events indexes

DELETE /opennms-events-*/

# Get all the raw events indexes

GET /opennms-events-raw*/

# Get all the alarmchange event indexes

GET /opennms-events-alarmchange-*/

# Search all the alarm change event indexes

GET opennms-events-alarmchange-*/_search

# Get a specific alarm change event

GET opennms-events-alarmchange-2016-08/eventdata/11549</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mapping_of_alarms_and_events_to_elasticsearch">Mapping of Alarms and Events to Elasticsearch</h5>
<div class="sect5">
<h6 id="_overview_of_index_mapping">Overview of index mapping</h6>
<div class="paragraph">
<p>In <em>OpenNMS Horizon</em>, Alarm and Event table entries contain references to associated node, asset, service and journal message tables.
In <em>Elasticsearch</em>, we must flatten these entries into a single index entry for each insertion. Thus each index entry contains
more context information than would be found in the actual <em>OpenNMS Horizon</em> event or alarm. This context information includes the associated node
and asset table information which was current when (but may have changed since) the event was archived.</p>
</div>
<div class="paragraph">
<p>In the <em>Table of Index Mappings</em> below we have example alarm and event JSON entries retrieved using a sense command. The table helps illustrate how <em>OpenNMS Horizon</em>
saves data in <em>Elasticsearch</em>.</p>
</div>
<div class="paragraph">
<p>Internal <em>Elasticsearch</em> fields always begin with an underscore character. The internal fields <code><em>id</code>, <code>_index</code> and <code>_type</code> are combined to give the unique identifier for an entry
as described above under Index Definitions. All of the fields under <code>_source</code> represent the stored alarm or event (_Elasticsearch</em> documentation refers to source entries as indexed documents).
The ID of each event is included in the <code>_source</code> <code>id</code> field and also duplicated in the internal <code>_id</code>.</p>
</div>
<div class="paragraph">
<p>Events in the <em>OpenNMS Horizon</em> events table (i.e. those corresponding to logs or traps) are copied directly to the <code>opennms-events-raw-</code>
indexes. In <em>OpenNMS Horizon</em> alarms and events can contain <code>parameters</code> which are key-value pairs referencing additional data stored when the
event or alarm is created. In <em>Elasticsearch</em> these parameters are always stored in separate fields in the index with names beginning with <code>p_</code></p>
</div>
<div class="paragraph">
<p>Alarm change events created by the <em>Alarm Change Notifier Plugin</em> have an identical format to raw events
but are only copied to the <code>opennms-events-alarmchange-</code> indexes. These alarm change events are also used to change
the state of alarms in the <code>opennms-alarms-</code> indexes. Thus alarm entries in the <code>opennms-alarms-</code> indexes reflect the current state of
alarms as notified by <em>OpenNMS Horizon</em> through alarm change events.</p>
</div>
<div class="paragraph">
<p>The parameters included with each type of Alarm Change Event are listed in the <em>Alarm Change Notifier Plugin</em> section. Each parameter in the index
will have a <code>p_</code> prefix (ie. <code>%parm[newalarmvalues]%</code> becomes <code>p_newalarmvalues</code>).</p>
</div>
<div class="paragraph">
<p>Alarms and Events have <code>severity</code> fields defined as integers (long) and also corresponding <code>severity_text</code> fields which give the
text equivalent (<code>Critical</code>, <code>Major</code>, <code>Minor</code>, <code>Normal</code>, <code>Cleared</code>).</p>
</div>
</div>
<div class="sect5">
<h6 id="_additional_alarm_fields">Additional Alarm Fields</h6>
<div class="paragraph">
<p>The id of each alarm is included in the <code>_source</code> <code>alarmid</code> field and also duplicated in the internal <code>_id</code> reference for the alarms index.
Alarm Change Events reference their associated alarm using the <code>p_alarmid</code> parameter. To make it easier to search for alarm change events associated
with the same alarm, alarms also have a <code>_source</code> <code>p_alarmid</code> parameter which matches <code>alarmid</code>. Thus we should be able to search for an alarm in the <code>opennms-alarms</code> index
and find its complete lifecycle from alarm raise to deletion in the <code>opennms-events-alarmchange</code> index.</p>
</div>
<div class="paragraph">
<p>The alarms index is enriched with additional data to allow the alarm entries to be used in SLA calculations.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Additional Alarm Fields</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alarmackduration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calculated time in milliseconds from first event which created the alarm to the latest alarm acknowledgement.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alarmclearduration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calculated time in milliseconds from first event which created the alarm to the latest alarm clear.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialseverity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The final state of any given alarm in an alarm index should be cleared and deleted. Therefore we also include an initial severity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialseverity_text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial severity as a text field.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_table_of_index_mapping">Table of Index Mapping</h6>
<div class="paragraph">
<p>The following table describes the mapping of simple
<em>OpenNMS Horizon</em> events to the Raw Events Index and the mapping of Alarm
Change Events to the Alarm Change Events index and  to the Alarms index. Note that
fields that begin with an underscore (_) are internal to Elasticsearch.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Alarm Index Fields</th>
<th class="tableblock halign-left valign-top" colspan="2">Event Index Fields (Alarm change and raw events)</th>
<th class="tableblock halign-left valign-top" colspan="2">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example Alarm JSON</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Alarm Field</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event Field</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example Event JSON</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_index": "opennms-alarms-2017.03",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_index":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_index":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_index":
"opennms-events-alarmchange-2017.03",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_index</code> is the index in which
this alarm or event is stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_type": "alarmdata",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_type":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_type":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_type": "eventdata",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_type</code> either <code>alarmdata</code> or <code>eventdata</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_id": "31",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_id":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_id":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_id": "1110",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_id</code> field matches the event or alarm ID, if present.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_score": 1,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_score":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_score":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_score": 1,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal Elasticsearch ranking of the search result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_source": {</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_source":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_source":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"_source": {</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_source</code> contains the data of the index entry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"@timestamp": "2017-03-03T12:44:21.210Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"@timestamp":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"@timestamp":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"@timestamp": "2017-03-02T15:20:56.861Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For Alarms, <code>@timestamp</code> is alarm creation time based on the first event time.
For Events, <code>@timestamp</code> is event time from <code>event.getTime()</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dom": "3",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dom":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dom":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dom": "2",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Day of month from <code>@timestamp</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dow": "6",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dow":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dow":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"dow": "5",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Day of week from <code>@timestamp</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"hour": "12",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"hour":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"hour":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"hour": "15",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hour of day from <code>@timestamp</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventdescr":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventdescr": "&lt;p&gt;Alarm &lt;a
href=\"/opennms/alarm/detail.htm?id=30\"&gt;30&lt;/a&gt; Cleared&lt;p&gt;&#8230;&#8203;",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event description.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventseverity":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventseverity": "3",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event severity.</p>
<p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">All events have severity normal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventseverity_text":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventseverity_text": "Normal",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text representation of severity value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventsource":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventsource": "AlarmChangeNotifier",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenNMS event source.</p>
<p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">All events have the event source <code>AlarmChangeNotifier</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventuei":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventuei":
"uei.opennms.org/plugin/AlarmChangeNotificationEvent/AlarmCleared",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenNMS universal event identifier (UEI) of the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"id":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"id": "1110",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"interface":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"interface": "127.0.0.1",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address of the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ipaddr":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ipaddr": "/127.0.0.1",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address of the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"logmsg":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"logmsg": "&lt;p&gt;Alarm &lt;a
href=\"/opennms/alarm/detail.htm?id=30\"&gt;30&lt;/a&gt; Cleared&lt;p&gt;",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log message of the event.</p>
<p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Log messages contain a link to the alarm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"logmsgdest":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"logmsgdest": "logndisplay",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log
Destination of the Event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_newalarmvalues":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_newalarmvalues": "{<br>
 \"suppressedtime\":\"2017-03-02T14:24:59.282Z\",+
 \"systemid\":\"00000000-0000-0000-0000-000000000000\",+
 \"suppresseduntil\":\"2017-03-02T14:24:59.282Z\",+
 \"description\":\"&lt;p&gt;SNMP data collection on interface 127.0.0.1\\n<br>
failed.&lt;\\/p&gt;\",<br>
 \"mouseovertext\":null,<br>
 \"x733probablecause\":0,<br>
 \"lasteventid\":1072,<br>
 \"lasteventtime\":\"2017-03-02T14:24:59.282Z\",<br>
 \"managedobjectinstance\":null,<br>
 \"alarmacktime\":null,<br>
 \"qosalarmstate\":null,<br>
 \"ipaddr\":\"127.0.0.1\",<br>
 \"alarmackuser\":null,<br>
 \"nodeid\":88,<br>
 \"firsteventtime\":\"2017-03-02T14:24:59.282Z\",<br>
 \"severity\":2,<br>
 \"ifindex\":null,<br>
 \"alarmtype\":1,<br>
 \"x733alarmtype\":null,<br>
 \"logmsg\":\"SNMP data collection on interface 127.0.0.1 failed with Unexpected exception when collecting SNMP data for interface 127.0.0.1 at location Default.'.\", <br>
 \"tticketid\":null,<br>
 \"firstautomationtime\":null,<br>
 \"clearkey\":null,<br>
 \"managedobjecttype\":null,<br>
 \"eventuei\":\"uei.opennms.org\\/nodes\\/dataCollectionFailed\",<br>
 \"counter\":1,<br>
 \"applicationdn\":null,<br>
 \"operinstruct\":null,<br>
 \"ossprimarykey\":null,<br>
 \"stickymemo\":null,<br>
 \"tticketstate\":null,<br>
 \"alarmid\":30,<br>
 \"serviceid\":5,<br>
\"reductionkey\":\"uei.opennms.org\\/nodes\\/dataCollectionFailed::88\",<br>
 \"suppresseduser\":null,<br>
 \"lastautomationtime\":null,<br>
 \"eventparms\":\"reason=Unexpected exception when collecting SNMP data for interface 127.0.0.1 at location Default.(string,text)\"}",<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm and event parameters are key-value pairs which can be associated
with alarms or events. All parameters in Alarms or Events are stored in
Elasticsearch in separate index fields with names beginning with <code>p_</code>.</p>
<p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Parameters <code>p_oldalarmvalues</code> and <code>p_newalarmvalue</code>
contain a JSON string representing the alarm fields before and after the
Alarm change respectively.</p>
<p class="tableblock">The <code>p_newalarmvalue</code> values are copied into the alarm index of the
corresponding alarm (given by <code>alarmid</code> in <code>p_newalarmvalue</code> and by
<code>p_alarmid</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_oldalarmvalues":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_oldalarmvalues": "{ &#8230;&#8203;. }",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <code>p_newalarmvalues</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_oldseverity":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_oldseverity": "5",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Contains the old severity of the alarm before this alarm change event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmackduration": "2132249",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmackduration":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in
milliseconds from first event which created the alarm to the latest alarm
acknowledgement.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmacktime": "2017-03-03T13:19:53.351Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmacktime":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmacktime":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmacktime": "2017-03-03T13:19:53.351Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/AlarmAcknowledged Events:</em></p>
<p class="tableblock">Time that the alarm was acknowledged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmackuser": "admin",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmackuser":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmackuser"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmackuser": "admin",</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/AlarmAcknowledged Events:</em></p>
<p class="tableblock">Name of the user who acknowledged the alarm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmclearduration": "2175014"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmclearduration":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time
in milliseconds from first event which created the alarm to the latest alarm clear.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmcleartime": "2017-03-03T13:20:36.224Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmcleartime":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmcleartime":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmcleartime": "2017-03-03T13:20:36.224Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/AlarmClear Events:</em></p>
<p class="tableblock">Time that the alarm was cleared.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmid": "31",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmid": "30",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">The alarm ID of the alarm that has changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmtype": "1",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"alarmtype":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmtype":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmtype": "1",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"applicationdn": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"applicationdn":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-category": "Power",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-category":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-category":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-category": "Power",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All <code>asset_</code> entries correspond to
fields in the Asset Table of the node referenced in the event. These
fields are only present if populated in the asset table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-building": "55",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-building":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-building":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-building": "55",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-room": "F201",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-room":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-room":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-room":
"F201",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-floor": "Gnd",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-floor":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-floor":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-floor":
"Gnd",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-rack": "2101",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-rack":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-rack":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"asset-rack":
"2101",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"categories": "",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"categories":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"categories":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"categories": "",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>categories</code> corresponds to node categories table. This is a
comma-separated list of categories associated with this node ID. This
field is indexed so separate values can be searched.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"clearkey": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"clearkey":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"counter": "1",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"counter":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"description": "&lt;p&gt;SNMP data collection on interface 127.0.0.1\n
failed.&lt;/p&gt;",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"description":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventuei": "uei.opennms.org/nodes/dataCollectionFailed",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"eventuei":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_eventuei":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_eventuei":
"uei.opennms.org/nodes/dataCollectionFailed",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s event UEI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"firstautomationtime": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"firstautomationtime":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"firsteventtime": "2017-03-03T12:44:21.210Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"firsteventtime":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignid": "1488375237814",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignid": "1488375237814",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreign ID of the node associated with
the alarm or event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignsource": "LocalTest",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignsource":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignsource":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"foreignsource": "LocalTest",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Foreign source of the node associated
with alarm or event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ifindex": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ifindex":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ipaddr": "127.0.0.1",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ipaddr":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"lastautomationtime": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"lastautomationtime":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"lasteventid": "1112",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"lasteventid":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"lasteventtime": "2017-03-03T12:44:21.210Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"lasteventtime":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"logmsg": "SNMP data collection on interface 127.0.0.1 failed with
'Unexpected exception when collecting SNMP data for interface 127.0.0.1
at location Default.'.",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"logmsg":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_logmsg":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_logmsg": "SNMP
data collection on interface 127.0.0.1 failed with 'Unexpected exception
when collecting SNMP data for interface 127.0.0.1 at location
Default.'.",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"managedobjectinstance": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"managedobjectinstance":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"managedobjecttype": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"managedobjecttype":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"mouseovertext": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"mouseovertext":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodeid": "88",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodeid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodeid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodeid": "88",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node ID of the node associated with the alarm or event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodelabel": "localhost",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodelabel":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodelabel":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodelabel":
"localhost",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node label of the node associated with the alarm or event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesyslocation": "Unknown (edit /etc/snmp/snmpd.conf)",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesyslocation":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesyslocation":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesyslocation": "Unknown
(edit /etc/snmp/snmpd.conf)",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP <code>syslocation</code> of the node
associated with the alarm or event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesysname": "localhost.localdomain",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesysname":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesysname":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"nodesysname": "localhost.localdomain",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP <code>sysname</code> of the node associated with the alarm or event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"operatingsystem": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"operatingsystem":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"operinstruct": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"operinstruct":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ossprimarykey": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ossprimarykey":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmid": "31",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmid":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Elasticsearch
alarms index has a field <code>p_alarmid</code> which corresponds to the <code>alarmid</code> of
the alarm and also the <code>p_alarmid</code> field in Alarm Change Events. This
allows Alarm and Alarm Change Event indexes to be easily searched
together for all Alarm Change Events corresponding to an alarm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_reason": "Unexpected exception when collecting SNMP data for
interface 127.0.0.1 at location Default.",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_reason":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All parameters in Alarms or Events are stored in Elasticsearch in
separate index fields with names beginning with <code>p_</code>. <code>p_reason</code> is an
example parameter injected by the <code>uei.opennms.org/nodes/dataCollectionFailed</code>
event in OpenNMS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"qosalarmstate": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"qosalarmstate":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"reductionkey": "uei.opennms.org/nodes/dataCollectionFailed::88",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"reductionkey":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_reductionkey":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_reductionkey":
"uei.opennms.org/nodes/dataCollectionFailed::88",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Corresponds to alarm reductionkey.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"serviceid": "5",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"serviceid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_serviceid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_serviceid": "5"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s service ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"severity": "2",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"severity":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmseverity":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_alarmseverity": "2",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s severity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"severity_text": "Cleared",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"severity_text":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"stickymemo": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"stickymemo":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_stickymemo"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_stickymemo":
null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><em>AlarmChangeNotificationEvent/StickyMemoAdded Events:</em></p>
</div>
<div class="paragraph">
<p>Content of current sticky memo for the alarm.</p>
</div>
<div class="paragraph">
<p><em>AlarmChangeNotificationEvent/StickyMemoUpdate Events:</em></p>
</div>
<div class="paragraph">
<p>These events have parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>p_author</code>: author of stickymemo</p>
</li>
<li>
<p><code>p_body</code>: content of sticky memo</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>AlarmChangeNotificationEvent/JournalMemoUpdate Events:</em></p>
</div>
<div class="paragraph">
<p>These events have parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>p_author</code>: user who authored the memo</p>
</li>
<li>
<p><code>p_body</code>: content of the memo</p>
</li>
<li>
<p><code>p_reductionkey</code>: reduction key associated with memo (corresponds to alarm
reduction key)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that journal memos do not have an entry in the alarm index but are
only referenced by reduction key.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"suppressedtime": "2017-03-03T12:44:21.210Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"suppressedtime":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_suppressedtime":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_suppressedtime": "2017-03-02T14:24:59.282Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/AlarmSuppressed Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s suppressed time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"suppresseduntil": "2017-03-03T12:44:21.210Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"suppresseduntil":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_suppresseduntil":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_suppresseduntil": "2017-03-02T14:24:59.282Z",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/AlarmSuppressed Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s suppressed until time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"suppresseduser": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"suppresseduser":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_suppresseduser":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_suppresseduser": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/AlarmSuppressed Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s suppressed user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"systemid": "00000000-0000-0000-0000-000000000000",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"systemid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_systemid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_systemid": "00000000-0000-0000-0000-000000000000",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Alarm Change Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s system ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"tticketid": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_tticketid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_tticketid":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_tticketid": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/TroubleTicketStateChange Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s trouble ticket ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"tticketstate": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_tticketstate":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_tticketstate":</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"p_tticketstate": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AlarmChangeNotificationEvent/TroubleTicketStateChange Events:</em></p>
<p class="tableblock">Corresponds to the alarm&#8217;s trouble ticket state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"x733alarmtype": null,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"x733alarmtype":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"x733probablecause": "0",</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"x733probablecause":</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">}</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ga-elasticsearch-integration-flow-support">26.3.3. Flow Support</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Flow Support</em> is described in detail <a href="#ga-flow-support">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When persisting flows into Elasticsearch, every flow is represented by a single document.</p>
</div>
<div class="paragraph">
<p>The following table describes a subset of the fields in the flow document:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp in milliseconds at which the flow was sent by the exporter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>location</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring location at which the flow was received.
  This will be <code>Default</code> unless you are using Minion.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netflow.bytes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of bytes transferred in the flow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netflow.last_switched</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp in milliseconds at which the last packet of the flow was transferred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netflow.direction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ingress</code> or <code>egress</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netflow.first_switched</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp in milliseconds at which the first packet of the flow was transferred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netflow.last_switched</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp in milliseconds at which the last packet of the flow was transferred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netflow.input_snmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP interface index on which packets related to this flow were received.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>netflow.output_snmp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP interface index on which packets related to this flow were forwarded.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ga-elasticsearch-integration-situation-feedback">26.3.4. Situation Feedback</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Full documentation on <em>Situation Feedback</em> is available  <a href="#ga-situation-feedback">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When persisting <code>Situation Feedback</code>, feedback on each related alarm  is represented by a document as follows:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@timestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp in milliseconds when the feedback was submitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>situation_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reduction key of the situation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alarm_key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reduction key of the related alarm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>feedback_type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of <code>CORRECT</code>, <code>FALSE_POSITIVE</code> or <code>FALSE_NEGATIVE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>situation_fingerprint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A hash calculated on the situation when the feedback was submitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reason</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A text string provided with the feedback.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user that submitted the feedback.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-flow-support">27. Flow 支持</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ga-flow-support-introduction">27.1. 介绍</h3>
<div class="paragraph">
<p><em>OpenNMS Horizon</em> 支持接收，解码和存储 flow（流）信息，支持协议包括 <em>Netflow v5</em>, <em>Netflow v9</em>, <em>IPFIX</em> 和 <em>sFlow</em>。
虽然 flows（流）提供了广泛的信息，但是 <em>OpenNMS Horizon</em> 中支持的重点是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>网络诊断: 能够在特定网络接口的上下文中查看顶层协议和顶层会话。</p>
</li>
<li>
<p>流量分析: 存储移动时期的 flows（流）数据。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_工作原理">27.1.1. 工作原理</h4>
<div class="paragraph">
<p>在高层次:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ga-telemetryd">telemetryd</a> 在 <em>OpenNMS Horizon</em> 和 <em>Minion</em> 上用于接收和解码 flows（流）。</p>
</li>
<li>
<p><em>telemetryd</em> 适配器将 flows 转换为规范流模型，并将这些流分发到 <em>flow repository（流仓库）</em>。</p>
</li>
<li>
<p><em>flow repository（流仓库）</em> 丰富流并将它们存储到 Elasticsearch:</p>
<div class="ulist">
<ul>
<li>
<p>通过 <a href="#ga-flow-support-classification-engine">Classification Engine</a> 使用应用程序名称标记流。</p>
</li>
<li>
<p>与设备相关的元数据(Metadata)，例如 ids 和 类别，也会添加到流中。</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>REST API</em> 支持从存储在 <em>flow repository（流仓库）</em> 中的流生成汇总和时间序列数据。</p>
</li>
<li>
<p><em>OpenNMS Helm</em> 使用 <em>OpenNMS Horizon</em> <em>REST API</em> 接口来可视化 <em>流数据源</em>。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ga-flow-support-setup">27.2. 设置</h3>
<div class="paragraph">
<p>这里，我们假设你已经拥有:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在每个 Elasticsearch 节点上安装了 <a href="https://github.com/OpenNMS/elasticsearch-drift-plugin">elasticsearch-drift-plugin</a> 的 Elasticsearch 集群设置。</p>
</li>
<li>
<p>安装了 Grafana <a href="https://github.com/OpenNMS/opennms-helm">OpenNMS Helm</a> v2.0.0 或更高版本的实例。</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_照片_elasticsearch_存储">27.2.1. 照片 Elasticsearch 存储</h4>
<div class="paragraph">
<p>从 <em>OpenNMS Horizon</em> 实例上的 Karaf shell，开始配置使用 Elasticsearch 集群存储 flow（流）:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.features.flows.persistence.elastic
admin@opennms()&gt; config:property-set elasticUrl http://elastic:9200
admin@opennms()&gt; config:update</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
此配置存储在 <code>${OPENNMS_HOME/etc/org.opennms.features.flows.persistence.elastic.cfg</code>。
      有关完整的选项，请参阅 <a href="#ga-elasticsearch-integration-configuration">Elasticsearch 通用配置</a>。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_启用协议">27.2.2. 启用协议</h4>
<div class="paragraph">
<p>接下来，在 <code>${OPENNMS_HOME}/etc/telemetryd-configuration.xml</code> 中启用你想要处理的一个或多个协议。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在此示例中，我们启用 NetFlow v5 协议，但是可以对其它相关流协议执行相同的过程。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">在 telemetryd-configuration.xml 中启用 NetFlow v5</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-xml" data-lang="xml">&lt;protocol name="Netflow-5" description="Listener for Netflow 5 UDP packets" enabled="true"&gt;
   &lt;listener name="Netflow-5-UDP-8877" class-name="org.opennms.netmgt.telemetry.listeners.udp.UdpListener"&gt;
        &lt;parameter key="port" value="8877"/&gt;
    &lt;/listener&gt;

    &lt;adapter name="Netflow-5-Parser" class-name="org.opennms.netmgt.telemetry.adapters.netflow.Netflow5Adapter"&gt;
    &lt;/adapter&gt;
 &lt;/protocol&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过 CLI 发送 <code>reloadDaemonConfig</code> 事件，无需重新启动即可应用更改:</p>
</div>
<div class="listingblock">
<div class="title">通过 CLI 发送 reloadDaemonConfig 事件</div>
<div class="content">
<pre class="prettyprint highlight"><code>${OPENNMS_HOME}bin/send-event.pl -p 'daemonName Telemetryd' uei.opennms.org/internal/reloadDaemonConfig</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将打开一个绑定到 <code>0.0.0.0:8877</code> 的 UDP socket，可以转发 <em>NetFlow v5</em> 消息。</p>
</div>
</div>
<div class="sect3">
<h4 id="_在_web_ui_中链接到_opennms_helm">27.2.3. 在 Web UI 中链接到 OpenNMS Helm</h4>
<div class="paragraph">
<p>要从 <em>OpenNMS Horizon</em> web 界面访问流相关的图，你必须配置指向 <em>OpenNMS Helm</em> 实例的链接。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.netmgt.flows.rest
admin@opennms()&gt; config:property-set flowGraphUrl 'http://grafana:3000/dashboard/flows?node=$nodeId&amp;interface=$ifIndex'
admin@opennms()&gt; config:update</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
此 URL 也可以选择指向其它工具。
      它支持 <code>$nodeId</code>, <code>$ifIndex</code>, <code>$start</code> 和 <code>$end</code> 占位符。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>配置完成后，如果存在该接口的流数据，则 SNMP 接口的资源图的右上角会出现一个图标。</p>
</div>
<div class="sect4">
<h5 id="_在_minion_上配置侦听器_可选">在 Minion 上配置侦听器 (可选)</h5>
<div class="paragraph">
<p>在这个例子中，我们将在 Minion 上启用 NetFlow v5 协议的通用侦听器。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
NetFlow v5 使用通用 UDP 侦听器，但是其它协议需要特定侦听器。
           有关详细信息，请参阅 <code>${OPENNMS_HOME}/etc/telemetryd-configuration.xml</code>, 或 <a href="#ga-telemetryd-listener">Telemetryd Listener Reference</a> 中的示例。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要在 Minion 上为 NetFlow v5 启用和配置 <em>UDP 侦听器</em>，请连接到 <em>Karaf 控制台</em> 并设置以下属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8201 admin@localhost
...
admin@minion()&gt; config:edit org.opennms.features.telemetry.listeners-udp-8877
admin@minion()&gt; config:property-set name Netflow-5
admin@minion()&gt; config:property-set class-name org.opennms.netmgt.telemetry.listeners.udp.UdpListener
admin@minion()&gt; config:property-set listener.port 8877
admin@minion()&gt; config:update</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
如果使用配置管理工具，则可以创建属性文件 <code>${MINION_HOME}/etc/org.opennms.features.telemetry.listeners-udp-8877.cfg</code>，作为启动配置。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>name = Netflow-5
class-name = org.opennms.netmgt.telemetry.listeners.udp.UdpListener
listener.port = 8877</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
对于要处理的消息，还必须在 <em>OpenNMS Horizon</em> 上启用相关协议，在本例中为 <code>Netflow-5</code>。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_设备缓存配置_可选">27.2.4. 设备缓存配置 (可选)</h4>
<div class="paragraph">
<p>默认情况下，<em>Flow Document</em> 是 - 已知的 <em>OpenNMS Horizon</em> 的设备的信息。
为了减少对数据库的查询次数而缓存数据。</p>
</div>
<div class="paragraph">
<p>可以在 <code>${OPENNMS_HOME/etc/org.opennms.features.flows.persistence.elastic.cfg</code> 中设置以下缓存属性:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需要</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodeCache.maximumSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">缓存的最大值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodeCache.expireAfterWrite</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在设备缓存中清除记录的等待时间，单位秒。设置为0，则禁止清除记录。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodeCache.recordStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义是否通过 JMX 公开缓存统计信息。设置为 <code>false</code>，则禁用统计记录。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_classification_导出过滤器缓存配置_可选">27.2.5. Classification 导出过滤器缓存配置 (可选)</h4>
<div class="paragraph">
<p><em>Classification Engine</em> 中的规则可以定义 <code>exporterFilter</code>。
为了解决过滤条件是否与导出器的地址匹配，需要执行数据库查询。
可以配置缓存，以缓存结果来提高性能。</p>
</div>
<div class="paragraph">
<p>可以在 <code>${OPENNMS_HOME/etc/org.opennms.features.flows.classification.cfg</code> 中设置以下缓存属性:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">需要</th>
<th class="tableblock halign-left valign-top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache.classificationFilter.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">启用或禁用缓存。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache.classificationFilter.maxSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">缓存的最大值</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cache.classificationFilter.expireAfterRead</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在设备缓存中清除记录的等待时间，单位秒。设置为0，则禁止清除记录。
  每次读取记录时，计时器都会复位。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodeCache.recordStats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">定义是否通过 JMX 公开缓存统计信息。设置为 <code>false</code>，则禁用统计记录。</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ga-flow-support-classification-engine">27.3. Classification Engine (分类引擎)</h3>
<div class="paragraph">
<p><em>Classification Engine</em> 将一组用户- 和/或 系统定义的规则应用于每个流，来对其进行分类。
这允许用户按应用程序对流进行分组，例如，发送到80端口的所有流，都标记为 <code>http</code>。</p>
</div>
<div class="paragraph">
<p>为了对流进行分类，必须定义规则。
规则至少定义了流被分类的名称，以及必须与成功分类匹配的附加参数。</p>
</div>
<div class="sect3">
<h4 id="_规则定义">27.3.1. 规则定义</h4>
<div class="paragraph">
<p>规则包含以下字段:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">强制项</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mandatory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流分类的名称，例如，<code>http</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dstPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流的 <code>dstPort</code> 必须与此端口匹配。
  可以是范围或端口列表，例如 80,8080,8980, 或 8000-9000。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dstAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流的 <code>dstAddress</code> 必须与此地址匹配。
  可以包含通配符。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>srcPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流的 <code>srcPort</code> 必须与此端口匹配。
  有关详细信息，请参阅 <code>dstPort</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>srcAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流的 <code>srcAddress</code> 必须与此地址匹配。
  有关详细信息，请参阅 <code>dstAddress</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exporterFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流导出必须符合该规范。
  它支持 <em><a href="https://wiki.opennms.org/wiki/Filters">OpenNMS Horizon Filters API</a></em> 的所有功能。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>optional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">流的 ip 协议必须符合此规范。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>即使所有字段 (除了 <code>name</code>) 都是可选的，也必须至少将其中一项定义为有效规则。
已存在预定于规则列表。
预定义规则的规范来源于 <a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml">IANA Service Name and Transport Protocol Port Number Registry（IANA 服务名称和传输协议端口号注册表）</a>。
可以使用管理菜单: <strong>Admin &#8594; Configure OpenNMS &#8594; Manage Flow Classification</strong> 中的 <em>Classification UI</em> 定义新规则。</p>
</div>
</div>
<div class="sect3">
<h4 id="_规则优先级">27.3.2. 规则优先级</h4>
<div class="paragraph">
<p>用户定义的规则优先级始终高于预定义规则。
例如，如果用户定义了一个新规则，<code>http</code> 的 <code>dstPort</code> 为 <code>8980</code>，该规则的优先级高于预定义的规则 <code>www-alt</code>。</p>
</div>
<div class="paragraph">
<p>优先级如下：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">字段</th>
<th class="tableblock halign-left valign-top">优先级</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>srcAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+9</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dstAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+9</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>srcPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dstPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exporterFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+1</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>为上表定义的每个字段添加优先级。
这意味着带有 <code>srcAddress</code> 或 <code>dstAddress</code> 的规则的优先级至少为9，并且始终高于带有 <code>srcPort</code> 或 <code>dstPort</code> 的规则，等等。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/OpenNMS/opennms/blob/develop/features/flows/classification/persistence/api/src/main/java/org/opennms/netmgt/flows/classification/persistence/api/RuleDefinition.java#L52-61">这里</a> 实现了优先级的计算。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
目前无法手动定义优先级。
        可能在以后实现。
        请参阅问题 <a href="https://issues.opennms.org/browse/HZN-1265">HZN-1265</a>。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_验证">27.3.3. 验证</h4>
<div class="paragraph">
<p>使用复杂的规则集合时，验证所有配置是否正确，并不是很容易。
为了使验证更容易，<em>Classification UI</em> 允许测试/验证分类。
为此，请导航至 <em>Classification UI</em>：
<strong>Admin &#8594; Configure OpenNMS &#8594; Manage Flow Classification</strong> 然后选择右上角的 <em>Test Classification</em> 操作。
这允许模拟使用某些字段发送到 <em>Classification Engine</em> 的流。</p>
</div>
</div>
<div class="sect3">
<h4 id="_例子_2">27.3.4. 例子</h4>
<div class="paragraph">
<p>我们假设定义了以下规则:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">srcAddress</th>
<th class="tableblock halign-left valign-top">srcPort</th>
<th class="tableblock halign-left valign-top">dstAddress</th>
<th class="tableblock halign-left valign-top">dstPort</th>
<th class="tableblock halign-left valign-top">protocol</th>
<th class="tableblock halign-left valign-top">exporterFilter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8980</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tcp,udp</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80,8980,8080,9000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">udp,tcp</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exporters</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">categoryName == 'Exporters'</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>以下 flows（流）将发送到 <em>OpenNMS Horizon</em>，并根据上面定义的规则进行相应分类。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flow（流）</th>
<th class="tableblock halign-left valign-top">分类</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocol: tcp,</p>
<p class="tableblock">  srcAddress: 10.0.0.5, srcPort: 60123,</p>
<p class="tableblock">  dstAddress: 54.246.188.65, dstPort: 80,</p>
<p class="tableblock">  exporterAddress: 10.0.0.55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocol: tcp,</p>
<p class="tableblock">  srcAddress: 10.0.0.5, srcPort: 60123,</p>
<p class="tableblock">  dstAddress: 54.246.188.65, dstPort: 443,</p>
<p class="tableblock">  exporterAddress: 10.0.0.55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>https</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocol: tcp,</p>
<p class="tableblock">  srcAddress: 10.0.0.5, srcPort: 60123,</p>
<p class="tableblock">  dstAddress: 10.0.0.1, dstPort: 8980,</p>
<p class="tableblock">  exporterAddress: 10.0.0.55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenNMS</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-kafka-producer">28. Kafka Producer</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2">28.1. Overview</h3>
<div class="paragraph">
<p>The <em>Kafka Producer feature</em> allows events, alarms, nodes and metrics from <em>OpenNMS Horizon</em> to be forwarded to <em>Kafka</em>.</p>
</div>
<div class="paragraph">
<p>These objects are stored in different topics and the payloads are encoded using <a href="https://developers.google.com/protocol-buffers/">Google Protocol Buffers (GPB)</a>.
See <code>opennms-kafka-producer.proto</code> and <code>collectionset.proto</code> in the corresponding source distribution for the model definitions.</p>
</div>
<div class="sect3">
<h4 id="_events">28.1.1. Events</h4>
<div class="paragraph">
<p>The <em>Kafka Producer</em> listens for all events on the event bus and forwards these to a <em>Kafka</em> topic.
The records are keyed by event <em>UEI</em> and contain a <em>GPB</em> encoded model of the event.</p>
</div>
<div class="paragraph">
<p>By default, all events are forwarded to a topic named <code>events</code>.</p>
</div>
<div class="paragraph">
<p>The name of the topic used can be configured, and an optional filtering expression can be set to help control which events are sent to the topic.</p>
</div>
</div>
<div class="sect3">
<h4 id="_alarms">28.1.2. Alarms</h4>
<div class="paragraph">
<p>The <em>Kafka Producer</em> listens for changes made to the current set of alarms and forwards the resulting alarms to a <em>Kafka</em> topic.
The records are keyed by alarm reduction key and contain a <em>GPB</em> encoded model of the alarm.
When an alarm is deleted, a <em>null</em> value is sent with the corresponding reduction key.
Publishing records in this fashion allows the topic to be used as a <a href="https://docs.confluent.io/current/streams/concepts.html#ktable">KTable</a>.
The <em>Kafka Producer</em> will also perform periodic synchronization tasks to ensure that the contents of the Kafka topic reflect the current state of alarms in the <em>OpenNMS Horizon</em> database.</p>
</div>
<div class="paragraph">
<p>By default, all alarms (and subsequent updates) are forwarded to a topic named <code>alarms</code>.</p>
</div>
<div class="paragraph">
<p>The name of the topic used can be configured, and an optional filtering expression can be set to help control which alarms are sent to the topic.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nodes">28.1.3. Nodes</h4>
<div class="paragraph">
<p>If an event or alarm being forwarded reference a node, then the corresponding node is also forwarded.
The records are keyed by "node criteria" (see bellow) and contain a <em>GPB</em> encoded model of the alarm.
A caching mechanism is in place to help avoid forwarding nodes that have been successfully forwarded, and have not changed since.</p>
</div>
<div class="paragraph">
<p>The name of the topic used can be configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The node topic is not intended to include all of the nodes in the system, it only includes records for nodes that relate to events or alarms that have been forwarded.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_node_criteria">Node Criteria</h5>
<div class="paragraph">
<p>The <em>node criteria</em> is a string representation of the unique identifier for a given node.
If the node is associated with a <em>foreign source (fs)</em>  and <em>foreign id (fid)</em>, the node criteria resulting node criteria will be the name of the <em>foreign source</em>, followed by a colon (:) and then the foreign id i.e. (fs:fid).
If the node is not associated with both a <em>foreign source</em> and <em>foreign id</em>, then the node id (database id) will be used.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_metrics">28.1.4. Metrics</h4>
<div class="paragraph">
<p>The <em>Kafka Producer</em> can be used to write metrics to <em>Kafka</em> either exclusively, or in addition to an existing persistence strategy i.e. RRD or Newts.
The metrics are written in the form of "collection sets" which correspond to the internal representation used by the existing collectors and persistence strategies.
The records are keyed by Node ID or by IP Address if no Node ID is available and contain a <em>GPB</em> encoded version of the collection sets.
The records are keyed in this fashion to help ensure that collection sets related to the same resources are written to the same partitions.</p>
</div>
<div class="paragraph">
<p>When enabled (this functionality is disabled by default), the metrics are written to a topic named <code>metrics</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When exclusively writing to <em>Kafka</em>, no metrics or resource graphs will be available on the <em>OpenNMS Horizon</em> instance.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_the_kafka_producer">28.2. Enabling the Kafka Producer</h3>
<div class="paragraph">
<p>The <em>Kafka Producer</em> is disabled by default and can be enabled as follows.</p>
</div>
<div class="paragraph">
<p>First, login to the <em>Karaf</em> shell of your <em>OpenNMS Horizon</em> instance and configure the <em>Kafka</em> client settings to point to your <em>Kafka</em> broker.
See <a href="https://kafka.apache.org/10/documentation.html#producerconfigs">Producer Configs</a> for a complete list of available options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.features.kafka.producer.client
admin@opennms()&gt; config:property-set bootstrap.servers 127.0.0.1:9092
admin@opennms()&gt; config:update</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, install the <code>opennms-kafka-producer</code> feature from that same shell using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>admin@opennms()&gt; feature:install opennms-kafka-producer</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to ensure that the feature continues to be installed as subsequent restarts, add <code>opennms-kafka-producer</code> to the <code>featuresBoot</code> property in the <code>${OPENNMS_HOME}/etc/org.apache.karaf.features.cfg</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_kafka_producer">28.3. Configuring the Kafka Producer</h3>
<div class="paragraph">
<p>The <em>Kafka Producer</em> exposes the following options to help fine tune its behavior.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eventTopic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic used for events.
                                                   Set this to an empty string to disable forwarding events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alarmTopic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alarms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic used for alarms.
                                                   Set this to an empty string to disable forwarding alarms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodeTopic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic used for nodes.
                                                   Set this to an empty string to disable forwarding nodes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metricTopic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic used for metrics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eventFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>Spring SpEL expression</em> (see bellow) used to filter events.
                                                   Set this to an empty string to disable filtering, and forward all events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alarmFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>Spring SpEL expression</em> (see bellow) used to filter alarms.
                                                   Set this to an empty string to disable filtering, and forward all alarms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forward.metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this value to <code>true</code> to enable forwarding of metrics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nodeRefreshTimeoutMs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300000</code> (5 minutes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds to wait before looking up a node in the database again.
                                                   Decrease this value to improve accuracy at the cost of additional database look ups.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alarmSyncIntervalMs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300000</code> (5 minutes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of milliseconds at which the contents of the alarm topic will be synchronized with the local database.
                                                   Decrease this to improve accuracy at the cost of additional database look ups.
                                                   Set this value to 0 to disable alarm synchronization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>suppressIncrementalAlarms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suppresses forwarding alarms that differ only by count or last event time.
                                                   Set this to <code>false</code> to prevent suppressing these alarms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafkaSendQueueCapacity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The capacity for the queue of Kafka messages that is used when a Kafka message is pushed but Kafka is unavailable.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_configuring_filtering">28.3.1. Configuring Filtering</h4>
<div class="paragraph">
<p>Filtering can be used to selectively forward events and/or alarms to the <em>Kafka</em> topics.</p>
</div>
<div class="paragraph">
<p>Filtering is performed using a <a href="https://docs.spring.io/spring/docs/4.2.9.RELEASE/spring-framework-reference/html/expressions.html">Spring SpEL expression</a> which is evaluated against each object to determine if it should be forwarded.
The expression must return a boolean value i.e. <code>true</code> or <code>false</code>.</p>
</div>
<div class="sect4">
<h5 id="_enabling_event_filtering">Enabling Event Filtering</h5>
<div class="paragraph">
<p>To enable event filtering, set the value of the <code>eventFilter</code> property to a valid <em>SpEL expression</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.features.kafka.producer
admin@opennms()&gt; config:property-set eventFilter 'getUei().equals("uei.opennms.org/internal/discovery/newSuspect")'
admin@opennms()&gt; config:update</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the filter is configured such that only events with the given <em>UEI</em> are forwarded.
Consult the source code of the <code>org.opennms.netmgt.xml.event.OnmsEvent</code> class in your distribution for a complete list of available properties.</p>
</div>
</div>
<div class="sect4">
<h5 id="_enabling_alarm_filtering">Enabling Alarm Filtering</h5>
<div class="paragraph">
<p>To enable alarm filtering, set the value of the <code>alarmFilter</code> property to a valid <em>SpEL expression</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.features.kafka.producer
admin@opennms()&gt; config:property-set alarmFilter 'getTTicketId() != null'
admin@opennms()&gt; config:update</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the filter is configured such that only alarms that are associated with a <em>ticket id</em> are forwarded.
Consult the source code of the <code>org.opennms.netmgt.model.OnmsAlarm</code> class in your distribution for a complete list of available properties.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_metric_forwarding">28.3.2. Enabling Metric Forwarding</h4>
<div class="paragraph">
<p>To enable metric forward, set the value of the <code>forward.metrics</code> property to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.features.kafka.producer
admin@opennms()&gt; config:property-set forward.metrics true
admin@opennms()&gt; config:update</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_enabling_exclusive_metric_forwarding">Enabling Exclusive Metric Forwarding</h5>
<div class="paragraph">
<p>Once metric forwarding is enabled, you can use this as the exclusive persistence strategy as follows by setting the following system property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-sh" data-lang="sh">echo 'org.opennms.timeseries.strategy=osgi' &gt; "$OPENNMS_HOME/etc/opennms.properties.d/kafka-for-metrics.properties"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_topic_names">28.3.3. Configuring Topic Names</h4>
<div class="paragraph">
<p>By default three topics are created i.e. <code>events</code>, <code>alarms</code>, <code>nodes</code>.
To change these, you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.features.kafka.producer
admin@opennms()&gt; config:property-set eventTopic ""
admin@opennms()&gt; config:property-set nodeTopic "opennms-nodes"
admin@opennms()&gt; config:update</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, we disable event forwarding by setting an empty topic name and change the node topic name to <code>opennms-nodes</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_shell_commands">28.4. Shell Commands</h3>
<div class="paragraph">
<p>The <em>Kafka Producer</em> also provides a series of shell commands to help administering and debugging the service.</p>
</div>
<div class="sect3">
<h4 id="_kafka_producerlist_alarms">28.4.1. kafka-producer:list-alarms</h4>
<div class="paragraph">
<p>The <code>list-alarms</code> command can be used to enumerate the reduction keys and show the associated event labels for the alarms that are present in the topic.
This command leverages functionality used by the alarm synchronization process, and as a result this must be enabled in for this command to function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms&gt; kafka-producer:list-alarms
uei.opennms.org/alarms/trigger:n33:0.0.0.0:HTTPS_POOLs
        Alarm: Generic Trigger</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_producersync_alarms">28.4.2. kafka-producer:sync-alarms</h4>
<div class="paragraph">
<p>The <code>sync-alarms</code> command can be used to manually trigger the alarm synchronization process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms&gt; kafka-producer:sync-alarms
Performing synchronization of alarms from the database with those in the ktable.
Executed 1 updates in 47ms.

Number of reduction keys in ktable: 4
Number of reduction keys in the db: 4 (4 alarms total)
Reduction keys added to the ktable: (None)
Reduction keys deleted from the ktable: (None)
Reduction keys updated in the ktable:
        uei.opennms.org/nodes/nodeLostService::1:127.0.0.1:Minion-RPC</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kafka_producerevaluate_filter">28.4.3. kafka-producer:evaluate-filter</h4>
<div class="paragraph">
<p>The <code>evaluate-filter</code> command can be used to test arbitrary <em>SpEL</em> filtering expressions against alarms or events.</p>
</div>
<div class="sect4">
<h5 id="_evaluating_filters_against_alarms">Evaluating filters against alarms</h5>
<div class="paragraph">
<p>To test a filter against an alarm, specify the database id of the alarm and the expression to test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>admin@opennms&gt; kafka-producer:evaluate-filter --alarm-id 57 "getReductionKey().contains('n33')"
SPEL Expression: getReductionKey().contains('n33')
Alarm with ID 57 has reduction key: uei.opennms.org/alarms/trigger:n33:0.0.0.0:HTTPS_POOLs
Result: true</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_evaluating_filters_against_events">Evaluating filters against events</h5>
<div class="paragraph">
<p>To test a filter against an event, specify the <em>UEI</em> of the event and the expression to test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>admin@opennms&gt; kafka-producer:evaluate-filter --event-uei uei.opennms.org/alarms/trigger "getUei().contains('alarm')"
SPEL Expression: getUei().contains('alarm')
Event has UEI: uei.opennms.org/alarms/trigger
Result: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, a new event will be created with the given <em>UEI</em>, and the filter will be evaluated against this new event object.
At this time, existing events cannot be referenced by this tool, so this functionality only serves to help make sure the expressions are syntactically valid.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ga-alarm-correlation">29. Alarm Correlation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ga-situation-feedback">29.1. Situation Feedback</h3>
<div class="sect3">
<h4 id="_introduction">29.1.1. Introduction</h4>
<div class="paragraph">
<p>Situation Feedback allows operators to provide real time feedback on Alarm Correlation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_installation_2">29.1.2. Installation</h4>
<div class="paragraph">
<p>Situation Feedback needs to be enabled by installing the feature from the Karaf shell:</p>
</div>
<div class="paragraph">
<p><code>feature:install opennms-situation-feedback</code></p>
</div>
<div class="paragraph">
<p>In order to ensure that the feature continues to be installed as subsequent restarts, add <code>opennms-situation-feedback</code> to the <code>featuresBoot</code> property in the <code>${OPENNMS_HOME}/etc/org.apache.karaf.features.cfg</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_requirements">29.1.3. Requirements</h4>
<div class="paragraph">
<p>The feature requires Elasticsearch to persist the feeback records.</p>
</div>
<div class="sect4">
<h5 id="_configuration_elasticsearch_persistence">Configuration Elasticsearch persistence</h5>
<div class="paragraph">
<p>From a Karaf shell on your <em>OpenNMS Horizon</em> instance, start by configuring the Situation Feedback persistence to use your Elasticsearch cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>$ ssh -p 8101 admin@localhost
...
admin@opennms()&gt; config:edit org.opennms.features.situation-feedback.persistence.elastic
admin@opennms()&gt; config:property-set elasticUrl http://elastic:9200
admin@opennms()&gt; config:update</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This configuration is stored in <code>${OPENNMS_HOME/etc/org.opennms.features.situation-feedback.persistence.elastic.cfg</code>.
      See <a href="#ga-elasticsearch-integration">Elasticsearch Integration</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Installing the feature exposes a ReST endpoint that <em>OpenNMS Helm</em> uses to display and submit feedback.</p>
</div>
<div class="paragraph">
<p>Further information on the ReST API can be found in the <a href="#gs-situation-feedback">Developer Guide</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Wikipedia LLDP: <a href="https://en.wikipedia.org/wiki/Link_Layer_Discovery_Protocol" class="bare">https://en.wikipedia.org/wiki/Link_Layer_Discovery_Protocol</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
 OpenNMS Horizon 23.0.1<br>
Last updated 2018-12-22 11:30:11 CST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>